<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Nashville Winter Resources</title>
  <link rel="icon" type="image/png" href="https://substackcdn.com/image/fetch/w_80,h_80,c_fill,f_png,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4253394d-9735-40dd-961c-daa685b93262_1024x1024.png">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Fonts for Alerts Feed -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Text scaling - adjustable via JS */
      --text-scale: 1;

      /* Core colors - improved contrast */
      --color-bg-primary: #1a1a2e;
      --color-bg-secondary: #16213e;
      --color-bg-tertiary: #0f3460;

      /* Text colors - WCAG AA compliant on dark backgrounds */
      --color-text-primary: #ffffff;
      --color-text-secondary: #c8d3e0;  /* Improved from #94a3b8 - now 7:1 contrast */
      --color-text-muted: #9badc4;       /* Improved from #64748b - now 5.5:1 contrast */

      /* Accent colors */
      --color-accent-red: #e63946;
      --color-accent-red-hover: #f1404e;
      --color-accent-blue: #60a5fa;
      --color-accent-green: #10b981;
      --color-accent-orange: #fb923c;    /* Improved from #f97316 */
      --color-accent-cyan: #67e8f9;      /* Improved from #38bdf8 */

      /* Interactive surfaces */
      --color-surface: rgba(255, 255, 255, 0.08);
      --color-surface-hover: rgba(255, 255, 255, 0.15);
      --color-border: rgba(255, 255, 255, 0.15);

      /* Focus ring */
      --color-focus: #60a5fa;
    }

    /* Text size variants */
    html.text-small { --text-scale: 0.9; }
    html.text-normal { --text-scale: 1; }
    html.text-large { --text-scale: 1.15; }
    html.text-xlarge { --text-scale: 1.3; }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
      font-size: calc(16px * var(--text-scale));
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--color-bg-primary) 0%, var(--color-bg-secondary) 50%, var(--color-bg-tertiary) 100%);
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1.5rem 1rem;
      padding-top: max(1.5rem, env(safe-area-inset-top));
      padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
      padding-left: max(1rem, env(safe-area-inset-left));
      padding-right: max(1rem, env(safe-area-inset-right));
      color: var(--color-text-primary);
      -webkit-text-size-adjust: 100%;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    @media (max-width: 360px) {
      body {
        padding: 1rem 0.75rem;
        padding-top: max(1rem, env(safe-area-inset-top));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    }
    
    /* Top bar - language left, a11y right */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }

    .lang-select {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .a11y-toggle {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      min-height: 44px;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      touch-action: manipulation;
      flex-shrink: 0;
    }

    .a11y-toggle:hover {
      background: rgba(255, 255, 255, 0.12);
      color: var(--color-text-primary);
    }

    .a11y-toggle:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    .a11y-toggle.active {
      background: rgba(255, 255, 255, 0.2);
      color: var(--color-text-primary);
    }

    .lang-btn {
      background: var(--color-surface);
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.75rem;
      min-height: 36px;
      color: var(--color-text-secondary);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    @media (hover: hover) {
      .lang-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        color: var(--color-text-primary);
      }
    }

    .lang-btn:active {
      background: rgba(255, 255, 255, 0.18);
      color: var(--color-text-primary);
      transform: scale(0.97);
    }

    .lang-btn:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    .lang-btn.active {
      background: #3b82f6;
      color: var(--color-text-primary);
    }

    /* Text size controls */
    .text-size-controls {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 0.25rem;
    }

    .text-size-btn {
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      width: 36px;
      height: 36px;
      min-height: 44px;
      min-width: 44px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    .text-size-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-text-primary);
    }

    .text-size-btn:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 1px;
    }

    .text-size-btn.active {
      background: rgba(255, 255, 255, 0.15);
      color: var(--color-text-primary);
    }

    .text-size-btn i {
      font-size: 1.1rem;
    }

    .text-size-label {
      color: var(--color-text-muted);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0 0.35rem;
    }
    
    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .branding {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .app-logo {
      width: 56px;
      height: 56px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .title-group {
      text-align: left;
    }

    [dir="rtl"] .title-group {
      text-align: right;
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    @media (max-width: 360px) {
      h1 {
        font-size: 1.3rem;
      }
    }

    .subtitle {
      color: var(--color-text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* Location button - prominent CTA */
    .location-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      color: white;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
      text-decoration: none;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    .location-btn:hover {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    }

    .location-btn:active {
      transform: scale(0.98);
    }

    .location-btn:focus-visible {
      outline: 2px solid #f87171;
      outline-offset: 2px;
    }

    .location-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Outreach section */
    .outreach {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-border);
    }

    .outreach-label {
      color: var(--color-text-secondary);
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .outreach-number {
      color: var(--color-text-primary);
      font-size: 1rem;
      font-weight: normal;
      text-decoration: none;
    }

    .outreach-number:hover {
      text-decoration: underline;
    }

    .section {
      margin-bottom: 1.25rem;
    }

    .section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-muted);
      margin-bottom: 0.6rem;
      padding-left: 0.25rem;
    }

    .links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    a.link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--color-surface);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      min-height: 52px;
      color: var(--color-text-primary);
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    a.link i {
      font-size: 1.35rem;
      opacity: 0.85;
      flex-shrink: 0;
    }

    @media (hover: hover) {
      a.link:hover {
        background: var(--color-surface-hover);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
    }

    a.link:active {
      background: rgba(255, 255, 255, 0.18);
      transform: scale(0.98);
    }

    a.link:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }
    
    .featured {
      background: linear-gradient(135deg, #e63946 0%, #d62839 100%);
      border-color: transparent;
      font-weight: 600;
    }

    @media (hover: hover) {
      .featured:hover {
        background: linear-gradient(135deg, #f1404e 0%, #e63946 100%);
        border-color: transparent;
      }
    }

    .featured:active {
      background: linear-gradient(135deg, #d62839 0%, #c41e2e 100%);
    }

    .featured i {
      opacity: 1;
    }

    /* Emergency Link - Subtle utility style */
    .emergency-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: #f87171;
      font-size: 0.85rem;
      font-weight: 500;
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: all 0.15s ease;
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.2);
    }

    .emergency-link i {
      font-size: 1rem;
    }

    .emergency-link:hover {
      background: rgba(248, 113, 113, 0.2);
      color: #fca5a5;
    }

    .emergency-link:active {
      transform: scale(0.98);
    }

    .emergency-link:focus-visible {
      outline: 2px solid #f87171;
      outline-offset: 2px;
    }

    .header-utility {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    [dir="rtl"] .header-utility {
      justify-content: flex-start;
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.25rem;
      padding-bottom: 0.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--color-text-muted);
      font-size: 0.8rem;
    }

    [dir="rtl"] a.link {
      flex-direction: row-reverse;
      text-align: right;
    }

    [dir="rtl"] .section-title {
      padding-left: 0;
      padding-right: 0.25rem;
      text-align: right;
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        transform: none !important;
      }
      html {
        scroll-behavior: auto;
      }
    }

    @supports (-webkit-touch-callout: none) {
      body {
        min-height: -webkit-fill-available;
      }
    }

    /* Weather Forecast Styles */
    .forecast-section {
      margin-bottom: 1.25rem;
    }

    .forecast-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.6rem;
      gap: 0.5rem;
    }

    .forecast-header .section-title {
      margin-bottom: 0;
    }

    .zip-input-wrapper {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 0.35rem 0.5rem;
    }

    .zip-input-wrapper i {
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }

    #zipInput {
      background: transparent;
      border: none;
      outline: none;
      color: var(--color-text-primary);
      font-family: inherit;
      font-size: 0.85rem;
      width: 50px;
      letter-spacing: 0.05em;
    }

    #zipInput::placeholder {
      color: var(--color-text-muted);
    }

    #fetchBtn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--color-text-secondary);
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    #fetchBtn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--color-text-primary);
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
    }

    .day-card {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 0.75rem 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: all 0.2s ease;
    }

    .day-card:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .day-name {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-muted);
      margin-bottom: 0.25rem;
    }

    .day-date {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--color-text-primary);
    }

    .weather-icon {
      font-size: 1.75rem;
      margin-bottom: 0.35rem;
      color: var(--color-accent-blue);
    }

    .condition {
      font-size: 0.65rem;
      color: var(--color-text-secondary);
      margin-bottom: 0.5rem;
      line-height: 1.3;
      min-height: 1.6rem;
    }

    .temps {
      width: 100%;
    }

    .temp-high, .temp-low {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
    }

    .temp-high {
      color: var(--color-accent-orange);
      margin-bottom: 0.15rem;
    }

    .temp-low {
      color: var(--color-accent-cyan);
    }

    .temp-high i, .temp-low i {
      font-size: 0.7rem;
    }

    .forecast-loading, .forecast-error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 2rem 1rem;
      color: var(--color-text-muted);
    }

    .forecast-loading i {
      font-size: 2rem;
      animation: pulse 1.5s ease-in-out infinite;
      margin-bottom: 0.5rem;
      display: block;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .forecast-error {
      color: #f87171;
    }

    .forecast-error i {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .location-display {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      text-align: center;
      margin-bottom: 0.5rem;
      min-height: 1rem;
    }

    @media (max-width: 400px) {
      .forecast-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .day-card:nth-child(4),
      .day-card:nth-child(5) {
        grid-column: span 1;
      }
      .forecast-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      /* Center last 2 cards */
      .forecast-grid::after {
        content: '';
        grid-column: span 1;
      }
    }

    @media (max-width: 320px) {
      .forecast-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    [dir="rtl"] .forecast-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .zip-input-wrapper {
      flex-direction: row-reverse;
    }

    /* Weather Alert Styles */
    .alerts-container {
      margin-bottom: 1rem;
    }

    .alert-banner {
      padding: 0.75rem 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      animation: slideDown 0.4s ease-out;
      border-radius: 12px;
      margin-bottom: 0.5rem;
    }

    .alert-banner.severity-extreme {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
    }

    .alert-banner.severity-severe {
      background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    }

    .alert-banner.severity-moderate {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    }

    .alert-banner.severity-minor {
      background: linear-gradient(135deg, #ca8a04 0%, #a16207 100%);
    }

    .alert-banner.severity-unknown {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .alert-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
      animation: pulse-alert 2s ease-in-out infinite;
    }

    @keyframes pulse-alert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .alert-content {
      flex: 1;
      min-width: 0;
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.2rem;
    }

    .alert-title {
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.01em;
      color: #fff;
    }

    .alert-severity-badge {
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(0,0,0,0.25);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      color: #fff;
    }

    .alert-description {
      font-size: 0.8rem;
      opacity: 0.95;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      white-space: pre-wrap;
      color: #fff;
    }

    .alert-meta {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.35rem;
      font-size: 0.7rem;
      opacity: 0.85;
      color: #fff;
      flex-wrap: wrap;
    }

    .alert-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .alert-dismiss {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
      min-height: 44px;
      min-width: 44px;
    }

    .alert-dismiss:hover {
      background: rgba(0,0,0,0.35);
    }

    .alert-expand-btn {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.7rem;
      cursor: pointer;
      margin-top: 0.35rem;
      transition: background 0.2s;
    }

    .alert-expand-btn:hover {
      background: rgba(0,0,0,0.35);
    }

    .alert-description.expanded {
      -webkit-line-clamp: unset;
    }

    .no-alerts {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #10b981;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .no-alerts i {
      font-size: 1.1rem;
    }

    .alerts-loading {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--color-text-muted);
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    /* Cold Weather Shelter Alert Banner */
    .shelter-alert-banner {
      background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
      border: 2px solid #60a5fa;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      animation: slideDown 0.4s ease-out, pulseGlow 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 15px rgba(96, 165, 250, 0.3); }
      50% { box-shadow: 0 0 25px rgba(96, 165, 250, 0.6); }
    }

    .shelter-alert-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #60a5fa, #a78bfa, #60a5fa);
      background-size: 200% 100%;
      animation: shimmer 2s linear infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .shelter-alert-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .shelter-alert-icon {
      font-size: 1.75rem;
      color: #fbbf24;
      animation: pulse-alert 2s ease-in-out infinite;
    }

    .shelter-alert-title-group {
      flex: 1;
    }

    .shelter-alert-date {
      display: inline-block;
      background: #fbbf24;
      color: #1e3a5f;
      font-size: 0.7rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .shelter-alert-title {
      font-size: 1rem;
      font-weight: 700;
      color: #fff;
      line-height: 1.3;
    }

    .shelter-alert-status {
      background: #dc2626;
      color: #fff;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      animation: pulse-alert 2s ease-in-out infinite;
      white-space: nowrap;
    }

    .shelter-alert-body {
      color: rgba(255,255,255,0.95);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .shelter-alert-details {
      display: grid;
      gap: 0.5rem;
      margin: 0.75rem 0;
    }

    .shelter-detail-item {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .shelter-detail-item i {
      color: #60a5fa;
      font-size: 1rem;
      margin-top: 0.1rem;
      flex-shrink: 0;
    }

    .shelter-alert-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .shelter-cta-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
    }

    .shelter-cta-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-1px);
    }

    .shelter-cta-btn.primary {
      background: #fbbf24;
      border-color: #fbbf24;
      color: #1e3a5f;
    }

    .shelter-cta-btn.primary:hover {
      background: #fcd34d;
    }

    .shelter-primary-note {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.5rem;
      font-style: italic;
    }

    /* Power Outage Styles */
    .outages-container {
      margin-bottom: 1rem;
    }

    .outage-banner {
      padding: 0.75rem 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      animation: slideDown 0.4s ease-out;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
    }

    .outage-banner.assigned {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }

    .outage-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
    }

    .outage-icon.unassigned {
      animation: pulse-alert 2s ease-in-out infinite;
    }

    .outage-content {
      flex: 1;
      min-width: 0;
    }

    .outage-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.2rem;
    }

    .outage-title {
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.01em;
      color: #fff;
    }

    .outage-status-badge {
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(0,0,0,0.25);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      color: #fff;
    }

    .outage-description {
      font-size: 0.8rem;
      opacity: 0.95;
      line-height: 1.4;
      color: #fff;
    }

    .outage-meta {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.35rem;
      font-size: 0.7rem;
      opacity: 0.85;
      color: #fff;
      flex-wrap: wrap;
    }

    .outage-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .outage-dismiss {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
      min-height: 44px;
      min-width: 44px;
    }

    .outage-dismiss:hover {
      background: rgba(0,0,0,0.35);
    }

    .no-outages {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #10b981;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .no-outages i {
      font-size: 1.1rem;
    }

    .outages-loading {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--color-text-muted);
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .outage-link {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: rgba(255,255,255,0.9);
      font-size: 0.7rem;
      text-decoration: none;
      margin-top: 0.35rem;
      padding: 0.2rem 0.5rem;
      background: rgba(0,0,0,0.15);
      border-radius: 4px;
      transition: background 0.2s;
    }

    .outage-link:hover {
      background: rgba(0,0,0,0.3);
      color: #fff;
    }

    .outages-summary {
      background: rgba(124, 58, 237, 0.15);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
    }

    .outages-summary-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .outages-summary-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--color-text-primary);
    }

    .outages-summary-title i {
      color: #a78bfa;
    }

    .outages-summary-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      margin-top: 0.35rem;
    }

    .outages-summary-link {
      font-size: 0.75rem;
      color: #a78bfa;
      text-decoration: none;
    }

    .outages-summary-link:hover {
      text-decoration: underline;
    }

    .outage-nearby-badge {
      font-size: 0.55rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      background: #10b981;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      color: #fff;
    }

    .outage-section-header {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      margin: 0.75rem 0 0.4rem 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      user-select: none;
    }

    .outage-section-header:hover {
      color: var(--color-text-primary);
    }

    .outage-section-header i {
      font-size: 0.9rem;
      color: #a78bfa;
    }

    .outage-section-header .toggle-icon {
      margin-left: auto;
      transition: transform 0.2s ease;
    }

    .outage-section-header.collapsed .toggle-icon {
      transform: rotate(-90deg);
    }

    .outage-list-container {
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.2s ease;
    }

    .outage-list-container.collapsed {
      max-height: 0 !important;
      opacity: 0;
    }

    .outage-more-text {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      text-align: center;
      padding: 0.5rem;
    }

    .outage-banner.nearby {
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .outage-location-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .outage-location-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: rgba(124, 58, 237, 0.15);
      border: 1px solid rgba(124, 58, 237, 0.3);
      color: #a78bfa;
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .outage-location-btn:hover {
      background: rgba(124, 58, 237, 0.25);
      color: #c4b5fd;
    }

    .outage-location-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .outage-location-btn i {
      font-size: 0.9rem;
    }

    .outage-location-status {
      font-size: 0.7rem;
      color: var(--color-text-muted);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .outage-location-status.success {
      color: #10b981;
    }

    .outage-location-status.error {
      color: #f87171;
    }

    .alerts-loading i {
      font-size: 1.1rem;
      animation: pulse 1.5s ease-in-out infinite;
    }

    [dir="rtl"] .alert-banner {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .alert-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .alert-meta {
      flex-direction: row-reverse;
    }

    /* Outage Map Preview Styles */
    .map-preview-section {
      margin-top: 1rem;
    }

    .map-preview-container {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 12px;
      overflow: hidden;
    }

    .map-preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid var(--color-border);
    }

    .map-preview-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .map-preview-title i {
      color: var(--color-accent-blue);
    }

    .map-expand-btn {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: var(--color-accent-blue);
      border: none;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: white;
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      min-height: 36px;
    }

    .map-expand-btn:hover {
      background: #3b82f6;
    }

    .map-expand-btn:active {
      transform: scale(0.98);
    }

    .map-preview-wrapper {
      position: relative;
      height: 200px;
    }

    #outageMapPreview {
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .map-preview-legend {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(30, 41, 59, 0.95);
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 0.7rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    [dir="rtl"] .map-preview-legend {
      left: auto;
      right: 10px;
    }

    .map-legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      color: #e2e8f0;
    }

    .map-legend-item:last-child {
      margin-bottom: 0;
    }

    .map-legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .map-legend-dot.red { background: #f87171; }
    .map-legend-dot.yellow { background: #fbbf24; }
    .map-legend-dot.green { background: #4ade80; }
    .map-legend-dot.blue { background: #60a5fa; }
    .map-legend-dot.orange { background: #f97316; }

    .map-preview-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1px;
      background: var(--color-border);
    }

    .map-stat {
      background: var(--color-bg-secondary);
      padding: 0.6rem;
      text-align: center;
    }

    .map-stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .map-stat-value.red { color: #f87171; }
    .map-stat-value.yellow { color: #fbbf24; }
    .map-stat-value.green { color: #4ade80; }

    .map-stat-label {
      font-size: 0.65rem;
      color: var(--color-text-muted);
      margin-top: 2px;
    }

    /* Fullscreen Map Modal */
    .map-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
      background: var(--color-bg-primary);
    }

    .map-modal.active {
      display: flex;
      flex-direction: column;
    }

    .map-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--color-bg-secondary);
      border-bottom: 1px solid var(--color-border);
      flex-shrink: 0;
    }

    .map-modal-title {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .map-modal-title i {
      color: var(--color-accent-blue);
    }

    .map-modal-close {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      color: var(--color-text-primary);
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s ease;
      font-size: 1.25rem;
    }

    .map-modal-close:hover {
      background: var(--color-surface-hover);
    }

    .map-modal-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1px;
      background: var(--color-border);
      flex-shrink: 0;
    }

    .map-modal-stat {
      background: var(--color-bg-secondary);
      padding: 12px;
      text-align: center;
    }

    .map-modal-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .map-modal-stat-value.red { color: #f87171; }
    .map-modal-stat-value.yellow { color: #fbbf24; }
    .map-modal-stat-value.green { color: #4ade80; }

    .map-modal-stat-label {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-top: 4px;
    }

    .map-modal-body {
      flex: 1;
      position: relative;
      min-height: 0;
    }

    #outageMapFull {
      width: 100%;
      height: 100%;
    }

    .map-modal-legend {
      position: absolute;
      bottom: 80px;
      left: 10px;
      z-index: 1000;
      background: rgba(30, 41, 59, 0.95);
      border-radius: 8px;
      padding: 12px;
      font-size: 0.8rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    [dir="rtl"] .map-modal-legend {
      left: auto;
      right: 10px;
    }

    .map-modal-legend-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #94a3b8;
    }

    .map-modal-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      color: #e2e8f0;
    }

    .map-modal-legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .map-modal-legend-dot.red { background: #f87171; }
    .map-modal-legend-dot.yellow { background: #fbbf24; }
    .map-modal-legend-dot.green { background: #4ade80; }
    .map-modal-legend-dot.blue { background: #60a5fa; }
    .map-modal-legend-dot.orange { background: #f97316; }

    .map-modal-footer {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1px;
      background: var(--color-border);
      flex-shrink: 0;
    }

    .map-modal-action {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 16px;
      background: var(--color-bg-secondary);
      border: none;
      color: var(--color-text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .map-modal-action:hover {
      background: var(--color-surface-hover);
    }

    .map-modal-action.primary {
      background: var(--color-accent-blue);
      color: white;
    }

    .map-modal-action.primary:hover {
      background: #3b82f6;
    }

    /* Leaflet popup customization */
    .leaflet-popup-content-wrapper {
      background: #1e293b;
      color: #f1f5f9;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .leaflet-popup-tip {
      background: #1e293b;
    }

    .outage-popup {
      padding: 4px;
    }

    .outage-popup-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .outage-popup-status.assigned {
      background: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    .outage-popup-status.unassigned {
      background: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    .outage-popup-status.working {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .outage-popup-info {
      font-size: 0.875rem;
      color: #94a3b8;
      line-height: 1.5;
    }

    .warming-center-icon {
      background: #2563eb;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .warming-popup-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #f1f5f9;
    }

    .warming-popup-status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      background: rgba(74, 222, 128, 0.2);
      color: #4ade80;
      margin-bottom: 6px;
    }

    .warming-popup-status.unconfirmed {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    @media (max-width: 400px) {
      .map-preview-header {
        flex-direction: column;
        gap: 0.5rem;
        align-items: stretch;
      }

      .map-expand-btn {
        justify-content: center;
      }

      .map-stat-value {
        font-size: 1rem;
      }

      .map-modal-stat-value {
        font-size: 1.25rem;
      }
    }

    /* ==========================================
       UX REVAMP - Intent-Based Navigation
       ========================================== */

    /* Emergency Button - Green Gradient */
    .location-btn.green-style {
      background: linear-gradient(135deg, #16a34a, #15803d);
      box-shadow: 0 2px 8px rgba(22, 163, 74, 0.3);
      width: 100%;
      justify-content: center;
      padding: 0.875rem 1.5rem;
      border-radius: 24px;
    }

    .location-btn.green-style:hover {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4);
    }

    /* Critical Alert Card */
    .critical-card {
      background: linear-gradient(135deg, #1e1e2e, #252538);
      border: 1px solid #3b3b5c;
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1.25rem;
    }

    .critical-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .critical-label {
      background: #7c3aed;
      color: #fff;
      font-size: 0.625rem;
      font-weight: 700;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-badge {
      background: #065f46;
      color: #34d399;
      font-size: 0.6875rem;
      font-weight: 600;
      padding: 0.25rem 0.625rem;
      border-radius: 12px;
    }

    .critical-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .critical-address {
      color: #a0a0b0;
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }

    .critical-details {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .detail-chip {
      background: #2a2a3c;
      padding: 0.375rem 0.625rem;
      border-radius: 8px;
      font-size: 0.75rem;
      color: #c0c0d0;
    }

    .critical-actions {
      display: flex;
      gap: 0.625rem;
    }

    .action-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 10px;
      border: none;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      text-decoration: none;
      transition: all 0.15s ease;
      min-height: 44px;
    }

    .action-btn.primary {
      background: #2563eb;
      color: #fff;
    }

    .action-btn.primary:hover {
      background: #3b82f6;
    }

    .action-btn.secondary {
      background: #1f1f2e;
      border: 1px solid #3b3b5c;
      color: #fff;
    }

    .action-btn.secondary:hover {
      background: #2a2a3c;
    }

    /* Compact Status Row */
    .status-row {
      display: flex;
      gap: 0.625rem;
      margin-bottom: 1.25rem;
    }

    .status-card {
      flex: 1;
      background: #1a1a24;
      border: 1px solid #2a2a3c;
      border-radius: 12px;
      padding: 0.75rem;
    }

    .status-card h4 {
      font-size: 0.6875rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.375rem;
      font-weight: 600;
    }

    .status-value {
      font-size: 1.25rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .status-value.alert {
      color: #f97316;
    }

    .status-sub {
      font-size: 0.6875rem;
      color: #666;
      margin-top: 0.125rem;
    }

    .expand-link {
      font-size: 0.6875rem;
      color: #60a5fa;
      text-decoration: none;
      display: inline-block;
      margin-top: 0.375rem;
    }

    .expand-link:hover {
      text-decoration: underline;
    }

    /* Weather Alert Inline */
    .weather-alert-inline {
      background: #1c1917;
      border-left: 3px solid #f97316;
      padding: 0.75rem 0.875rem;
      border-radius: 8px;
      margin-bottom: 1.25rem;
      font-size: 0.8125rem;
    }

    .weather-alert-inline strong {
      color: #fb923c;
    }

    .weather-alert-inline span {
      color: #a0a0a0;
    }

    /* Tab Bar */
    .tab-bar {
      display: flex;
      gap: 0;
      margin-bottom: 1.25rem;
      background: #1a1a24;
      border-radius: 12px;
      padding: 0.25rem;
    }

    .tab-btn {
      flex: 1;
      padding: 0.625rem;
      border: none;
      background: transparent;
      color: #888;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.15s ease;
      min-height: 44px;
    }

    .tab-btn.active {
      background: #2a2a3c;
      color: #fff;
    }

    .tab-btn:hover:not(.active) {
      color: #ccc;
    }

    /* Section Label */
    .section-label {
      font-size: 0.75rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.75rem;
      margin-top: 0.5rem;
    }

    /* Intent Navigation */
    .intent-grid {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
      margin-bottom: 1.5rem;
    }

    .intent-card {
      background: #12121a;
      border: 1px solid #2a2a3c;
      border-radius: 14px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .intent-card:hover, .intent-card.expanded {
      border-color: #3b5998;
      background: #1a1a28;
    }

    .intent-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .intent-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .intent-icon {
      width: 2.5rem;
      height: 2.5rem;
      background: #1f2937;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .intent-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .intent-count {
      font-size: 0.75rem;
      color: #888;
      margin-top: 0.125rem;
    }

    .intent-arrow {
      color: #666;
      font-size: 1.125rem;
      transition: transform 0.2s;
    }

    .intent-card.expanded .intent-arrow {
      transform: rotate(90deg);
    }

    /* Expanded Resource List */
    .resource-list {
      margin-top: 0.875rem;
      padding-top: 0.875rem;
      border-top: 1px solid #2a2a3c;
      display: none;
    }

    .intent-card.expanded .resource-list {
      display: block;
    }

    .resource-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid #1f1f2a;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .resource-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .resource-info {
      flex: 1 1 60%;
      min-width: 250px;
    }

    .resource-info h5 {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .resource-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .resource-status {
      font-size: 0.6875rem;
      padding: 0.125rem 0.5rem;
      border-radius: 10px;
      font-weight: 500;
    }

    .resource-status.open {
      background: #064e3b;
      color: #34d399;
    }

    .resource-status.closed {
      background: #450a0a;
      color: #f87171;
    }

    .wttin-verified {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 2px 6px;
      font-size: 0.625rem;
      font-weight: 500;
      background: rgba(59, 130, 246, 0.15);
      color: #93c5fd;
      border-radius: 4px;
      text-decoration: none;
      white-space: nowrap;
    }

    .wttin-verified:hover {
      background: rgba(59, 130, 246, 0.25);
      color: #bfdbfe;
    }

    .resource-hours {
      font-size: 0.6875rem;
      color: #888;
    }

    .resource-address {
      font-size: 0.6875rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .resource-subheader {
      font-size: 0.75rem;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 1rem 0 0.5rem 0;
      margin-top: 0.5rem;
      border-top: 1px solid #1f1f2a;
    }

    .resource-phone {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      background: #1f2937;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.8125rem;
      font-weight: 500;
      white-space: nowrap;
      flex-shrink: 0;
      min-height: 44px;
      transition: background 0.15s ease;
    }

    .resource-phone:hover {
      background: #374151;
    }

    .resource-link {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.8125rem;
      padding: 0.5rem 0;
      min-height: 44px;
    }

    .resource-link:hover {
      text-decoration: underline;
    }

    /* WTTIN Category Link (bottom of intent cards) */
    .wttin-category-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      margin-top: 0.75rem;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.8125rem;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .wttin-category-link:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
      border-color: rgba(59, 130, 246, 0.5);
      text-decoration: none;
    }

    .wttin-category-link i {
      font-size: 0.875rem;
    }

    /* Featured WTTIN Resource Banner */
    .wttin-banner {
      background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%);
      border: 1px solid #3b82f6;
      border-radius: 14px;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
    }

    .wttin-banner-content {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      flex: 1;
      min-width: 0;
    }

    .wttin-banner-icon {
      flex-shrink: 0;
      width: 56px;
      height: 56px;
    }

    .wttin-banner-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    .wttin-banner-text h4 {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.25rem;
    }

    .wttin-banner-text p {
      font-size: 0.8125rem;
      color: #94a3b8;
      margin: 0;
    }

    .wttin-banner-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #3b82f6;
      color: #fff;
      padding: 0.625rem 1rem;
      border-radius: 8px;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      white-space: nowrap;
      flex-shrink: 0;
      min-height: 44px;
      transition: background 0.15s ease, transform 0.15s ease;
    }

    .wttin-banner-link:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .wttin-banner-link i {
      font-size: 1rem;
    }

    @media (max-width: 400px) {
      .wttin-banner {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }

      .wttin-banner-content {
        flex-direction: column;
      }

      .wttin-banner-link {
        justify-content: center;
      }
    }

    /* Warming Locations Section - Time-bound emergency content */
    .warming-locations-section {
      background: linear-gradient(135deg, #7c2d12 0%, #431407 100%);
      border: 2px solid #ea580c;
      border-radius: 16px;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
      box-shadow: 0 0 30px rgba(234, 88, 12, 0.2);
    }

    .warming-locations-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      cursor: pointer;
      user-select: none;
    }

    .warming-header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .warming-toggle-icon {
      font-size: 1.25rem;
      color: #fdba74;
      transition: transform 0.2s ease;
    }

    .warming-locations-section.collapsed .warming-toggle-icon {
      transform: rotate(-90deg);
    }

    .warming-locations-section.collapsed .warming-locations-grid,
    .warming-locations-section.collapsed .warming-locations-footer {
      display: none;
    }

    .warming-locations-section.collapsed .warming-locations-header {
      margin-bottom: 0;
    }

    .warming-locations-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .warming-icon {
      font-size: 1.75rem;
    }

    .warming-locations-title h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #fff;
      margin: 0;
    }

    .warming-subtitle {
      font-size: 0.8125rem;
      color: #fdba74;
      margin-top: 0.125rem;
    }

    .warming-transport-note {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8125rem;
      color: #fed7aa;
      flex-shrink: 0;
    }

    .warming-transport-phone {
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      background: rgba(255,255,255,0.15);
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }

    .warming-locations-grid {
      display: grid;
      gap: 0.75rem;
    }

    .warming-location-card {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 0.875rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .warming-location-card.type-24hr {
      border-left: 3px solid #4ade80;
    }

    .warming-location-card.type-limited {
      border-left: 3px solid #fbbf24;
    }

    .warming-location-card.type-community {
      border-left: 3px solid #60a5fa;
    }

    .warming-location-info h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.25rem;
    }

    .warming-location-hours {
      font-size: 0.8125rem;
      color: #4ade80;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .warming-location-card.type-limited .warming-location-hours {
      color: #fbbf24;
    }

    .warming-location-card.type-community .warming-location-hours {
      color: #60a5fa;
    }

    .warming-location-address {
      font-size: 0.75rem;
      color: #d6d3d1;
    }

    .warming-location-services {
      font-size: 0.75rem;
      color: #a8a29e;
      margin-top: 0.25rem;
    }

    .warming-location-actions {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      flex-shrink: 0;
    }

    .warming-location-link {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      text-decoration: none;
      font-size: 1rem;
    }

    .warming-location-link:hover {
      background: rgba(255,255,255,0.2);
    }

    .warming-locations-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      gap: 1rem;
      flex-wrap: wrap;
    }

    .warming-pets-note {
      font-size: 0.75rem;
      color: #a8a29e;
    }

    .warming-verify-link {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      color: #fdba74;
      text-decoration: none;
    }

    .warming-verify-link:hover {
      color: #fff;
    }

    .warming-locations-disclaimer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.875rem;
      margin-top: 0.75rem;
      background: rgba(251, 191, 36, 0.15);
      border: 1px solid rgba(251, 191, 36, 0.3);
      border-radius: 0.5rem;
      font-size: 0.8rem;
      color: #fbbf24;
      flex-wrap: wrap;
    }

    .warming-locations-disclaimer .ph-warning {
      font-size: 1rem;
      flex-shrink: 0;
    }

    .warming-locations-disclaimer .warming-verify-link {
      margin-left: auto;
      font-weight: 500;
    }

    .warming-locations-section.collapsed .warming-locations-disclaimer {
      display: none;
    }

    .critical-disclaimer {
      margin-top: 0.75rem;
      padding: 0.5rem 0.75rem;
      background: rgba(251, 191, 36, 0.15);
      border-radius: 0.375rem;
      font-size: 0.75rem;
      color: #fbbf24;
      text-align: center;
    }

    @media (max-width: 400px) {
      .warming-locations-header {
        flex-direction: column;
        gap: 0.75rem;
      }

      .warming-header-right {
        width: 100%;
        justify-content: space-between;
      }

      .warming-location-card {
        flex-direction: column;
        gap: 0.5rem;
      }

      .warming-location-actions {
        flex-direction: row;
        width: 100%;
      }

      .warming-location-link {
        flex: 1;
      }
    }

    /* Quick Contacts Footer */
    .quick-contacts {
      background: #0f0f18;
      border: 1px solid #2a2a3c;
      border-radius: 14px;
      padding: 1rem;
      margin-top: 1.25rem;
    }

    .quick-contacts h4 {
      font-size: 0.8125rem;
      color: #888;
      margin-bottom: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .contact-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.625rem 0;
      border-bottom: 1px solid #1a1a24;
      gap: 0.5rem;
    }

    .contact-row:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .contact-name {
      font-size: 0.875rem;
      color: #e0e0e0;
    }

    .contact-number {
      color: #60a5fa;
      font-weight: 600;
      font-size: 0.875rem;
      text-decoration: none;
      white-space: nowrap;
    }

    .contact-number:hover {
      text-decoration: underline;
    }

    /* Tab content visibility */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Map tab content */
    .map-tab-content {
      background: #12121a;
      border: 1px solid #2a2a3c;
      border-radius: 14px;
      padding: 1rem;
    }

    /* Hide old sections when in new mode */
    .legacy-sections {
      display: none;
    }

    .intent-mode .legacy-sections {
      display: none;
    }

    .intent-mode .intent-navigation {
      display: block;
    }

    /* RTL Support for new components */
    [dir="rtl"] .intent-left {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .intent-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .resource-item {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .contact-row {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .critical-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .status-row {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .intent-arrow {
      transform: rotate(180deg);
    }

    [dir="rtl"] .intent-card.expanded .intent-arrow {
      transform: rotate(270deg);
    }

    /* ===========================================
       SCREEN SYSTEM (Main vs Alerts)
       =========================================== */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* Alerts toggle button in top bar */
    .alerts-toggle-btn {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      min-height: 36px;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    .alerts-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.12);
      color: var(--color-text-primary);
    }

    .alerts-toggle-btn:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    .alerts-toggle-btn .alert-count-badge {
      background: var(--color-accent-red);
      color: white;
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 8px;
      font-weight: 600;
      min-width: 18px;
      text-align: center;
    }

    .alerts-toggle-btn .pulse-indicator {
      width: 6px;
      height: 6px;
      background: var(--color-accent-red);
      border-radius: 50%;
      animation: alertPulse 2s infinite;
    }

    @keyframes alertPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.85); }
    }

    /* ===========================================
       ALERTS FEED SCREEN STYLES
       =========================================== */
    .alerts-screen {
      --alerts-bg-primary: #0a0a0f;
      --alerts-bg-secondary: #12121a;
      --alerts-bg-card: #1a1a24;
      --alerts-bg-card-hover: #22222e;
      --alerts-border-color: #2a2a3a;
      --alerts-border-hover: #3a3a4a;
      --alerts-text-primary: #e8e8ed;
      --alerts-text-secondary: #a0a0b0;
      --alerts-text-muted: #6a6a7a;

      --alerts-extreme: #ef4444;
      --alerts-extreme-bg: rgba(239, 68, 68, 0.12);
      --alerts-severe: #f97316;
      --alerts-severe-bg: rgba(249, 115, 22, 0.12);
      --alerts-moderate: #eab308;
      --alerts-moderate-bg: rgba(234, 179, 8, 0.12);
      --alerts-minor: #3b82f6;
      --alerts-minor-bg: rgba(59, 130, 246, 0.12);
      --alerts-info: #6b7280;
      --alerts-info-bg: rgba(107, 114, 128, 0.12);
      --alerts-resolved: #22c55e;
      --alerts-resolved-bg: rgba(34, 197, 94, 0.12);
      --alerts-accent: #6366f1;
    }

    .alerts-screen {
      background: var(--alerts-bg-primary);
      min-height: 100vh;
      min-height: 100dvh;
      position: fixed;
      inset: 0;
      overflow-y: auto;
      z-index: 150;
      font-family: 'Source Sans 3', -apple-system, sans-serif;
    }

    .alerts-screen::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none;
      z-index: 0;
    }

    .alerts-container {
      max-width: 720px;
      margin: 0 auto;
      padding: 0 1rem;
      position: relative;
      z-index: 1;
    }

    /* Alerts Header */
    .alerts-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10, 10, 15, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--alerts-border-color);
      padding: 1rem 0;
    }

    .alerts-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .alerts-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .alerts-back-btn {
      width: 36px;
      height: 36px;
      min-width: 44px;
      min-height: 44px;
      border-radius: 8px;
      border: 1px solid var(--alerts-border-color);
      background: transparent;
      color: var(--alerts-text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      text-decoration: none;
    }

    .alerts-back-btn:hover {
      background: var(--alerts-bg-card);
      border-color: var(--alerts-border-hover);
      color: var(--alerts-text-primary);
    }

    .alerts-header-title {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      color: var(--alerts-text-primary);
      display: flex;
      align-items: center;
    }

    .alerts-counter {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: 8px;
      padding: 4px 10px;
      background: var(--alerts-extreme-bg);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--alerts-extreme);
      font-family: 'JetBrains Mono', monospace;
    }

    .alerts-counter .pulse-dot {
      width: 6px;
      height: 6px;
      background: var(--alerts-extreme);
      border-radius: 50%;
      animation: alertPulse 2s infinite;
    }

    .alerts-header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .alerts-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.875rem;
      border-radius: 8px;
      border: 1px solid var(--alerts-border-color);
      background: transparent;
      color: var(--alerts-text-secondary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 44px;
    }

    .alerts-btn:hover {
      background: var(--alerts-bg-card);
      border-color: var(--alerts-border-hover);
      color: var(--alerts-text-primary);
    }

    .alerts-btn.primary {
      background: var(--alerts-accent);
      border-color: var(--alerts-accent);
      color: white;
    }

    .alerts-btn svg { width: 16px; height: 16px; }
    .alerts-btn.loading svg { animation: alertsSpin 1s linear infinite; }

    @keyframes alertsSpin { to { transform: rotate(360deg); } }

    /* Alerts Status Bar */
    .alerts-status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 0;
      border-bottom: 1px solid var(--alerts-border-color);
      margin-bottom: 1rem;
    }

    .alerts-status-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--alerts-text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .alerts-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--alerts-resolved);
    }

    .alerts-status-dot.loading { background: var(--alerts-moderate); }
    .alerts-status-dot.error { background: var(--alerts-extreme); }

    .alerts-source-pills {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .alerts-source-pill {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      background: var(--alerts-bg-card);
      color: var(--alerts-text-muted);
      font-family: 'JetBrains Mono', monospace;
      cursor: pointer;
      transition: all 0.15s;
      border: 1px solid transparent;
    }

    .alerts-source-pill:hover {
      background: var(--alerts-bg-card-hover);
      color: var(--alerts-text-primary);
    }

    .alerts-source-pill.has-alerts {
      background: var(--alerts-severe-bg);
      color: var(--alerts-severe);
    }

    .alerts-source-pill.active {
      background: var(--alerts-accent);
      color: white;
      border-color: var(--alerts-accent);
    }

    /* Priority Section */
    .alerts-priority-section {
      margin-bottom: 1.5rem;
      border: 1px solid var(--alerts-severe);
      border-radius: 12px;
      overflow: hidden;
      background: rgba(239, 68, 68, 0.05);
    }

    .alerts-priority-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: rgba(239, 68, 68, 0.1);
      cursor: pointer;
      user-select: none;
    }

    .alerts-priority-header:hover {
      background: rgba(239, 68, 68, 0.15);
    }

    .alerts-priority-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--alerts-severe);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .alerts-priority-count {
      background: var(--alerts-severe);
      color: white;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      font-size: 0.75rem;
    }

    .alerts-priority-toggle {
      color: var(--alerts-text-muted);
      font-size: 0.8rem;
      transition: transform 0.2s;
    }

    .alerts-priority-section.collapsed .alerts-priority-toggle {
      transform: rotate(-90deg);
    }

    .alerts-priority-section.collapsed .alerts-priority-content {
      display: none;
    }

    .alerts-priority-content {
      padding: 0.5rem;
    }

    .alerts-priority-content .alerts-card {
      margin-bottom: 0.5rem;
    }

    .alerts-priority-content .alerts-card:last-child {
      margin-bottom: 0;
    }

    /* Filter Bar */
    .alerts-filter-bar {
      display: none;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--alerts-bg-card);
      border: 1px solid var(--alerts-border-color);
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .alerts-filter-bar.active {
      display: flex;
    }

    .alerts-filter-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--alerts-text-secondary);
    }

    .alerts-filter-source {
      font-weight: 600;
      color: var(--alerts-text-primary);
    }

    .alerts-clear-filter {
      padding: 0.35rem 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--alerts-border-color);
      background: transparent;
      color: var(--alerts-text-secondary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .alerts-clear-filter:hover {
      background: var(--alerts-bg-card-hover);
      color: var(--alerts-text-primary);
    }

    /* Feed */
    .alerts-feed { padding-bottom: 2rem; }
    .alerts-feed.updating { opacity: 0.6; transition: opacity 0.3s; }

    .alerts-time-group { margin-bottom: 1.5rem; }

    .alerts-time-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--alerts-text-muted);
      margin-bottom: 0.75rem;
      padding-left: 4px;
    }

    /* Alert Card */
    .alerts-card {
      background: var(--alerts-bg-card);
      border: 1px solid var(--alerts-border-color);
      border-radius: 12px;
      margin-bottom: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .alerts-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--severity-color, var(--alerts-info));
    }

    .alerts-card:hover {
      background: var(--alerts-bg-card-hover);
      border-color: var(--alerts-border-hover);
      transform: translateY(-1px);
    }

    .alerts-card.extreme { --severity-color: var(--alerts-extreme); }
    .alerts-card.severe { --severity-color: var(--alerts-severe); }
    .alerts-card.moderate { --severity-color: var(--alerts-moderate); }
    .alerts-card.minor { --severity-color: var(--alerts-minor); }
    .alerts-card.info { --severity-color: var(--alerts-info); }

    /* Unread indicator */
    .alerts-card.unread::after {
      content: '';
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 8px;
      height: 8px;
      background: var(--alerts-accent);
      border-radius: 50%;
    }

    .alerts-card.unread {
      background: color-mix(in srgb, var(--alerts-bg-card) 95%, var(--alerts-accent) 5%);
    }

    /* Smooth entry animation */
    .alerts-card {
      animation: alertsCardSlideIn 0.35s ease-out backwards;
    }

    @keyframes alertsCardSlideIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .alerts-card-inner { padding: 1rem 1.25rem; }

    .alerts-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .alerts-source-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alerts-source-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      background: var(--alerts-bg-secondary);
    }

    .alerts-source-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--alerts-text-secondary);
    }

    .alerts-time-ago {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--alerts-text-muted);
    }

    .alerts-card-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--alerts-text-primary);
      line-height: 1.3;
    }

    .alerts-card-meta {
      font-size: 0.85rem;
      color: var(--alerts-text-muted);
      margin-bottom: 0.5rem;
    }

    .alerts-card-meta strong { color: var(--alerts-text-secondary); }

    .alerts-card-description {
      font-size: 0.9rem;
      color: var(--alerts-text-secondary);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .alerts-card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--alerts-border-color);
    }

    .alerts-expand-hint {
      font-size: 0.8rem;
      color: var(--alerts-accent);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .alerts-severity-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .alerts-severity-badge.extreme { background: var(--alerts-extreme-bg); color: var(--alerts-extreme); }
    .alerts-severity-badge.severe { background: var(--alerts-severe-bg); color: var(--alerts-severe); }
    .alerts-severity-badge.moderate { background: var(--alerts-moderate-bg); color: var(--alerts-moderate); }
    .alerts-severity-badge.minor { background: var(--alerts-minor-bg); color: var(--alerts-minor); }
    .alerts-severity-badge.info { background: var(--alerts-info-bg); color: var(--alerts-info); }

    .alerts-severity-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* Expanded state */
    .alerts-card.expanded .alerts-card-description { display: none; }
    .alerts-card.expanded .alerts-expand-content { display: block; }

    .alerts-expand-content {
      display: none;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--alerts-border-color);
    }

    .alerts-expand-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    .alerts-expand-btn {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--alerts-border-color);
      background: transparent;
      color: var(--alerts-text-secondary);
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.15s;
      text-decoration: none;
    }

    .alerts-expand-btn:hover {
      background: var(--alerts-bg-secondary);
      color: var(--alerts-text-primary);
    }

    /* Sources Panel */
    .alerts-sources-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .alerts-sources-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .alerts-sources-panel {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: 100%;
      max-width: 400px;
      background: var(--alerts-bg-secondary);
      border-left: 1px solid var(--alerts-border-color);
      z-index: 201;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
    }

    .alerts-sources-overlay.active .alerts-sources-panel {
      transform: translateX(0);
    }

    .alerts-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--alerts-border-color);
    }

    .alerts-panel-title {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      font-weight: 600;
      color: var(--alerts-text-primary);
    }

    .alerts-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 1.5rem;
    }

    .alerts-source-section { margin-bottom: 1.5rem; }

    .alerts-section-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--alerts-text-muted);
      margin-bottom: 0.75rem;
    }

    .alerts-source-item {
      display: flex;
      align-items: flex-start;
      gap: 0.875rem;
      padding: 0.875rem;
      border-radius: 10px;
      margin-bottom: 0.5rem;
      transition: background 0.15s;
    }

    .alerts-source-item:hover { background: var(--alerts-bg-card); }

    .alerts-source-item-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--alerts-bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .alerts-source-item-content { flex: 1; min-width: 0; }

    .alerts-source-item-name {
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--alerts-text-primary);
    }

    .alerts-source-item-count {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--alerts-severe-bg);
      color: var(--alerts-severe);
      font-weight: 600;
    }

    .alerts-source-item-desc {
      font-size: 0.8rem;
      color: var(--alerts-text-muted);
      margin-top: 0.15rem;
    }

    /* Toggle switch */
    .alerts-toggle {
      position: relative;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }

    .alerts-toggle input { opacity: 0; width: 0; height: 0; }

    .alerts-toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: var(--alerts-bg-primary);
      border: 1px solid var(--alerts-border-color);
      border-radius: 12px;
      transition: all 0.2s;
    }

    .alerts-toggle-slider::before {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      left: 2px;
      bottom: 2px;
      background: var(--alerts-text-muted);
      border-radius: 50%;
      transition: all 0.2s;
    }

    .alerts-toggle input:checked + .alerts-toggle-slider {
      background: var(--alerts-accent);
      border-color: var(--alerts-accent);
    }

    .alerts-toggle input:checked + .alerts-toggle-slider::before {
      transform: translateX(20px);
      background: white;
    }

    /* States */
    .alerts-empty-state, .alerts-loading-state {
      text-align: center;
      padding: 4rem 2rem;
    }

    .alerts-empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.6;
    }

    .alerts-empty-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--alerts-resolved);
      margin-bottom: 0.5rem;
    }

    .alerts-empty-desc {
      font-size: 0.9rem;
      color: var(--alerts-text-muted);
    }

    .alerts-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--alerts-border-color);
      border-top-color: var(--alerts-text-primary);
      border-radius: 50%;
      animation: alertsSpin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    /* Footer */
    .alerts-footer {
      padding: 1.5rem 0;
      border-top: 1px solid var(--alerts-border-color);
      text-align: center;
    }

    .alerts-footer-links {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }

    .alerts-footer-links a {
      color: var(--alerts-text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      transition: color 0.2s;
    }

    .alerts-footer-links a:hover { color: var(--alerts-text-primary); }

    .alerts-footer-credit {
      font-size: 0.75rem;
      color: var(--alerts-text-muted);
    }

    .alerts-footer-credit a { color: var(--alerts-text-secondary); }

    @media (max-width: 640px) {
      .alerts-header-title { font-size: 1rem; }
      .alerts-counter { display: none; }
      .alerts-source-pills { display: none; }
      .alerts-card-inner { padding: 0.875rem 1rem; }
      .alerts-btn .btn-text { display: none; }
    }

    /* ===========================================
       GOOGLE TRANSLATE INTEGRATION
       =========================================== */
    /* Hide Google Translate default UI elements */
    .goog-te-banner-frame, .goog-te-balloon-frame { display: none !important; }
    .goog-te-gadget { font-family: inherit !important; font-size: 0 !important; }
    body { top: 0 !important; } /* Prevent Google's bar from pushing content */
    .skiptranslate { display: none !important; }
    .VIpgJd-ZVi9od-ORHb-OEVmcd { display: none !important; }
    #goog-gt-tt { display: none !important; } /* Hide tooltip */
    .goog-text-highlight { background: none !important; box-shadow: none !important; }

    /* Prevent translation of UI elements */
    .notranslate, [translate="no"] {
      font-family: inherit !important;
    }
    .alerts-header, .alerts-lang-selector, .alerts-lang-menu, .alerts-btn {
      font-family: 'JetBrains Mono', monospace !important;
    }

    /* Custom language selector for alerts screen */
    .alerts-lang-selector {
      display: flex;
      gap: 2px;
      background: var(--alerts-bg-card);
      border: 1px solid var(--alerts-border-color);
      border-radius: 8px;
      padding: 2px;
    }

    .alerts-lang-btn {
      padding: 0.4rem 0.6rem;
      border: none;
      background: transparent;
      color: var(--alerts-text-muted);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      min-height: 32px;
      min-width: 32px;
    }

    .alerts-lang-btn:hover {
      background: var(--alerts-bg-card-hover);
      color: var(--alerts-text-primary);
    }

    .alerts-lang-btn.active {
      background: var(--alerts-accent);
      color: white;
    }

    .alerts-lang-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: var(--alerts-bg-card);
      border: 1px solid var(--alerts-border-color);
      border-radius: 8px;
      padding: 0.5rem;
      z-index: 200;
      min-width: 150px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .alerts-lang-menu.active {
      display: block;
    }

    .alerts-lang-menu button {
      display: block;
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: none;
      background: transparent;
      color: var(--alerts-text-secondary);
      font-family: 'Source Sans 3', sans-serif;
      font-size: 0.85rem;
      text-align: left;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .alerts-lang-menu button:hover {
      background: var(--alerts-bg-card-hover);
      color: var(--alerts-text-primary);
    }

    .alerts-header-actions {
      position: relative;
    }

    @media (max-width: 640px) {
      .alerts-lang-selector { gap: 1px; padding: 1px; }
      .alerts-lang-btn { padding: 0.3rem 0.4rem; font-size: 0.65rem; }
      .alerts-lang-menu { right: -60px; }
    }

    /* ===========================================
       ENHANCED MOBILE UX - Large Text Support
       =========================================== */

    /* Cap text scale on very small screens to prevent overflow */
    @media (max-width: 360px) {
      html.text-xlarge { --text-scale: 1.15; }
      html.text-large { --text-scale: 1.05; }
    }

    @media (max-width: 320px) {
      html.text-xlarge { --text-scale: 1.1; }
      html.text-large { --text-scale: 1; }
      html.text-normal { --text-scale: 0.95; }
    }

    /* Top Bar Controls - utility group */
    .top-bar-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    /* Top Bar - Stack vertically on narrow screens with large text */
    @media (max-width: 420px) {
      .top-bar {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
      }

      .lang-select {
        justify-content: center;
      }

      .top-bar-controls {
        justify-content: center;
      }
    }

    @media (max-width: 340px) {
      .top-bar-controls {
        flex-direction: column;
        gap: 0.5rem;
      }

      .alerts-toggle-btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Language buttons - scale properly with text */
    .lang-btn {
      min-height: 44px;
      padding: 0.5rem 0.625rem;
    }

    @media (max-width: 360px) {
      .lang-btn {
        padding: 0.4rem 0.5rem;
        font-size: 0.75rem;
      }
    }

    /* Text size controls - ensure touch targets on all sizes */
    @media (max-width: 400px) {
      .text-size-controls {
        gap: 0.125rem;
        padding: 0.125rem;
      }

      .text-size-btn {
        width: 40px;
        height: 40px;
        font-size: 0.75rem;
      }

      .text-size-label {
        display: none;
      }
    }

    /* Header improvements for large text */
    @media (max-width: 400px) {
      h1 {
        font-size: clamp(1.1rem, 5vw, 1.5rem);
      }

      .branding {
        gap: 0.75rem;
      }

      .app-logo {
        width: 48px;
        height: 48px;
      }
    }

    /* Location button - full width and wrap text on mobile */
    .location-btn.green-style {
      word-break: break-word;
      text-align: center;
      line-height: 1.3;
      min-height: 48px;
      padding: 0.75rem 1rem;
    }

    /* Critical Card - Improved mobile layout */
    @media (max-width: 400px) {
      .critical-card {
        padding: 0.875rem;
      }

      .critical-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .critical-title {
        font-size: 1rem;
        word-break: break-word;
      }

      .critical-address {
        font-size: 0.8125rem;
        word-break: break-word;
      }

      .critical-details {
        gap: 0.375rem;
      }

      .detail-chip {
        font-size: 0.6875rem;
        padding: 0.3rem 0.5rem;
      }

      .critical-actions {
        flex-direction: column;
        gap: 0.5rem;
      }

      .action-btn {
        width: 100%;
        min-height: 48px;
      }
    }

    /* Status Row - Stack on small screens */
    @media (max-width: 380px) {
      .status-row {
        flex-direction: column;
        gap: 0.5rem;
      }

      .status-card {
        width: 100%;
      }
    }

    .status-card {
      min-width: 0;
      overflow: hidden;
    }

    .status-value {
      word-break: break-word;
      font-size: clamp(1rem, 4vw, 1.25rem);
    }

    /* Intent Cards - Better mobile handling */
    .intent-card {
      padding: 0.875rem;
    }

    @media (max-width: 380px) {
      .intent-card {
        padding: 0.75rem;
      }

      .intent-icon {
        width: 2.25rem;
        height: 2.25rem;
        font-size: 1.125rem;
      }

      .intent-left {
        gap: 0.625rem;
        min-width: 0;
        flex: 1;
      }

      .intent-title {
        font-size: 0.9375rem;
        word-break: break-word;
      }

      .intent-count {
        font-size: 0.6875rem;
      }
    }

    /* Resource Items - Critical fix for overflow */
    .resource-info {
      min-width: 0;
      flex: 1 1 auto;
    }

    .resource-item {
      gap: 0.5rem;
    }

    @media (max-width: 420px) {
      .resource-item {
        flex-direction: column;
        align-items: stretch;
      }

      .resource-info {
        width: 100%;
      }

      .resource-info h5 {
        font-size: 0.8125rem;
        word-break: break-word;
      }

      .resource-phone {
        width: 100%;
        justify-content: center;
        min-height: 48px;
      }

      .resource-meta {
        gap: 0.375rem;
      }

      .resource-status {
        font-size: 0.625rem;
      }
    }

    /* Ensure resource actions don't overflow */
    .resource-phone,
    .resource-link {
      flex-shrink: 0;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* WTTIN Category Link - Mobile improvements */
    @media (max-width: 380px) {
      .wttin-category-link {
        padding: 0.625rem 0.75rem;
        font-size: 0.75rem;
        flex-wrap: wrap;
        justify-content: center;
        text-align: center;
      }
    }

    /* Warming Locations - Enhanced mobile */
    @media (max-width: 380px) {
      .warming-locations-section {
        padding: 1rem;
      }

      .warming-locations-title h3 {
        font-size: 1.0625rem;
      }

      .warming-icon {
        font-size: 1.5rem;
      }

      .warming-location-info h4 {
        font-size: 0.875rem;
        word-break: break-word;
      }

      .warming-location-hours,
      .warming-location-address,
      .warming-location-services {
        font-size: 0.75rem;
      }

      .warming-transport-note {
        font-size: 0.75rem;
        flex-wrap: wrap;
        justify-content: center;
        text-align: center;
      }
    }

    /* Quick Contacts - Mobile layout */
    @media (max-width: 380px) {
      .contact-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .contact-number {
        font-size: 1rem;
        padding: 0.25rem 0;
      }
    }

    /* Tab Bar - Better touch targets */
    .tab-btn {
      min-height: 48px;
      font-size: clamp(0.8125rem, 3.5vw, 0.875rem);
    }

    /* Weather Forecast - Better small screen handling */
    @media (max-width: 360px) {
      .forecast-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .zip-input-wrapper {
        width: 100%;
      }

      #zipInput {
        flex: 1;
        width: auto;
      }

      .day-card {
        padding: 0.5rem 0.25rem;
      }

      .weather-icon {
        font-size: 1.5rem;
      }

      .condition {
        font-size: 0.6rem;
        min-height: auto;
      }
    }

    /* Alert Banners - Mobile improvements */
    @media (max-width: 380px) {
      .alert-banner {
        padding: 0.625rem 0.75rem;
        gap: 0.5rem;
      }

      .alert-title {
        font-size: 0.8125rem;
        word-break: break-word;
      }

      .alert-description {
        font-size: 0.75rem;
      }

      .alert-meta {
        font-size: 0.65rem;
        gap: 0.5rem;
      }
    }

    /* Map Preview - Mobile stacking */
    @media (max-width: 360px) {
      .map-preview-stats {
        grid-template-columns: 1fr;
      }

      .map-stat {
        padding: 0.5rem;
      }

      .map-stat-value {
        font-size: 1.25rem;
      }
    }

    /* Global text overflow prevention */
    .container {
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6,
    .critical-title,
    .intent-title,
    .resource-info h5,
    .warming-location-info h4,
    .alert-title,
    .outage-title {
      overflow-wrap: break-word;
      word-wrap: break-word;
      hyphens: auto;
    }

    /* Improved touch feedback for all interactive elements */
    @media (hover: none) and (pointer: coarse) {
      .intent-card:active,
      .resource-phone:active,
      .action-btn:active,
      .tab-btn:active,
      .lang-btn:active,
      .text-size-btn:active,
      .warming-location-link:active {
        transform: scale(0.98);
        opacity: 0.9;
      }
    }

    /* Ensure all buttons have adequate touch targets */
    button,
    a.link,
    .action-btn,
    .resource-phone,
    .resource-link,
    .warming-location-link,
    .shelter-cta-btn,
    .wttin-banner-link,
    .wttin-category-link {
      min-height: 44px;
    }

    /* Large text specific adjustments */
    html.text-large,
    html.text-xlarge {
      .intent-card {
        padding: 1rem;
      }

      .resource-item {
        padding: 0.875rem 0;
      }

      .critical-card {
        padding: 1.125rem;
      }
    }

    @media (max-width: 400px) {
      html.text-large .intent-icon,
      html.text-xlarge .intent-icon {
        width: 2rem;
        height: 2rem;
        font-size: 1rem;
      }

      html.text-large .intent-left,
      html.text-xlarge .intent-left {
        gap: 0.5rem;
      }
    }

    /* Safe area handling for modern phones with notches */
    @supports (padding: max(0px)) {
      .container {
        padding-left: max(0.5rem, env(safe-area-inset-left));
        padding-right: max(0.5rem, env(safe-area-inset-right));
      }

      .map-modal-header,
      .map-modal-footer {
        padding-left: max(16px, env(safe-area-inset-left));
        padding-right: max(16px, env(safe-area-inset-right));
      }
    }

    /* Scrollable content areas - better mobile handling */
    .resource-list {
      max-height: 70vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Prevent horizontal scroll on the whole page */
    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }
  </style>
</head>
<body>
  <div class="container notranslate" translate="no">
    <div class="top-bar">
      <div class="lang-select">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="ar"></button>
        <button class="lang-btn" data-lang="ku"></button>
        <button class="lang-btn" data-lang="vi">VI</button>
      </div>
      <div class="top-bar-controls">
        <button class="alerts-toggle-btn" id="alertsToggleBtn" onclick="openAlertsScreen()" aria-label="View live news and alerts feed" title="Live News & Alerts Feed">
          <span class="pulse-indicator"></span>
          <span>News & Alerts</span>
          <span class="alert-count-badge" id="mainAlertCountBadge" style="display: none;">--</span>
        </button>
        <button class="a11y-toggle" id="textSizeToggle" aria-label="Change text size" title="Change text size">Aa</button>
      </div>
    </div>

    <header>
      <h1 data-i18n="title" style="text-align: center; margin-bottom: 0.25rem;">Nashville Winter Resources</h1>
      <p class="subtitle" data-i18n="subtitle" style="text-align: center; margin-bottom: 1.25rem;">Shelter, food & support during extreme weather</p>

      <a href="emergency.html" class="location-btn green-style">
        <i class="ph ph-map-pin"></i>
        <span data-i18n="get_location_911">Get My Location for 911</span>
      </a>
    </header>

    <!-- Critical Alert Card - Emergency Shelter -->
    <div id="shelterAlertBanner" class="critical-card" role="alert" aria-live="polite">
      <div class="critical-header">
        <span class="critical-label" data-i18n="critical_overflow_open">Emergency Overflow Open</span>
        <span class="status-badge"> <span data-i18n="shelter_alert_status">24 Hours</span></span>
      </div>
      <h3 class="critical-title" data-i18n="shelter_alert_title">Metro Emergency Shelter</h3>
      <p class="critical-address" data-i18n="shelter_alert_location">3230 Brick Church Pike, Nashville</p>
      <div class="critical-details">
        <span class="detail-chip" data-i18n="critical_who_short"> 18+, couples, dogs OK</span>
        <span class="detail-chip" data-i18n="critical_meals"> Hot meals</span>
        <span class="detail-chip" data-i18n="critical_transport"> WeGo #23B after 7pm</span>
      </div>
      <div class="critical-actions">
        <a href="tel:615-862-6391" class="action-btn primary"> 615-862-6391</a>
        <a href="https://www.nashville.gov/departments/government/winter-storm-fern-resources" class="action-btn secondary" target="_blank" rel="noopener noreferrer"> <span data-i18n="details">Details</span></a>
      </div>
      <div class="critical-disclaimer" data-i18n="shelter_disclaimer"> Info may change  always double-check on Metro Nashville's official site</div>
    </div>

    <!-- Compact Status Row -->
    <div class="status-row">
      <div class="status-card">
        <h4 data-i18n="power_outages">Power Outages</h4>
        <div class="status-value alert" id="statusOutageCount">--</div>
        <div class="status-sub" data-i18n="outage_customers">customers affected</div>
        <a href="#" class="expand-link" onclick="openMapModal(); return false;" data-i18n="status_view_map">View NES map </a>
      </div>
      <div class="status-card">
        <h4 data-i18n="forecast">Forecast</h4>
        <div class="status-value" id="statusForecastTemp">--</div>
        <div class="status-sub" id="statusForecastDesc">Enter ZIP below</div>
        <a href="#forecastSection" class="expand-link" data-i18n="status_5day">5-day details </a>
      </div>
    </div>

    <!-- Weather Alert Inline -->
    <div class="weather-alert-inline" id="weatherAlertInline" style="display: none;">
      <strong> <span id="weatherAlertTitle">Cold Weather Advisory</span></strong>
      <span id="weatherAlertExpiry"></span>
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="find-help" data-i18n="tab_find_help">Find Help</button>
      <button class="tab-btn" data-tab="resource-map" data-i18n="tab_resource_map">Map</button>
    </div>

    <!-- Find Help Tab Content -->
    <div class="tab-content active" id="tab-find-help">
      <div class="section-label" data-i18n="what_do_you_need">What do you need?</div>

      <!-- Featured WTTIN Banner -->
      <div class="wttin-banner">
        <div class="wttin-banner-content">
          <div class="wttin-banner-icon">
            <img src="https://i0.wp.com/wttin.org/wp-content/uploads/2024/04/logo.png?w=796&ssl=1" alt="Where to Turn in Nashville logo">
          </div>
          <div class="wttin-banner-text">
            <h4 data-i18n="wttin_title">Verified by Where to Turn in Nashville</h4>
            <p data-i18n="wttin_desc">273 resources verified  Look for "via wttin.org" badges</p>
          </div>
        </div>
        <a href="https://wttin.org/" class="wttin-banner-link" target="_blank" rel="noopener noreferrer">
          <span data-i18n="wttin_visit">Browse all categories</span>
          <i class="ph ph-arrow-square-out"></i>
        </a>
      </div>

      <!-- Warming Locations - Time-bound emergency section -->
      <div id="warmingLocationsSection" class="warming-locations-section" style="display: none;">
        <div class="warming-locations-header" onclick="toggleWarmingSection(event)">
          <div class="warming-locations-title">
            <span class="warming-icon"></span>
            <div>
              <h3 data-i18n="warming_title">Warming Locations</h3>
              <div class="warming-subtitle" id="warmingExpiryText">Winter Storm Fern  Updated Jan 31</div>
            </div>
          </div>
          <div class="warming-header-right">
            <div class="warming-transport-note">
              <span data-i18n="warming_transport">Need a ride?</span>
              <a href="tel:615-401-1712" class="warming-transport-phone"> 615-401-1712</a>
            </div>
            <i class="ph ph-caret-down warming-toggle-icon"></i>
          </div>
        </div>

        <div class="warming-locations-grid" id="warmingLocationsGrid">
          <!-- Populated by JavaScript -->
        </div>

        <div class="warming-locations-disclaimer">
          <i class="ph ph-warning"></i>
          <span data-i18n="warming_disclaimer">Info may change. Always check Metro Nashville's site for up-to-date shelter info.</span>
          <a href="https://www.nashville.gov/departments/government/winter-storm-fern-resources" class="warming-verify-link" target="_blank" rel="noopener noreferrer">
            <span data-i18n="warming_verify_metro">Check Metro site</span>
            <i class="ph ph-arrow-square-out"></i>
          </a>
        </div>
        <div class="warming-locations-footer">
          <span class="warming-pets-note" data-i18n="warming_pets">Pets allowed at Metro shelters</span>
          <a href="https://www.nashville.gov/departments/government/winter-storm-fern-resources" class="warming-verify-link" target="_blank" rel="noopener noreferrer">
            <span data-i18n="warming_verify">Verify on Nashville.gov</span>
            <i class="ph ph-arrow-square-out"></i>
          </a>
        </div>
      </div>

      <div class="intent-grid">
        <!-- Shelter Card -->
        <div class="intent-card" data-intent="shelter">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_shelter">I need a place tonight</div>
                <div class="intent-count" data-i18n="intent_shelter_count">7 shelters open now</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nashville Rescue Mission</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours" data-i18n="hours_24hr">24hr intake</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Showers, hygiene, meals, diapers/formula at Women's Campus</div>
              </div>
              <a href="tel:615-312-1574" class="resource-phone"> 615-312-1574</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Room In The Inn</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Nov-Mar: 150-300 beds nightly</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Men: 5:15pm at 705 Drexel | Women: 2:30pm | Families call first</div>
              </div>
              <a href="tel:615-251-7019" class="resource-phone"> 615-251-7019</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Salvation Army Center of Hope</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Families, men, women, LGBTQ+</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Fri 8am-6pm | Self-sufficiency plan required</div>
              </div>
              <a href="tel:615-242-0411" class="resource-phone"> 615-242-0411</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Metro Nashville Overflow Shelter</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Opens when temp 32F</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">7pm-7am | Bus 23B free from downtown WeGo station</div>
              </div>
              <a href="tel:615-862-6391" class="resource-phone"> 615-862-6391</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Launch Pad Winter Shelter</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Ages 18-24, Nov-Mar</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">LGBTQIA+ affirming | Reserve at NashvilleLaunchPad.com</div>
              </div>
              <a href="https://www.nashvillelaunchpad.com" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Reserve</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Oasis Center (Youth 13-17)</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">24/7 crisis hotline</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Emergency shelter, crisis counseling, learning center</div>
              </div>
              <a href="tel:615-327-4455" class="resource-phone"> 615-327-4455</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Safe Haven Family Shelter</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Families only</span>
                </div>
              </div>
              <a href="tel:615-256-8195" class="resource-phone"> 615-256-8195</a>
            </div>
            <a href="https://wttin.org/emergency-shelter/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_shelter">More shelter resources at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Food Card -->
        <div class="intent-card" data-intent="food">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_food">I need food</div>
                <div class="intent-count" data-i18n="intent_food_count">Food banks, pantries & meal services</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <!-- Second Harvest Food Bank -->
            <div class="resource-item">
              <div class="resource-info">
                <h5>Second Harvest  Find Food</h5>
                <div class="resource-meta">
                  <span class="resource-status open" data-i18n="status_open">Open</span>
                  <span class="resource-hours">Food boxes & pantries</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Call ahead to confirm times before visiting</div>
              </div>
              <a href="tel:615-329-3491" class="resource-phone"> 615-329-3491</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Second Harvest Mobile Pantry Schedule</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="hours_mobile">Mobile distribution</span>
                </div>
              </div>
              <a href="https://www.secondharvestmidtn.org/find-resources/find-food/mobile-pantry-schedule/" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Schedule</a>
            </div>

            <!-- Food Pantry Locations -->
            <div class="resource-item">
              <div class="resource-info">
                <h5>East Nashville Co-Op</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Wed 9am-3:30pm</span>
                </div>
                <div class="resource-address">3115 Gallatin Pike, Nashville 37216 | Bus #4, 56</div>
              </div>
              <a href="tel:615-540-0122" class="resource-phone"> 615-540-0122</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Inspiritus</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-12pm (closed Thu)</span>
                </div>
                <div class="resource-address">1628 Rosa L Parks Blvd, Nashville 37208 | Bus #9, 22, 49</div>
              </div>
              <a href="tel:615-838-5550" class="resource-phone"> 615-838-5550</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Martha O'Bryan Center</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 1-4pm (Seniors 8:30-11am)</span>
                </div>
                <div class="resource-address">711 S 7th St, Nashville 37216 | Bus #4, 56</div>
              </div>
              <a href="tel:615-254-1791" class="resource-phone"> 615-254-1791</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nourish Food Bank / South Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Tue 5-7pm; Sat 12-3pm</span>
                </div>
                <div class="resource-address">416 E Thompson Ln, Nashville 37211</div>
              </div>
              <a href="tel:615-971-7376" class="resource-phone"> 615-971-7376</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>St Luke's Community House</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Tue-Fri 10am-2:30pm; Tue 4-6pm</span>
                </div>
                <div class="resource-address">5601 New York Ave, Nashville 37209 | Bus #19, 50</div>
              </div>
              <a href="tel:615-350-7893" class="resource-phone"> 615-350-7893</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Salvation Army Magness Potter</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Thu 1-4pm</span>
                </div>
                <div class="resource-address">611 Stockell St, Nashville 37207 | Bus #23, 28</div>
              </div>
              <a href="tel:615-242-0411" class="resource-phone"> 615-242-0411</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>The Help Center</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Wed 9:30am-3:30pm</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Photo ID, Davidson County proof, income docs required</div>
              </div>
              <a href="tel:615-750-2145" class="resource-phone"> 615-750-2145</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>The Store  Free Grocery</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Thu 1-5pm; Fri 9am-5pm; Sat 11am-3pm</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Referral or walk-in | Proof of income & IDs for household</div>
              </div>
              <a href="tel:615-460-8331" class="resource-phone"> 615-460-8331</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Madison Church of Christ</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8:30-11:30am</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Food pantry + clothing closet</div>
              </div>
              <a href="tel:615-868-3360" class="resource-phone"> 615-868-3360</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Adventist Community Services</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Thu 10am-1pm</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">403 Gallatin Pike S | Photo ID required</div>
              </div>
              <a href="tel:615-860-6001" class="resource-phone"> 615-860-6001</a>
            </div>

            <!-- Mobile Food Distribution -->
            <div class="resource-item">
              <div class="resource-info">
                <h5>Dream Streets Mobile Food</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="hours_mobile">West & North Nashville</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Food from Sprouts, Whole Foods, Aldi, Trader Joe's</div>
              </div>
              <a href="https://dreamstreetstn.com/mobilefood" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Schedule</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>One Generation Away</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mobile distribution ~9am</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">15,000-25,000 lbs food, first come first served</div>
              </div>
              <a href="https://www.onegenaway.com/mobile-pantry" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Schedule</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>The Bridge Ministry</h5>
                <div class="resource-meta">
                  <span class="resource-hours">5 weekly outreaches</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Hot meals, groceries, toiletries, camping supplies</div>
              </div>
              <a href="tel:615-855-2611" class="resource-phone"> 615-855-2611</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>People Loving Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon 7-8:30pm</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Food, clothing, haircuts, showers</div>
              </div>
              <a href="https://www.peoplelovingnashville.com" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>

            <!-- Government Benefits -->
            <div class="resource-item">
              <div class="resource-info">
                <h5>SNAP Benefits (Food Stamps)</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-4:30pm</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Davidson County DHS | Apps in English, Spanish, Arabic, Somali</div>
              </div>
              <a href="tel:615-532-4000" class="resource-phone"> 615-532-4000</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Second Harvest SNAP Outreach</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Application assistance</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Pre-screening, help filling out application | Call or text</div>
              </div>
              <a href="tel:615-310-0752" class="resource-phone"> 615-310-0752</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>WIC Program</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Women, Infants, Children</span>
                  <a href="https://wttin.org/food/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Free foods, breastfeeding support, immunization referrals</div>
              </div>
              <a href="tel:800-342-5942" class="resource-phone"> 800-342-5942</a>
            </div>
            <a href="https://wttin.org/food/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_food">More food resources at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Power Out Card -->
        <div class="intent-card" data-intent="power">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_power">My power is out</div>
                <div class="intent-count" data-i18n="intent_power_count">Report power outage, warming centers</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="report_outage">Report Power Outage to NES</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="hours_24hr">24/7 hotline</span>
                </div>
              </div>
              <a href="tel:615-234-0000" class="resource-phone"> 615-234-0000</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="nes_outage_map">NES Power Outage Map</h5>
              </div>
              <a href="https://nespower.com/outages" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> View map</a>
            </div>
            <div class="resource-subheader">Rent & Utility Assistance</div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>NeedLink Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Tue 8am-2pm</span>
                  <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Emergency utility and rent assistance</div>
              </div>
              <a href="tel:615-269-6835" class="resource-phone"> 615-269-6835</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Rooftop</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-5pm (calls only)</span>
                  <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Davidson Co residents with lease, unexpected hardship</div>
              </div>
              <a href="tel:615-485-5920" class="resource-phone"> 615-485-5920</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Metro Action Commission</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Utility & housing assistance</span>
                  <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-862-8860" class="resource-phone"> 615-862-8860</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Catholic Charities</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Financial assistance</span>
                  <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-352-3087" class="resource-phone"> 615-352-3087</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Salvation Army</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 9am-6pm</span>
                  <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-242-0411" class="resource-phone"> 615-242-0411</a>
            </div>
            <a href="https://wttin.org/rent-utilities-assistance/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_utilities">Utility assistance at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Helping Someone Card -->
        <div class="intent-card" data-intent="helping">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_helping">I'm helping someone</div>
                <div class="intent-count" data-i18n="intent_helping_count">Outreach contacts, resources</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="homeless_outreach">Office of Homeless Services</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-4:30pm</span>
                </div>
              </div>
              <a href="tel:615-862-6992" class="resource-phone"> 615-862-6992</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>SAFPAW (People & Animal Welfare)</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Pet care for homeless</span>
                  <a href="https://wttin.org/emergency-shelter/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Free vet care, pet food, supplies, shelter for pets</div>
              </div>
              <a href="tel:615-474-8390" class="resource-phone"> 615-474-8390</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Open Table Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Street outreach, housing navigation</span>
                </div>
              </div>
              <a href="https://www.opentablenashville.org/" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-subheader">Showers & Laundry</div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Room In The Inn</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 6-8am showers, 7am laundry</span>
                  <a href="https://wttin.org/personal-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-251-9791" class="resource-phone"> 615-251-9791</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Community Care Fellowship (Ken & Carol's)</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 9am-1pm showers, 9-11am laundry</span>
                  <a href="https://wttin.org/personal-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-227-1953" class="resource-phone"> 615-227-1953</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Showers of Blessing</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon & Wed 9am-1pm</span>
                  <a href="https://wttin.org/personal-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">City Road Chapel | Laundry & showers</div>
              </div>
              <a href="tel:615-868-1673" class="resource-phone"> 615-868-1673</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Shower UP</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mobile showers - check schedule</span>
                  <a href="https://wttin.org/personal-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Free towels, toiletries provided</div>
              </div>
              <a href="tel:888-210-0777" class="resource-phone"> 888-210-0777</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>People Loving Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon 7-8:30pm</span>
                  <a href="https://wttin.org/personal-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Food, clothing, haircuts, showers</div>
              </div>
              <a href="https://www.peoplelovingnashville.com/" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <a href="https://wttin.org/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_browse_all">Browse all WTTIN categories</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Immigrant Resources Card -->
        <div class="intent-card" data-intent="immigrant">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_immigrant">Immigrant resources</div>
                <div class="intent-count" data-i18n="intent_immigrant_count">Safe services, language support</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <!-- Main Immigrant & Refugee Services -->
            <div class="resource-item">
              <div class="resource-info">
                <h5>Conexin Amricas</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Legal, financial, youth programs</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon/Wed 9a-7p, Tue/Thu 9a-5:30p, Fri 9a-2p</div>
              </div>
              <a href="tel:615-270-9252" class="resource-phone"> 615-270-9252</a>
              <a href="https://www.conexionamericas.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Casa Azafrn</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Health, legal, financial services hub</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon/Wed 9a-7p, Tue/Thu 9a-5:30p, Fri 9a-2p</div>
              </div>
              <a href="tel:615-269-6900" class="resource-phone"> 615-269-6900</a>
              <a href="https://casaazafran.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Tennessee Immigrant & Refugee Rights Coalition (TIRRC)</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Education, integration, advocacy</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">By appointment only</div>
              </div>
              <a href="tel:615-833-0384" class="resource-phone"> 615-833-0384</a>
              <a href="https://tnimmigrant.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Catholic Charities of Tennessee</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Refugee resettlement, immigration services</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Fri 8a-4p (appointment only)</div>
              </div>
              <a href="tel:615-352-3087" class="resource-phone"> 615-352-3087</a>
              <a href="https://cctenn.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nashville International Center for Empowerment</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Education, health, employment, childcare</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Fri 9a-5p | Free childcare during ESL classes</div>
              </div>
              <a href="tel:615-315-9681" class="resource-phone"> 615-315-9681</a>
              <a href="https://www.empowernashville.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Tennessee Justice for Our Neighbors</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Free/low-cost immigration legal services</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Asylum, citizenship, family reunification | By appointment</div>
              </div>
              <a href="tel:615-538-7481" class="resource-phone"> 615-538-7481 (English/Spanish)</a>
              <a href="https://tnjfon.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Hispanic Family Foundation</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Economic mobility, education, advocacy</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Fri 8a-5p</div>
              </div>
              <a href="tel:615-562-2222" class="resource-phone"> 615-562-2222</a>
              <a href="https://www.hispanicfamilyfoundation.com" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Legacy Mission Village</h5>
                <div class="resource-meta">
                  <span class="resource-hours">ESL, citizenship, after-school programs</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Thu 9a-5p</div>
              </div>
              <a href="tel:615-649-8858" class="resource-phone"> 615-649-8858</a>
              <a href="https://legacymissionvillage.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nations Ministry Center</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Citizenship, youth literacy, elder programs</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Mon-Fri 9a-5p | Nepali elder support</div>
              </div>
              <a href="tel:615-828-9664" class="resource-phone"> 615-828-9664</a>
              <a href="https://nationsministrycenter.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>AMAC (American Muslim Advisory Council)</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Civic engagement, community building</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-988-6460" class="resource-phone"> 615-988-6460</a>
              <a href="https://www.amactn.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Elmahaba Center</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Arabic community, mutual aid, diaper bank</span>
                  <a href="https://wttin.org/immigrants-refugees/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Resource navigation: Tue/Thu evenings 615-200-6171</div>
              </div>
              <a href="tel:615-567-3215" class="resource-phone"> 615-567-3215</a>
              <a href="https://www.elmahabacenter.com/services" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>International Families - Alignment Nashville</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Resource guides for refugee/immigrant families</span>
                </div>
              </div>
              <a href="tel:629-285-4127" class="resource-phone"> 629-285-4127</a>
              <a href="https://www.alignmentnashville.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Workers Dignity / Dignidad Obrera</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Worker advocacy, wage theft assistance</span>
                </div>
                <div class="resource-address">Mon-Thu 9a-9p, Fri-Sun 10a-9p</div>
              </div>
              <a href="tel:615-669-6631" class="resource-phone"> English: 615-669-6631</a>
              <a href="tel:615-669-6679" class="resource-phone"> Espaol: 615-669-6679</a>
              <a href="https://workersdignity.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Centerstone - Immigrant Mental Health</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Culturally appropriate mental health services</span>
                </div>
                <div class="resource-address">Mon-Fri 9a-5p</div>
              </div>
              <a href="tel:615-460-4357" class="resource-phone"> 615-460-4357</a>
              <a href="tel:800-681-7444" class="resource-phone"> Crisis: 800-681-7444</a>
              <a href="https://centerstone.org/programs/specialized-treatment-services-for-immigrants-and-refugees/" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>

            <!-- Free English Classes -->
            <div class="resource-subheader">Free English Classes</div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nashville Public Library - ESL</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Free classes at various library locations</span>
                </div>
              </div>
              <a href="https://www.nashvillepubliclibrary.org/newamericanscorner/learn-english-esl" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Begin Anew of Middle Tennessee</h5>
                <div class="resource-meta">
                  <span class="resource-hours">ESL, HiSET prep, free childcare</span>
                </div>
                <div class="resource-address">Mon-Thu 8a-4:30p, Fri 8a-2p</div>
              </div>
              <a href="tel:615-244-3669" class="resource-phone"> 615-244-3669</a>
              <a href="https://www.beginanew.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Nashville Adult Literacy Council</h5>
                <div class="resource-meta">
                  <span class="resource-hours">ESL, tutoring, citizenship classes</span>
                </div>
                <div class="resource-address">Mon-Thu, call for hours</div>
              </div>
              <a href="tel:615-298-8060" class="resource-phone"> 615-298-8060</a>
              <a href="https://www.nashvilleliteracy.org" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Institute for Educational Volunteer Programs</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Free ESL and GED classes</span>
                </div>
                <div class="resource-address">Mon-Sat evenings</div>
              </div>
              <a href="tel:615-290-5567" class="resource-phone"> 615-290-5567</a>
              <a href="https://www.evpinstitute.com" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <a href="https://wttin.org/immigrants-refugees/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_immigrant">More immigrant resources at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Legal Help Card -->
        <div class="intent-card" data-intent="legal">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_legal">Legal help</div>
                <div class="intent-count" data-i18n="intent_legal_count">Eviction defense, ID recovery</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="legal_aid">Legal Aid Society of Middle TN</h5>
              </div>
              <a href="https://las.org/" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> las.org</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="nashville_hispanic_bar">Nashville Hispanic Bar  Eviction Help</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="nashville_hispanic_bar_desc">Free legal help for eviction cases</span>
                </div>
              </div>
              <a href="https://www.nashvillehispanicbar.org/help" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Get Help</a>
            </div>
            <a href="https://wttin.org/legal-aid/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_legal">More legal resources at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Health & Wellness Card -->
        <div class="intent-card" data-intent="health">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_health">Health & wellness</div>
                <div class="intent-count" data-i18n="intent_health_count">Medical, mental health, crisis lines</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="crisis_line">Tennessee Crisis Line</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="hours_24hr">24/7 mental health support</span>
                </div>
              </div>
              <a href="tel:988" class="resource-phone"> 988</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Family & Children's Crisis Line</h5>
                <div class="resource-meta">
                  <span class="resource-hours" data-i18n="hours_24hr">24/7 crisis support</span>
                  <a href="https://wttin.org/mental-health/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-244-7444" class="resource-phone"> 615-244-7444</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Matthew Walker Comprehensive Health</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Sliding scale fees</span>
                  <a href="https://wttin.org/medical-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Medical, dental, pharmacy | All insurance accepted</div>
              </div>
              <a href="tel:615-327-9400" class="resource-phone"> 615-327-9400</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Neighborhood Health</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-5pm</span>
                  <a href="https://wttin.org/medical-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Sliding scale | Medical, dental, mental health, MAT</div>
              </div>
              <a href="tel:615-227-3000" class="resource-phone"> 615-227-3000</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Siloam Health</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Melrose & Antioch locations</span>
                  <a href="https://wttin.org/medical-care/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
                <div class="resource-address">Refugees, immigrants, uninsured welcome</div>
              </div>
              <a href="tel:615-298-5406" class="resource-phone"> 615-298-5406</a>
            </div>
            <div class="resource-subheader">Addiction & Recovery</div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Tennessee Redline</h5>
                <div class="resource-meta">
                  <span class="resource-hours">24/7 addiction helpline</span>
                  <a href="https://wttin.org/addiction-services/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:800-889-9789" class="resource-phone"> 800-889-9789</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Mental Health Cooperative</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mon-Fri 8am-4:30pm</span>
                  <a href="https://wttin.org/mental-health/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-726-0125" class="resource-phone"> 615-726-0125</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5>Centerstone</h5>
                <div class="resource-meta">
                  <span class="resource-hours">Mental health & addiction services</span>
                  <a href="https://wttin.org/mental-health/" class="wttin-verified" target="_blank" rel="noopener noreferrer">via wttin.org</a>
                </div>
              </div>
              <a href="tel:615-460-4357" class="resource-phone"> 615-460-4357</a>
            </div>
            <a href="https://wttin.org/medical-care/" class="wttin-category-link" target="_blank" rel="noopener noreferrer">
              <span data-i18n="wttin_more_health">More health resources at WTTIN</span>
              <i class="ph ph-arrow-square-out"></i>
            </a>
          </div>
        </div>

        <!-- Official Resources Card -->
        <div class="intent-card" data-intent="official">
          <div class="intent-header">
            <div class="intent-left">
              <div class="intent-icon"></div>
              <div>
                <div class="intent-title" data-i18n="intent_official">Official info hubs</div>
                <div class="intent-count" data-i18n="intent_official_count">Government resources</div>
              </div>
            </div>
            <span class="intent-arrow"></span>
          </div>
          <div class="resource-list">
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="nashville_weather">Nashville.gov Winter Weather</h5>
              </div>
              <a href="https://www.nashville.gov/departments/emergency-management/news/january-27-winter-weather-update" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="ohs_extreme">Metro OHS  Extreme Weather</h5>
              </div>
              <a href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="tema_map">TEMA Statewide Shelter Map</h5>
              </div>
              <a href="https://www.tn.gov/tema/tennessee-shelters.html" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
            <div class="resource-item">
              <div class="resource-info">
                <h5 data-i18n="tema_hub">TEMA Winter Weather Hub</h5>
              </div>
              <a href="https://www.tn.gov/tema/updates/2026-disasters/january-2026-winter-weather.html" class="resource-link" target="_blank" rel="noopener noreferrer"><i class="ph ph-arrow-square-out"></i> Website</a>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Resource Map Tab Content -->
    <div class="tab-content" id="tab-resource-map">
      <div class="map-tab-content">
        <!-- Outages Hidden Container for API data -->
        <div id="outagesContainer" style="display: none;"></div>

        <!-- Map Preview -->
        <div class="map-preview-section" style="margin-top: 0;">
          <div class="map-preview-container" style="border: none; background: transparent;">
            <div class="map-preview-header" style="background: transparent; border-bottom: none; padding: 0 0 0.75rem 0;">
              <div class="map-preview-title">
                <i class="ph ph-map-trifold"></i>
                <span data-i18n="map_outage_map">Power Outage Map</span>
              </div>
              <button class="map-expand-btn" onclick="openMapModal()">
                <i class="ph ph-arrows-out"></i>
                <span data-i18n="map_fullscreen">Full Screen</span>
              </button>
            </div>
            <div class="map-preview-wrapper" style="height: 300px; border-radius: 12px; overflow: hidden;">
              <div id="outageMapPreview"></div>
            </div>
            <div class="map-toggles" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.75rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
              <label class="map-toggle-item" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                <input type="checkbox" id="toggleOutages" checked onchange="toggleMapLayer('outages')" style="accent-color: #f87171;">
                <span class="map-legend-dot red" style="width: 10px; height: 10px;"></span>
                <span data-i18n="map_legend_outage">Power Outages</span>
              </label>
              <label class="map-toggle-item" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                <input type="checkbox" id="toggleWarmingCenters" checked onchange="toggleMapLayer('warmingCenters')" style="accent-color: #60a5fa;">
                <span class="map-legend-dot blue" style="width: 10px; height: 10px;"></span>
                <span data-i18n="map_legend_warming">Warming centers</span>
              </label>
              <label class="map-toggle-item" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                <input type="checkbox" id="toggleRoadClosures" checked onchange="toggleMapLayer('roadClosures')" style="accent-color: #f97316;">
                <span class="map-legend-dot orange" style="width: 10px; height: 10px;"></span>
                <span data-i18n="map_legend_road_closed">Road closures</span>
              </label>
            </div>
            <div class="map-preview-stats" style="margin-top: 0.75rem;">
              <div class="map-stat">
                <div class="map-stat-value red" id="mapStatCustomers">--</div>
                <div class="map-stat-label" data-i18n="map_stat_affected">Affected</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Outage Location Button -->
        <div class="outage-location-controls" style="margin-top: 1rem;">
          <button class="outage-location-btn" id="outageLocationBtn" onclick="useMyLocationForOutages()">
            <i class="ph ph-crosshair"></i>
            <span data-i18n="outage_use_location">Use My Location</span>
          </button>
          <span class="outage-location-status" id="outageLocationStatus"></span>
        </div>
      </div>
    </div>

    <!-- Forecast Section (collapsible) -->
    <section class="forecast-section" id="forecastSection" style="margin-top: 1.5rem;">
      <div class="forecast-header">
        <div class="section-title" data-i18n="forecast">5-Day Forecast</div>
        <div class="zip-input-wrapper">
          <i class="ph ph-map-pin"></i>
          <input type="text" id="zipInput" placeholder="37206" maxlength="5" value="37206" inputmode="numeric" pattern="[0-9]*">
          <button id="fetchBtn" data-i18n="update_btn">Go</button>
        </div>
      </div>
      <p class="location-display" id="locationDisplay"></p>
      <div class="forecast-grid" id="forecastGrid">
        <div class="forecast-loading">
          <i class="ph ph-cloud"></i>
          <p data-i18n="loading_forecast">Loading forecast...</p>
        </div>
      </div>
    </section>

    <!-- Weather Alerts Section (kept for detailed alerts) -->
    <section class="section" style="margin-top: 1rem;">
      <div class="section-title" data-i18n="weather_alerts">Weather Alerts</div>
      <div class="alerts-container" id="alertsContainer">
        <div class="alerts-loading">
          <i class="ph ph-cloud"></i>
          <span data-i18n="loading_alerts">Checking for alerts...</span>
        </div>
      </div>
    </section>

    <footer>
      <span data-i18n="footer">Share widely  Updated Jan 2026</span>
      <p style="margin-top: 0.75rem;">Brought to you by <a href="https://readrichtext.substack.com/" target="_blank" rel="noopener" style="color: var(--color-link);">Rich Text</a> and <a href="https://groundtruthnashville.substack.com/" target="_blank" rel="noopener" style="color: var(--color-link);">Ground Truth Nashville</a></p>
      <p style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--color-text-muted);">NES outage data powered by <a href="https://github.com/NeckBeardPrince/nes-outage-status-checker" target="_blank" rel="noopener" style="color: var(--color-text-muted);">NeckBeardPrince/nes-outage-status-checker</a></p>
    </footer>
  </div>

  <!-- Alerts Feed Screen (Alt Screen) -->
  <div class="screen alerts-screen" id="alertsScreen">
    <header class="alerts-header">
      <div class="alerts-container">
        <div class="alerts-header-inner">
          <div class="alerts-header-left">
            <button class="alerts-back-btn" onclick="closeAlertsScreen()" title="Back to Resources">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
            </button>
            <h1 class="alerts-header-title">
              <span data-i18n="alerts_title">News & Alerts</span>
              <span class="alerts-counter" id="alertsCounterBadge">
                <span class="pulse-dot"></span>
                <span id="alertsFeedCount">--</span>
              </span>
            </h1>
          </div>
          <div class="alerts-header-actions">
            <div class="alerts-lang-selector notranslate" translate="no">
              <button class="alerts-lang-btn active" data-lang="en" onclick="setAlertsLanguage('en')" title="English">EN</button>
              <button class="alerts-lang-btn" data-lang="es" onclick="setAlertsLanguage('es')" title="Espaol">ES</button>
              <button class="alerts-lang-btn" data-lang="ar" onclick="setAlertsLanguage('ar')" title=""></button>
              <button class="alerts-lang-btn" data-lang="ku" onclick="setAlertsLanguage('ku')" title=""></button>
              <button class="alerts-lang-btn" data-lang="vi" onclick="setAlertsLanguage('vi')" title="Ting Vit">VI</button>
              <button class="alerts-lang-btn" onclick="toggleAlertsLangMenu()" title="More languages">+</button>
            </div>
            <div class="alerts-lang-menu notranslate" translate="no" id="alertsLangMenu">
              <button data-lang="so" onclick="setAlertsLanguage('so')">Soomaali</button>
              <button data-lang="zh-CN" onclick="setAlertsLanguage('zh-CN')"></button>
              <button data-lang="ko" onclick="setAlertsLanguage('ko')"></button>
              <button data-lang="my" onclick="setAlertsLanguage('my')"></button>
              <button data-lang="am" onclick="setAlertsLanguage('am')"></button>
            </div>
            <div id="google_translate_element" style="display:none;"></div>
            <button class="alerts-btn" id="alertsRefreshBtn" onclick="AlertsFeed.refreshAll()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M23 4v6h-6M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
              </svg>
              <span class="btn-text" data-i18n="alerts_refresh">Refresh</span>
            </button>
            <button class="alerts-btn" onclick="AlertsFeed.toggleSourcesPanel()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
              </svg>
              <span class="btn-text" data-i18n="alerts_sources">Sources</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="alerts-container">
      <div class="alerts-status-bar">
        <div class="alerts-status-item">
          <span class="alerts-status-dot" id="alertsStatusDot"></span>
          <span id="alertsStatusText" data-i18n="alerts_connecting">Connecting...</span>
        </div>
        <div class="alerts-source-pills" id="alertsSourcePills"></div>
      </div>

      <div class="alerts-filter-bar" id="alertsFilterBar">
        <div class="alerts-filter-info">
          <span data-i18n="alerts_showing_only">Showing only:</span>
          <span class="alerts-filter-source" id="alertsFilterSourceName"></span>
        </div>
        <button class="alerts-clear-filter" onclick="AlertsFeed.clearFilter()"> <span data-i18n="alerts_show_all">Show All</span></button>
      </div>

      <div class="alerts-priority-section" id="alertsPrioritySection" style="display: none;">
        <div class="alerts-priority-header" onclick="AlertsFeed.togglePriority()">
          <div class="alerts-priority-title">
             <span data-i18n="alerts_priority">Priority Alerts</span>
            <span class="alerts-priority-count" id="alertsPriorityCount">0</span>
          </div>
          <span class="alerts-priority-toggle"></span>
        </div>
        <div class="alerts-priority-content" id="alertsPriorityContent"></div>
      </div>

      <div class="alerts-feed" id="alertsFeedContainer">
        <div class="alerts-loading-state">
          <div class="alerts-spinner"></div>
          <p data-i18n="alerts_loading">Loading alerts...</p>
        </div>
      </div>

      <footer class="alerts-footer">
        <div class="alerts-footer-links">
          <a href="https://groundtruthnashville.org" target="_blank">Ground Truth Nashville</a>
          <a href="https://bit.ly/help4nash" target="_blank">Winter Resources</a>
          <a href="https://www.nespower.com/outages/" target="_blank">NES Power Outage Map</a>
          <a href="https://smartway.tn.gov/traffic" target="_blank">TDOT Traffic</a>
        </div>
        <p class="alerts-footer-credit">
          Data: NWS  NES  FEMA  TDOT  Metro 311  r/Nashville  Local TV<br>
          Built by <a href="https://richtxt.substack.com" target="_blank">{Rich Text}</a>  Auto-refreshes every 2 minutes
        </p>
      </footer>
    </main>

    <!-- Sources Panel -->
    <div class="alerts-sources-overlay" id="alertsSourcesOverlay" onclick="AlertsFeed.toggleSourcesPanel()">
      <aside class="alerts-sources-panel" onclick="event.stopPropagation()">
        <div class="alerts-panel-header">
          <h2 class="alerts-panel-title" data-i18n="alerts_sources_title">Alert Sources</h2>
          <button class="alerts-btn primary" onclick="AlertsFeed.toggleSourcesPanel()" data-i18n="alerts_done">Done</button>
        </div>
        <div class="alerts-panel-content">
          <section class="alerts-source-section">
            <div class="alerts-section-label" data-i18n="alerts_enabled_default">Enabled by Default</div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_nws">NWS Weather</span>
                  <span class="alerts-source-item-count" id="alerts-nws-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_nws_desc">Severe weather warnings & watches</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="nws" onchange="AlertsFeed.toggleSource('nws', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_nes">NES Power Outages</span>
                  <span class="alerts-source-item-count" id="alerts-nes-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_nes_desc">Nashville Electric power outage events</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="nes" onchange="AlertsFeed.toggleSource('nes', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_fema">FEMA Disasters</span>
                  <span class="alerts-source-item-count" id="alerts-fema-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_fema_desc">Federal disaster declarations for TN</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="fema" onchange="AlertsFeed.toggleSource('fema', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>
          </section>

          <section class="alerts-source-section">
            <div class="alerts-section-label" data-i18n="alerts_additional_sources">Additional Sources</div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_tdot">TDOT SmartWay</span>
                  <span class="alerts-source-item-count" id="alerts-traffic-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_tdot_desc">Road closures & traffic incidents</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="traffic" onchange="AlertsFeed.toggleSource('traffic', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_311">Metro 311</span>
                  <span class="alerts-source-item-count" id="alerts-hub311-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_311_desc">Tree limbs, road hazards, debris</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="hub311" onchange="AlertsFeed.toggleSource('hub311', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_reddit">r/Nashville</span>
                  <span class="alerts-source-item-count" id="alerts-reddit-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_reddit_desc">Community reports & discussions</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="reddit" onchange="AlertsFeed.toggleSource('reddit', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_news">Local News</span>
                  <span class="alerts-source-item-count" id="alerts-localNews-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_news_desc">WKRN, WSMV, NC5, Fox17, WPLN</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" checked data-source="localNews" onchange="AlertsFeed.toggleSource('localNews', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name">
                  <span data-i18n="alerts_src_usgs">USGS Earthquakes</span>
                  <span class="alerts-source-item-count" id="alerts-usgs-count" style="display:none">0</span>
                </div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_usgs_desc">Seismic activity (300km radius)</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" data-source="usgs" onchange="AlertsFeed.toggleSource('usgs', this.checked)">
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>
          </section>

          <section class="alerts-source-section">
            <div class="alerts-section-label" data-i18n="alerts_coming_soon">Coming Soon</div>

            <div class="alerts-source-item" style="opacity: 0.5;">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name" data-i18n="alerts_src_airnow">AirNow AQI</div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_airnow_desc">Requires API key registration</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" disabled>
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>

            <div class="alerts-source-item" style="opacity: 0.5;">
              <div class="alerts-source-item-icon"></div>
              <div class="alerts-source-item-content">
                <div class="alerts-source-item-name" data-i18n="alerts_src_tema">TEMA Shelters</div>
                <div class="alerts-source-item-desc" data-i18n="alerts_src_tema_desc">Warming/cooling centers</div>
              </div>
              <label class="alerts-toggle">
                <input type="checkbox" disabled>
                <span class="alerts-toggle-slider"></span>
              </label>
            </div>
          </section>
        </div>
      </aside>
    </div>
  </div>

  <!-- Fullscreen Map Modal -->
  <div class="map-modal" id="mapModal">
    <div class="map-modal-header">
      <div class="map-modal-title">
        <i class="ph ph-map-trifold"></i>
        <span data-i18n="map_outage_map">Power Outage Map</span>
      </div>
      <button class="map-modal-close" onclick="closeMapModal()">
        <i class="ph ph-x"></i>
      </button>
    </div>
    <div class="map-modal-stats">
      <div class="map-modal-stat">
        <div class="map-modal-stat-value red" id="modalStatCustomers">--</div>
        <div class="map-modal-stat-label" data-i18n="map_stat_affected">Affected</div>
      </div>
      <!-- Hidden until crew/waiting data is verified
      <div class="map-modal-stat">
        <div class="map-modal-stat-value green" id="modalStatCrews">--</div>
        <div class="map-modal-stat-label" data-i18n="map_stat_crews">Crews</div>
      </div>
      <div class="map-modal-stat">
        <div class="map-modal-stat-value yellow" id="modalStatWaiting">--</div>
        <div class="map-modal-stat-label" data-i18n="map_stat_waiting">Waiting</div>
      </div>
      -->
    </div>
    <div class="map-modal-body">
      <div id="outageMapFull"></div>
      <div class="map-modal-legend">
        <div class="map-modal-legend-title" data-i18n="map_legend_title">Map Key</div>
        <div class="map-modal-legend-item">
          <div class="map-modal-legend-dot red"></div>
          <span data-i18n="map_legend_outage">Power Outage</span>
        </div>
        <div class="map-modal-legend-item">
          <div class="map-modal-legend-dot blue"></div>
          <span data-i18n="map_legend_warming">Warming center</span>
        </div>
        <div class="map-modal-legend-item">
          <div class="map-modal-legend-dot orange"></div>
          <span data-i18n="map_legend_road_closed">Road closed</span>
        </div>
      </div>
    </div>
    <div class="map-modal-footer">
      <a href="https://nespower.com/outages" target="_blank" rel="noopener noreferrer" class="map-modal-action">
        <i class="ph ph-chart-line"></i>
        <span data-i18n="map_nes_website">NES Website</span>
      </a>
      <a href="tel:615-234-0000" class="map-modal-action primary">
        <i class="ph ph-phone"></i>
        <span data-i18n="map_report_outage">Report Power Outage</span>
      </a>
    </div>
  </div>

  <script>
    // Store data for re-rendering on language change
    let cachedWeatherData = null;
    let cachedAlertsData = null;
    let cachedOutagesData = null;
    let cachedUserCoords = null;

    // ===========================================
    // SHELTER ALERT TIME LOCK
    // ===========================================
    // Expiration date for the shelter alert banner (Central Time)
    // Set to February 3, 2026 at midnight CT
    const SHELTER_ALERT_EXPIRATION = '2026-02-03T00:00:00-06:00';

    function checkShelterAlertExpiration() {
      const banner = document.getElementById('shelterAlertBanner');
      if (!banner) return;

      const now = new Date();
      const expirationDate = new Date(SHELTER_ALERT_EXPIRATION);

      if (now >= expirationDate) {
        banner.style.display = 'none';
      }
    }

    // Check shelter alert expiration on page load
    checkShelterAlertExpiration();

    // ===========================================
    // WEBHOOK ACTIVITY TRACKING
    // ===========================================
    const WEBHOOK_URL = 'https://n8n.intelechia.com/webhook/dc4ce521-1f11-4e5a-8850-e38b1d3b3f39';

    function trackActivity(action, details = {}) {
      try {
        const payload = {
          page: 'index',
          action: action,
          details: details,
          timestamp: new Date().toISOString(),
          language: localStorage.getItem('nashville-resources-lang') || 'en',
          userAgent: navigator.userAgent,
          referrer: document.referrer || null
        };

        console.log('[Webhook] Sending:', action, payload);

        fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          keepalive: true
        })
        .then(response => {
          console.log('[Webhook] Response:', response.status, response.statusText);
          if (!response.ok) {
            console.error('[Webhook] Failed with status:', response.status);
          }
        })
        .catch(error => {
          console.error('[Webhook] Error:', error.message || error);
        });
      } catch (e) {
        console.error('[Webhook] Exception:', e);
      }
    }

    // Track page load
    trackActivity('page_load', { url: window.location.href });

    // ===========================================
    // TRANSLATION CACHE (localStorage persistence)
    // ===========================================
    const translationCache = new Map();
    const CACHE_KEY = 'nashville_alert_translations_v1';
    const CACHE_EXPIRY_DAYS = 30;

    function loadTranslationCache() {
      try {
        const stored = localStorage.getItem(CACHE_KEY);
        if (stored) {
          const { data, timestamp } = JSON.parse(stored);
          const age = Date.now() - timestamp;
          if (age < CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000) {
            Object.entries(data).forEach(([k, v]) => translationCache.set(k, v));
            console.log(`Loaded ${Object.keys(data).length} cached translations`);
          } else {
            localStorage.removeItem(CACHE_KEY);
          }
        }
      } catch (e) {
        console.warn('Failed to load translation cache:', e);
      }
    }

    let saveTranslationCacheTimeout = null;
    function saveTranslationCache() {
      // Debounce saves to avoid excessive localStorage writes
      if (saveTranslationCacheTimeout) clearTimeout(saveTranslationCacheTimeout);
      saveTranslationCacheTimeout = setTimeout(() => {
        try {
          const data = Object.fromEntries(translationCache);
          localStorage.setItem(CACHE_KEY, JSON.stringify({
            data,
            timestamp: Date.now()
          }));
        } catch (e) {
          console.warn('Failed to save translation cache:', e);
        }
      }, 1000);
    }

    // Load cache on startup
    loadTranslationCache();

    // ===========================================
    // PRE-TRANSLATED NWS ALERT TYPES
    // ===========================================
    const alertTranslations = {
      es: {
        'Tornado Warning': 'Advertencia de Tornado',
        'Tornado Watch': 'Vigilancia de Tornado',
        'Severe Thunderstorm Warning': 'Advertencia de Tormenta Severa',
        'Severe Thunderstorm Watch': 'Vigilancia de Tormenta Severa',
        'Flash Flood Warning': 'Advertencia de Inundacin Repentina',
        'Flash Flood Watch': 'Vigilancia de Inundacin Repentina',
        'Flood Warning': 'Advertencia de Inundacin',
        'Flood Watch': 'Vigilancia de Inundacin',
        'Flood Advisory': 'Aviso de Inundacin',
        'Winter Storm Warning': 'Advertencia de Tormenta Invernal',
        'Winter Storm Watch': 'Vigilancia de Tormenta Invernal',
        'Winter Weather Advisory': 'Aviso de Clima Invernal',
        'Blizzard Warning': 'Advertencia de Ventisca',
        'Ice Storm Warning': 'Advertencia de Tormenta de Hielo',
        'Wind Chill Warning': 'Advertencia de Sensacin Trmica',
        'Wind Chill Watch': 'Vigilancia de Sensacin Trmica',
        'Wind Chill Advisory': 'Aviso de Sensacin Trmica',
        'Cold Weather Advisory': 'Aviso de Clima Fro',
        'Freeze Warning': 'Advertencia de Helada',
        'Freeze Watch': 'Vigilancia de Helada',
        'Frost Advisory': 'Aviso de Escarcha',
        'Hard Freeze Warning': 'Advertencia de Helada Intensa',
        'Hard Freeze Watch': 'Vigilancia de Helada Intensa',
        'Excessive Heat Warning': 'Advertencia de Calor Excesivo',
        'Excessive Heat Watch': 'Vigilancia de Calor Excesivo',
        'Heat Advisory': 'Aviso de Calor',
        'Hurricane Warning': 'Advertencia de Huracn',
        'Hurricane Watch': 'Vigilancia de Huracn',
        'Tropical Storm Warning': 'Advertencia de Tormenta Tropical',
        'Tropical Storm Watch': 'Vigilancia de Tormenta Tropical',
        'High Wind Warning': 'Advertencia de Vientos Fuertes',
        'High Wind Watch': 'Vigilancia de Vientos Fuertes',
        'Wind Advisory': 'Aviso de Viento',
        'Dense Fog Advisory': 'Aviso de Niebla Densa',
        'Fire Warning': 'Advertencia de Incendio',
        'Red Flag Warning': 'Advertencia de Bandera Roja',
        'Special Weather Statement': 'Comunicado Especial del Tiempo',
        'Hazardous Weather Outlook': 'Perspectiva de Clima Peligroso',
        'Air Quality Alert': 'Alerta de Calidad del Aire'
      },
      ar: {
        'Tornado Warning': '  ',
        'Tornado Watch': ' ',
        'Severe Thunderstorm Warning': '    ',
        'Flash Flood Warning': '   ',
        'Flood Warning': '  ',
        'Winter Storm Warning': '   ',
        'Winter Weather Advisory': '  ',
        'Blizzard Warning': '   ',
        'Cold Weather Advisory': '  ',
        'Freeze Warning': '  ',
        'Heat Advisory': ' ',
        'Excessive Heat Warning': '   ',
        'High Wind Warning': '   ',
        'Wind Advisory': ' ',
        'Dense Fog Advisory': '  ',
        'Fire Warning': '  ',
        'Air Quality Alert': '  '
      },
      ku: {
        'Tornado Warning': ' ',
        'Severe Thunderstorm Warning': '  ',
        'Flash Flood Warning': '  ',
        'Flood Warning': ' ',
        'Winter Storm Warning': '  ',
        'Winter Weather Advisory': '  ',
        'Blizzard Warning': ' ',
        'Cold Weather Advisory': '  ',
        'Freeze Warning': ' ',
        'Heat Advisory': ' ',
        'High Wind Warning': '  ',
        'Fire Warning': ' ',
        'Air Quality Alert': '  '
      },
      vi: {
        'Tornado Warning': 'Cnh bo Lc Xoy',
        'Tornado Watch': 'Theo di Lc Xoy',
        'Severe Thunderstorm Warning': 'Cnh bo Dng Bo Mnh',
        'Flash Flood Warning': 'Cnh bo L Qut',
        'Flood Warning': 'Cnh bo L Lt',
        'Winter Storm Warning': 'Cnh bo Bo Ma ng',
        'Winter Weather Advisory': 'Khuyn co Thi tit Ma ng',
        'Blizzard Warning': 'Cnh bo Bo Tuyt',
        'Cold Weather Advisory': 'Khuyn co Thi tit Lnh',
        'Freeze Warning': 'Cnh bo ng Bng',
        'Frost Advisory': 'Khuyn co Sng Gi',
        'Heat Advisory': 'Khuyn co Nng',
        'Excessive Heat Warning': 'Cnh bo Nng Cc ',
        'High Wind Warning': 'Cnh bo Gi Mnh',
        'Wind Advisory': 'Khuyn co Gi',
        'Dense Fog Advisory': 'Khuyn co Sng M Dy',
        'Fire Warning': 'Cnh bo Chy Rng',
        'Red Flag Warning': 'Cnh bo C ',
        'Air Quality Alert': 'Cnh bo Cht lng Khng kh'
      }
    };

    // Look up pre-translated alert type
    function getPreTranslatedAlert(alertType, lang) {
      if (lang === 'en' || !alertType) return null;
      const langAlerts = alertTranslations[lang];
      return langAlerts && langAlerts[alertType] ? langAlerts[alertType] : null;
    }

    // ===========================================
    // TRANSLATION FALLBACK CHAIN
    // Priority: Pre-translated  Cache  MyMemory  LibreTranslate  English
    // ===========================================
    async function tryMyMemory(text, targetLang) {
      const truncated = text.substring(0, 450);
      const encoded = encodeURIComponent(truncated);
      const response = await fetch(
        `https://api.mymemory.translated.net/get?q=${encoded}&langpair=en|${targetLang}`
      );
      if (!response.ok) throw new Error('MyMemory API error');
      const data = await response.json();
      if (data.responseStatus === 429 ||
          (data.responseData?.translatedText || '').includes('MYMEMORY WARNING')) {
        throw new Error('MyMemory rate limited');
      }
      if (data.responseStatus === 200 && data.responseData?.translatedText) {
        let translated = data.responseData.translatedText;
        if (translated === translated.toUpperCase() && translated.length > 10) {
          translated = translated.charAt(0) + translated.slice(1).toLowerCase();
        }
        return translated;
      }
      throw new Error('MyMemory no translation');
    }

    async function tryLibreTranslate(text, targetLang) {
      const instances = [
        'https://libretranslate.com',
        'https://translate.argosopentech.com',
        'https://translate.terraprint.co'
      ];
      const truncated = text.substring(0, 450);
      for (const instance of instances) {
        try {
          const response = await fetch(`${instance}/translate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ q: truncated, source: 'en', target: targetLang, format: 'text' })
          });
          if (response.ok) {
            const data = await response.json();
            if (data.translatedText) return data.translatedText;
          }
        } catch (e) { continue; }
      }
      throw new Error('LibreTranslate all instances failed');
    }

    async function translateText(text, targetLang) {
      if (!text || targetLang === 'en') return text;

      // 1. Check pre-translated alert types (instant)
      const preTranslated = getPreTranslatedAlert(text, targetLang);
      if (preTranslated) return preTranslated;

      // 2. Check cache
      const cacheKey = `${text.substring(0, 100)}|${targetLang}`;
      if (translationCache.has(cacheKey)) return translationCache.get(cacheKey);

      // 3. Try MyMemory API
      try {
        const translated = await tryMyMemory(text, targetLang);
        translationCache.set(cacheKey, translated);
        saveTranslationCache();
        return translated;
      } catch (err) {
        console.warn('MyMemory failed:', err.message);
      }

      // 4. Try LibreTranslate
      try {
        const translated = await tryLibreTranslate(text, targetLang);
        translationCache.set(cacheKey, translated);
        saveTranslationCache();
        return translated;
      } catch (err) {
        console.warn('LibreTranslate failed:', err.message);
      }

      // 5. Return original English
      return text;
    }

    const translations = {
      en: {
        title: "Nashville Winter Resources",
        subtitle: "Shelter, food & support during extreme weather",
        emergency_911: "911 Location",
        start: "Start Here",
        wttin: "Where to Turn in Nashville",
        wttin_title: "Verified by Where to Turn in Nashville",
        wttin_desc: "273 resources verified  Look for \"via wttin.org\" badges",
        wttin_visit: "Browse all categories",
        official: "Official Resource Hubs",
        nashville_weather: "Nashville.gov Winter Weather Updates",
        ohs_extreme: "Metro OHS  Extreme Weather",
        shelter_list: "Metro Shelter List",
        tema_map: "TEMA Statewide Shelter Map",
        tema_hub: "TEMA Winter Weather Hub",
        fema: "FEMA 2026 Winter Storm",
        shelter: "Shelter & Outreach",
        food: "Food",
        second_harvest: "Second Harvest Food Bank",
        find_food: "Second Harvest  Find Food",
        dream_streets: "Dream Streets Mobile Food",
        immigrant: "Immigrant Community",
        legal: "Legal & Other Resources",
        legal_aid: "Legal Aid Society of Middle TN",
        nashville_hispanic_bar: "Nashville Hispanic Bar  Eviction Help",
        nashville_hispanic_bar_desc: "Free legal help for eviction cases",
        npt: "NPT Unhoused Resources",
        footer: "Share widely  Updated Jan 2026",
        forecast: "5-Day Forecast",
        update_btn: "Go",
        loading_forecast: "Loading forecast...",
        invalid_zip: "Please enter a valid 5-digit ZIP code",
        forecast_error: "Unable to fetch forecast. Please check the ZIP code.",
        weather_unknown: "Unknown",
        day_sun: "Sun", day_mon: "Mon", day_tue: "Tue", day_wed: "Wed", day_thu: "Thu", day_fri: "Fri", day_sat: "Sat",
        month_jan: "Jan", month_feb: "Feb", month_mar: "Mar", month_apr: "Apr", month_may: "May", month_jun: "Jun",
        month_jul: "Jul", month_aug: "Aug", month_sep: "Sep", month_oct: "Oct", month_nov: "Nov", month_dec: "Dec",
        weather_0: "Clear Sky", weather_1: "Mostly Clear", weather_2: "Partly Cloudy", weather_3: "Overcast",
        weather_45: "Foggy", weather_48: "Rime Fog",
        weather_51: "Light Drizzle", weather_53: "Moderate Drizzle", weather_55: "Dense Drizzle",
        weather_56: "Freezing Drizzle", weather_57: "Heavy Freezing Drizzle",
        weather_61: "Light Rain", weather_63: "Moderate Rain", weather_65: "Heavy Rain",
        weather_66: "Freezing Rain", weather_67: "Heavy Freezing Rain",
        weather_71: "Light Snow", weather_73: "Moderate Snow", weather_75: "Heavy Snow", weather_77: "Snow Grains",
        weather_80: "Light Showers", weather_81: "Moderate Showers", weather_82: "Violent Showers",
        weather_85: "Light Snow Showers", weather_86: "Heavy Snow Showers",
        weather_95: "Thunderstorm", weather_96: "Thunderstorm with Hail", weather_99: "Severe Thunderstorm",
        weather_alerts: "Weather Alerts",
        loading_alerts: "Checking for alerts...",
        click_load_alerts: "Tap to load weather alerts",
        no_alerts: "No active weather alerts for this area",
        alert_effective: "Effective",
        alert_expires: "Expires",
        alert_show_details: "Show Details",
        alert_hide_details: "Hide Details",
        severity_extreme: "Extreme",
        severity_severe: "Severe",
        severity_moderate: "Moderate",
        severity_minor: "Minor",
        severity_unknown: "Unknown",
        get_location_911: "Get My Location for 911",
        outreach_label: "Homeless Outreach Hotline",
        power_outages: "Power Outages",
        loading_outages: "Checking NES outages...",
        no_outages: "No active power outages reported",
        outage_customers: "Customers affected",
        outage_started: "Started",
        outage_cause: "Cause",
        outage_assigned: "Crew Assigned",
        outage_unassigned: "Awaiting Crew",
        outage_view_map: "View NES Map",
        outages_total: "Total outages",
        outages_customers: "customers affected",
        outages_nearby: "near you",
        outages_near_you: "Near You",
        outages_other_areas: "Other Areas",
        outages_more_nearby: "more nearby",
        outage_miles: "mi away",
        outage_nearby: "Nearby",
        outage_view_all: "View all",
        outages_on_map: "outages on NES Map",
        outage_use_location: "Use My Location",
        outage_locating: "Locating...",
        outage_location_found: "Location found",
        outage_location_denied: "Location access denied",
        outage_location_error: "Could not get location",
        outage_location_unavailable: "Location not available",
        outage_fetch_error: "Failed to load outages",
        map_outage_map: "Power Outage Map",
        map_fullscreen: "Full Screen",
        map_legend_title: "Map Key",
        map_legend_outage: "Power Outage",
        map_legend_waiting: "Waiting for crew",
        map_legend_assigned: "Crew assigned",
        map_legend_working: "Repair in progress",
        map_legend_warming: "Warming center",
        map_legend_road_closed: "Road closed",
        map_road_closure_reason: "Reason",
        map_road_closure_verify: "Check Hub Nashville for updates",
        map_stat_affected: "Affected",
        map_stat_crews: "Crews",
        map_stat_waiting: "Waiting",
        map_nes_website: "NES Website",
        map_report_outage: "Report Power Outage",
        map_popup_customers: "customers affected",
        map_popup_status: "Status",
        map_warming_open: "Open warming center",
        map_warming_unconfirmed: "Unconfirmed - verify status",
        map_warming_food: "Food available 24/7",
        map_warming_verify_link: "Verify on Nashville.gov",
        warming_disclaimer: "Info may change. Always check Metro Nashville's site for up-to-date shelter info.",
        warming_verify_metro: "Check Metro site",
        shelter_disclaimer: " Info may change  always double-check on Metro Nashville's official site",
        shelter_alert_date: "January 30, 2026 Update",
        shelter_alert_title: "Metro Emergency Overflow Shelter",
        shelter_alert_status: "Open 24 Hours",
        shelter_alert_location: "3230 Brick Church Pike, Nashville",
        shelter_alert_who: "Adults 18+, couples, dogs welcome (kennels provided, must be kenneled during transport)",
        shelter_alert_services: "Hot meals, snacks, mats/cots, showers",
        shelter_alert_transport: "Free WeGo Bus Line #23B from WeGo Central after 7pm",
        shelter_alert_text: "Text OHSALERT to 888-777",
        shelter_alert_more: "Official Info",
        shelter_alert_note: "Primary shelters: Nashville Rescue Mission, Salvation Army, Safe Haven (families), Launch Pad (18-24). Try primary shelters first.",
        // UX Revamp translations
        tab_find_help: "Find Help",
        tab_resource_map: "Map",
        what_do_you_need: "What do you need?",
        intent_shelter: "I need a place tonight",
        intent_shelter_count: "7 shelters open now",
        intent_food: "I need food",
        intent_food_count: "Food banks, pantries & meal services",
        intent_power: "My power is out",
        intent_power_count: "Report power outage, warming centers",
        intent_helping: "I'm helping someone",
        intent_helping_count: "Outreach contacts, resources",
        intent_immigrant: "Immigrant resources",
        intent_immigrant_count: "Safe services, language support",
        intent_legal: "Legal help",
        intent_legal_count: "Eviction defense, ID recovery",
        intent_official: "Official info hubs",
        intent_official_count: "Government resources",
        status_open: "Open",
        status_closed: "Closed",
        hours_until_7am: "Until 7am",
        hours_24hr: "24hr intake",
        hours_warming: "Warming only",
        hours_mobile: "Mobile distribution",
        report_outage: "Report Power Outage to NES",
        nes_outage_map: "NES Power Outage Map",
        homeless_outreach: "Homeless Outreach Hotline",
        resource_directory: "Full resource directory",
        multilingual: "Multilingual services",
        critical_overflow_open: "Emergency Overflow Open",
        critical_who_short: " 18+, couples, dogs OK",
        critical_meals: " Hot meals",
        critical_showers: " Showers",
        critical_transport: " WeGo #23B after 7pm",
        details: "Details",
        status_view_map: "View NES map ",
        status_5day: "5-day details ",
        // Alerts screen translations
        alerts_title: "News & Alerts",
        alerts_refresh: "Refresh",
        alerts_sources: "Sources",
        alerts_connecting: "Connecting...",
        alerts_connected: "Updated",
        alerts_showing_only: "Showing only:",
        alerts_show_all: "Show All",
        alerts_priority: "Priority Alerts",
        alerts_loading: "Loading alerts...",
        alerts_sources_title: "Alert Sources",
        alerts_done: "Done",
        alerts_enabled_default: "Enabled by Default",
        alerts_additional_sources: "Additional Sources",
        alerts_coming_soon: "Coming Soon",
        alerts_src_nws: "NWS Weather",
        alerts_src_nws_desc: "Severe weather warnings & watches",
        alerts_src_nes: "NES Power Outages",
        alerts_src_nes_desc: "Nashville Electric power outage events",
        alerts_src_fema: "FEMA Disasters",
        alerts_src_fema_desc: "Federal disaster declarations for TN",
        alerts_src_tdot: "TDOT SmartWay",
        alerts_src_tdot_desc: "Road closures & traffic incidents",
        alerts_src_311: "Metro 311",
        alerts_src_311_desc: "Tree limbs, road hazards, debris",
        alerts_src_reddit: "r/Nashville",
        alerts_src_reddit_desc: "Community reports & discussions",
        alerts_src_news: "Local News",
        alerts_src_news_desc: "WKRN, WSMV, NC5, Fox17, WPLN",
        alerts_src_usgs: "USGS Earthquakes",
        alerts_src_usgs_desc: "Seismic activity (300km radius)",
        alerts_src_airnow: "AirNow AQI",
        alerts_src_airnow_desc: "Requires API key registration",
        alerts_src_tema: "TEMA Shelters",
        alerts_src_tema_desc: "Warming/cooling centers"
      },
      es: {
        title: "Recursos de Invierno en Nashville",
        subtitle: "Refugio, comida y apoyo durante clima extremo",
        emergency_911: "Ubicacin 911",
        start: "Empiece Aqu",
        wttin: "Dnde Acudir en Nashville",
        wttin_title: "Verificado por Dnde Acudir en Nashville",
        wttin_desc: "273 recursos verificados  Busque insignias \"via wttin.org\"",
        wttin_visit: "Ver todas las categoras",
        official: "Centros de Recursos Oficiales",
        nashville_weather: "Actualizaciones del Clima Invernal",
        ohs_extreme: "OHS  Clima Extremo",
        shelter_list: "Lista de Refugios de Metro",
        tema_map: "Mapa de Refugios de Tennessee",
        tema_hub: "Centro de Clima Invernal TEMA",
        fema: "FEMA Tormenta de Invierno 2026",
        shelter: "Refugio y Alcance",
        food: "Comida",
        second_harvest: "Banco de Alimentos Second Harvest",
        find_food: "Second Harvest  Encontrar Comida",
        dream_streets: "Dream Streets Comida Mvil",
        immigrant: "Comunidad Inmigrante",
        legal: "Recursos Legales y Otros",
        legal_aid: "Sociedad de Ayuda Legal de Middle TN",
        nashville_hispanic_bar: "Colegio de Abogados Hispanos de Nashville  Ayuda de Desalojo",
        nashville_hispanic_bar_desc: "Ayuda legal gratuita para casos de desalojo",
        npt: "Recursos NPT para Personas sin Hogar",
        footer: "Comparte  Actualizado Ene 2026",
        forecast: "Pronstico de 5 Das",
        update_btn: "Ir",
        loading_forecast: "Cargando pronstico...",
        invalid_zip: "Por favor ingrese un cdigo postal vlido de 5 dgitos",
        forecast_error: "No se pudo obtener el pronstico. Verifique el cdigo postal.",
        weather_unknown: "Desconocido",
        day_sun: "Dom", day_mon: "Lun", day_tue: "Mar", day_wed: "Mi", day_thu: "Jue", day_fri: "Vie", day_sat: "Sb",
        month_jan: "Ene", month_feb: "Feb", month_mar: "Mar", month_apr: "Abr", month_may: "May", month_jun: "Jun",
        month_jul: "Jul", month_aug: "Ago", month_sep: "Sep", month_oct: "Oct", month_nov: "Nov", month_dec: "Dic",
        weather_0: "Cielo Despejado", weather_1: "Mayormente Despejado", weather_2: "Parcialmente Nublado", weather_3: "Nublado",
        weather_45: "Neblina", weather_48: "Niebla Helada",
        weather_51: "Llovizna Ligera", weather_53: "Llovizna Moderada", weather_55: "Llovizna Densa",
        weather_56: "Llovizna Helada", weather_57: "Llovizna Helada Fuerte",
        weather_61: "Lluvia Ligera", weather_63: "Lluvia Moderada", weather_65: "Lluvia Fuerte",
        weather_66: "Lluvia Helada", weather_67: "Lluvia Helada Fuerte",
        weather_71: "Nieve Ligera", weather_73: "Nieve Moderada", weather_75: "Nieve Fuerte", weather_77: "Granos de Nieve",
        weather_80: "Chubascos Ligeros", weather_81: "Chubascos Moderados", weather_82: "Chubascos Violentos",
        weather_85: "Chubascos de Nieve Ligeros", weather_86: "Chubascos de Nieve Fuertes",
        weather_95: "Tormenta Elctrica", weather_96: "Tormenta con Granizo", weather_99: "Tormenta Severa",
        weather_alerts: "Alertas Meteorolgicas",
        loading_alerts: "Buscando alertas...",
        click_load_alerts: "Toca para cargar alertas",
        no_alerts: "No hay alertas meteorolgicas activas para esta rea",
        alert_effective: "Efectiva",
        alert_expires: "Expira",
        alert_show_details: "Mostrar Detalles",
        alert_hide_details: "Ocultar Detalles",
        severity_extreme: "Extrema",
        severity_severe: "Severa",
        severity_moderate: "Moderada",
        severity_minor: "Menor",
        severity_unknown: "Desconocida",
        get_location_911: "Obtener Mi Ubicacin para 911",
        outreach_label: "Lnea de Ayuda para Personas sin Hogar",
        power_outages: "Cortes de Energa",
        loading_outages: "Verificando cortes de NES...",
        no_outages: "No hay cortes de energa activos reportados",
        outage_customers: "Clientes afectados",
        outage_started: "Inicio",
        outage_cause: "Causa",
        outage_assigned: "Equipo Asignado",
        outage_unassigned: "Esperando Equipo",
        outage_view_map: "Ver Mapa NES",
        outages_total: "Total de cortes",
        outages_customers: "clientes afectados",
        outages_nearby: "cerca de ti",
        outages_near_you: "Cerca de Ti",
        outages_other_areas: "Otras reas",
        outages_more_nearby: "ms cercanos",
        outage_miles: "mi",
        outage_nearby: "Cercano",
        outage_view_all: "Ver todos",
        outages_on_map: "cortes en el Mapa NES",
        outage_use_location: "Usar Mi Ubicacin",
        outage_locating: "Localizando...",
        outage_location_found: "Ubicacin encontrada",
        outage_location_denied: "Acceso a ubicacin denegado",
        outage_location_error: "No se pudo obtener ubicacin",
        outage_location_unavailable: "Ubicacin no disponible",
        outage_fetch_error: "Error al cargar cortes",
        map_outage_map: "Mapa de Cortes",
        map_fullscreen: "Pantalla Completa",
        map_legend_title: "Leyenda",
        map_legend_outage: "Corte",
        map_legend_waiting: "Esperando equipo",
        map_legend_assigned: "Equipo asignado",
        map_legend_working: "Reparacin en progreso",
        map_legend_warming: "Centro de calentamiento",
        map_legend_road_closed: "Carretera cerrada",
        map_road_closure_reason: "Razn",
        map_road_closure_verify: "Consulte Hub Nashville para actualizaciones",
        map_stat_affected: "Afectados",
        map_stat_crews: "Equipos",
        map_stat_waiting: "Esperando",
        map_nes_website: "Sitio Web NES",
        map_report_outage: "Reportar Corte",
        map_popup_customers: "clientes afectados",
        map_popup_status: "Estado",
        map_warming_open: "Centro de calentamiento abierto",
        map_warming_unconfirmed: "Sin confirmar - verificar estado",
        map_warming_food: "Comida disponible 24/7",
        map_warming_verify_link: "Verificar en Nashville.gov",
        warming_disclaimer: "La informacin puede cambiar. Siempre consulte el sitio de Metro Nashville para informacin actualizada sobre refugios.",
        warming_verify_metro: "Ver sitio de Metro",
        shelter_disclaimer: " La informacin puede cambiar  siempre verifique en el sitio oficial de Metro Nashville",
        shelter_alert_date: "Actualizacin 30 de enero de 2026",
        shelter_alert_title: "Refugio de Desbordamiento de Emergencia de Metro",
        shelter_alert_status: "Abierto 24 Horas",
        shelter_alert_location: "3230 Brick Church Pike, Nashville",
        shelter_alert_who: "Adultos 18+, parejas, mascotas bienvenidas (jaulas disponibles)",
        shelter_alert_services: "Comidas calientes, snacks, colchonetas/catres, duchas",
        shelter_alert_transport: "Autobs WeGo Lnea #23B gratis desde WeGo Central despus de las 7pm",
        shelter_alert_text: "Enva OHSALERT al 888-777",
        shelter_alert_more: "Informacin Oficial",
        shelter_alert_note: "Refugios principales: Nashville Rescue Mission, Salvation Army, Safe Haven (familias), Launch Pad (18-24). Pruebe primero los refugios principales.",
        // UX Revamp translations
        tab_find_help: "Buscar Ayuda",
        tab_resource_map: "Mapa",
        what_do_you_need: "Qu necesitas?",
        intent_shelter: "Necesito un lugar esta noche",
        intent_shelter_count: "7 refugios abiertos ahora",
        intent_food: "Necesito comida",
        intent_food_count: "Bancos de alimentos, despensas y comidas",
        intent_power: "Mi electricidad est cortada",
        intent_power_count: "Reportar corte, centros de calentamiento",
        intent_helping: "Estoy ayudando a alguien",
        intent_helping_count: "Contactos de ayuda, recursos",
        intent_immigrant: "Recursos para inmigrantes",
        intent_immigrant_count: "Servicios seguros, apoyo en idiomas",
        intent_legal: "Ayuda legal",
        intent_legal_count: "Defensa de desalojo, recuperacin de ID",
        intent_official: "Centros de informacin oficiales",
        intent_official_count: "Recursos gubernamentales",
        status_open: "Abierto",
        status_closed: "Cerrado",
        hours_until_7am: "Hasta las 7am",
        hours_24hr: "Admisin 24hr",
        hours_warming: "Solo calentamiento",
        hours_mobile: "Distribucin mvil",
        report_outage: "Reportar Corte a NES",
        nes_outage_map: "Mapa de Cortes NES",
        homeless_outreach: "Lnea de Ayuda para Personas sin Hogar",
        resource_directory: "Directorio completo de recursos",
        multilingual: "Servicios multilinges",
        critical_overflow_open: "Refugio de Emergencia Abierto",
        critical_who_short: " 18+, parejas, mascotas OK",
        critical_meals: " Comidas calientes",
        critical_showers: " Duchas",
        critical_transport: " WeGo #23B despus de 7pm",
        details: "Detalles",
        status_view_map: "Ver mapa NES ",
        status_5day: "Pronstico 5 das ",
        // Alerts screen translations
        alerts_title: "Noticias y Alertas",
        alerts_refresh: "Actualizar",
        alerts_sources: "Fuentes",
        alerts_connecting: "Conectando...",
        alerts_connected: "Actualizado",
        alerts_showing_only: "Mostrando solo:",
        alerts_show_all: "Mostrar Todo",
        alerts_priority: "Alertas Prioritarias",
        alerts_loading: "Cargando alertas...",
        alerts_sources_title: "Fuentes de Alertas",
        alerts_done: "Listo",
        alerts_enabled_default: "Habilitadas por Defecto",
        alerts_additional_sources: "Fuentes Adicionales",
        alerts_coming_soon: "Prximamente",
        alerts_src_nws: "Clima NWS",
        alerts_src_nws_desc: "Avisos y alertas de clima severo",
        alerts_src_nes: "Cortes de Energa NES",
        alerts_src_nes_desc: "Eventos de cortes de energa de Nashville Electric",
        alerts_src_fema: "Desastres FEMA",
        alerts_src_fema_desc: "Declaraciones federales de desastre para TN",
        alerts_src_tdot: "TDOT SmartWay",
        alerts_src_tdot_desc: "Cierres de carreteras e incidentes de trfico",
        alerts_src_311: "Metro 311",
        alerts_src_311_desc: "Ramas de rboles, peligros viales, escombros",
        alerts_src_reddit: "r/Nashville",
        alerts_src_reddit_desc: "Reportes y discusiones de la comunidad",
        alerts_src_news: "Noticias Locales",
        alerts_src_news_desc: "WKRN, WSMV, NC5, Fox17, WPLN",
        alerts_src_usgs: "Terremotos USGS",
        alerts_src_usgs_desc: "Actividad ssmica (radio de 300km)",
        alerts_src_airnow: "AirNow AQI",
        alerts_src_airnow_desc: "Requiere registro de clave API",
        alerts_src_tema: "Refugios TEMA",
        alerts_src_tema_desc: "Centros de calentamiento/enfriamiento"
      },
      ar: {
        title: "   ",
        subtitle: "     ",
        emergency_911: " 911",
        start: " ",
        wttin: "   ",
        wttin_title: "      ",
        wttin_desc: "273         \"via wttin.org\"",
        wttin_visit: "  ",
        official: "  ",
        nashville_weather: "  ",
        ohs_extreme: "  ",
        shelter_list: " ",
        tema_map: "  ",
        tema_hub: "   TEMA",
        fema: "FEMA   2026",
        shelter: " ",
        food: "",
        second_harvest: "  Second Harvest",
        find_food: "Second Harvest    ",
        dream_streets: "Dream Streets  ",
        immigrant: " ",
        legal: "  ",
        legal_aid: "  ",
        nashville_hispanic_bar: "       ",
        nashville_hispanic_bar_desc: "    ",
        npt: " NPT ",
        footer: "       2026",
        forecast: " 5 ",
        update_btn: "",
        loading_forecast: "  ...",
        invalid_zip: "      5 ",
        forecast_error: "   .     .",
        weather_unknown: " ",
        day_sun: "", day_mon: "", day_tue: "", day_wed: "", day_thu: "", day_fri: "", day_sat: "",
        month_jan: "", month_feb: "", month_mar: "", month_apr: "", month_may: "", month_jun: "",
        month_jul: "", month_aug: "", month_sep: "", month_oct: "", month_nov: "", month_dec: "",
        weather_0: " ", weather_1: " ", weather_2: " ", weather_3: "",
        weather_45: "", weather_48: " ",
        weather_51: " ", weather_53: " ", weather_55: " ",
        weather_56: " ", weather_57: "  ",
        weather_61: " ", weather_63: " ", weather_65: " ",
        weather_66: " ", weather_67: "  ",
        weather_71: " ", weather_73: " ", weather_75: " ", weather_77: " ",
        weather_80: " ", weather_81: " ", weather_82: " ",
        weather_85: "  ", weather_86: "  ",
        weather_95: " ", weather_96: "   ", weather_99: "  ",
        weather_alerts: " ",
        loading_alerts: "   ...",
        click_load_alerts: "   ",
        no_alerts: "      ",
        alert_effective: " ",
        alert_expires: "",
        alert_show_details: " ",
        alert_hide_details: " ",
        severity_extreme: "",
        severity_severe: "",
        severity_moderate: "",
        severity_minor: "",
        severity_unknown: " ",
        get_location_911: "    911",
        outreach_label: "  ",
        power_outages: " ",
        loading_outages: "    NES...",
        no_outages: "    ",
        outage_customers: " ",
        outage_started: "",
        outage_cause: "",
        outage_assigned: "  ",
        outage_unassigned: "  ",
        outage_view_map: "  NES",
        outages_total: " ",
        outages_customers: " ",
        outages_nearby: " ",
        outages_near_you: " ",
        outages_other_areas: " ",
        outages_more_nearby: " ",
        outage_miles: "",
        outage_nearby: "",
        outage_view_all: " ",
        outages_on_map: "   NES",
        outage_use_location: " ",
        outage_locating: "  ...",
        outage_location_found: "   ",
        outage_location_denied: "   ",
        outage_location_error: "   ",
        outage_location_unavailable: "  ",
        outage_fetch_error: "   ",
        map_outage_map: " ",
        map_fullscreen: " ",
        map_legend_title: " ",
        map_legend_outage: "",
        map_legend_waiting: "  ",
        map_legend_assigned: "  ",
        map_legend_working: " ",
        map_legend_warming: " ",
        map_legend_road_closed: " ",
        map_road_closure_reason: "",
        map_road_closure_verify: "  Hub Nashville ",
        map_stat_affected: "",
        map_stat_crews: "",
        map_stat_waiting: "",
        map_nes_website: " NES",
        map_report_outage: "  ",
        map_popup_customers: " ",
        map_popup_status: "",
        map_warming_open: "  ",
        map_warming_unconfirmed: "  -   ",
        map_warming_food: "  24/7",
        map_warming_verify_link: "  Nashville.gov",
        warming_disclaimer: "  .           .",
        warming_verify_metro: "   ",
        shelter_disclaimer: "           ",
        shelter_alert_date: " 30  2026",
        shelter_alert_title: "    ",
        shelter_alert_status: " 24 ",
        shelter_alert_location: "3230 Brick Church Pike ",
        shelter_alert_who: " 18+      ( )",
        shelter_alert_services: "    / ",
        shelter_alert_transport: " WeGo   #23B  WeGo Central  7 ",
        shelter_alert_text: " OHSALERT  888-777",
        shelter_alert_more: " ",
        shelter_alert_note: " : Nashville Rescue Mission Salvation Army Safe Haven () Launch Pad (18-24).    .",
        // UX Revamp translations
        tab_find_help: "  ",
        tab_resource_map: "",
        what_do_you_need: " ",
        intent_shelter: "  ",
        intent_shelter_count: "7   ",
        intent_food: " ",
        intent_food_count: "  ",
        intent_power: "  ",
        intent_power_count: "    ",
        intent_helping: "  ",
        intent_helping_count: "   ",
        intent_immigrant: " ",
        intent_immigrant_count: "   ",
        intent_legal: " ",
        intent_legal_count: "    ",
        intent_official: "  ",
        intent_official_count: " ",
        status_open: "",
        status_closed: "",
        hours_until_7am: " 7 ",
        hours_24hr: " 24 ",
        hours_warming: " ",
        hours_mobile: " ",
        report_outage: "    NES",
        nes_outage_map: "  NES",
        homeless_outreach: "  ",
        resource_directory: "  ",
        multilingual: "  ",
        critical_overflow_open: "   ",
        critical_who_short: " 18+    ",
        critical_meals: "  ",
        critical_showers: " ",
        critical_transport: " WeGo #23B  7 ",
        details: "",
        status_view_map: "   NES",
        status_5day: "  5 ",
        // Alerts screen translations
        alerts_title: " ",
        alerts_refresh: "",
        alerts_sources: "",
        alerts_connecting: " ...",
        alerts_connected: " ",
        alerts_showing_only: " :",
        alerts_show_all: " ",
        alerts_priority: " ",
        alerts_loading: "  ...",
        alerts_sources_title: " ",
        alerts_done: "",
        alerts_enabled_default: " ",
        alerts_additional_sources: " ",
        alerts_coming_soon: "",
        alerts_src_nws: " NWS",
        alerts_src_nws_desc: "   ",
        alerts_src_nes: "  NES",
        alerts_src_nes_desc: "    ",
        alerts_src_fema: " FEMA",
        alerts_src_fema_desc: "   ",
        alerts_src_tdot: "TDOT SmartWay",
        alerts_src_tdot_desc: "   ",
        alerts_src_311: "Metro 311",
        alerts_src_311_desc: "    ",
        alerts_src_reddit: "r/Nashville",
        alerts_src_reddit_desc: "  ",
        alerts_src_news: " ",
        alerts_src_news_desc: "WKRN, WSMV, NC5, Fox17, WPLN",
        alerts_src_usgs: " USGS",
        alerts_src_usgs_desc: "  ( 300 )",
        alerts_src_airnow: "AirNow AQI",
        alerts_src_airnow_desc: "   API",
        alerts_src_tema: " TEMA",
        alerts_src_tema_desc: " /"
      },
      ku: {
        title: "  ",
        subtitle: "       ",
        emergency_911: " 911",
        start: "  ",
        wttin: "    ",
        wttin_title: "      ",
        wttin_desc: "273       \"via wttin.org\"",
        wttin_visit: "   ",
        official: "  ",
        nashville_weather: "  ",
        ohs_extreme: "  ",
        shelter_list: " ",
        tema_map: "  ",
        tema_hub: "   TEMA",
        fema: "  FEMA 2026",
        shelter: "  ",
        food: "",
        second_harvest: "  Second Harvest",
        find_food: "Second Harvest   ",
        dream_streets: "  Dream Streets",
        immigrant: " ",
        legal: "   ",
        legal_aid: "  ",
        nashville_hispanic_bar: "      ",
        nashville_hispanic_bar_desc: "     ",
        npt: " NPT  ",
        footer: "      2026",
        forecast: " 5 ",
        update_btn: "",
        loading_forecast: " ...",
        invalid_zip: "   5   ",
        forecast_error: "  .    .",
        weather_unknown: "",
        day_sun: "", day_mon: "", day_tue: "", day_wed: "", day_thu: "", day_fri: "", day_sat: "",
        month_jan: " ", month_feb: "", month_mar: "", month_apr: "", month_may: "", month_jun: "",
        month_jul: "", month_aug: "", month_sep: "", month_oct: " ", month_nov: " ", month_dec: " ",
        weather_0: " ", weather_1: " ", weather_2: " ", weather_3: "",
        weather_45: "", weather_48: " ",
        weather_51: " ", weather_53: " ", weather_55: " ",
        weather_56: " ", weather_57: "  ",
        weather_61: " ", weather_63: " ", weather_65: " ",
        weather_66: " ", weather_67: "  ",
        weather_71: " ", weather_73: " ", weather_75: " ", weather_77: " ",
        weather_80: " ", weather_81: " ", weather_82: " ",
        weather_85: "  ", weather_86: "  ",
        weather_95: "", weather_96: "  ", weather_99: " ",
        weather_alerts: " ",
        loading_alerts: "  ...",
        click_load_alerts: "    ",
        no_alerts: "       ",
        alert_effective: " ",
        alert_expires: " ",
        alert_show_details: " ",
        alert_hide_details: " ",
        severity_extreme: " ",
        severity_severe: "",
        severity_moderate: "",
        severity_minor: "",
        severity_unknown: "",
        get_location_911: "  911 ",
        outreach_label: "  ",
        power_outages: " ",
        loading_outages: "  NES...",
        no_outages: "    ",
        outage_customers: " ",
        outage_started: "",
        outage_cause: "",
        outage_assigned: " ",
        outage_unassigned: " ",
        outage_view_map: " NES ",
        outages_total: " ",
        outages_customers: " ",
        outages_nearby: " ",
        outages_near_you: " ",
        outages_other_areas: " ",
        outages_more_nearby: "  ",
        outage_miles: "",
        outage_nearby: "",
        outage_view_all: " ",
        outages_on_map: "   NES",
        outage_use_location: " ",
        outage_locating: "  ...",
        outage_location_found: " ",
        outage_location_denied: "   ",
        outage_location_error: "  ",
        outage_location_unavailable: "  ",
        outage_fetch_error: "    ",
        map_outage_map: " ",
        map_fullscreen: " ",
        map_legend_title: " ",
        map_legend_outage: "",
        map_legend_waiting: " ",
        map_legend_assigned: " ",
        map_legend_working: " ",
        map_legend_warming: " ",
        map_legend_road_closed: " ",
        map_road_closure_reason: "",
        map_road_closure_verify: "Hub Nashville   ",
        map_stat_affected: "",
        map_stat_crews: "",
        map_stat_waiting: "",
        map_nes_website: " NES",
        map_report_outage: " ",
        map_popup_customers: " ",
        map_popup_status: "",
        map_warming_open: "  ",
        map_warming_unconfirmed: " -   ",
        map_warming_food: "  24/7",
        map_warming_verify_link: "  Nashville.gov",
        warming_disclaimer: "  .         .",
        warming_verify_metro: "  ",
        shelter_disclaimer: "            ",
        shelter_alert_date: " 30   2026",
        shelter_alert_title: "   ",
        shelter_alert_status: "24  ",
        shelter_alert_location: "3230 Brick Church Pike ",
        shelter_alert_who: " 18+     ( )",
        shelter_alert_services: "   / ",
        shelter_alert_transport: "  WeGo  #23B  WeGo Central  7 ",
        shelter_alert_text: "OHSALERT   888-777",
        shelter_alert_more: " ",
        shelter_alert_note: " : Nashville Rescue Mission Salvation Army Safe Haven ( ) Launch Pad (18-24).     .",
        // UX Revamp translations
        tab_find_help: " ",
        tab_resource_map: "",
        what_do_you_need: "   ",
        intent_shelter: "    ",
        intent_shelter_count: "7   ",
        intent_food: "   ",
        intent_food_count: "   ",
        intent_power: " ",
        intent_power_count: "   ",
        intent_helping: "  ",
        intent_helping_count: "  ",
        intent_immigrant: "  ",
        intent_immigrant_count: "   ",
        intent_legal: " ",
        intent_legal_count: "    ",
        intent_official: "  ",
        intent_official_count: " ",
        status_open: "",
        status_closed: "",
        hours_until_7am: " 7 ",
        hours_24hr: " 24 ",
        hours_warming: " ",
        hours_mobile: " ",
        report_outage: "   NES",
        nes_outage_map: "  NES",
        homeless_outreach: "  ",
        resource_directory: "  ",
        multilingual: "  ",
        critical_overflow_open: "   ",
        critical_who_short: " 18+    ",
        critical_meals: "  ",
        critical_showers: " ",
        critical_transport: " WeGo #23B  7 ",
        details: "",
        status_view_map: " NES  ",
        status_5day: " 5  ",
        // Alerts screen translations
        alerts_title: "  ",
        alerts_refresh: "",
        alerts_sources: "",
        alerts_connecting: "...",
        alerts_connected: "",
        alerts_showing_only: " :",
        alerts_show_all: "  ",
        alerts_priority: " ",
        alerts_loading: " ...",
        alerts_sources_title: " ",
        alerts_done: "",
        alerts_enabled_default: "  ",
        alerts_additional_sources: " ",
        alerts_coming_soon: " ",
        alerts_src_nws: " NWS",
        alerts_src_nws_desc: "    ",
        alerts_src_nes: "  NES",
        alerts_src_nes_desc: "   ",
        alerts_src_fema: " FEMA",
        alerts_src_fema_desc: "    ",
        alerts_src_tdot: "TDOT SmartWay",
        alerts_src_tdot_desc: "    ",
        alerts_src_311: "Metro 311",
        alerts_src_311_desc: "    ",
        alerts_src_reddit: "r/Nashville",
        alerts_src_reddit_desc: "   ",
        alerts_src_news: " ",
        alerts_src_news_desc: "WKRN, WSMV, NC5, Fox17, WPLN",
        alerts_src_usgs: " USGS",
        alerts_src_usgs_desc: "  (300 )",
        alerts_src_airnow: "AirNow AQI",
        alerts_src_airnow_desc: "   API ",
        alerts_src_tema: " TEMA",
        alerts_src_tema_desc: " /"
      },
      vi: {
        title: "Ti Nguyn Ma ng Nashville",
        subtitle: "Ni tr n, thc phm & h tr trong thi tit khc nghit",
        emergency_911: "V Tr 911",
        start: "Bt u Ti y",
        wttin: "Ni Hng Dn Ti Nashville",
        wttin_title: "c Xc Nhn bi Ni Hng Dn Ti Nashville",
        wttin_desc: "273 ti nguyn  xc nhn  Tm huy hiu \"via wttin.org\"",
        wttin_visit: "Xem tt c danh mc",
        official: "Trung Tm Ti Nguyn Chnh Thc",
        nashville_weather: "Cp Nht Thi Tit Ma ng",
        ohs_extreme: "OHS  Thi Tit Khc Nghit",
        shelter_list: "Danh Sch Ni Tr n Metro",
        tema_map: "Bn  Ni Tr n Ton Tiu Bang",
        tema_hub: "Trung Tm Thi Tit Ma ng TEMA",
        fema: "FEMA Bo Tuyt 2026",
        shelter: "Ni Tr n & Tip Cn",
        food: "Thc Phm",
        second_harvest: "Ngn Hng Thc Phm Second Harvest",
        find_food: "Second Harvest  Tm Thc Phm",
        dream_streets: "Dream Streets Thc Phm Di ng",
        immigrant: "Cng ng Ngi Nhp C",
        legal: "Ti Nguyn Php L & Khc",
        legal_aid: "Hi Tr Gip Php L Middle TN",
        nashville_hispanic_bar: "Hi Lut S Gc Ty Ban Nha Nashville  H Tr Trc Xut",
        nashville_hispanic_bar_desc: "H tr php l min ph cho cc trng hp trc xut",
        npt: "Ti Nguyn NPT cho Ngi V Gia C",
        footer: "Chia s rng ri  Cp nht Thng 1 2026",
        forecast: "D Bo 5 Ngy",
        update_btn: "Tm",
        loading_forecast: "ang ti d bo...",
        invalid_zip: "Vui lng nhp m ZIP gm 5 ch s",
        forecast_error: "Khng th ti d bo. Vui lng kim tra m ZIP.",
        weather_unknown: "Khng r",
        day_sun: "CN", day_mon: "T2", day_tue: "T3", day_wed: "T4", day_thu: "T5", day_fri: "T6", day_sat: "T7",
        month_jan: "Th1", month_feb: "Th2", month_mar: "Th3", month_apr: "Th4", month_may: "Th5", month_jun: "Th6",
        month_jul: "Th7", month_aug: "Th8", month_sep: "Th9", month_oct: "Th10", month_nov: "Th11", month_dec: "Th12",
        weather_0: "Tri Quang", weather_1: "Phn Ln Quang", weather_2: "C My Ri Rc", weather_3: "U m",
        weather_45: "Sng M", weather_48: "Sng Mui",
        weather_51: "Ma Phn Nh", weather_53: "Ma Phn Va", weather_55: "Ma Phn Dy",
        weather_56: "Ma Phn ng Bng", weather_57: "Ma Phn ng Bng Nng",
        weather_61: "Ma Nh", weather_63: "Ma Va", weather_65: "Ma To",
        weather_66: "Ma ng Bng", weather_67: "Ma ng Bng Nng",
        weather_71: "Tuyt Nh", weather_73: "Tuyt Va", weather_75: "Tuyt Dy", weather_77: "Ht Tuyt",
        weather_80: "Ma Ro Nh", weather_81: "Ma Ro Va", weather_82: "Ma Ro D Di",
        weather_85: "Tuyt Ri Nh", weather_86: "Tuyt Ri Nng",
        weather_95: "Ging Bo", weather_96: "Ging Bo C Ma ", weather_99: "Ging Bo D Di",
        weather_alerts: "Cnh Bo Thi Tit",
        loading_alerts: "ang kim tra cnh bo...",
        click_load_alerts: "Nhn  ti cnh bo thi tit",
        no_alerts: "Khng c cnh bo thi tit no cho khu vc ny",
        alert_effective: "C hiu lc",
        alert_expires: "Ht hn",
        alert_show_details: "Xem Chi Tit",
        alert_hide_details: "n Chi Tit",
        severity_extreme: "Cc K Nghim Trng",
        severity_severe: "Nghim Trng",
        severity_moderate: "Trung Bnh",
        severity_minor: "Nh",
        severity_unknown: "Khng R",
        get_location_911: "Ly V Tr Ca Ti Cho 911",
        outreach_label: "ng Dy H Tr Ngi V Gia C",
        power_outages: "Mt in",
        loading_outages: "ang kim tra tnh trng mt in NES...",
        no_outages: "Khng c bo co mt in no",
        outage_customers: "Khch hng b nh hng",
        outage_started: "Bt u",
        outage_cause: "Nguyn nhn",
        outage_assigned: " C i K Thut",
        outage_unassigned: "ang Ch i K Thut",
        outage_view_map: "Xem Bn  NES",
        outages_total: "Tng s s c",
        outages_customers: "khch hng b nh hng",
        outages_nearby: "gn bn",
        outages_near_you: "Gn Bn",
        outages_other_areas: "Khu Vc Khc",
        outages_more_nearby: "gn hn",
        outage_miles: "dm",
        outage_nearby: "Gn y",
        outage_view_all: "Xem tt c",
        outages_on_map: "s c trn Bn  NES",
        outage_use_location: "Dng V Tr Ca Ti",
        outage_locating: "ang nh v...",
        outage_location_found: " tm thy v tr",
        outage_location_denied: "Quyn truy cp v tr b t chi",
        outage_location_error: "Khng th ly v tr",
        outage_location_unavailable: "V tr khng kh dng",
        outage_fetch_error: "Khng th ti s c",
        map_outage_map: "Bn  Mt in",
        map_fullscreen: "Ton Mn Hnh",
        map_legend_title: "Ch Thch",
        map_legend_outage: "S c",
        map_legend_waiting: "ang ch i",
        map_legend_assigned: " phn cng i",
        map_legend_working: "ang sa cha",
        map_legend_warming: "Trung tm si m",
        map_legend_road_closed: "ng ng",
        map_road_closure_reason: "L do",
        map_road_closure_verify: "Kim tra Hub Nashville  cp nht",
        map_stat_affected: "B nh hng",
        map_stat_crews: "i",
        map_stat_waiting: "ang ch",
        map_nes_website: "Trang Web NES",
        map_report_outage: "Bo Co Mt in",
        map_popup_customers: "khch hng b nh hng",
        map_popup_status: "Trng thi",
        map_warming_open: "Trung tm si m ang m",
        map_warming_unconfirmed: "Cha xc nhn - kim tra trng thi",
        map_warming_food: "C thc n 24/7",
        map_warming_verify_link: "Xc minh ti Nashville.gov",
        warming_disclaimer: "Thng tin c th thay i. Lun kim tra trang web Metro Nashville  c thng tin ni tr n mi nht.",
        warming_verify_metro: "Xem trang Metro",
        shelter_disclaimer: " Thng tin c th thay i  lun kim tra li trn trang chnh thc ca Metro Nashville",
        shelter_alert_date: "Cp nht ngy 30 thng 1, 2026",
        shelter_alert_title: "Ni Tr n Khn Cp Trn Lan Metro",
        shelter_alert_status: "M 24 Gi",
        shelter_alert_location: "3230 Brick Church Pike, Nashville",
        shelter_alert_who: "Ngi ln 18+, cp i, th cng c cho n (c chung)",
        shelter_alert_services: "Ba n nng,  n nh, chiu/ging gp, nh tm",
        shelter_alert_transport: "Xe but WeGo min ph Tuyn #23B t WeGo Central sau 7 gi ti",
        shelter_alert_text: "Nhn OHSALERT n 888-777",
        shelter_alert_more: "Thng Tin Chnh Thc",
        shelter_alert_note: "Ni tr n chnh: Nashville Rescue Mission, Salvation Army, Safe Haven (gia dinh), Launch Pad (18-24). Hy th cc ni tr n chnh trc.",
        // UX Revamp translations
        tab_find_help: "Tm Tr Gip",
        tab_resource_map: "Bn ",
        what_do_you_need: "Bn cn g?",
        intent_shelter: "Ti cn ch  ti nay",
        intent_shelter_count: "7 ni tr n ang m",
        intent_food: "Ti cn thc phm",
        intent_food_count: "Ngn hng thc phm & dch v",
        intent_power: "Nh ti mt in",
        intent_power_count: "Bo co mt in, trung tm si m",
        intent_helping: "Ti ang gip ai ",
        intent_helping_count: "Lin h tip cn, ti nguyn",
        intent_immigrant: "Ti nguyn cho ngi nhp c",
        intent_immigrant_count: "Dch v an ton, h tr ngn ng",
        intent_legal: "Tr gip php l",
        intent_legal_count: "Bo v khi trc xut, khi phc giy t",
        intent_official: "Trung tm thng tin chnh thc",
        intent_official_count: "Ti nguyn chnh ph",
        status_open: "M",
        status_closed: "ng",
        hours_until_7am: "n 7 gi sng",
        hours_24hr: "Tip nhn 24 gi",
        hours_warming: "Ch si m",
        hours_mobile: "Phn phi di ng",
        report_outage: "Bo Co Mt in cho NES",
        nes_outage_map: "Bn  Mt in NES",
        homeless_outreach: "ng Dy H Tr Ngi V Gia C",
        resource_directory: "Danh b ti nguyn y ",
        multilingual: "Dch v a ngn ng",
        critical_overflow_open: "Ni Tr n Khn Cp ang M",
        critical_who_short: " 18+, cp i, th cng OK",
        critical_meals: " Ba n nng",
        critical_showers: " Nh tm",
        critical_transport: " WeGo #23B sau 7 gi ti",
        details: "Chi tit",
        status_view_map: "Xem bn  NES ",
        status_5day: "D bo 5 ngy ",
        // Alerts screen translations
        alerts_title: "Tin Tc & Cnh Bo",
        alerts_refresh: "Lm mi",
        alerts_sources: "Ngun",
        alerts_connecting: "ang kt ni...",
        alerts_connected: " cp nht",
        alerts_showing_only: "Ch hin th:",
        alerts_show_all: "Hin th tt c",
        alerts_priority: "Cnh bo u tin",
        alerts_loading: "ang ti cnh bo...",
        alerts_sources_title: "Ngun cnh bo",
        alerts_done: "Xong",
        alerts_enabled_default: "Bt theo mc nh",
        alerts_additional_sources: "Ngun b sung",
        alerts_coming_soon: "Sp c",
        alerts_src_nws: "Thi tit NWS",
        alerts_src_nws_desc: "Cnh bo & theo di thi tit khc nghit",
        alerts_src_nes: "Mt in NES",
        alerts_src_nes_desc: "S c mt in Nashville Electric",
        alerts_src_fema: "Thm ha FEMA",
        alerts_src_fema_desc: "Tuyn b thm ha lin bang cho TN",
        alerts_src_tdot: "TDOT SmartWay",
        alerts_src_tdot_desc: "ng ng & s c giao thng",
        alerts_src_311: "Metro 311",
        alerts_src_311_desc: "Cnh cy, nguy him ng, mnh vn",
        alerts_src_reddit: "r/Nashville",
        alerts_src_reddit_desc: "Bo co & tho lun cng ng",
        alerts_src_news: "Tin a phng",
        alerts_src_news_desc: "WKRN, WSMV, NC5, Fox17, WPLN",
        alerts_src_usgs: "ng t USGS",
        alerts_src_usgs_desc: "Hot ng a chn (bn knh 300km)",
        alerts_src_airnow: "AirNow AQI",
        alerts_src_airnow_desc: "Cn ng k kha API",
        alerts_src_tema: "Ni tr n TEMA",
        alerts_src_tema_desc: "Trung tm si m/lm mt"
      }
    };

    const rtlLangs = ['ar', 'ku'];

    const langCodes = {
      en: 'en',
      es: 'es',
      ar: 'ar',
      ku: 'ckb',
      vi: 'vi'
    };

    // Get language from URL parameter (?es, ?ar, etc.)
    function getLanguageFromURL() {
      // First check the current page's URL
      const search = window.location.search.slice(1).toLowerCase(); // Remove '?' and lowercase
      if (search && translations[search]) {
        return search;
      }
      // If embedded, also check the referrer URL (parent page) for language parameter
      if (document.referrer) {
        try {
          const referrerUrl = new URL(document.referrer);
          const referrerLang = referrerUrl.search.slice(1).toLowerCase();
          if (referrerLang && translations[referrerLang]) {
            return referrerLang;
          }
        } catch (e) {
          // Invalid referrer URL, ignore
        }
      }
      return null;
    }

    // Update URL with current language without adding history entry
    function updateURLWithLanguage(lang) {
      const url = new URL(window.location);
      url.search = (lang === 'en') ? '' : `?${lang}`;
      window.history.replaceState({}, '', url);
    }

    // Update internal navigation links to preserve language
    function updateInternalLinks(lang) {
      document.querySelectorAll('.location-btn, .back-link').forEach(link => {
        const baseUrl = link.getAttribute('href').split('?')[0];
        link.href = (lang === 'en') ? baseUrl : `${baseUrl}?${lang}`;
      });
    }

    function updateExternalLinks(lang) {
      document.querySelectorAll('.external-link').forEach(link => {
        const originalUrl = link.dataset.href;
        if (lang === 'en') {
          link.href = originalUrl;
        } else {
          link.href = `https://translate.google.com/translate?sl=en&tl=${langCodes[lang]}&u=${encodeURIComponent(originalUrl)}`;
        }
      });
    }

    function setLanguage(lang) {
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      // Also sync alerts screen language buttons
      document.querySelectorAll('.alerts-lang-btn, .alerts-lang-menu button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === lang) {
          btn.classList.add('active');
        }
      });

      if (rtlLangs.includes(lang)) {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', lang);
        document.getElementById('alertsScreen')?.setAttribute('dir', 'rtl');
      } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', lang);
        document.getElementById('alertsScreen')?.setAttribute('dir', 'ltr');
      }

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang] && translations[lang][key]) {
          el.textContent = translations[lang][key];
        } else if (translations['en'][key]) {
          el.textContent = translations['en'][key];
        }
      });

      updateExternalLinks(lang);
      updateInternalLinks(lang);
      localStorage.setItem('nashville-resources-lang', lang);
      updateURLWithLanguage(lang);

      // Re-render weather data with new language
      if (cachedWeatherData) {
        renderForecast(cachedWeatherData);
      }
      if (cachedAlertsData) {
        renderAlerts(cachedAlertsData);
      }
      if (cachedOutagesData) {
        renderOutages(cachedOutagesData);
      }
    }

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        trackActivity('language_change', { language: btn.dataset.lang });
        setLanguage(btn.dataset.lang);
      });
    });

    // Check URL parameter first, then localStorage
    const urlLang = getLanguageFromURL();
    const savedLang = localStorage.getItem('nashville-resources-lang');
    if (urlLang) {
      setLanguage(urlLang);
    } else if (savedLang && translations[savedLang]) {
      setLanguage(savedLang);
    }

    // Text size controls
    const textSizes = ['normal', 'large', 'xlarge'];
    let currentTextSizeIndex = 0;

    function setTextSize(size) {
      // Remove all size classes
      ['small', 'normal', 'large', 'xlarge'].forEach(s => document.documentElement.classList.remove(`text-${s}`));
      // Add the selected size class
      document.documentElement.classList.add(`text-${size}`);
      // Update toggle button state
      const toggle = document.getElementById('textSizeToggle');
      if (toggle) {
        toggle.classList.toggle('active', size !== 'normal');
      }
      // Save preference
      localStorage.setItem('nashville-resources-textsize', size);
    }

    // Text size toggle - cycles through sizes
    document.getElementById('textSizeToggle')?.addEventListener('click', () => {
      currentTextSizeIndex = (currentTextSizeIndex + 1) % textSizes.length;
      const newSize = textSizes[currentTextSizeIndex];
      trackActivity('text_size_change', { size: newSize });
      setTextSize(newSize);
    });

    // Load saved text size
    const savedTextSize = localStorage.getItem('nashville-resources-textsize');
    if (savedTextSize && textSizes.includes(savedTextSize)) {
      currentTextSizeIndex = textSizes.indexOf(savedTextSize);
      setTextSize(savedTextSize);
    }

    // Weather Forecast Functionality
    // Pre-cached Nashville area ZIP codes to skip geocoding API call
    const nashvilleZipCoords = {
      '37201': { lat: 36.1627, lon: -86.7816, name: 'Nashville, TN' },
      '37203': { lat: 36.1509, lon: -86.7951, name: 'Nashville, TN' },
      '37204': { lat: 36.1048, lon: -86.7905, name: 'Nashville, TN' },
      '37205': { lat: 36.1193, lon: -86.8578, name: 'Nashville, TN' },
      '37206': { lat: 36.1848, lon: -86.7340, name: 'Nashville, TN' },
      '37207': { lat: 36.2219, lon: -86.7545, name: 'Nashville, TN' },
      '37208': { lat: 36.1832, lon: -86.8062, name: 'Nashville, TN' },
      '37209': { lat: 36.1533, lon: -86.8666, name: 'Nashville, TN' },
      '37210': { lat: 36.1330, lon: -86.7386, name: 'Nashville, TN' },
      '37211': { lat: 36.0644, lon: -86.7358, name: 'Nashville, TN' },
      '37212': { lat: 36.1319, lon: -86.8025, name: 'Nashville, TN' },
      '37213': { lat: 36.1676, lon: -86.7677, name: 'Nashville, TN' },
      '37214': { lat: 36.1770, lon: -86.6644, name: 'Nashville, TN' },
      '37215': { lat: 36.0850, lon: -86.8290, name: 'Nashville, TN' },
      '37216': { lat: 36.2117, lon: -86.7232, name: 'Nashville, TN' },
      '37217': { lat: 36.1067, lon: -86.6615, name: 'Nashville, TN' },
      '37218': { lat: 36.2079, lon: -86.8470, name: 'Nashville, TN' },
      '37219': { lat: 36.1661, lon: -86.7832, name: 'Nashville, TN' },
      '37220': { lat: 36.0658, lon: -86.7878, name: 'Nashville, TN' },
      '37221': { lat: 36.0549, lon: -86.9679, name: 'Nashville, TN' },
      '37013': { lat: 36.0397, lon: -86.6536, name: 'Antioch, TN' },
      '37027': { lat: 35.9990, lon: -86.7889, name: 'Brentwood, TN' },
      '37064': { lat: 35.9245, lon: -86.8689, name: 'Franklin, TN' },
      '37072': { lat: 36.3101, lon: -86.7019, name: 'Goodlettsville, TN' },
      '37076': { lat: 36.1769, lon: -86.5939, name: 'Hermitage, TN' },
      '37115': { lat: 36.2584, lon: -86.7087, name: 'Madison, TN' },
      '37138': { lat: 36.2429, lon: -86.6188, name: 'Old Hickory, TN' },
      '37189': { lat: 36.3446, lon: -86.7897, name: 'Whites Creek, TN' },
      '37228': { lat: 36.1904, lon: -86.8044, name: 'Nashville, TN' }
    };

    // localStorage cache keys and TTL (15 minutes)
    const FORECAST_CACHE_KEY = 'nashville-forecast-cache';
    const FORECAST_CACHE_TTL = 15 * 60 * 1000;

    function getCachedForecast(zip) {
      try {
        const cached = localStorage.getItem(FORECAST_CACHE_KEY);
        if (!cached) return null;
        const { data, zip: cachedZip, timestamp } = JSON.parse(cached);
        if (cachedZip !== zip) return null;
        if (Date.now() - timestamp > FORECAST_CACHE_TTL) return null;
        return data;
      } catch { return null; }
    }

    function setCachedForecast(zip, data) {
      try {
        localStorage.setItem(FORECAST_CACHE_KEY, JSON.stringify({
          data, zip, timestamp: Date.now()
        }));
      } catch { /* localStorage full or unavailable */ }
    }

    const weatherIcons = {
      0: 'ph-sun', 1: 'ph-sun', 2: 'ph-cloud-sun', 3: 'ph-cloud',
      45: 'ph-cloud-fog', 48: 'ph-cloud-fog',
      51: 'ph-cloud-rain', 53: 'ph-cloud-rain', 55: 'ph-cloud-rain',
      56: 'ph-cloud-rain', 57: 'ph-cloud-rain',
      61: 'ph-cloud-rain', 63: 'ph-cloud-rain', 65: 'ph-cloud-rain',
      66: 'ph-cloud-rain', 67: 'ph-cloud-rain',
      71: 'ph-snowflake', 73: 'ph-snowflake', 75: 'ph-snowflake', 77: 'ph-snowflake',
      80: 'ph-cloud-rain', 81: 'ph-cloud-rain', 82: 'ph-cloud-rain',
      85: 'ph-snowflake', 86: 'ph-snowflake',
      95: 'ph-cloud-lightning', 96: 'ph-cloud-lightning', 99: 'ph-cloud-lightning'
    };

    function getCurrentLang() {
      return localStorage.getItem('nashville-resources-lang') || 'en';
    }

    function t(key) {
      const lang = getCurrentLang();
      return translations[lang][key] || translations['en'][key] || key;
    }

    function getDayName(dayIndex) {
      const keys = ['day_sun', 'day_mon', 'day_tue', 'day_wed', 'day_thu', 'day_fri', 'day_sat'];
      return t(keys[dayIndex]);
    }

    function getMonthName(monthIndex) {
      const keys = ['month_jan', 'month_feb', 'month_mar', 'month_apr', 'month_may', 'month_jun',
                    'month_jul', 'month_aug', 'month_sep', 'month_oct', 'month_nov', 'month_dec'];
      return t(keys[monthIndex]);
    }

    function getWeatherLabel(code) {
      return t('weather_' + code) || t('weather_unknown');
    }

    // Cache ZIP code lookups to avoid redundant geocoding API calls
    const zipCoordinateCache = new Map();

    async function getCoordinates(zip) {
      // Return cached result if available
      if (zipCoordinateCache.has(zip)) {
        return zipCoordinateCache.get(zip);
      }

      const response = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json&limit=1`);
      const data = await response.json();
      if (data.length === 0) throw new Error('Location not found');
      const coords = {
        lat: parseFloat(data[0].lat),
        lon: parseFloat(data[0].lon),
        name: data[0].display_name.split(',').slice(0, 2).join(',').trim()
      };

      // Cache the result
      zipCoordinateCache.set(zip, coords);
      return coords;
    }

    async function getWeather(lat, lon) {
      const response = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto&forecast_days=5`
      );
      return response.json();
    }

    async function getNWSAlerts(lat, lon) {
      try {
        const response = await fetch(
          `https://api.weather.gov/alerts/active?point=${lat.toFixed(4)},${lon.toFixed(4)}`,
          {
            headers: {
              'User-Agent': '(NashvilleEmergencyResources, contact@example.com)',
              'Accept': 'application/geo+json'
            }
          }
        );
        if (!response.ok) throw new Error('NWS API error');
        const data = await response.json();
        return data.features || [];
      } catch (err) {
        console.error('Failed to fetch NWS alerts:', err);
        return [];
      }
    }

    // Haversine distance calculation (returns miles)
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 3959; // Earth's radius in miles
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // NES Power Outage API - data source: github.com/NeckBeardPrince/nes-outage-status-checker
    async function getNESOutages(userLat, userLon) {
      try {
        const response = await fetch(
          'https://utilisocial.io/datacapable/v2/p/NES/map/events',
          {
            headers: {
              'Accept': 'application/json'
            }
          }
        );
        if (!response.ok) throw new Error('NES API error');
        const data = await response.json();

        if (!data || data.length === 0) return { all: [], nearby: [] };

        // Calculate distance for each outage and categorize
        const NEARBY_RADIUS = 15; // miles
        const outagesWithDistance = data.map(outage => {
          // Try different possible coordinate field names
          const lat = outage.lat || outage.latitude || outage.location?.lat || outage.location?.latitude;
          const lon = outage.lon || outage.lng || outage.longitude || outage.location?.lon || outage.location?.lng || outage.location?.longitude;

          let distance = null;
          if (lat && lon && userLat && userLon) {
            distance = calculateDistance(userLat, userLon, lat, lon);
          }
          return { ...outage, distance };
        });

        // Separate nearby and all outages
        const nearby = outagesWithDistance
          .filter(o => o.distance !== null && o.distance <= NEARBY_RADIUS)
          .sort((a, b) => a.distance - b.distance);

        const all = outagesWithDistance.sort((a, b) => (b.numPeople || 0) - (a.numPeople || 0));

        return { all, nearby, userCoords: { lat: userLat, lon: userLon } };
      } catch (err) {
        console.error('Failed to fetch NES outages:', err);
        return { all: [], nearby: [] };
      }
    }

    function getSeverityClass(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme') return 'severity-extreme';
      if (s === 'severe') return 'severity-severe';
      if (s === 'moderate') return 'severity-moderate';
      if (s === 'minor') return 'severity-minor';
      return 'severity-unknown';
    }

    function getSeverityIcon(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme' || s === 'severe') return 'ph-warning-octagon';
      if (s === 'moderate') return 'ph-warning';
      return 'ph-info';
    }

    function getSeverityLabel(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme') return t('severity_extreme');
      if (s === 'severe') return t('severity_severe');
      if (s === 'moderate') return t('severity_moderate');
      if (s === 'minor') return t('severity_minor');
      return t('severity_unknown');
    }

    function formatAlertTime(isoString) {
      if (!isoString) return '';
      const d = new Date(isoString);
      const dayName = getDayName(d.getDay());
      const monthName = getMonthName(d.getMonth());
      const day = d.getDate();
      const hours = d.getHours();
      const minutes = d.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const hour12 = hours % 12 || 12;
      return `${dayName}, ${monthName} ${day}, ${hour12}:${minutes} ${ampm}`;
    }

    async function renderAlerts(alerts) {
      const container = document.getElementById('alertsContainer');
      container.innerHTML = '';
      const lang = getCurrentLang();

      if (!alerts || alerts.length === 0) {
        container.innerHTML = `
          <div class="no-alerts">
            <i class="ph ph-check-circle"></i>
            <span data-i18n="no_alerts">${t('no_alerts')}</span>
          </div>
        `;
        return;
      }

      // Sort by severity (extreme first)
      const severityOrder = { extreme: 0, severe: 1, moderate: 2, minor: 3, unknown: 4 };
      alerts.sort((a, b) => {
        const sA = (a.properties.severity || 'unknown').toLowerCase();
        const sB = (b.properties.severity || 'unknown').toLowerCase();
        return (severityOrder[sA] ?? 4) - (severityOrder[sB] ?? 4);
      });

      // Translate all events and headlines in parallel for faster loading
      const translationPromises = alerts.map(alert => {
        const props = alert.properties;
        const event = props.event || 'Weather Alert';
        const headline = props.headline || event;
        return Promise.all([
          translateText(event, lang),
          translateText(headline, lang)
        ]);
      });
      const translations = await Promise.all(translationPromises);

      alerts.forEach((alert, index) => {
        const props = alert.properties;
        const severity = props.severity || 'Unknown';
        const description = props.description || '';
        const effective = props.effective;
        const expires = props.expires;

        const [displayEvent, displayHeadline] = translations[index];

        const banner = document.createElement('div');
        banner.className = `alert-banner ${getSeverityClass(severity)}`;
        banner.style.animationDelay = `${index * 0.1}s`;

        banner.innerHTML = `
          <i class="ph ${getSeverityIcon(severity)} alert-icon"></i>
          <div class="alert-content">
            <div class="alert-header">
              <span class="alert-title">${displayEvent}</span>
              <span class="alert-severity-badge">${getSeverityLabel(severity)}</span>
            </div>
            <p class="alert-description" id="alert-desc-${index}">${displayHeadline}</p>
            ${description ? `<button class="alert-expand-btn" onclick="toggleAlertExpand(${index}, this)" data-i18n="alert_show_details">${t('alert_show_details')}</button>` : ''}
            <div class="alert-meta">
              ${effective ? `<span><i class="ph ph-clock"></i> ${t('alert_effective')}: ${formatAlertTime(effective)}</span>` : ''}
              ${expires ? `<span><i class="ph ph-clock-countdown"></i> ${t('alert_expires')}: ${formatAlertTime(expires)}</span>` : ''}
            </div>
          </div>
          <button class="alert-dismiss" onclick="this.parentElement.remove()" aria-label="Dismiss alert">
            <i class="ph ph-x"></i>
          </button>
        `;

        // Store original English for expansion and translation
        banner.dataset.fullDescription = description;
        banner.dataset.headline = displayHeadline;
        banner.dataset.originalDescription = description;

        container.appendChild(banner);
      });
    }

    function formatOutageTime(timestamp) {
      if (!timestamp) return '';
      const d = new Date(timestamp);
      const dayName = getDayName(d.getDay());
      const monthName = getMonthName(d.getMonth());
      const day = d.getDate();
      const hours = d.getHours();
      const minutes = d.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const hour12 = hours % 12 || 12;
      return `${dayName}, ${monthName} ${day}, ${hour12}:${minutes} ${ampm}`;
    }

    function renderOutages(outageData) {
      const container = document.getElementById('outagesContainer');
      container.innerHTML = '';

      // Handle both old format (array) and new format (object with nearby/all)
      const nearby = outageData?.nearby || [];
      const all = outageData?.all || (Array.isArray(outageData) ? outageData : []);

      if (all.length === 0) {
        container.innerHTML = `
          <div class="no-outages">
            <i class="ph ph-check-circle"></i>
            <span data-i18n="no_outages">${t('no_outages')}</span>
          </div>
        `;
        return;
      }

      // Calculate totals for summary
      const totalOutages = all.length;
      const totalCustomers = all.reduce((sum, o) => sum + (o.numPeople || 0), 0);

      // Show summary card
      const summary = document.createElement('div');
      summary.className = 'outages-summary';
      summary.innerHTML = `
        <div class="outages-summary-header">
          <div class="outages-summary-title">
            <i class="ph ph-lightning"></i>
            <span>NES ${t('power_outages')}</span>
          </div>
          <a href="https://nespower.com/outages" target="_blank" rel="noopener noreferrer" class="outages-summary-link">
            ${t('outage_view_map')} <i class="ph ph-arrow-square-out"></i>
          </a>
        </div>
        <div class="outages-summary-stats">
          <span><strong>${totalOutages}</strong> ${t('outages_total')}</span>
          <span><strong>${totalCustomers.toLocaleString()}</strong> ${t('outages_customers')}</span>
          ${nearby.length > 0 ? `<span><strong>${nearby.length}</strong> ${t('outages_nearby')}</span>` : ''}
        </div>
      `;
      container.appendChild(summary);

      // Helper to create outage banner
      function createOutageBanner(outage, index, isNearby) {
        // Use status field (consistent with map markers) - API returns status text like "Assigned", "Crew En Route", etc.
        const status = outage.status || outage.crewStatus || '';
        const statusCategory = getMapStatusCategory(status);
        const isAssigned = statusCategory === 'assigned' || statusCategory === 'working';
        const banner = document.createElement('div');
        banner.className = `outage-banner ${isAssigned ? 'assigned' : ''} ${isNearby ? 'nearby' : ''}`;
        banner.style.animationDelay = `${index * 0.1}s`;

        const startTime = outage.startTime ? formatOutageTime(outage.startTime) : '';
        const cause = outage.cause || 'Unknown';
        const numCustomers = outage.numPeople || 0;
        const distance = outage.distance;
        const distanceStr = distance !== null ? `${distance.toFixed(1)} ${t('outage_miles')}` : '';

        banner.innerHTML = `
          <i class="ph ph-lightning outage-icon ${isAssigned ? '' : 'unassigned'}"></i>
          <div class="outage-content">
            <div class="outage-header">
              <span class="outage-title">${t('power_outages')}</span>
              <span class="outage-status-badge">${isAssigned ? t('outage_assigned') : t('outage_unassigned')}</span>
              ${isNearby ? `<span class="outage-nearby-badge">${t('outage_nearby')}</span>` : ''}
            </div>
            <p class="outage-description">${t('outage_cause')}: ${cause}</p>
            <div class="outage-meta">
              <span><i class="ph ph-users"></i> ${numCustomers.toLocaleString()} ${t('outage_customers')}</span>
              ${distanceStr ? `<span><i class="ph ph-map-pin"></i> ${distanceStr}</span>` : ''}
              ${startTime ? `<span><i class="ph ph-clock"></i> ${t('outage_started')}: ${startTime}</span>` : ''}
            </div>
          </div>
          <button class="outage-dismiss" onclick="this.parentElement.remove()" aria-label="Dismiss outage">
            <i class="ph ph-x"></i>
          </button>
        `;

        return banner;
      }

      // Show nearby outages first (if any)
      if (nearby.length > 0) {
        const nearbyHeader = document.createElement('div');
        nearbyHeader.className = 'outage-section-header collapsed';
        nearbyHeader.innerHTML = `<i class="ph ph-map-pin"></i> ${t('outages_near_you')} (${nearby.length}) <i class="ph ph-caret-down toggle-icon"></i>`;
        container.appendChild(nearbyHeader);

        // Create collapsible container for nearby outages
        const nearbyContainer = document.createElement('div');
        nearbyContainer.className = 'outage-list-container collapsed';
        nearbyContainer.id = 'nearbyOutagesList';

        nearby.slice(0, 5).forEach((outage, index) => {
          nearbyContainer.appendChild(createOutageBanner(outage, index, true));
        });

        if (nearby.length > 5) {
          const moreNearby = document.createElement('div');
          moreNearby.className = 'outage-more-text';
          moreNearby.textContent = `+ ${nearby.length - 5} ${t('outages_more_nearby')}`;
          nearbyContainer.appendChild(moreNearby);
        }

        container.appendChild(nearbyContainer);

        // Add click handler to toggle collapse
        nearbyHeader.addEventListener('click', () => {
          nearbyHeader.classList.toggle('collapsed');
          nearbyContainer.classList.toggle('collapsed');
          if (!nearbyContainer.classList.contains('collapsed')) {
            nearbyContainer.style.maxHeight = nearbyContainer.scrollHeight + 'px';
          } else {
            nearbyContainer.style.maxHeight = '0';
          }
        });
      }

      // Show other outages (not nearby) if we have space
      const otherOutages = all.filter(o => !nearby.some(n => n === o || (n.id && n.id === o.id)));
      if (otherOutages.length > 0 && nearby.length < 5) {
        const showCount = Math.min(5 - nearby.length, otherOutages.length);

        if (nearby.length > 0) {
          const otherHeader = document.createElement('div');
          otherHeader.className = 'outage-section-header';
          otherHeader.innerHTML = `<i class="ph ph-lightning"></i> ${t('outages_other_areas')}`;
          container.appendChild(otherHeader);
        }

        otherOutages.slice(0, showCount).forEach((outage, index) => {
          container.appendChild(createOutageBanner(outage, index + nearby.length, false));
        });
      }

      // If there are more outages, show a link
      if (all.length > 5) {
        const moreLink = document.createElement('a');
        moreLink.href = 'https://nespower.com/outages';
        moreLink.target = '_blank';
        moreLink.rel = 'noopener noreferrer';
        moreLink.className = 'outage-link';
        moreLink.style.display = 'flex';
        moreLink.style.justifyContent = 'center';
        moreLink.style.marginTop = '0.5rem';
        moreLink.innerHTML = `<i class="ph ph-arrow-square-out"></i> ${t('outage_view_all')} ${all.length} ${t('outages_on_map')}`;
        container.appendChild(moreLink);
      }
    }

    // Use device location for outage search
    window.useMyLocationForOutages = async function() {
      const btn = document.getElementById('outageLocationBtn');
      const status = document.getElementById('outageLocationStatus');

      if (!navigator.geolocation) {
        status.className = 'outage-location-status error';
        status.innerHTML = `<i class="ph ph-warning"></i> ${t('outage_location_unavailable')}`;
        return;
      }

      btn.disabled = true;
      btn.innerHTML = `<i class="ph ph-spinner" style="animation: spin 1s linear infinite;"></i> ${t('outage_locating')}`;
      status.className = 'outage-location-status';
      status.innerHTML = '';

      document.getElementById('outagesContainer').innerHTML = `
        <div class="outages-loading">
          <i class="ph ph-lightning"></i>
          <span>${t('loading_outages')}</span>
        </div>
      `;

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;

          try {
            const outages = await getNESOutages(latitude, longitude);
            cachedOutagesData = outages;
            renderOutages(outages);

            btn.disabled = false;
            btn.innerHTML = `<i class="ph ph-crosshair"></i> <span data-i18n="outage_use_location">${t('outage_use_location')}</span>`;
            status.className = 'outage-location-status success';
            status.innerHTML = `<i class="ph ph-check-circle"></i> ${t('outage_location_found')}`;

            trackActivity('outage_location_used', { method: 'gps' });
          } catch (err) {
            console.error('Failed to fetch outages with location:', err);
            btn.disabled = false;
            btn.innerHTML = `<i class="ph ph-crosshair"></i> <span data-i18n="outage_use_location">${t('outage_use_location')}</span>`;
            status.className = 'outage-location-status error';
            status.innerHTML = `<i class="ph ph-warning"></i> ${t('outage_fetch_error')}`;
          }
        },
        (error) => {
          console.error('Geolocation error:', error);
          btn.disabled = false;
          btn.innerHTML = `<i class="ph ph-crosshair"></i> <span data-i18n="outage_use_location">${t('outage_use_location')}</span>`;
          status.className = 'outage-location-status error';
          if (error.code === error.PERMISSION_DENIED) {
            status.innerHTML = `<i class="ph ph-warning"></i> ${t('outage_location_denied')}`;
          } else {
            status.innerHTML = `<i class="ph ph-warning"></i> ${t('outage_location_error')}`;
          }
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
      );
    };

    window.toggleAlertExpand = async function(index, btn) {
      const desc = document.getElementById(`alert-desc-${index}`);
      const banner = btn.closest('.alert-banner');
      const originalDesc = banner.dataset.originalDescription;
      const headline = banner.dataset.headline;
      const lang = getCurrentLang();

      if (desc.classList.contains('expanded')) {
        desc.classList.remove('expanded');
        desc.textContent = headline;
        btn.textContent = t('alert_show_details');
        trackActivity('alert_collapse', { alertIndex: index });
      } else {
        desc.classList.add('expanded');
        // Show loading indicator
        btn.innerHTML = '<i class="ph ph-spinner" style="animation: spin 1s linear infinite;"></i>';
        // Translate description
        const displayDesc = await translateText(originalDesc, lang);
        desc.textContent = displayDesc;
        btn.textContent = t('alert_hide_details');
        trackActivity('alert_expand', { alertIndex: index, alertHeadline: headline });
      }
    };

    function renderForecast(weather) {
      const grid = document.getElementById('forecastGrid');
      grid.innerHTML = '';

      weather.daily.time.forEach((date, index) => {
        const d = new Date(date + 'T12:00:00');
        const code = weather.daily.weather_code[index];
        const icon = weatherIcons[code] || 'ph-question';
        const label = getWeatherLabel(code);
        const high = Math.round(weather.daily.temperature_2m_max[index]);
        const low = Math.round(weather.daily.temperature_2m_min[index]);

        const card = document.createElement('div');
        card.className = 'day-card';
        card.innerHTML = `
          <div class="day-name">${getDayName(d.getDay())}</div>
          <div class="day-date">${getMonthName(d.getMonth())} ${d.getDate()}</div>
          <i class="ph ${icon} weather-icon"></i>
          <div class="condition">${label}</div>
          <div class="temps">
            <div class="temp-high">
              <i class="ph ph-arrow-up"></i>
              <span>${high}</span>
            </div>
            <div class="temp-low">
              <i class="ph ph-arrow-down"></i>
              <span>${low}</span>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function showForecastError(message) {
      document.getElementById('forecastGrid').innerHTML = `
        <div class="forecast-error">
          <i class="ph ph-warning-circle"></i>
          <p>${message}</p>
        </div>
      `;
    }

    async function fetchForecast() {
      const zip = document.getElementById('zipInput').value.trim();
      if (!/^\d{5}$/.test(zip)) {
        showForecastError(t('invalid_zip'));
        return;
      }

      // Check localStorage cache first for instant display
      const cached = getCachedForecast(zip);
      if (cached) {
        // Show cached data immediately
        cachedWeatherData = cached.weather;
        cachedUserCoords = cached.coords;
        document.getElementById('locationDisplay').textContent = cached.coords.name;
        renderForecast(cached.weather);
        // Refresh in background (don't await)
        fetchForecastFresh(zip, true);
        return;
      }

      document.getElementById('forecastGrid').innerHTML = `
        <div class="forecast-loading">
          <i class="ph ph-cloud"></i>
          <p>${t('loading_forecast')}</p>
        </div>
      `;

      await fetchForecastFresh(zip, false);
    }

    async function fetchForecastFresh(zip, isBackground) {
      // Defer alerts - only show if user clicks to expand
      const alertsContainer = document.getElementById('alertsContainer');
      if (alertsContainer && !cachedAlertsData) {
        alertsContainer.innerHTML = `
          <div class="alerts-click-to-load" onclick="loadNWSAlerts()" style="padding: 1rem; text-align: center; cursor: pointer; color: var(--text-secondary);">
            <i class="ph ph-cloud-warning" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
            <span data-i18n="click_load_alerts">Tap to load weather alerts</span>
          </div>
        `;
      }

      // Use cached outage data from fetchMapOutages if available
      const outagesContainer = document.getElementById('outagesContainer');
      if (outagesContainer) {
        if (cachedMapOutages && cachedMapOutages.length > 0) {
          // Use already-fetched map outage data
          outagesContainer.innerHTML = `
            <div style="padding: 1rem; text-align: center; color: var(--text-secondary);">
              <i class="ph ph-lightning" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; color: #fbbf24;"></i>
              <span>${mapStatsData.customers.toLocaleString()} ${t('outage_customers')}</span>
              <a href="#" onclick="openMapModal(); return false;" style="display: block; margin-top: 0.5rem; color: var(--link-color);">${t('status_view_map')}</a>
            </div>
          `;
        } else {
          outagesContainer.innerHTML = `
            <div style="padding: 1rem; text-align: center; color: var(--text-secondary);">
              <i class="ph ph-check-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; color: #4ade80;"></i>
              <span data-i18n="no_outages">${t('no_outages')}</span>
            </div>
          `;
        }
      }

      try {
        // Use pre-cached Nashville coords if available (skips geocoding API)
        let coords;
        if (nashvilleZipCoords[zip]) {
          coords = nashvilleZipCoords[zip];
        } else {
          coords = await getCoordinates(zip);
        }
        document.getElementById('locationDisplay').textContent = coords.name;

        // Fetch weather data
        const weather = await getWeather(coords.lat, coords.lon);

        // Cache data for re-rendering on language change
        cachedWeatherData = weather;
        cachedUserCoords = coords;

        // Save to localStorage for faster future loads
        setCachedForecast(zip, { weather, coords });

        renderForecast(weather);
      } catch (err) {
        if (!isBackground) {
          cachedWeatherData = null;
          cachedUserCoords = null;
          showForecastError(t('forecast_error'));
        }
        console.error(err);
      }
    }

    // Lazy load NWS alerts when user clicks
    async function loadNWSAlerts() {
      const alertsContainer = document.getElementById('alertsContainer');
      if (!alertsContainer) return;

      alertsContainer.innerHTML = `
        <div class="alerts-loading">
          <i class="ph ph-cloud"></i>
          <span>${t('loading_alerts')}</span>
        </div>
      `;

      try {
        // Use cached coords or get from ZIP
        let coords = cachedUserCoords;
        if (!coords) {
          const zip = document.getElementById('zipInput').value.trim();
          if (!/^\d{5}$/.test(zip)) {
            alertsContainer.innerHTML = '';
            return;
          }
          coords = await getCoordinates(zip);
          cachedUserCoords = coords;
        }

        const alerts = await getNWSAlerts(coords.lat, coords.lon);
        cachedAlertsData = alerts;
        renderAlerts(alerts);
      } catch (err) {
        console.error('Failed to load NWS alerts:', err);
        alertsContainer.innerHTML = `
          <div style="padding: 1rem; text-align: center; color: var(--text-secondary);">
            <span>${t('forecast_error')}</span>
          </div>
        `;
      }
    }
    window.loadNWSAlerts = loadNWSAlerts;

    document.getElementById('fetchBtn').addEventListener('click', () => {
      trackActivity('weather_fetch', { zip: document.getElementById('zipInput').value });
      fetchForecast();
    });
    document.getElementById('zipInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        trackActivity('weather_fetch', { zip: document.getElementById('zipInput').value, method: 'enter_key' });
        fetchForecast();
      }
    });

    // Track external link clicks
    document.querySelectorAll('.external-link').forEach(link => {
      link.addEventListener('click', () => {
        const linkText = link.querySelector('span')?.textContent || link.textContent;
        trackActivity('resource_link_click', {
          url: link.dataset.href,
          text: linkText
        });
      });
    });

    // Track location button click
    document.querySelector('.location-btn')?.addEventListener('click', () => {
      trackActivity('location_btn_click', { destination: 'emergency.html' });
    });

    // ===========================================
    // OUTAGE MAP FUNCTIONALITY
    // ===========================================

    let previewMap = null;
    let fullMap = null;
    let previewOutageLayer = null;
    let fullOutageLayer = null;
    let cachedMapOutages = [];
    let mapStatsData = { customers: 0, crews: 0, waiting: 0 };

    // Map layer toggle state
    let mapToggles = {
      outages: true,
      warmingCenters: true,
      roadClosures: true
    };

    // Warming centers data - Official locations from Nashville.gov + community resources
    // Last verified: January 31, 2026
    // Sources: Nashville.gov, Nashville Predators, Nashville Scene, The Allsorts Lobby
    // EXPIRATION: This section auto-hides after expires_at date
    const WARMING_LOCATIONS_CONFIG = {
      verified_date: '2026-01-31',
      expires_at: '2026-02-01T23:59:59-06:00', // Section stops showing after this date
      event_name: 'Winter Storm Fern'
    };

    const warmingLocations = [
      // 24/7 Metro Shelters
      {
        lat: 36.0679, lng: -86.6675,
        name: "Southeast Regional Community Center",
        address: "5260 Hickory Hollow Pkwy, Suite 202, Antioch, TN 37013",
        hours: "24/7 until further notice",
        type: "24hr",
        hasFood: true,
        services: "Overnight stays, food, warming"
      },
      {
        lat: 36.2573, lng: -86.7093,
        name: "Madison Community Center",
        address: "550 N Dupont Ave, Madison, TN 37115",
        hours: "24/7 until further notice",
        type: "24hr",
        hasFood: true,
        services: "Overnight stays, food, warming"
      },
      {
        lat: 36.1409, lng: -86.7634,
        name: "Nashville Fairgrounds",
        address: "401 Wingrove St, Nashville, TN 37203",
        hours: "24/7 until further notice",
        type: "24hr",
        hasFood: true,
        services: "Overnight stays, food, warming"
      },
      {
        lat: 36.0771, lng: -86.9208,
        name: "Bellevue Community Center",
        address: "7638A Highway 70 S, Nashville, TN 37221",
        hours: "24/7 until further notice",
        type: "24hr",
        hasFood: true,
        services: "Overnight stays, food, warming"
      },
      // Limited hours locations
      {
        lat: 36.1592, lng: -86.7785,
        name: "Bridgestone Arena",
        address: "501 Broadway, Nashville, TN 37203",
        hours: "11:30am-4:30pm (Fri Jan 31)",
        type: "limited",
        hasFood: true,
        services: "Device charging, water, hot meals"
      },
      {
        lat: 36.1875, lng: -86.7450,
        name: "Riverside Commons",
        address: "1211 Riverside Drive, Nashville, TN 37206",
        hours: "12pm-7pm (Sat Feb 1)",
        type: "limited",
        hasFood: true,
        services: "Heat, power, food, WiFi, Jazz Jam 2-4pm"
      },
      // Community locations
      {
        lat: 36.2557, lng: -86.7062,
        name: "The Allsorts Lobby (Madison Co-op)",
        address: "752 Madison Square, Madison, TN 37115",
        hours: "5:30pm-8:30pm (when below 40)",
        type: "community",
        hasFood: true,
        services: "Dinner ~6pm, shuttle to overnight shelter ~7pm"
      }
    ];

    // Legacy format for map compatibility
    const warmingCenters = warmingLocations.map(loc => ({
      lat: loc.lat,
      lng: loc.lng,
      name: loc.type === 'limited' ? `${loc.name} (${loc.hours})` : loc.name,
      address: loc.address,
      hasFood: loc.hasFood
    }));

    const WARMING_CENTERS_VERIFIED_DATE = WARMING_LOCATIONS_CONFIG.verified_date;
    const WARMING_CENTERS_EXPIRY_DAYS = 3;

    // Road closures data - fetched from Nashville NERVE API
    // Source: Nashville Metro GIS - NERVE Road Closures MapServer
    // API: http://maps.nashville.gov/arcgis/rest/services/NERVE/RoadClosures/MapServer/1
    let roadClosures = []; // Populated from API
    let roadClosuresLastFetched = null;
    let roadClosuresApiError = false;

    const ROAD_CLOSURES_API_URL = 'https://maps.nashville.gov/arcgis/rest/services/NERVE/RoadClosures/MapServer/1/query?where=1%3D1&outFields=*&returnGeometry=true&f=geojson';

    async function fetchRoadClosures() {
      try {
        const response = await fetch(ROAD_CLOSURES_API_URL);
        if (!response.ok) throw new Error('API response not ok');
        const data = await response.json();

        if (data.features && Array.isArray(data.features)) {
          roadClosures = data.features.map(feature => {
            const props = feature.properties || {};
            const geom = feature.geometry;

            // Get centroid for polygon geometries, or use point directly
            let lat, lng;
            if (geom && geom.type === 'Point') {
              lng = geom.coordinates[0];
              lat = geom.coordinates[1];
            } else if (geom && geom.type === 'Polygon' && geom.coordinates[0]) {
              // Calculate centroid of polygon
              const coords = geom.coordinates[0];
              let sumLat = 0, sumLng = 0;
              coords.forEach(c => { sumLng += c[0]; sumLat += c[1]; });
              lng = sumLng / coords.length;
              lat = sumLat / coords.length;
            } else if (geom && geom.type === 'MultiPolygon' && geom.coordinates[0]) {
              // Use first polygon's centroid
              const coords = geom.coordinates[0][0];
              let sumLat = 0, sumLng = 0;
              coords.forEach(c => { sumLng += c[0]; sumLat += c[1]; });
              lng = sumLng / coords.length;
              lat = sumLat / coords.length;
            }

            return {
              lat: lat,
              lng: lng,
              name: props.STREETNAME || props.StreetName || props.NAME || props.name || 'Road Closure',
              location: props.LOCATION || props.Location || props.ADDRESS || props.address || props.STREETNAME || 'Nashville Area',
              reason: props.REASON || props.Reason || props.DESCRIPTION || props.Description || props.COMMENTS || props.Comments || props.TYPE || props.Type || 'Road closed',
              geometry: geom // Keep original geometry for polygon rendering if needed
            };
          }).filter(c => c.lat && c.lng); // Only keep closures with valid coordinates

          roadClosuresLastFetched = new Date();
          roadClosuresApiError = false;
          console.log(`Fetched ${roadClosures.length} road closures from Nashville NERVE API`);
        } else {
          roadClosures = [];
          roadClosuresLastFetched = new Date();
        }
      } catch (error) {
        console.error('Failed to fetch road closures from Nashville API:', error);
        roadClosuresApiError = true;
        roadClosures = []; // No fake data - only show real closures
      }

      return roadClosures;
    }

    function isRoadClosureDataStale() {
      // Data is stale if we haven't fetched in the last 30 minutes or if there was an API error
      if (!roadClosuresLastFetched) return true;
      if (roadClosuresApiError) return true;
      const now = new Date();
      const minutesSinceFetch = (now - roadClosuresLastFetched) / (1000 * 60);
      return minutesSinceFetch > 30;
    }

    function isWarmingDataStale() {
      const verifiedDate = new Date(WARMING_CENTERS_VERIFIED_DATE);
      const now = new Date();
      const daysDiff = (now - verifiedDate) / (1000 * 60 * 60 * 24);
      return daysDiff > WARMING_CENTERS_EXPIRY_DAYS;
    }

    // Check if warming locations section should be displayed (time-bound)
    function isWarmingLocationsExpired() {
      const expiryDate = new Date(WARMING_LOCATIONS_CONFIG.expires_at);
      const now = new Date();
      return now > expiryDate;
    }

    // Render the warming locations section
    function renderWarmingLocationsSection() {
      const section = document.getElementById('warmingLocationsSection');
      const grid = document.getElementById('warmingLocationsGrid');
      const expiryText = document.getElementById('warmingExpiryText');

      if (!section || !grid) return;

      // Hide section if expired
      if (isWarmingLocationsExpired()) {
        section.style.display = 'none';
        return;
      }

      // Show section
      section.style.display = 'block';

      // Update subtitle with event name and date
      if (expiryText) {
        const verifiedDate = new Date(WARMING_LOCATIONS_CONFIG.verified_date);
        const dateStr = verifiedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        expiryText.textContent = `${WARMING_LOCATIONS_CONFIG.event_name}  Updated ${dateStr}`;
      }

      // Sort locations: 24hr first, then limited, then community
      const sortOrder = { '24hr': 0, 'limited': 1, 'community': 2 };
      const sortedLocations = [...warmingLocations].sort((a, b) =>
        (sortOrder[a.type] || 99) - (sortOrder[b.type] || 99)
      );

      // Render location cards
      grid.innerHTML = sortedLocations.map(loc => {
        const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(loc.address)}`;
        return `
          <div class="warming-location-card type-${loc.type}">
            <div class="warming-location-info">
              <h4>${loc.name}</h4>
              <div class="warming-location-hours">${loc.hours}</div>
              <div class="warming-location-address">${loc.address}</div>
              ${loc.services ? `<div class="warming-location-services">${loc.services}</div>` : ''}
            </div>
            <div class="warming-location-actions">
              <a href="${mapsUrl}" class="warming-location-link" target="_blank" rel="noopener noreferrer" title="Get directions">
                <i class="ph ph-navigation-arrow"></i>
              </a>
            </div>
          </div>
        `;
      }).join('');

      // Default to collapsed state
      section.classList.add('collapsed');
    }

    // Toggle warming section expand/collapse
    function toggleWarmingSection(event) {
      // Don't toggle if clicking on the phone link
      if (event.target.closest('a')) {
        return;
      }

      const section = document.getElementById('warmingLocationsSection');
      if (section) {
        section.classList.toggle('collapsed');
        trackActivity('warming_section_toggle', { expanded: !section.classList.contains('collapsed') });
      }
    }

    function getMapStatusColor(status) {
      const s = (status || '').toLowerCase();
      if (s.includes('crew en route') || s.includes('crew on site') || s.includes('assessing')) {
        return '#4ade80'; // green - being worked
      } else if (s.includes('unassigned') || s.includes('waiting')) {
        // Check unassigned BEFORE assigned (since 'unassigned' contains 'assigned')
        return '#f87171'; // red - unassigned/waiting
      } else if (s.includes('assigned') || s.includes('scheduled')) {
        return '#fbbf24'; // yellow - assigned
      } else {
        return '#f87171'; // red - unknown defaults to waiting
      }
    }

    function getMapStatusCategory(status) {
      const s = (status || '').toLowerCase();
      if (s.includes('crew en route') || s.includes('crew on site') || s.includes('assessing')) {
        return 'working';
      } else if (s.includes('unassigned') || s.includes('waiting')) {
        // Check unassigned BEFORE assigned (since 'unassigned' contains 'assigned')
        return 'unassigned';
      } else if (s.includes('assigned') || s.includes('scheduled')) {
        return 'assigned';
      } else {
        return 'unassigned'; // unknown defaults to waiting
      }
    }

    function getMapStatusText(status) {
      const cat = getMapStatusCategory(status);
      switch(cat) {
        case 'unassigned': return t('map_legend_waiting');
        case 'assigned': return t('map_legend_assigned');
        case 'working': return t('map_legend_working');
        default: return status || 'Unknown';
      }
    }

    function createOutagePopup(customers, status) {
      const statusClass = getMapStatusCategory(status);
      return `
        <div class="outage-popup">
          <div class="outage-popup-status ${statusClass}">${getMapStatusText(status)}</div>
          <div class="outage-popup-info">
            <strong>${customers.toLocaleString()}</strong> ${t('map_popup_customers')}
          </div>
        </div>
      `;
    }

    function createWarmingCenterPopup(name, address, hasFood) {
      const isStale = isWarmingDataStale();
      const statusText = isStale ? t('map_warming_unconfirmed') : t('map_warming_open');
      const statusClass = isStale ? 'unconfirmed' : '';
      const foodNote = hasFood ? `<div class="outage-popup-info" style="margin-top: 4px; color: #4ade80;"> ${t('map_warming_food')}</div>` : '';

      return `
        <div class="outage-popup">
          <div class="warming-popup-title">${name}</div>
          <div class="warming-popup-status ${statusClass}">${statusText}</div>
          <div class="outage-popup-info">${address}</div>
          ${foodNote}
          <a href="https://www.nashville.gov/departments/emergency-management" target="_blank" rel="noopener"
             style="display: block; margin-top: 8px; font-size: 0.75rem; color: #60a5fa;">
            ${t('map_warming_verify_link')} 
          </a>
        </div>
      `;
    }

    function createRoadClosurePopup(name, location, reason) {
      const isStale = isRoadClosureDataStale();
      const statusText = isStale ? t('map_warming_unconfirmed') : t('map_legend_road_closed');
      const statusClass = isStale ? 'unconfirmed' : '';

      return `
        <div class="outage-popup">
          <div class="warming-popup-title" style="color: #f97316;">${name}</div>
          <div class="warming-popup-status ${statusClass}">${statusText}</div>
          <div class="outage-popup-info">${location}</div>
          <div class="outage-popup-info" style="margin-top: 4px;">
            <strong>${t('map_road_closure_reason')}:</strong> ${reason}
          </div>
          <a href="https://www.nashville.gov/departments/transportation/road-closures" target="_blank" rel="noopener"
             style="display: block; margin-top: 8px; font-size: 0.75rem; color: #60a5fa;">
            ${t('map_road_closure_verify')} 
          </a>
        </div>
      `;
    }

    function addOutageMarkers(map, layer) {
      layer.clearLayers();

      // Add outage markers (if toggle enabled)
      if (mapToggles.outages) {
        cachedMapOutages.forEach(event => {
          const lat = event.lat || event.latitude;
          const lng = event.lng || event.longitude;
          const customers = event.customersAffected || event.customers_affected || event.numPeople || 1;
          const status = event.status || event.crewStatus || 'Unassigned';

          if (!lat || !lng) return;

          const color = getMapStatusColor(status);
          const radius = Math.min(Math.max(Math.sqrt(customers) * 1.2, 6), 30);

          const marker = L.circleMarker([lat, lng], {
            radius: radius,
            fillColor: color,
            color: '#1e293b',
            weight: 1.5,
            opacity: 1,
            fillOpacity: 0.75
          }).addTo(layer);

          marker.bindPopup(() => createOutagePopup(customers, status));
        });
      }

      // Add warming center markers (if toggle enabled)
      if (mapToggles.warmingCenters) {
        const warmingIcon = L.divIcon({
          className: '',
          html: '<div class="warming-center-icon"></div>',
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        });

        warmingCenters.forEach(center => {
          const marker = L.marker([center.lat, center.lng], { icon: warmingIcon }).addTo(layer);
          marker.bindPopup(() => createWarmingCenterPopup(center.name, center.address, center.hasFood));
        });
      }

      // Add road closure markers (if toggle enabled)
      if (mapToggles.roadClosures) {
        const roadClosureIcon = L.divIcon({
          className: '',
          html: '<div class="road-closure-icon" style="background: #f97316; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; border: 2px solid #1e293b; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        });

        roadClosures.forEach(closure => {
          const marker = L.marker([closure.lat, closure.lng], { icon: roadClosureIcon }).addTo(layer);
          marker.bindPopup(() => createRoadClosurePopup(closure.name, closure.location, closure.reason));
        });
      }
    }

    function toggleMapLayer(layerType) {
      mapToggles[layerType] = !mapToggles[layerType];

      // Refresh both maps
      if (previewMap && previewOutageLayer) {
        addOutageMarkers(previewMap, previewOutageLayer);
      }
      if (fullMap && fullOutageLayer) {
        addOutageMarkers(fullMap, fullOutageLayer);
      }
    }

    function updateMapStats() {
      // Update preview stats
      const customersEl = document.getElementById('mapStatCustomers');
      const crewsEl = document.getElementById('mapStatCrews');
      const waitingEl = document.getElementById('mapStatWaiting');

      if (customersEl) {
        customersEl.textContent = mapStatsData.customers > 1000
          ? Math.round(mapStatsData.customers / 1000) + 'K'
          : mapStatsData.customers.toLocaleString();
      }
      if (crewsEl) crewsEl.textContent = mapStatsData.crews.toLocaleString();
      if (waitingEl) waitingEl.textContent = mapStatsData.waiting.toLocaleString();

      // Update modal stats
      const modalCustomersEl = document.getElementById('modalStatCustomers');
      const modalCrewsEl = document.getElementById('modalStatCrews');
      const modalWaitingEl = document.getElementById('modalStatWaiting');

      if (modalCustomersEl) {
        modalCustomersEl.textContent = mapStatsData.customers > 1000
          ? Math.round(mapStatsData.customers / 1000) + 'K'
          : mapStatsData.customers.toLocaleString();
      }
      if (modalCrewsEl) modalCrewsEl.textContent = mapStatsData.crews.toLocaleString();
      if (modalWaitingEl) modalWaitingEl.textContent = mapStatsData.waiting.toLocaleString();
    }

    async function fetchMapOutages() {
      try {
        const response = await fetch('https://utilisocial.io/datacapable/v2/p/NES/map/events');
        const data = await response.json();

        const events = data.events || data || [];
        cachedMapOutages = events;

        let totalCustomers = 0;
        let crewsWorking = 0;
        let unassignedCount = 0;

        events.forEach(event => {
          const customers = event.customersAffected || event.customers_affected || event.numPeople || 1;
          const status = event.status || event.crewStatus || 'Unassigned';

          totalCustomers += customers;
          const cat = getMapStatusCategory(status);
          if (cat === 'working' || cat === 'assigned') {
            crewsWorking++;
          } else {
            unassignedCount++;
          }
        });

        mapStatsData = {
          customers: totalCustomers,
          crews: crewsWorking,
          waiting: unassignedCount
        };

        updateMapStats();

        if (previewOutageLayer) {
          addOutageMarkers(previewMap, previewOutageLayer);
        }
        if (fullOutageLayer) {
          addOutageMarkers(fullMap, fullOutageLayer);
        }

        console.log(`Map: Loaded ${events.length} outage events, ${totalCustomers} customers affected`);

      } catch (error) {
        console.error('Failed to fetch map outage data:', error);
      }
    }

    function initPreviewMap() {
      if (previewMap) return;

      const mapContainer = document.getElementById('outageMapPreview');
      if (!mapContainer) return;

      previewMap = L.map('outageMapPreview', {
        zoomControl: false,
        attributionControl: false,
        dragging: false,
        scrollWheelZoom: false,
        doubleClickZoom: false,
        touchZoom: false
      }).setView([36.1627, -86.7816], 10);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
      }).addTo(previewMap);

      previewOutageLayer = L.layerGroup().addTo(previewMap);

      // If we already have data, add markers
      if (cachedMapOutages.length > 0) {
        addOutageMarkers(previewMap, previewOutageLayer);
      }
    }

    function initFullMap() {
      if (fullMap) {
        // Just invalidate size if already exists
        setTimeout(() => fullMap.invalidateSize(), 100);
        return;
      }

      const mapContainer = document.getElementById('outageMapFull');
      if (!mapContainer) return;

      fullMap = L.map('outageMapFull', {
        zoomControl: true
      }).setView([36.1627, -86.7816], 11);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: ' OpenStreetMap contributors',
        maxZoom: 18
      }).addTo(fullMap);

      fullOutageLayer = L.layerGroup().addTo(fullMap);

      // If we already have data, add markers
      if (cachedMapOutages.length > 0) {
        addOutageMarkers(fullMap, fullOutageLayer);
      }
    }

    function openMapModal() {
      const modal = document.getElementById('mapModal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Fetch road closures on first map view (lazy load)
        if (typeof fetchRoadClosuresIfNeeded === 'function') {
          fetchRoadClosuresIfNeeded();
        }

        // Initialize or resize the full map
        setTimeout(() => {
          initFullMap();
        }, 50);

        trackActivity('map_modal_open');
      }
    }

    function closeMapModal() {
      const modal = document.getElementById('mapModal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMapModal();
      }
    });

    // Track if road closures have been fetched (deferred until map is viewed)
    let roadClosuresFetched = false;

    async function fetchRoadClosuresIfNeeded() {
      if (!roadClosuresFetched) {
        roadClosuresFetched = true;
        await fetchRoadClosures();
      }
    }

    // Initialize page - weather forecast loads FIRST, then outages
    // Road closures are deferred until user views the map
    (async () => {
      // Load weather forecast first with default Nashville ZIP
      const defaultZip = '37203';
      const zipInput = document.getElementById('zipInput');
      if (zipInput && !zipInput.value) {
        zipInput.value = defaultZip;
      }
      // Fetch forecast immediately (priority load)
      await fetchForecast();

      // Then initialize map and fetch outages
      initPreviewMap();
      await fetchMapOutages();

      // Render warming locations section (time-bound)
      renderWarmingLocationsSection();
    })();

    // Refresh outage data every 2 minutes (road closures only if already fetched)
    // Also refresh weather forecast every 15 minutes
    setInterval(() => {
      fetchMapOutages();
      if (roadClosuresFetched) fetchRoadClosures();
    }, 120000);

    setInterval(() => {
      fetchForecast();
    }, 900000); // 15 minutes

    // ===========================================
    // UX REVAMP - Tab Switching
    // ===========================================
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const tabId = this.dataset.tab;

        // Update button states
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Update content visibility
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById('tab-' + tabId).classList.add('active');

        // Track tab switch
        trackActivity('tab_switch', { tab: tabId });

        // Reinitialize map if switching to map tab
        if (tabId === 'resource-map') {
          // Fetch road closures on first map view (lazy load)
          fetchRoadClosuresIfNeeded();
          if (typeof previewMap !== 'undefined' && previewMap) {
            setTimeout(() => previewMap.invalidateSize(), 100);
          }
        }
      });
    });

    // ===========================================
    // UX REVAMP - Intent Card Expansion
    // ===========================================
    document.querySelectorAll('.intent-card').forEach(card => {
      card.addEventListener('click', function(e) {
        // Don't toggle if clicking on a link or phone button
        if (e.target.closest('.resource-phone') || e.target.closest('.resource-link') || e.target.closest('a')) {
          return;
        }

        this.classList.toggle('expanded');

        // Track intent card interaction
        const intent = this.dataset.intent;
        const isExpanded = this.classList.contains('expanded');
        trackActivity('intent_card_toggle', { intent: intent, expanded: isExpanded });
      });
    });

    // ===========================================
    // UX REVAMP - Status Row Updates
    // ===========================================
    function updateStatusOutageCount(count) {
      const statusEl = document.getElementById('statusOutageCount');
      if (statusEl) {
        if (count !== null && count !== undefined) {
          // Format large numbers with K suffix
          if (count >= 1000) {
            statusEl.textContent = Math.round(count / 1000) + 'K';
          } else {
            statusEl.textContent = count.toLocaleString();
          }
        } else {
          statusEl.textContent = '0';
        }
      }
    }

    function updateStatusForecast(high, low, description) {
      const tempEl = document.getElementById('statusForecastTemp');
      const descEl = document.getElementById('statusForecastDesc');
      if (tempEl && high !== null && low !== null) {
        tempEl.textContent = high + '  ' + low + '';
      }
      if (descEl && description) {
        descEl.textContent = description;
      }
    }

    // ===========================================
    // UX REVAMP - Inline Weather Alert
    // ===========================================
    function updateInlineWeatherAlert(alerts) {
      const inlineAlert = document.getElementById('weatherAlertInline');
      const titleEl = document.getElementById('weatherAlertTitle');
      const expiryEl = document.getElementById('weatherAlertExpiry');

      if (!inlineAlert || !alerts || alerts.length === 0) {
        if (inlineAlert) inlineAlert.style.display = 'none';
        return;
      }

      // Show the first/most severe alert
      const alert = alerts[0];
      if (titleEl) titleEl.textContent = alert.properties?.event || 'Weather Alert';

      if (expiryEl && alert.properties?.expires) {
        const expires = new Date(alert.properties.expires);
        const options = { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' };
        expiryEl.textContent = ' through ' + expires.toLocaleDateString('en-US', options);
      }

      inlineAlert.style.display = 'block';
    }

    // Hook into existing alert fetch to update inline alert
    const originalRenderAlerts = typeof renderAlerts === 'function' ? renderAlerts : null;
    if (originalRenderAlerts) {
      window.renderAlerts = function(alerts) {
        originalRenderAlerts(alerts);
        updateInlineWeatherAlert(alerts);
      };
    }

    // Hook into existing outage fetch to update status row
    const originalUpdateMapStats = window.updateMapStats;
    if (typeof updateMapStats === 'function') {
      window.updateMapStats = function() {
        if (originalUpdateMapStats) {
          originalUpdateMapStats();
        }
        // Read from mapStatsData global after original function updates it
        updateStatusOutageCount(mapStatsData.customers);
      };
    }

    // Hook into forecast to update status row
    const originalRenderForecast = typeof renderForecast === 'function' ? renderForecast : null;
    if (originalRenderForecast) {
      const newRenderForecast = function(data, lang) {
        originalRenderForecast(data, lang);

        // Update status row with forecast data
        if (data && data.daily) {
          const today = data.daily;
          const todayHigh = Math.round(today.temperature_2m_max[0]);
          const tomorrowLow = Math.round(today.temperature_2m_min[1] || today.temperature_2m_min[0]);

          // Get description from weather code
          const days = ['Fri', 'Sat', 'Sun'];
          const weatherCode = today.weather_code[0];
          let desc = '';

          // Check for precipitation in next few days
          const hasRain = today.weather_code.slice(0, 5).some(code =>
            [51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82].includes(code)
          );
          const hasSnow = today.weather_code.slice(0, 5).some(code =>
            [71, 73, 75, 77, 85, 86].includes(code)
          );

          if (hasSnow) {
            desc = 'Snow expected';
          } else if (hasRain) {
            const rainDay = today.weather_code.findIndex(code =>
              [51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82].includes(code)
            );
            if (rainDay > 0 && rainDay < days.length) {
              desc = 'Rain ' + days[rainDay];
            } else {
              desc = 'Rain expected';
            }
          } else {
            desc = 'FriSat';
          }

          updateStatusForecast(todayHigh, tomorrowLow, desc);
        }
      };
      window.renderForecast = newRenderForecast;
    }

    // ===========================================
    // ALERTS FEED - ALTERNATE SCREEN
    // ===========================================

    // Screen toggle functions
    function openAlertsScreen() {
      const alertsScreen = document.getElementById('alertsScreen');
      if (alertsScreen) {
        alertsScreen.classList.add('active');
        document.body.style.overflow = 'hidden';
        trackActivity('alerts_screen_open');

        // Restore language selector state
        if (typeof restoreAlertsLanguage === 'function') {
          restoreAlertsLanguage();
        }

        // Initialize alerts feed if first time
        if (!AlertsFeed.initialized) {
          AlertsFeed.init();
        } else {
          // Refresh on re-open if stale (> 1 min old)
          const lastUpdate = AlertsFeed.lastUpdate || 0;
          if (Date.now() - lastUpdate > 60000) {
            AlertsFeed.refreshAll();
          }
        }
      }
    }

    function closeAlertsScreen() {
      const alertsScreen = document.getElementById('alertsScreen');
      if (alertsScreen) {
        alertsScreen.classList.remove('active');
        document.body.style.overflow = '';
        trackActivity('alerts_screen_close');
      }
    }

    // Alerts Feed Module
    const AlertsFeed = {
      initialized: false,
      lastUpdate: 0,
      isLoading: false,
      refreshInterval: 120000,
      allAlerts: [],
      activeFilter: null,

      CONFIG: {
        nashvilleCoords: { lat: 36.1627, lon: -86.7816 },
        nwsZones: ['TNZ063', 'TNZ064', 'TNZ065'],
      },

      CORS_PROXIES: [
        'https://corsproxy.io/?',
        'https://api.allorigins.win/raw?url='
      ],

      SOURCES: {
        nws: {
          name: 'NWS Weather',
          icon: '',
          enabled: true,
          alerts: []
        },
        nes: {
          name: 'NES Power',
          icon: '',
          enabled: true,
          alerts: []
        },
        fema: {
          name: 'FEMA',
          icon: '',
          enabled: true,
          alerts: []
        },
        traffic: {
          name: 'TDOT Traffic',
          icon: '',
          enabled: true,
          alerts: []
        },
        hub311: {
          name: 'hubNashville 311',
          icon: '',
          enabled: true,
          alerts: []
        },
        reddit: {
          name: 'r/Nashville',
          icon: '',
          enabled: true,
          alerts: []
        },
        localNews: {
          name: 'Local News',
          icon: '',
          enabled: true,
          feeds: [
            { name: 'WKRN', url: 'https://www.wkrn.com/feed' },
            { name: 'WSMV', url: 'https://www.wsmv.com/search/?f=rss&t=article' },
            { name: 'NC5', url: 'https://www.newschannel5.com/index.rss' },
            { name: 'Fox17', url: 'https://fox17.com/feed' },
            { name: 'WPLN', url: 'https://wpln.org/feed' }
          ],
          alerts: []
        },
        usgs: {
          name: 'USGS',
          icon: '',
          enabled: false,
          alerts: []
        }
      },

      // Local state management
      LocalState: {
        KEY: 'gtn_alert_state',
        get() {
          try {
            return JSON.parse(localStorage.getItem(this.KEY)) || { read: {}, dismissed: {}, lastSeen: null };
          } catch { return { read: {}, dismissed: {}, lastSeen: null }; }
        },
        save(state) {
          localStorage.setItem(this.KEY, JSON.stringify(state));
        },
        markRead(alertId) {
          const state = this.get();
          state.read[alertId] = Date.now();
          this.save(state);
        },
        isRead(alertId) {
          return !!this.get().read[alertId];
        }
      },

      init() {
        this.loadPrefs();
        this.refreshAll();
        this.initialized = true;

        // Set up auto-refresh
        setInterval(() => {
          if (document.getElementById('alertsScreen')?.classList.contains('active')) {
            this.refreshAll();
          }
        }, this.refreshInterval);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && document.getElementById('alertsScreen')?.classList.contains('active')) {
            if (document.getElementById('alertsSourcesOverlay')?.classList.contains('active')) {
              this.toggleSourcesPanel();
            } else if (this.activeFilter) {
              this.clearFilter();
            } else {
              closeAlertsScreen();
            }
          }
        });
      },

      loadPrefs() {
        try {
          const saved = localStorage.getItem('alertSources');
          if (saved) {
            const prefs = JSON.parse(saved);
            Object.keys(prefs).forEach(k => {
              if (this.SOURCES[k]) {
                this.SOURCES[k].enabled = prefs[k];
                const toggle = document.querySelector(`#alertsScreen input[data-source="${k}"]`);
                if (toggle) toggle.checked = prefs[k];
              }
            });
          }
        } catch (e) {}
      },

      async refreshAll() {
        if (this.isLoading) return;
        this.isLoading = true;

        const btn = document.getElementById('alertsRefreshBtn');
        if (btn) {
          btn.classList.add('loading');
          const btnText = btn.querySelector('.btn-text');
          if (btnText) btnText.textContent = 'Loading...';
        }
        this.updateStatus('loading', 'Fetching alerts...');

        const feedContainer = document.getElementById('alertsFeedContainer');
        if (feedContainer) feedContainer.classList.add('updating');

        const isFreshLoad = this.allAlerts.length === 0;
        Object.values(this.SOURCES).forEach(s => s.alerts = []);

        if (isFreshLoad) {
          this.allAlerts = [];
          this.renderAlerts();
        }

        this.updateSourcePills();

        try {
          const fetchers = [
            { fn: () => this.fetchNWSAlerts(), key: 'nws' },
            { fn: () => this.fetchNESOutages(), key: 'nes' },
            { fn: () => this.fetchFEMADisasters(), key: 'fema' },
            { fn: () => this.fetchTrafficEvents(), key: 'traffic' },
            { fn: () => this.fetchHub311(), key: 'hub311' },
            { fn: () => this.fetchReddit(), key: 'reddit' },
            { fn: () => this.fetchLocalNews(), key: 'localNews' },
            { fn: () => this.fetchUSGSEarthquakes(), key: 'usgs' }
          ];

          const promises = fetchers.map(async ({ fn, key }) => {
            if (!this.SOURCES[key]?.enabled) return;
            try {
              await fn();
              this.rebuildAndRender();
              this.updateStatus('loading', `Got ${this.SOURCES[key].name}...`);
            } catch (e) {
              console.error(`${key} failed:`, e);
            }
          });

          await Promise.race([
            Promise.allSettled(promises),
            new Promise(resolve => setTimeout(resolve, 15000))
          ]);

        } finally {
          if (feedContainer) feedContainer.classList.remove('updating');
          this.isLoading = false;
          this.lastUpdate = Date.now();
          if (btn) {
            btn.classList.remove('loading');
            const btnText = btn.querySelector('.btn-text');
            if (btnText) btnText.textContent = 'Refresh';
          }
          this.updateStatus('success', `Updated ${new Date().toLocaleTimeString()}`);
        }
      },

      rebuildAndRender() {
        this.allAlerts = [];
        Object.values(this.SOURCES).forEach(s => {
          if (s.enabled) this.allAlerts = this.allAlerts.concat(s.alerts);
        });

        this.allAlerts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        this.allAlerts = this.interleaveBySource(this.allAlerts);

        this.updateAlertCount();
        this.updateSourcePills();
        this.updateSourceCounts();
        this.renderAlerts();
      },

      interleaveBySource(alerts, maxPerSource = 6) {
        if (alerts.length === 0) return alerts;

        const bySource = {};
        alerts.forEach(a => {
          if (!bySource[a.source]) bySource[a.source] = [];
          if (bySource[a.source].length < maxPerSource) {
            bySource[a.source].push(a);
          }
        });

        const sourcePriority = ['nws', 'nes', 'fema', 'traffic', 'hub311', 'localNews', 'reddit', 'usgs'];
        const result = [];
        const sourceQueues = {};
        let totalItems = 0;

        sourcePriority.forEach(src => {
          if (bySource[src] && bySource[src].length > 0) {
            sourceQueues[src] = [...bySource[src]];
            totalItems += sourceQueues[src].length;
          }
        });

        Object.keys(bySource).forEach(src => {
          if (!sourceQueues[src] && bySource[src].length > 0) {
            sourceQueues[src] = [...bySource[src]];
            totalItems += sourceQueues[src].length;
          }
        });

        let lastSource = null;
        while (result.length < totalItems) {
          const sources = Object.keys(sourceQueues).filter(s => sourceQueues[s].length > 0);
          if (sources.length === 0) break;

          let nextSource = sources.find(s => s !== lastSource) || sources[0];

          if (nextSource && sourceQueues[nextSource].length > 0) {
            const item = sourceQueues[nextSource].shift();
            result.push(item);
            lastSource = nextSource;
          } else {
            break;
          }
        }

        return result;
      },

      formatTimeAgo(timestamp) {
        if (!timestamp) return '';
        const now = Date.now();
        const diff = now - new Date(timestamp).getTime();
        const minutes = Math.floor(diff / 60000);

        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        return `${days}d ago`;
      },

      updateStatus(status, text) {
        const dot = document.getElementById('alertsStatusDot');
        if (dot) dot.className = 'alerts-status-dot' + (status === 'loading' ? ' loading' : status === 'error' ? ' error' : '');
        const textEl = document.getElementById('alertsStatusText');
        if (textEl) textEl.textContent = text;
      },

      updateAlertCount() {
        let count = this.allAlerts.length;
        if (this.activeFilter && this.SOURCES[this.activeFilter]) {
          count = this.SOURCES[this.activeFilter].alerts.length;
        }

        const feedCount = document.getElementById('alertsFeedCount');
        if (feedCount) feedCount.textContent = count;

        const counterBadge = document.getElementById('alertsCounterBadge');
        if (counterBadge) counterBadge.style.display = count > 0 ? 'inline-flex' : 'none';

        // Update main screen badge
        const mainBadge = document.getElementById('mainAlertCountBadge');
        if (mainBadge) {
          mainBadge.textContent = this.allAlerts.length;
          mainBadge.style.display = this.allAlerts.length > 0 ? 'inline' : 'none';
        }
      },

      updateSourceCounts() {
        Object.keys(this.SOURCES).forEach(key => {
          const el = document.getElementById(`alerts-${key}-count`);
          if (el) {
            const count = this.SOURCES[key].alerts.length;
            el.textContent = count;
            el.style.display = count > 0 ? 'inline' : 'none';
          }
        });
      },

      updateSourcePills() {
        const container = document.getElementById('alertsSourcePills');
        if (!container) return;

        container.innerHTML = Object.entries(this.SOURCES)
          .filter(([_, s]) => s.enabled && s.alerts.length > 0)
          .map(([key, s]) => {
            const isActive = this.activeFilter === key;
            return `<span class="alerts-source-pill${s.alerts.length > 0 ? ' has-alerts' : ''}${isActive ? ' active' : ''}"
                          onclick="AlertsFeed.setFilter('${key}')"
                          title="Click to filter">${s.icon} ${s.alerts.length}</span>`;
          })
          .join('');
      },

      setFilter(sourceKey) {
        if (this.activeFilter === sourceKey) {
          this.clearFilter();
          return;
        }

        this.activeFilter = sourceKey;
        const source = this.SOURCES[sourceKey];

        const filterBar = document.getElementById('alertsFilterBar');
        if (filterBar) filterBar.classList.add('active');

        const filterName = document.getElementById('alertsFilterSourceName');
        if (filterName) filterName.textContent = `${source.icon} ${source.name}`;

        this.updateSourcePills();
        this.updateAlertCount();
        this.renderAlerts();
      },

      clearFilter() {
        this.activeFilter = null;
        const filterBar = document.getElementById('alertsFilterBar');
        if (filterBar) filterBar.classList.remove('active');
        this.updateSourcePills();
        this.updateAlertCount();
        this.renderAlerts();
      },

      togglePriority() {
        const section = document.getElementById('alertsPrioritySection');
        if (section) {
          section.classList.toggle('collapsed');
          localStorage.setItem('priorityCollapsed', section.classList.contains('collapsed'));
        }
      },

      isPriorityAlert(alert) {
        // All NWS weather alerts are priority (cold weather advisories, winter storms, etc.)
        if (alert.source === 'nws') return true;
        if (alert.source === 'nes') return true;
        if (alert.source === 'fema') return alert.severity === 'severe';
        if (alert.source === 'localNews') {
          const title = alert.title?.toLowerCase() || '';
          return ['death', 'killed', 'dies', 'dead', 'fatal', 'emergency', 'evacuate', 'rescue', 'missing', 'tornado', 'flash flood'].some(kw => title.includes(kw));
        }
        return false;
      },

      toggleSourcesPanel() {
        const overlay = document.getElementById('alertsSourcesOverlay');
        if (overlay) overlay.classList.toggle('active');
      },

      toggleSource(key, enabled) {
        this.SOURCES[key].enabled = enabled;
        localStorage.setItem('alertSources', JSON.stringify(
          Object.fromEntries(Object.entries(this.SOURCES).map(([k, v]) => [k, v.enabled]))
        ));
        this.refreshAll();
      },

      // API Fetchers
      async fetchNWSAlerts() {
        try {
          const url = `https://api.weather.gov/alerts/active?zone=${this.CONFIG.nwsZones.join(',')}`;
          const res = await fetch(url, {
            headers: { 'User-Agent': 'GroundTruthNashville' },
            signal: AbortSignal.timeout(8000)
          });
          const data = await res.json();

          this.SOURCES.nws.alerts = (data.features || []).map(f => ({
            id: `nws-${f.id}`,
            source: 'nws',
            sourceIcon: '',
            sourceName: 'NWS Weather',
            title: f.properties.event || 'Weather Alert',
            description: f.properties.description || f.properties.headline,
            location: f.properties.areaDesc,
            severity: f.properties.severity?.toLowerCase() || 'unknown',
            timestamp: f.properties.sent || f.properties.effective,
            expires: f.properties.expires,
            url: f.properties['@id']
          }));
        } catch (e) {
          console.error('NWS:', e);
        }
      },

      async fetchNESOutages() {
        const nesUrl = 'https://utilisocial.io/datacapable/v2/p/NES/map/events';
        const urls = [
          nesUrl,
          this.CORS_PROXIES[0] + encodeURIComponent(nesUrl),
          this.CORS_PROXIES[1] + encodeURIComponent(nesUrl)
        ];

        for (const url of urls) {
          try {
            const res = await fetch(url, {
              headers: { 'Accept': 'application/json' },
              signal: AbortSignal.timeout(8000)
            });

            if (!res.ok) continue;
            const data = await res.json();

            if (data && Array.isArray(data) && data.length > 0) {
              const significant = data.filter(e => (e.customersAffected || 0) >= 5);

              this.SOURCES.nes.alerts = significant.slice(0, 8).map(e => ({
                id: `nes-${e.id || e.eventId}`,
                source: 'nes',
                sourceIcon: '',
                sourceName: 'NES Power',
                title: `Power Outage - ${(e.customersAffected || 0).toLocaleString()} customers`,
                description: `Status: ${e.status || e.crewStatus || 'Unknown'}. ${e.cause ? `Cause: ${e.cause}` : 'Cause under investigation.'}`,
                location: e.area || e.city || e.location || 'Nashville area',
                severity: (e.status === 'Assigned' || e.crewAssigned) ? 'moderate' : 'severe',
                timestamp: e.startTime || e.createdAt || e.reportedTime,
                url: 'https://www.nespower.com/outages/'
              }));
              return;
            }
          } catch (e) {
            continue;
          }
        }

        // Fallback
        this.SOURCES.nes.alerts = [{
          id: 'nes-fallback',
          source: 'nes',
          sourceIcon: '',
          sourceName: 'NES Power',
          title: 'Power outage data unavailable',
          description: 'Live data unavailable due to API restrictions. Visit nespower.com/outages for current map.',
          location: 'Nashville Service Area',
          severity: 'info',
          timestamp: new Date().toISOString(),
          url: 'https://www.nespower.com/outages/'
        }];
      },

      async fetchFEMADisasters() {
        try {
          const url = "https://www.fema.gov/api/open/v2/DisasterDeclarationsSummaries?$filter=state%20eq%20'TN'&$orderby=declarationDate%20desc&$top=10";
          const res = await fetch(url, { signal: AbortSignal.timeout(8000) });
          const data = await res.json();

          const cutoff = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000);
          const recent = (data.DisasterDeclarationsSummaries || [])
            .filter(d => new Date(d.declarationDate) > cutoff);

          const byDisaster = {};
          recent.forEach(d => {
            const key = d.disasterNumber;
            if (!byDisaster[key]) {
              byDisaster[key] = { ...d, counties: [] };
            }
            if (d.designatedArea) {
              byDisaster[key].counties.push(d.designatedArea.replace(' (County)', ''));
            }
          });

          this.SOURCES.fema.alerts = Object.values(byDisaster).map(d => {
            const countyList = d.counties.slice(0, 5).join(', ');
            const moreCount = d.counties.length > 5 ? ` +${d.counties.length - 5} more` : '';

            return {
              id: `fema-${d.disasterNumber}`,
              source: 'fema',
              sourceIcon: '',
              sourceName: 'FEMA',
              title: `${d.declarationType === 'DR' ? 'Major Disaster' : 'Emergency'}: ${d.incidentType}`,
              description: `${d.declarationTitle}. Designated areas: ${countyList}${moreCount}.`,
              location: d.counties.length > 3 ? `${d.counties.length} TN Counties` : countyList,
              severity: d.declarationType === 'DR' ? 'severe' : 'moderate',
              timestamp: d.declarationDate,
              url: `https://www.fema.gov/disaster/${d.disasterNumber}`
            };
          });
        } catch (e) {
          console.error('FEMA:', e);
        }
      },

      async fetchTrafficEvents() {
        if (!this.SOURCES.traffic.enabled) return;

        try {
          const url = 'https://spatial.tdot.tn.gov/ArcGIS/rest/services/Smartway/Smartway_Events/MapServer/0/query?where=1%3D1&outFields=*&f=json';
          const res = await fetch(url, { signal: AbortSignal.timeout(8000) });
          const data = await res.json();

          const relevant = (data.features || []).filter(f => {
            const a = f.attributes;
            return a.Region === 'Nashville' || a.Region === '3' ||
              a.County?.toLowerCase().includes('davidson') ||
              a.County?.toLowerCase().includes('williamson') ||
              a.County?.toLowerCase().includes('rutherford');
          });

          this.SOURCES.traffic.alerts = relevant.slice(0, 8).map(f => {
            const a = f.attributes;
            return {
              id: `traffic-${a.OBJECTID}`,
              source: 'traffic',
              sourceIcon: '',
              sourceName: 'TDOT Traffic',
              title: a.EventType || a.IncidentType || 'Traffic Event',
              description: a.Description || a.Comments || 'Traffic incident reported.',
              location: a.Location || a.Route || a.County || 'Middle TN',
              severity: (a.Severity === 'Major' || a.EventType?.includes('Closed')) ? 'severe' : 'minor',
              timestamp: a.StartTime || a.CreateDate,
              url: 'https://smartway.tn.gov/traffic'
            };
          });
        } catch (e) {
          console.error('Traffic:', e);
        }
      },

      async fetchHub311() {
        if (!this.SOURCES.hub311?.enabled) return;

        try {
          const url = 'https://services2.arcgis.com/HdTo6HJqh92wn4D8/arcgis/rest/services/hubNashville/FeatureServer/0/query?where=1%3D1&outFields=*&f=json&orderByFields=REQUESTDATE%20DESC&resultRecordCount=20';
          const res = await fetch(url, { signal: AbortSignal.timeout(8000) });
          const data = await res.json();

          const emergencyTypes = ['TREELIMB', 'TREEHAZ', 'FLOODING', 'SINKHOLE', 'POTHOLE', 'ROADHAZ', 'STREETLIT', 'SIGNDOWN', 'DEBRIS'];

          const relevant = (data.features || []).filter(f => {
            const type = f.attributes.REQUESTTYPE;
            return emergencyTypes.some(t => type?.includes(t));
          });

          this.SOURCES.hub311.alerts = relevant.slice(0, 5).map(f => {
            const a = f.attributes;
            return {
              id: `hub-${a.OBJECTID}`,
              source: 'hub311',
              sourceIcon: '',
              sourceName: 'Metro 311',
              title: a.REQUESTTYPE?.replace(/_/g, ' ') || 'Service Request',
              description: a.DESCRIPTION || `${a.REQUESTTYPE} reported`,
              location: a.ADDRESS || a.ZIPCODE || 'Nashville',
              severity: 'info',
              timestamp: a.REQUESTDATE,
              url: 'https://hub.nashville.gov'
            };
          });
        } catch (e) {
          console.error('Hub311:', e);
        }
      },

      async fetchReddit() {
        if (!this.SOURCES.reddit?.enabled) return;

        try {
          const url = 'https://www.reddit.com/r/nashville/new.json?limit=25';
          const res = await fetch(url, {
            headers: { 'User-Agent': 'GroundTruthNashville:1.0' },
            signal: AbortSignal.timeout(8000)
          });
          const data = await res.json();

          const emergencyKeywords = ['power', 'outage', 'nes', 'storm', 'ice', 'snow', 'weather', 'shelter', 'warming', 'closed', 'closure', 'emergency', 'flood', 'fire', 'accident', 'road', 'traffic'];

          const posts = (data.data?.children || []).filter(p => {
            const title = p.data.title?.toLowerCase() || '';
            const score = p.data.score || 0;
            const isEmergency = emergencyKeywords.some(kw => title.includes(kw));
            return isEmergency || score >= 50;
          });

          this.SOURCES.reddit.alerts = posts.slice(0, 6).map(p => {
            const d = p.data;
            const isUrgent = ['outage', 'emergency', 'shelter', 'closed'].some(kw => d.title?.toLowerCase().includes(kw));
            return {
              id: `reddit-${d.id}`,
              source: 'reddit',
              sourceIcon: '',
              sourceName: 'r/Nashville',
              title: d.title,
              description: d.selftext?.substring(0, 300) || `${d.num_comments} comments  ${d.score} upvotes`,
              location: 'Nashville Community',
              severity: isUrgent ? 'moderate' : 'info',
              timestamp: d.created_utc * 1000,
              url: `https://reddit.com${d.permalink}`
            };
          });
        } catch (e) {
          console.error('Reddit:', e);
        }
      },

      async fetchLocalNews() {
        if (!this.SOURCES.localNews?.enabled) return;

        const emergencyKeywords = ['power', 'outage', 'nes', 'storm', 'ice', 'snow', 'weather', 'shelter', 'warming', 'cold', 'freeze', 'emergency', 'flood', 'fire', 'accident', 'crash', 'death', 'killed', 'road', 'closed', 'closure', 'evacuate', 'rescue', 'missing', 'alert', 'warning', 'school', 'mnps', 'water', 'boil'];

        const allArticles = [];

        const feedPromises = this.SOURCES.localNews.feeds.map(async (feed) => {
          try {
            const rss2jsonUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`;
            const res = await fetch(rss2jsonUrl, { signal: AbortSignal.timeout(6000) });
            const data = await res.json();

            if (data.status === 'ok' && data.items) {
              return data.items.map(item => ({ ...item, feedName: feed.name }));
            }
          } catch (e) {
            return [];
          }
          return [];
        });

        const results = await Promise.allSettled(feedPromises);
        results.forEach(r => {
          if (r.status === 'fulfilled' && r.value) {
            allArticles.push(...r.value);
          }
        });

        const relevant = allArticles.filter(item => {
          const title = item.title?.toLowerCase() || '';
          return emergencyKeywords.some(kw => title.includes(kw));
        });

        const seen = new Set();
        this.SOURCES.localNews.alerts = relevant
          .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate))
          .filter(item => {
            const key = item.title?.substring(0, 40).toLowerCase();
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
          })
          .slice(0, 8)
          .map(item => {
            const isUrgent = ['death', 'killed', 'emergency', 'evacuate', 'rescue'].some(kw => item.title?.toLowerCase().includes(kw));
            return {
              id: `news-${item.guid || item.link}`,
              source: 'localNews',
              sourceIcon: '',
              sourceName: item.feedName,
              title: item.title,
              description: item.description?.replace(/<[^>]*>/g, '').substring(0, 200) || '',
              location: 'Nashville',
              severity: isUrgent ? 'severe' : 'moderate',
              timestamp: item.pubDate,
              url: item.link
            };
          });
      },

      async fetchUSGSEarthquakes() {
        if (!this.SOURCES.usgs.enabled) return;

        try {
          const url = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&latitude=${this.CONFIG.nashvilleCoords.lat}&longitude=${this.CONFIG.nashvilleCoords.lon}&maxradiuskm=300&minmagnitude=2.5&limit=20`;
          const res = await fetch(url, { signal: AbortSignal.timeout(8000) });
          const data = await res.json();

          this.SOURCES.usgs.alerts = (data.features || []).map(f => ({
            id: `usgs-${f.id}`,
            source: 'usgs',
            sourceIcon: '',
            sourceName: 'USGS',
            title: `M${f.properties.mag.toFixed(1)} Earthquake`,
            description: f.properties.place,
            location: f.properties.place,
            severity: f.properties.mag >= 4 ? 'severe' : f.properties.mag >= 3 ? 'moderate' : 'minor',
            timestamp: f.properties.time,
            url: f.properties.url
          }));
        } catch (e) {
          console.error('USGS:', e);
        }
      },

      // Rendering
      renderAlertCard(a, i = 0) {
        const sev = a.severity || 'info';
        const isUnread = !this.LocalState.isRead(a.id);
        const unreadClass = isUnread ? ' unread' : '';

        // Use translated content if available, otherwise fall back to original
        const displayTitle = a._translatedTitle || a.title;
        const displayDesc = a._translatedDescription || a.description || '';
        const shortDesc = displayDesc.substring(0, 200);

        return `
          <article class="alerts-card ${sev}${unreadClass}"
                   data-alert-id="${a.id}"
                   style="animation-delay:${i * 0.05}s"
                   onclick="AlertsFeed.handleCardClick(this, '${a.id}')">
            <div class="alerts-card-inner">
              <div class="alerts-card-header">
                <div class="alerts-source-badge">
                  <div class="alerts-source-icon">${a.sourceIcon}</div>
                  <span class="alerts-source-name">${a.sourceName}</span>
                </div>
                <span class="alerts-time-ago">${this.formatTimeAgo(a.timestamp)}</span>
              </div>
              <h2 class="alerts-card-title">${displayTitle}</h2>
              ${a.location ? `<p class="alerts-card-meta"><strong>${a.location}</strong>${a.expires ? `  Exp ${new Date(a.expires).toLocaleDateString()}` : ''}</p>` : ''}
              <p class="alerts-card-description">${shortDesc}</p>
              <div class="alerts-expand-content">
                <p style="font-size:0.9rem;color:var(--alerts-text-secondary);line-height:1.6;margin-bottom:1rem;">${displayDesc}</p>
                ${a.url ? `<div class="alerts-expand-actions"><a href="${a.url}" target="_blank" class="alerts-expand-btn" onclick="event.stopPropagation()">View Source </a></div>` : ''}
              </div>
              <div class="alerts-card-footer">
                <span class="alerts-expand-hint">Tap to expand </span>
                <span class="alerts-severity-badge ${sev}"><span class="alerts-severity-dot"></span>${sev}</span>
              </div>
            </div>
          </article>
        `;
      },

      handleCardClick(card, alertId) {
        card.classList.toggle('expanded');
        if (card.classList.contains('unread')) {
          card.classList.remove('unread');
          this.LocalState.markRead(alertId);
        }
      },

      async renderAlerts() {
        const container = document.getElementById('alertsFeedContainer');
        const prioritySection = document.getElementById('alertsPrioritySection');
        const priorityContent = document.getElementById('alertsPriorityContent');
        const priorityCount = document.getElementById('alertsPriorityCount');

        if (!container) return;

        let displayAlerts = this.allAlerts;
        if (this.activeFilter && this.SOURCES[this.activeFilter]) {
          displayAlerts = this.SOURCES[this.activeFilter].alerts;
        }

        // Translate all alert titles and descriptions in parallel
        const lang = getCurrentLang();
        if (lang !== 'en' && displayAlerts.length > 0) {
          const translationPromises = displayAlerts.map(async (alert) => {
            const [translatedTitle, translatedDesc] = await Promise.all([
              translateText(alert.title || '', lang),
              translateText((alert.description || '').substring(0, 450), lang)
            ]);
            alert._translatedTitle = translatedTitle;
            alert._translatedDescription = translatedDesc;
          });
          await Promise.all(translationPromises);
        }

        let priorityAlerts = [];
        let regularAlerts = displayAlerts;

        if (!this.activeFilter) {
          priorityAlerts = displayAlerts.filter(a => this.isPriorityAlert(a));
          regularAlerts = displayAlerts.filter(a => !this.isPriorityAlert(a));
        }

        if (prioritySection) {
          if (priorityAlerts.length > 0) {
            prioritySection.style.display = 'block';
            if (priorityCount) priorityCount.textContent = priorityAlerts.length;

            if (localStorage.getItem('priorityCollapsed') === 'true') {
              prioritySection.classList.add('collapsed');
            }

            if (priorityContent) {
              priorityContent.innerHTML = priorityAlerts.map((a, i) => this.renderAlertCard(a, i)).join('');
            }
          } else {
            prioritySection.style.display = 'none';
          }
        }

        if (regularAlerts.length === 0 && priorityAlerts.length === 0) {
          container.innerHTML = `
            <div class="alerts-empty-state">
              <div class="alerts-empty-icon"></div>
              <div class="alerts-empty-title">${this.activeFilter ? 'No Alerts' : 'All Clear'}</div>
              <div class="alerts-empty-desc">${this.activeFilter ? `No alerts from ${this.SOURCES[this.activeFilter]?.name || 'this source'}.` : 'No active alerts for the Nashville area.'}</div>
            </div>
          `;
          return;
        }

        if (regularAlerts.length === 0) {
          container.innerHTML = '';
          return;
        }

        const now = new Date();
        const groups = { 'Just Now': [], 'Earlier Today': [], 'Yesterday': [], 'This Week': [], 'Older': [] };

        regularAlerts.forEach(alert => {
          const time = new Date(alert.timestamp);
          const diffHours = (now - time) / 3600000;

          if (diffHours < 1) groups['Just Now'].push(alert);
          else if (diffHours < 24 && time.getDate() === now.getDate()) groups['Earlier Today'].push(alert);
          else if (diffHours < 48) groups['Yesterday'].push(alert);
          else if (diffHours < 168) groups['This Week'].push(alert);
          else groups['Older'].push(alert);
        });

        let html = '';
        let i = 0;

        Object.entries(groups).forEach(([label, alerts]) => {
          if (!alerts.length) return;
          html += `<section class="alerts-time-group"><div class="alerts-time-label">${label}</div>`;
          alerts.forEach(a => {
            html += this.renderAlertCard(a, i);
            i++;
          });
          html += '</section>';
        });

        container.innerHTML = html;
      }
    };

    // Expose globally for onclick handlers
    window.AlertsFeed = AlertsFeed;
    window.openAlertsScreen = openAlertsScreen;
    window.closeAlertsScreen = closeAlertsScreen;

    // ===========================================
    // NATIVE TRANSLATION FOR ALERTS SCREEN
    // ===========================================

    // Shared language key between main page and alerts
    const LANG_STORAGE_KEY = 'nashville-resources-lang';

    function setAlertsLanguage(lang) {
      // Update button states in alerts screen
      document.querySelectorAll('.alerts-lang-btn, .alerts-lang-menu button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === lang) {
          btn.classList.add('active');
        }
      });

      // Close menu
      document.getElementById('alertsLangMenu')?.classList.remove('active');

      // Save preference (shared with main page)
      localStorage.setItem(LANG_STORAGE_KEY, lang);

      // Also update main page language buttons
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      // Apply RTL for Arabic and Kurdish
      const alertsScreen = document.getElementById('alertsScreen');
      if (rtlLangs.includes(lang)) {
        alertsScreen?.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', lang);
      } else {
        alertsScreen?.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', lang);
      }

      // Apply translations to all elements with data-i18n
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang] && translations[lang][key]) {
          el.textContent = translations[lang][key];
        } else if (translations['en'][key]) {
          el.textContent = translations['en'][key];
        }
      });

      // Update URL parameter
      updateURLWithLanguage(lang);

      // Re-render alerts with new language translations
      if (AlertsFeed && AlertsFeed.initialized) {
        // Clear cached translations so they get re-translated
        AlertsFeed.allAlerts.forEach(a => {
          delete a._translatedTitle;
          delete a._translatedDescription;
        });
        Object.values(AlertsFeed.SOURCES).forEach(source => {
          source.alerts.forEach(a => {
            delete a._translatedTitle;
            delete a._translatedDescription;
          });
        });
        AlertsFeed.renderAlerts();
      }
    }

    function toggleAlertsLangMenu() {
      document.getElementById('alertsLangMenu')?.classList.toggle('active');
    }

    // Close menu on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.alerts-lang-selector') && !e.target.closest('.alerts-lang-menu')) {
        document.getElementById('alertsLangMenu')?.classList.remove('active');
      }
    });

    // Restore saved language on alerts screen open
    function restoreAlertsLanguage() {
      const savedLang = localStorage.getItem(LANG_STORAGE_KEY) || 'en';
      // Highlight the saved language button
      document.querySelectorAll('.alerts-lang-btn, .alerts-lang-menu button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === savedLang) {
          btn.classList.add('active');
        }
      });
      // If English, make sure EN button is active
      if (savedLang === 'en') {
        document.querySelector('.alerts-lang-btn[data-lang="en"]')?.classList.add('active');
      }
      // Apply the saved language translations
      if (savedLang !== 'en') {
        setAlertsLanguage(savedLang);
      }
    }

    // Call restore when page loads
    restoreAlertsLanguage();

    // Expose functions globally
    window.setAlertsLanguage = setAlertsLanguage;
    window.toggleAlertsLangMenu = toggleAlertsLangMenu;
  </script>

  <!-- Google Translate Widget (kept as fallback for unsupported languages) -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'so,zh-CN,ko,my,am',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
