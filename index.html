<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Nashville Winter Resources</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      -webkit-text-size-adjust: 100%;
    }

    /* Resources View Styles */
    #resources-view {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1.5rem 1rem;
      padding-top: max(1.5rem, env(safe-area-inset-top));
      padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
      padding-left: max(1rem, env(safe-area-inset-left));
      padding-right: max(1rem, env(safe-area-inset-right));
      color: #fff;
    }

    /* Emergency View Styles */
    #emergency-view {
      background: linear-gradient(135deg, #b91c1c 0%, #7f1d1d 100%);
      min-height: 100vh;
      min-height: 100dvh;
      padding: 16px;
      padding-top: max(16px, env(safe-area-inset-top));
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      padding-left: max(16px, env(safe-area-inset-left));
      padding-right: max(16px, env(safe-area-inset-right));
    }

    .hidden { display: none !important; }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    .container-emergency {
      max-width: 420px;
      margin: 0 auto;
    }

    @media (max-width: 360px) {
      #resources-view {
        padding: 1rem 0.75rem;
        padding-top: max(1rem, env(safe-area-inset-top));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    }

    /* Language Toggle - Resources */
    .lang-toggle {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .lang-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 0.6rem 0.85rem;
      min-height: 44px;
      color: #94a3b8;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      touch-action: manipulation;
    }

    @media (hover: hover) {
      .lang-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
      }
    }

    .lang-btn:active {
      background: rgba(255, 255, 255, 0.18);
      color: #fff;
      transform: scale(0.97);
    }

    .lang-btn:focus-visible {
      outline: 2px solid #60a5fa;
      outline-offset: 2px;
    }

    .lang-btn.active {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    /* Language Selector - Emergency */
    .lang-selector {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 12px;
    }

    .lang-btn-emergency {
      padding: 8px 12px;
      border: 2px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: white;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 44px;
      touch-action: manipulation;
    }

    .lang-btn-emergency:hover { background: rgba(255,255,255,0.2); }
    .lang-btn-emergency:active { transform: scale(0.97); }
    .lang-btn-emergency.active { background: white; color: #7f1d1d; border-color: white; }

    header {
      text-align: center;
      margin-bottom: 1.75rem;
    }

    h1 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    @media (max-width: 360px) {
      h1 {
        font-size: 1.4rem;
      }
    }

    .subtitle {
      color: #94a3b8;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .section {
      margin-bottom: 1.25rem;
    }

    .section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      margin-bottom: 0.6rem;
      padding-left: 0.25rem;
    }

    .links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    a.link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      min-height: 52px;
      color: #fff;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    a.link i {
      font-size: 1.35rem;
      opacity: 0.8;
      flex-shrink: 0;
    }

    @media (hover: hover) {
      a.link:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
    }

    a.link:active {
      background: rgba(255, 255, 255, 0.18);
      transform: scale(0.98);
    }

    a.link:focus-visible {
      outline: 2px solid #60a5fa;
      outline-offset: 2px;
    }

    .featured {
      background: linear-gradient(135deg, #e63946 0%, #d62839 100%);
      border-color: transparent;
      font-weight: 600;
    }

    @media (hover: hover) {
      .featured:hover {
        background: linear-gradient(135deg, #f1404e 0%, #e63946 100%);
        border-color: transparent;
      }
    }

    .featured:active {
      background: linear-gradient(135deg, #d62839 0%, #c41e2e 100%);
    }

    .featured i {
      opacity: 1;
    }

    /* Emergency Toggle Styles */
    .emergency-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      border: 2px solid #fca5a5;
      border-radius: 16px;
      padding: 1.25rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      touch-action: manipulation;
      text-decoration: none;
      color: #fff;
    }

    .emergency-toggle:hover {
      background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
    }

    .emergency-toggle:active {
      transform: scale(0.98);
    }

    .emergency-toggle-content {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .emergency-toggle-icon {
      font-size: 2rem;
      animation: pulse-icon 2s ease-in-out infinite;
    }

    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .emergency-toggle-text {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .emergency-toggle-title {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .emergency-toggle-subtitle {
      font-size: 0.8rem;
      opacity: 0.9;
      font-weight: 400;
    }

    .toggle-switch {
      width: 60px;
      height: 32px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      position: relative;
      flex-shrink: 0;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .emergency-toggle:hover .toggle-switch::after {
      transform: translateX(28px);
    }

    .toggle-label {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.65rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
    }

    .emergency-toggle:hover .toggle-label {
      left: 6px;
      right: auto;
      color: #22c55e;
    }

    [dir="rtl"] .emergency-toggle {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .emergency-toggle-content {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .emergency-toggle-text {
      text-align: right;
    }

    @media (max-width: 360px) {
      .emergency-toggle {
        padding: 1rem 1.25rem;
      }
      .emergency-toggle-icon {
        font-size: 1.75rem;
      }
      .emergency-toggle-title {
        font-size: 1rem;
      }
      .toggle-switch {
        width: 52px;
        height: 28px;
      }
      .toggle-switch::after {
        width: 20px;
        height: 20px;
      }
      .emergency-toggle:hover .toggle-switch::after {
        transform: translateX(24px);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .emergency-toggle-icon {
        animation: none;
      }
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.25rem;
      padding-bottom: 0.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #64748b;
      font-size: 0.8rem;
    }

    .admin-link {
      color: #475569;
      font-size: 0.7rem;
      text-decoration: none;
      cursor: pointer;
      margin-top: 0.75rem;
      display: inline-block;
      transition: color 0.15s ease;
    }

    .admin-link:hover {
      color: #64748b;
    }

    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 1.5rem;
      width: 100%;
      max-width: 320px;
      text-align: center;
    }

    .modal h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #fff;
    }

    .modal input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    .modal input:focus {
      outline: none;
      border-color: #60a5fa;
    }

    .modal-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .modal-btn {
      flex: 1;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .modal-btn.cancel {
      background: rgba(255, 255, 255, 0.1);
      color: #94a3b8;
    }

    .modal-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .modal-btn.submit {
      background: #3b82f6;
      color: #fff;
    }

    .modal-btn.submit:hover {
      background: #2563eb;
    }

    .modal-error {
      color: #f87171;
      font-size: 0.8rem;
      margin-bottom: 0.75rem;
      display: none;
    }

    .modal-error.show {
      display: block;
    }

    [dir="rtl"] a.link {
      flex-direction: row-reverse;
      text-align: right;
    }

    [dir="rtl"] .section-title {
      padding-left: 0;
      padding-right: 0.25rem;
      text-align: right;
    }

    /* Emergency View Specific Styles */
    [dir="rtl"] #emergency-view { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; }
    [dir="rtl"] .info-card-label { flex-direction: row-reverse; }
    [dir="rtl"] .gps-badge { margin-left: 0; margin-right: auto; }
    [dir="rtl"] .btn-call, [dir="rtl"] .btn-text, [dir="rtl"] .btn-copy, [dir="rtl"] .btn-refresh, [dir="rtl"] .btn-text-other { flex-direction: row-reverse; }
    [dir="rtl"] .privacy-notice { text-align: right; }

    .header-emergency {
      background: #7f1d1d;
      color: white;
      padding: 16px 20px;
      text-align: center;
      border-radius: 16px 16px 0 0;
    }

    .header-emergency h1 {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 0;
    }

    .header-emergency p {
      color: #fca5a5;
      font-size: 13px;
      margin-top: 4px;
    }

    .privacy-notice {
      background: #065f46;
      color: white;
      padding: 12px 16px;
      font-size: 13px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.4;
    }

    .privacy-notice svg {
      flex-shrink: 0;
      margin-top: 2px;
    }

    .emergency-buttons {
      background: #fee2e2;
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .btn-call, .btn-text {
      padding: 18px 16px;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 17px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.1s;
      text-decoration: none;
      color: white;
      min-height: 56px;
      touch-action: manipulation;
    }

    .btn-call {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      box-shadow: 0 4px 12px rgba(185, 28, 28, 0.4);
    }

    .btn-text {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    .btn-call:active, .btn-text:active { transform: scale(0.96); }

    .content-emergency {
      background: white;
      padding: 16px;
    }

    .info-card {
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 12px;
    }
    .info-card:last-child { margin-bottom: 0; }

    .info-card-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-card-value {
      font-size: 20px;
      font-weight: 700;
      color: #111;
      margin-top: 6px;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    }

    .info-card-hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
      font-style: italic;
    }

    .gps-card {
      background: #ecfdf5;
      border: 2px solid #10b981;
    }
    .gps-card .info-card-label { color: #065f46; }

    .gps-badge {
      background: #10b981;
      color: white;
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 20px;
      margin-left: auto;
    }

    .accuracy-text {
      font-size: 13px;
      margin-top: 8px;
      font-weight: 500;
    }
    .accuracy-excellent { color: #059669; }
    .accuracy-good { color: #2563eb; }
    .accuracy-moderate { color: #d97706; }
    .accuracy-poor { color: #dc2626; }

    .intersection-card {
      background: #fffbeb;
      border: 1px solid #fbbf24;
    }
    .intersection-card .info-card-label { color: #92400e; }

    .address-card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .address-card .info-card-label { color: #4b5563; }
    .address-card .info-card-value {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 17px;
    }

    .maps-card {
      background: #eff6ff;
      border: 1px solid #93c5fd;
    }
    .maps-card .info-card-label { color: #1d4ed8; }
    .maps-link {
      color: #2563eb;
      font-size: 13px;
      word-break: break-all;
      display: block;
      margin-top: 6px;
    }

    .actions {
      background: #f3f4f6;
      padding: 16px;
      border-radius: 0 0 16px 16px;
    }

    .btn-copy, .btn-text-other {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
      margin-bottom: 12px;
      min-height: 52px;
      touch-action: manipulation;
    }

    .btn-copy {
      background: #1f2937;
      color: white;
    }

    .btn-copy:hover { background: #111827; }
    .btn-copy:active { transform: scale(0.98); }
    .btn-copy.copied { background: #059669; }

    .btn-text-other {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }

    .btn-text-other:hover { opacity: 0.95; }
    .btn-text-other:active { transform: scale(0.98); }

    .btn-refresh {
      width: 100%;
      padding: 14px;
      border: 2px solid #d1d5db;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: white;
      color: #374151;
      transition: background 0.2s;
      min-height: 48px;
      touch-action: manipulation;
    }

    .btn-refresh:hover { background: #f9fafb; }
    .btn-refresh:active { transform: scale(0.98); }

    .instructions {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      font-size: 14px;
      color: #374151;
    }

    .instructions strong { color: #111; }

    .instructions .script {
      color: #1f2937;
      margin: 8px 0;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      font-size: 13px;
      background: #f3f4f6;
      padding: 8px 12px;
      border-radius: 8px;
      white-space: pre-wrap;
    }

    .instructions .note {
      font-size: 12px;
      color: #6b7280;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }

    .output-preview {
      background: #fefce8;
      border: 1px solid #fde047;
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      font-size: 12px;
    }

    .output-preview-title {
      font-weight: 600;
      color: #854d0e;
      margin-bottom: 8px;
    }

    .output-preview-content {
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      font-size: 11px;
      color: #1f2937;
      white-space: pre-wrap;
      background: white;
      padding: 8px;
      border-radius: 4px;
      max-height: 150px;
      overflow-y: auto;
    }

    .loading-container {
      background: white;
      border-radius: 16px;
      padding: 48px 24px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .spinner {
      width: 56px;
      height: 56px;
      border: 4px solid #fee2e2;
      border-top-color: #dc2626;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-container h2 {
      font-size: 20px;
      color: #111;
      margin-bottom: 8px;
    }
    .loading-container p { color: #6b7280; }

    .error-container {
      background: white;
      border-radius: 16px;
      padding: 48px 24px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .error-icon {
      width: 56px;
      height: 56px;
      background: #fee2e2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 28px;
    }

    .error-container h2 {
      font-size: 20px;
      color: #111;
      margin-bottom: 8px;
    }
    .error-container p {
      color: #6b7280;
      margin-bottom: 24px;
    }

    .btn-retry {
      background: #dc2626;
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      min-height: 48px;
      touch-action: manipulation;
    }

    .btn-retry:active { transform: scale(0.98); }

    .icon { width: 22px; height: 22px; flex-shrink: 0; }
    .icon-sm { width: 16px; height: 16px; }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: white;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 12px;
      opacity: 0.9;
      min-height: 44px;
      padding: 8px 0;
      cursor: pointer;
      background: none;
      border: none;
    }

    .back-link:hover { opacity: 1; }

    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        transform: none !important;
      }
      html {
        scroll-behavior: auto;
      }
      .spinner { animation: none; }
    }

    @supports (-webkit-touch-callout: none) {
      body {
        min-height: -webkit-fill-available;
      }
    }
  </style>
</head>
<body>
  <!-- Resources View -->
  <div id="resources-view">
    <div class="container">
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">English</button>
        <button class="lang-btn" data-lang="es">EspaÃ±ol</button>
        <button class="lang-btn" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="lang-btn" data-lang="ku">Ú©ÙˆØ±Ø¯ÛŒ</button>
        <button class="lang-btn" data-lang="vi">Tiáº¿ng Viá»‡t</button>
      </div>

      <header>
        <h1 data-i18n="title">Nashville Winter Resources</h1>
        <p class="subtitle" data-i18n="subtitle">Shelter, food & support during extreme weather</p>
      </header>

      <section class="section">
        <div class="section-title" data-i18n="emergency">Emergency</div>
        <button class="emergency-toggle" id="emergencyToggleBtn">
          <div class="emergency-toggle-content">
            <i class="ph ph-warning-circle emergency-toggle-icon"></i>
            <div class="emergency-toggle-text">
              <span class="emergency-toggle-title" data-i18n="emergency_location">911 Emergency Location</span>
              <span class="emergency-toggle-subtitle" data-i18n="emergency_tap">Tap to activate</span>
            </div>
          </div>
          <div class="toggle-switch">
            <span class="toggle-label">GO</span>
          </div>
        </button>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="start">Start Here</div>
        <div class="links">
          <a href="https://wttin.org/" class="link featured external-link" target="_blank" rel="noopener noreferrer" data-href="https://wttin.org/">
            <i class="ph ph-compass"></i>
            <span data-i18n="wttin">Where to Turn in Nashville</span>
          </a>
        </div>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="official">Official Resource Hubs</div>
        <div class="links">
          <a href="https://www.nashville.gov/departments/emergency-management/news/january-27-winter-weather-update" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/emergency-management/news/january-27-winter-weather-update">
            <i class="ph ph-cloud-snow"></i>
            <span data-i18n="nashville_weather">Nashville.gov Winter Weather Updates</span>
          </a>
          <a href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather">
            <i class="ph ph-thermometer-cold"></i>
            <span data-i18n="ohs_extreme">Metro OHS â€“ Extreme Weather</span>
          </a>
          <a href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather/shelters" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather/shelters">
            <i class="ph ph-list-bullets"></i>
            <span data-i18n="shelter_list">Metro Shelter List</span>
          </a>
          <a href="https://www.tn.gov/tema/tennessee-shelters.html" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.tn.gov/tema/tennessee-shelters.html">
            <i class="ph ph-map-trifold"></i>
            <span data-i18n="tema_map">TEMA Statewide Shelter Map</span>
          </a>
          <a href="https://www.tn.gov/tema/updates/2026-disasters/january-2026-winter-weather.html" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.tn.gov/tema/updates/2026-disasters/january-2026-winter-weather.html">
            <i class="ph ph-warning"></i>
            <span data-i18n="tema_hub">TEMA Winter Weather Hub</span>
          </a>
          <a href="https://www.fema.gov/disaster/2026-winter-storm" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.fema.gov/disaster/2026-winter-storm">
            <i class="ph ph-flag"></i>
            <span data-i18n="fema">FEMA 2026 Winter Storm</span>
          </a>
        </div>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="shelter">Shelter & Outreach</div>
        <div class="links">
          <a href="https://www.roomintheinn.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.roomintheinn.org/">
            <i class="ph ph-bed"></i>
            <span>Room in the Inn</span>
          </a>
          <a href="https://www.opentablenashville.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.opentablenashville.org/">
            <i class="ph ph-hand-heart"></i>
            <span>Open Table Nashville</span>
          </a>
          <a href="https://thecontributor.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://thecontributor.org/">
            <i class="ph ph-newspaper"></i>
            <span>The Contributor</span>
          </a>
          <a href="https://www.peoplelovingnashville.com/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.peoplelovingnashville.com/">
            <i class="ph ph-users"></i>
            <span>People Loving Nashville</span>
          </a>
        </div>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="food">Food</div>
        <div class="links">
          <a href="https://www.secondharvestmidtn.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.secondharvestmidtn.org/">
            <i class="ph ph-package"></i>
            <span data-i18n="second_harvest">Second Harvest Food Bank</span>
          </a>
          <a href="https://www.secondharvestmidtn.org/find-resources/find-food/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.secondharvestmidtn.org/find-resources/find-food/">
            <i class="ph ph-magnifying-glass"></i>
            <span data-i18n="find_food">Second Harvest â€“ Find Food</span>
          </a>
          <a href="https://dreamstreetstn.com/mobilefood" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://dreamstreetstn.com/mobilefood">
            <i class="ph ph-truck"></i>
            <span data-i18n="dream_streets">Dream Streets Mobile Food</span>
          </a>
        </div>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="immigrant">Immigrant Community</div>
        <div class="links">
          <a href="https://www.conexionamericas.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.conexionamericas.org/">
            <i class="ph ph-globe-hemisphere-west"></i>
            <span>ConexiÃ³n AmÃ©ricas / Casa AzafrÃ¡n</span>
          </a>
        </div>
      </section>

      <section class="section">
        <div class="section-title" data-i18n="legal">Legal & Other Resources</div>
        <div class="links">
          <a href="https://las.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://las.org/">
            <i class="ph ph-scales"></i>
            <span data-i18n="legal_aid">Legal Aid Society of Middle TN</span>
          </a>
          <a href="https://www.wnpt.org/agingmatters/unhoused/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.wnpt.org/agingmatters/unhoused/">
            <i class="ph ph-info"></i>
            <span data-i18n="npt">NPT Unhoused Resources</span>
          </a>
        </div>
      </section>

      <footer>
        <span data-i18n="footer">Share widely Â· Updated Jan 2026</span>
        <br>
        <a class="admin-link" id="adminLink">Admin</a>
      </footer>
    </div>
  </div>

  <!-- Admin Modal -->
  <div class="modal-overlay" id="adminModal">
    <div class="modal">
      <h3>Admin Login</h3>
      <div class="modal-error" id="modalError">Incorrect password</div>
      <input type="password" id="adminPassword" placeholder="Enter password" autocomplete="off">
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="modalCancel">Cancel</button>
        <button class="modal-btn submit" id="modalSubmit">Login</button>
      </div>
    </div>
  </div>

  <!-- Emergency View -->
  <div id="emergency-view" class="hidden">
    <div class="container-emergency">
      <button class="back-link" id="backToResourcesBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        <span data-i18n="back_to_resources">Back to Resources</span>
      </button>

      <div class="lang-selector">
        <button class="lang-btn-emergency active" data-lang="en">English</button>
        <button class="lang-btn-emergency" data-lang="es">EspaÃ±ol</button>
        <button class="lang-btn-emergency" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="lang-btn-emergency" data-lang="ku">Ú©ÙˆØ±Ø¯ÛŒ</button>
        <button class="lang-btn-emergency" data-lang="vi">Tiáº¿ng Viá»‡t</button>
      </div>

      <div id="loadingState" class="loading-container">
        <div class="spinner"></div>
        <h2 data-i18n="loading_title">Getting Your Location</h2>
        <p data-i18n="loading_desc">Please allow location access when prompted...</p>
      </div>

      <div id="errorState" class="error-container hidden">
        <div class="error-icon">âš ï¸</div>
        <h2 data-i18n="error_title">Location Error</h2>
        <p id="errorMessage" data-i18n="error_generic">Unable to get your location.</p>
        <button class="btn-retry" onclick="getLocation()" data-i18n="try_again">Try Again</button>
      </div>

      <div id="mainContent" class="hidden">
        <div class="header-emergency">
          <h1>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <span data-i18n="em_title">911 Emergency Location</span>
          </h1>
          <p data-i18n="em_subtitle">Share your exact location with emergency services</p>
        </div>

        <div class="privacy-notice">
          <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <span data-i18n="privacy_notice">Your location stays private on your device. Nothing is shared unless YOU choose to send it via call, text, or copy.</span>
        </div>

        <div class="emergency-buttons">
          <a href="tel:911" class="btn-call">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            <span data-i18n="call_911">CALL 911</span>
          </a>
          <a href="#" id="textBtn" class="btn-text">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span data-i18n="text_911">TEXT 911</span>
          </a>
        </div>

        <div class="content-emergency">
          <div class="info-card gps-card">
            <div class="info-card-label">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="3 11 22 2 13 21 11 13 3 11"/>
              </svg>
              <span data-i18n="gps_label">GPS COORDINATES</span>
              <span class="gps-badge" data-i18n="gps_badge">911 UNIVERSAL</span>
            </div>
            <div class="info-card-value" id="gpsCoords">â€”</div>
            <div class="info-card-hint" data-i18n="gps_hint">This is what 911 dispatchers need most</div>
            <div class="accuracy-text" id="accuracyText"></div>
          </div>

          <div class="info-card intersection-card" id="intersectionCard" style="display:none;">
            <div class="info-card-label">ğŸš¦ <span data-i18n="intersection_label">NEAREST INTERSECTION</span></div>
            <div class="info-card-value" id="intersection" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 18px;">â€”</div>
            <div class="info-card-hint" data-i18n="intersection_hint">Cross streets help responders find you</div>
          </div>

          <div class="info-card address-card" id="addressCard" style="display:none;">
            <div class="info-card-label">ğŸ“« <span data-i18n="address_label">STREET ADDRESS</span></div>
            <div class="info-card-value" id="streetAddress">â€”</div>
          </div>

          <div class="info-card maps-card">
            <div class="info-card-label">ğŸ—ºï¸ <span data-i18n="maps_label">GOOGLE MAPS</span></div>
            <a class="maps-link" id="mapsLink" href="#" target="_blank">â€”</a>
          </div>
        </div>

        <div class="actions">
          <button class="btn-copy" id="copyBtn" onclick="copyToClipboard()">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span data-i18n="copy_btn">Copy All Info</span>
          </button>

          <button class="btn-text-other" id="textOtherBtn" onclick="textSomeoneElse()">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <span data-i18n="text_other_btn">Text Someone Else</span>
          </button>

          <button class="btn-refresh" onclick="getLocation()">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
              <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
            <span data-i18n="refresh_btn">Refresh Location</span>
          </button>

          <div class="output-preview">
            <div class="output-preview-title" data-i18n="preview_title">ğŸ“¤ Message preview (in English for 911):</div>
            <div class="output-preview-content" id="outputPreview">â€”</div>
          </div>
        </div>

        <div class="instructions">
          <strong data-i18n="instructions_title">ğŸ“ When calling 911, say:</strong>
          <p class="script" id="callScript">"My GPS coordinates are..."</p>
          <p class="note" data-i18n="text_911_note">Nashville/Davidson County supports Text-to-911. Text if you cannot safely speak.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Combined translations for both views
    const translations = {
      en: {
        // Resources view
        title: "Nashville Winter Resources",
        subtitle: "Shelter, food & support during extreme weather",
        emergency: "Emergency",
        emergency_location: "911 Emergency Location",
        emergency_tap: "Tap to activate",
        start: "Start Here",
        wttin: "Where to Turn in Nashville",
        official: "Official Resource Hubs",
        nashville_weather: "Nashville.gov Winter Weather Updates",
        ohs_extreme: "Metro OHS â€“ Extreme Weather",
        shelter_list: "Metro Shelter List",
        tema_map: "TEMA Statewide Shelter Map",
        tema_hub: "TEMA Winter Weather Hub",
        fema: "FEMA 2026 Winter Storm",
        shelter: "Shelter & Outreach",
        food: "Food",
        second_harvest: "Second Harvest Food Bank",
        find_food: "Second Harvest â€“ Find Food",
        dream_streets: "Dream Streets Mobile Food",
        immigrant: "Immigrant Community",
        legal: "Legal & Other Resources",
        legal_aid: "Legal Aid Society of Middle TN",
        npt: "NPT Unhoused Resources",
        footer: "Share widely Â· Updated Jan 2026",
        // Emergency view
        back_to_resources: "Back to Resources",
        loading_title: "Getting Your Location",
        loading_desc: "Please allow location access when prompted...",
        error_title: "Location Error",
        error_generic: "Unable to get your location.",
        error_denied: "Location access denied. Please enable location permissions.",
        error_unavailable: "Location unavailable. Please try again.",
        error_timeout: "Location request timed out. Please try again.",
        try_again: "Try Again",
        em_title: "911 Emergency Location",
        em_subtitle: "Share your exact location with emergency services",
        privacy_notice: "Your location stays private on your device. Nothing is shared unless YOU choose to send it via call, text, or copy.",
        call_911: "CALL 911",
        text_911: "TEXT 911",
        gps_label: "GPS COORDINATES",
        gps_badge: "911 UNIVERSAL",
        gps_hint: "This is what 911 dispatchers need most",
        intersection_label: "NEAREST INTERSECTION",
        intersection_hint: "Cross streets help responders find you",
        address_label: "STREET ADDRESS",
        maps_label: "GOOGLE MAPS",
        copy_btn: "Copy All Info",
        copy_success: "Copied!",
        text_other_btn: "Text Someone Else",
        refresh_btn: "Refresh Location",
        preview_title: "ğŸ“¤ Message preview (in English for 911):",
        instructions_title: "ğŸ“ When calling 911, say:",
        text_911_note: "Nashville/Davidson County supports Text-to-911. Text if you cannot safely speak.",
        accuracy_excellent: "Accuracy: Excellent",
        accuracy_good: "Accuracy: Good",
        accuracy_moderate: "Accuracy: Moderate",
        accuracy_poor: "Accuracy: Approximate"
      },
      es: {
        // Resources view
        title: "Recursos de Invierno en Nashville",
        subtitle: "Refugio, comida y apoyo durante clima extremo",
        emergency: "Emergencia",
        emergency_location: "UbicaciÃ³n de Emergencia 911",
        emergency_tap: "Toca para activar",
        start: "Empiece AquÃ­",
        wttin: "DÃ³nde Acudir en Nashville",
        official: "Centros de Recursos Oficiales",
        nashville_weather: "Actualizaciones del Clima Invernal",
        ohs_extreme: "OHS â€“ Clima Extremo",
        shelter_list: "Lista de Refugios de Metro",
        tema_map: "Mapa de Refugios de Tennessee",
        tema_hub: "Centro de Clima Invernal TEMA",
        fema: "FEMA Tormenta de Invierno 2026",
        shelter: "Refugio y Alcance",
        food: "Comida",
        second_harvest: "Banco de Alimentos Second Harvest",
        find_food: "Second Harvest â€“ Encontrar Comida",
        dream_streets: "Dream Streets Comida MÃ³vil",
        immigrant: "Comunidad Inmigrante",
        legal: "Recursos Legales y Otros",
        legal_aid: "Sociedad de Ayuda Legal de Middle TN",
        npt: "Recursos NPT para Personas sin Hogar",
        footer: "Comparte Â· Actualizado Ene 2026",
        // Emergency view
        back_to_resources: "Volver a Recursos",
        loading_title: "Obteniendo Tu UbicaciÃ³n",
        loading_desc: "Permite el acceso a la ubicaciÃ³n cuando se solicite...",
        error_title: "Error de UbicaciÃ³n",
        error_generic: "No se puede obtener tu ubicaciÃ³n.",
        error_denied: "Acceso denegado. Habilita los permisos de ubicaciÃ³n.",
        error_unavailable: "UbicaciÃ³n no disponible. Intenta de nuevo.",
        error_timeout: "Tiempo agotado. Intenta de nuevo.",
        try_again: "Intentar de Nuevo",
        em_title: "UbicaciÃ³n de Emergencia 911",
        em_subtitle: "Comparte tu ubicaciÃ³n con servicios de emergencia",
        privacy_notice: "Tu ubicaciÃ³n permanece privada en tu dispositivo. No se comparte nada a menos que TÃš elijas enviarlo por llamada, mensaje o copia.",
        call_911: "LLAMAR 911",
        text_911: "MENSAJE 911",
        gps_label: "COORDENADAS GPS",
        gps_badge: "911 UNIVERSAL",
        gps_hint: "Esto es lo que mÃ¡s necesita el 911",
        intersection_label: "INTERSECCIÃ“N MÃS CERCANA",
        intersection_hint: "Las calles cruzadas ayudan a encontrarte",
        address_label: "DIRECCIÃ“N",
        maps_label: "GOOGLE MAPS",
        copy_btn: "Copiar Todo",
        copy_success: "Â¡Copiado!",
        text_other_btn: "Enviar a Otra Persona",
        refresh_btn: "Actualizar UbicaciÃ³n",
        preview_title: "ğŸ“¤ Vista previa (en inglÃ©s para 911):",
        instructions_title: "ğŸ“ Al llamar al 911, di en inglÃ©s:",
        text_911_note: "Nashville tiene texto al 911. EnvÃ­a mensaje si no puedes hablar.",
        accuracy_excellent: "PrecisiÃ³n: Excelente",
        accuracy_good: "PrecisiÃ³n: Buena",
        accuracy_moderate: "PrecisiÃ³n: Moderada",
        accuracy_poor: "PrecisiÃ³n: Aproximada"
      },
      ar: {
        // Resources view
        title: "Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø´ØªØ§Ø¡ ÙÙŠ Ù†Ø§Ø´ÙÙŠÙ„",
        subtitle: "Ù…Ø£ÙˆÙ‰ ÙˆØ·Ø¹Ø§Ù… ÙˆØ¯Ø¹Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù‚Ø§Ø³ÙŠ",
        emergency: "Ø·ÙˆØ§Ø±Ø¦",
        emergency_location: "Ù…ÙˆÙ‚Ø¹ Ø·ÙˆØ§Ø±Ø¦ 911",
        emergency_tap: "Ø§Ø¶ØºØ· Ù„Ù„ØªÙØ¹ÙŠÙ„",
        start: "Ø§Ø¨Ø¯Ø£ Ù‡Ù†Ø§",
        wttin: "Ø£ÙŠÙ† ØªØªÙˆØ¬Ù‡ ÙÙŠ Ù†Ø§Ø´ÙÙŠÙ„",
        official: "Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠØ©",
        nashville_weather: "ØªØ­Ø¯ÙŠØ«Ø§Øª Ø·Ù‚Ø³ Ø§Ù„Ø´ØªØ§Ø¡",
        ohs_extreme: "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù‚Ø§Ø³ÙŠ",
        shelter_list: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø¬Ø¦",
        tema_map: "Ø®Ø±ÙŠØ·Ø© Ù…Ù„Ø§Ø¬Ø¦ ØªÙŠÙ†ÙŠØ³ÙŠ",
        tema_hub: "Ù…Ø±ÙƒØ² Ø·Ù‚Ø³ Ø§Ù„Ø´ØªØ§Ø¡ TEMA",
        fema: "FEMA Ø¹Ø§ØµÙØ© Ø§Ù„Ø´ØªØ§Ø¡ 2026",
        shelter: "Ø§Ù„Ù…Ø£ÙˆÙ‰ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„",
        food: "Ø§Ù„Ø·Ø¹Ø§Ù…",
        second_harvest: "Ø¨Ù†Ùƒ Ø§Ù„Ø·Ø¹Ø§Ù… Second Harvest",
        find_food: "Second Harvest â€“ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¹Ø§Ù…",
        dream_streets: "Dream Streets Ø·Ø¹Ø§Ù… Ù…ØªÙ†Ù‚Ù„",
        immigrant: "Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ø§Ø¬Ø±ÙŠÙ†",
        legal: "Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙˆØºÙŠØ±Ù‡Ø§",
        legal_aid: "Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©",
        npt: "Ù…ÙˆØ§Ø±Ø¯ NPT Ù„Ù„Ù…Ø´Ø±Ø¯ÙŠÙ†",
        footer: "Ø´Ø§Ø±Ùƒ Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ ÙˆØ§Ø³Ø¹ Â· Ù…Ø­Ø¯Ø« ÙŠÙ†Ø§ÙŠØ± 2026",
        // Emergency view
        back_to_resources: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
        loading_title: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ",
        loading_desc: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹...",
        error_title: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹",
        error_generic: "ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ.",
        error_denied: "ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„. ÙŠØ±Ø¬Ù‰ ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.",
        error_unavailable: "Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
        error_timeout: "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
        try_again: "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
        em_title: "Ù…ÙˆÙ‚Ø¹ Ø·ÙˆØ§Ø±Ø¦ 911",
        em_subtitle: "Ø´Ø§Ø±Ùƒ Ù…ÙˆÙ‚Ø¹Ùƒ Ù…Ø¹ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦",
        privacy_notice: "Ù…ÙˆÙ‚Ø¹Ùƒ ÙŠØ¨Ù‚Ù‰ Ø®Ø§ØµØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ. Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø£ÙŠ Ø´ÙŠØ¡ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª Ø£Ù†Øª Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¹Ø¨Ø± Ù…ÙƒØ§Ù„Ù…Ø© Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ Ù†Ø³Ø®.",
        call_911: "Ø§ØªØµÙ„ 911",
        text_911: "Ø±Ø³Ø§Ù„Ø© 911",
        gps_label: "Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª GPS",
        gps_badge: "911 Ø¹Ø§Ù„Ù…ÙŠ",
        gps_hint: "Ù‡Ø°Ø§ Ù…Ø§ ÙŠØ­ØªØ§Ø¬Ù‡ 911 Ø£ÙƒØ«Ø±",
        intersection_label: "Ø£Ù‚Ø±Ø¨ ØªÙ‚Ø§Ø·Ø¹",
        intersection_hint: "Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ ØªØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙƒ",
        address_label: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø§Ø±Ø¹",
        maps_label: "Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„",
        copy_btn: "Ù†Ø³Ø® Ø§Ù„ÙƒÙ„",
        copy_success: "ØªÙ… Ø§Ù„Ù†Ø³Ø®!",
        text_other_btn: "Ø£Ø±Ø³Ù„ Ù„Ø´Ø®Øµ Ø¢Ø®Ø±",
        refresh_btn: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹",
        preview_title: "ğŸ“¤ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ù€ 911):",
        instructions_title: "ğŸ“ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù‚Ù„ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:",
        text_911_note: "Ù†Ø§Ø´ÙÙŠÙ„ ØªØ¯Ø¹Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù€ 911. Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ØªØ³ØªØ·Ø¹ Ø§Ù„ØªØ­Ø¯Ø«.",
        accuracy_excellent: "Ø§Ù„Ø¯Ù‚Ø©: Ù…Ù…ØªØ§Ø²Ø©",
        accuracy_good: "Ø§Ù„Ø¯Ù‚Ø©: Ø¬ÙŠØ¯Ø©",
        accuracy_moderate: "Ø§Ù„Ø¯Ù‚Ø©: Ù…ØªÙˆØ³Ø·Ø©",
        accuracy_poor: "Ø§Ù„Ø¯Ù‚Ø©: ØªÙ‚Ø±ÙŠØ¨ÙŠØ©"
      },
      ku: {
        // Resources view
        title: "Ø³Û•Ø±Ú†Ø§ÙˆÛ•Ú©Ø§Ù†ÛŒ Ø²Ø³ØªØ§Ù†ÛŒ Ù†Ø§Ø´Ú¤ÛŒÙ„",
        subtitle: "Ù¾Û•Ù†Ø§Ú¯Ø§ØŒ Ø®ÙˆØ§Ø±Ø¯Ù† Ùˆ Ù¾Ø´ØªÛŒÙˆØ§Ù†ÛŒ Ù„Û• Ú©Ø§ØªÛŒ Ú©Û•Ø´ÙˆÙ‡Û•ÙˆØ§ÛŒ Ø³Û•Ø®Øª",
        emergency: "ÙØ±ÛŒØ§Ú©Û•ÙˆØªÙ†",
        emergency_location: "Ø´ÙˆÛÙ†ÛŒ ÙØ±ÛŒØ§Ú©Û•ÙˆØªÙ†ÛŒ 911",
        emergency_tap: "Ø¨Û† Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¨Ú¯Ø±Û•",
        start: "Ù„ÛØ±Û•ÙˆÛ• Ø¯Û•Ø³Øª Ù¾ÛØ¨Ú©Û•",
        wttin: "Ù„Û• Ù†Ø§Ø´Ú¤ÛŒÙ„ Ø¨Û† Ú©ÙˆÛ Ø¨Ú•Û†ÛŒØª",
        official: "Ù†Ø§ÙˆÛ•Ù†Ø¯Û• ÙÛ•Ø±Ù…ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø³Û•Ø±Ú†Ø§ÙˆÛ•",
        nashville_weather: "Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•Ú©Ø§Ù†ÛŒ Ú©Û•Ø´ÙˆÙ‡Û•ÙˆØ§ÛŒ Ø²Ø³ØªØ§Ù†",
        ohs_extreme: "Ø®Ø²Ù…Û•ØªÚ¯ÙˆØ²Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ú©Û•Ø´ÙˆÙ‡Û•ÙˆØ§ÛŒ Ø³Û•Ø®Øª",
        shelter_list: "Ù„ÛŒØ³ØªÛŒ Ù¾Û•Ù†Ø§Ú¯Ø§Ú©Ø§Ù†",
        tema_map: "Ù†Û•Ø®Ø´Û•ÛŒ Ù¾Û•Ù†Ø§Ú¯Ø§Ú©Ø§Ù†ÛŒ ØªÛÙ†ÛØ³ÛŒ",
        tema_hub: "Ù†Ø§ÙˆÛ•Ù†Ø¯ÛŒ Ú©Û•Ø´ÙˆÙ‡Û•ÙˆØ§ÛŒ Ø²Ø³ØªØ§Ù†ÛŒ TEMA",
        fema: "Ø²Ø±ÛŒØ§Ù†ÛŒ Ø²Ø³ØªØ§Ù†ÛŒ FEMA 2026",
        shelter: "Ù¾Û•Ù†Ø§Ú¯Ø§ Ùˆ Ø¯Û•Ø³ØªÚ•Ø§Ú¯Û•ÛŒØ´ØªÙ†",
        food: "Ø®ÙˆØ§Ø±Ø¯Ù†",
        second_harvest: "Ø¨Ø§Ù†Ú©ÛŒ Ø®ÙˆØ§Ø±Ø¯Ù†ÛŒ Second Harvest",
        find_food: "Second Harvest â€“ Ø®ÙˆØ§Ø±Ø¯Ù† Ø¨Ø¯Û†Ø²Û•Ø±Û•ÙˆÛ•",
        dream_streets: "Ø®ÙˆØ§Ø±Ø¯Ù†ÛŒ Ú¯Û•Ú•Û†Ú©ÛŒ Dream Streets",
        immigrant: "Ú©Û†Ù…Û•ÚµÚ¯Ø§ÛŒ Ú©Û†Ú†Ø¨Û•Ø±Ø§Ù†",
        legal: "Ø³Û•Ø±Ú†Ø§ÙˆÛ• ÛŒØ§Ø³Ø§ÛŒÛŒÛ•Ú©Ø§Ù† Ùˆ Ù‡ÛŒØªØ±",
        legal_aid: "Ú©Û†Ù…Û•ÚµÛ•ÛŒ ÛŒØ§Ø±Ù…Û•ØªÛŒ ÛŒØ§Ø³Ø§ÛŒÛŒ",
        npt: "Ø³Û•Ø±Ú†Ø§ÙˆÛ•Ú©Ø§Ù†ÛŒ NPT Ø¨Û† Ø¨ÛÙ…Ø§ÚµØ§Ù†",
        footer: "Ø¨ÚµØ§ÙˆÛŒ Ø¨Ú©Û•Ø±Û•ÙˆÛ• Â· Ù†ÙˆÛÚ©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ• Ú©Ø§Ù†ÙˆÙˆÙ†ÛŒ Ø¯ÙˆÙˆÛ•Ù… 2026",
        // Emergency view
        back_to_resources: "Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ø³Û•Ø±Ú†Ø§ÙˆÛ•Ú©Ø§Ù†",
        loading_title: "Ø´ÙˆÛÙ†Û•Ú©Û•Øª Ø¯Û•Ø¯Û†Ø²Ø±ÛØªÛ•ÙˆÛ•",
        loading_desc: "Ú•ÛÚ¯Û• Ø¨Ø¯Û• Ø¨Û• Ø¯Û•Ø³ØªÚ¯Û•ÛŒØ´ØªÙ† Ø¨Û• Ø´ÙˆÛÙ†...",
        error_title: "Ù‡Û•ÚµÛ•ÛŒ Ø´ÙˆÛÙ†",
        error_generic: "Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ Ø´ÙˆÛÙ†Û•Ú©Û•Øª Ø¨Ø¯Û†Ø²Ø±ÛØªÛ•ÙˆÛ•.",
        error_denied: "Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•. Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø§Ù† Ú†Ø§Ù„Ø§Ú© Ø¨Ú©Û•.",
        error_unavailable: "Ø´ÙˆÛÙ† Ø¨Û•Ø±Ø¯Û•Ø³Øª Ù†ÛŒÛŒÛ•. Ø¯ÙˆÙˆØ¨Ø§Ø±Û• Ù‡Û•ÙˆÚµ Ø¨Ø¯Û•ÙˆÛ•.",
        error_timeout: "Ú©Ø§Øª ØªÛÙ¾Û•Ú•ÛŒ. Ø¯ÙˆÙˆØ¨Ø§Ø±Û• Ù‡Û•ÙˆÚµ Ø¨Ø¯Û•ÙˆÛ•.",
        try_again: "Ø¯ÙˆÙˆØ¨Ø§Ø±Û• Ù‡Û•ÙˆÚµ Ø¨Ø¯Û•ÙˆÛ•",
        em_title: "Ø´ÙˆÛÙ†ÛŒ ÙØ±ÛŒØ§Ú©Û•ÙˆØªÙ†ÛŒ 911",
        em_subtitle: "Ø´ÙˆÛÙ†Û•Ú©Û•Øª Ù‡Ø§ÙˆØ¨Û•Ø´ Ø¨Ú©Û•",
        privacy_notice: "Ø´ÙˆÛÙ†Û•Ú©Û•Øª ØªØ§ÛŒØ¨Û•Øª Ø¯Û•Ù…ÛÙ†ÛØªÛ•ÙˆÛ• Ù„Û• Ø¦Ø§Ù…ÛØ±Û•Ú©Û•Øª. Ù‡ÛŒÚ† Ø´ØªÛÚ© Ù‡Ø§ÙˆØ¨Û•Ø´ Ù†Ø§Ú©Ø±ÛØª Ù…Û•Ú¯Û•Ø± ØªÛ† Ø®Û†Øª Ø¨ÛŒØ¨Ù†ÛØ±ÛŒØª Ø¨Û• Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØŒ Ù†Ø§Ù…Û•ØŒ ÛŒØ§Ù† Ù„Û•Ø¨Û•Ø±Ú¯Ø±ØªÙ†Û•ÙˆÛ•.",
        call_911: "Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ 911",
        text_911: "Ù†Ø§Ù…Û• 911",
        gps_label: "Ú©Û†Ø¦Û†Ø±Ø¯ÛŒÙ†Ø§ØªÛŒ GPS",
        gps_badge: "911 Ø¬ÛŒÙ‡Ø§Ù†ÛŒ",
        gps_hint: "Ø¦Û•Ù…Û• Ù¾ÛÙˆÛŒØ³ØªØªØ±ÛŒÙ†Û• Ø¨Û† 911",
        intersection_label: "Ù†Ø²ÛŒÚ©ØªØ±ÛŒÙ† Ø®Ø§Ú†Û•Ú•Û",
        intersection_hint: "Ø´Û•Ù‚Ø§Ù…Û•Ú©Ø§Ù† ÛŒØ§Ø±Ù…Û•ØªÛŒ Ø¯Û•Ø¯Û•Ù†",
        address_label: "Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†",
        maps_label: "Ù†Û•Ø®Ø´Û•ÛŒ Ú¯ÙˆÙˆÚ¯Úµ",
        copy_btn: "Ù‡Û•Ù…ÙˆÙˆ Ù„Û•Ø¨Û•Ø±Ú¯Ø±ØªÙ†Û•ÙˆÛ•",
        copy_success: "Ù„Û•Ø¨Û•Ø±Ú¯ÛŒØ±Ø§!",
        text_other_btn: "Ù†Ø§Ù…Û• Ø¨Ù†ÛØ±Û• Ø¨Û† Ú©Û•Ø³ÛÚ©ÛŒ ØªØ±",
        refresh_btn: "Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•",
        preview_title: "ğŸ“¤ Ù¾ÛØ´Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ù†Ø§Ù…Û• (Ø¨Û• Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ Ø¨Û† 911):",
        instructions_title: "ğŸ“ Ø¨Û• Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ Ø¨ÚµÛ:",
        text_911_note: "Ù†Ø§Ø´Ú¤ÛŒÙ„ Ù†Ø§Ù…Û• Ø¨Û† 911 Ù¾Ø´ØªÚ¯ÛŒØ±ÛŒ Ø¯Û•Ú©Ø§Øª.",
        accuracy_excellent: "ÙˆØ±Ø¯ÛŒ: Ù†Ø§ÛŒØ§Ø¨",
        accuracy_good: "ÙˆØ±Ø¯ÛŒ: Ø¨Ø§Ø´",
        accuracy_moderate: "ÙˆØ±Ø¯ÛŒ: Ù…Ø§Ù…Ù†Ø§ÙˆÛ•Ù†Ø¯",
        accuracy_poor: "ÙˆØ±Ø¯ÛŒ: Ù†Ø²ÛŒÚ©"
      },
      vi: {
        // Resources view
        title: "TÃ i NguyÃªn MÃ¹a ÄÃ´ng Nashville",
        subtitle: "NÆ¡i trÃº áº©n, thá»±c pháº©m & há»— trá»£ trong thá»i tiáº¿t kháº¯c nghiá»‡t",
        emergency: "Kháº©n Cáº¥p",
        emergency_location: "Vá»‹ TrÃ­ Kháº©n Cáº¥p 911",
        emergency_tap: "Nháº¥n Ä‘á»ƒ kÃ­ch hoáº¡t",
        start: "Báº¯t Äáº§u Táº¡i ÄÃ¢y",
        wttin: "NÆ¡i HÆ°á»›ng Dáº«n Táº¡i Nashville",
        official: "Trung TÃ¢m TÃ i NguyÃªn ChÃ­nh Thá»©c",
        nashville_weather: "Cáº­p Nháº­t Thá»i Tiáº¿t MÃ¹a ÄÃ´ng",
        ohs_extreme: "OHS â€“ Thá»i Tiáº¿t Kháº¯c Nghiá»‡t",
        shelter_list: "Danh SÃ¡ch NÆ¡i TrÃº áº¨n Metro",
        tema_map: "Báº£n Äá»“ NÆ¡i TrÃº áº¨n ToÃ n Tiá»ƒu Bang",
        tema_hub: "Trung TÃ¢m Thá»i Tiáº¿t MÃ¹a ÄÃ´ng TEMA",
        fema: "FEMA BÃ£o Tuyáº¿t 2026",
        shelter: "NÆ¡i TrÃº áº¨n & Tiáº¿p Cáº­n",
        food: "Thá»±c Pháº©m",
        second_harvest: "NgÃ¢n HÃ ng Thá»±c Pháº©m Second Harvest",
        find_food: "Second Harvest â€“ TÃ¬m Thá»±c Pháº©m",
        dream_streets: "Dream Streets Thá»±c Pháº©m Di Äá»™ng",
        immigrant: "Cá»™ng Äá»“ng NgÆ°á»i Nháº­p CÆ°",
        legal: "TÃ i NguyÃªn PhÃ¡p LÃ½ & KhÃ¡c",
        legal_aid: "Há»™i Trá»£ GiÃºp PhÃ¡p LÃ½ Middle TN",
        npt: "TÃ i NguyÃªn NPT cho NgÆ°á»i VÃ´ Gia CÆ°",
        footer: "Chia sáº» rá»™ng rÃ£i Â· Cáº­p nháº­t ThÃ¡ng 1 2026",
        // Emergency view
        back_to_resources: "Quay láº¡i TÃ i NguyÃªn",
        loading_title: "Äang Láº¥y Vá»‹ TrÃ­",
        loading_desc: "Vui lÃ²ng cho phÃ©p truy cáº­p vá»‹ trÃ­...",
        error_title: "Lá»—i Vá»‹ TrÃ­",
        error_generic: "KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­.",
        error_denied: "Bá»‹ tá»« chá»‘i. Vui lÃ²ng báº­t quyá»n vá»‹ trÃ­.",
        error_unavailable: "Vá»‹ trÃ­ khÃ´ng kháº£ dá»¥ng. Thá»­ láº¡i.",
        error_timeout: "Háº¿t thá»i gian. Thá»­ láº¡i.",
        try_again: "Thá»­ Láº¡i",
        em_title: "Vá»‹ TrÃ­ Kháº©n Cáº¥p 911",
        em_subtitle: "Chia sáº» vá»‹ trÃ­ vá»›i dá»‹ch vá»¥ cáº¥p cá»©u",
        privacy_notice: "Vá»‹ trÃ­ cá»§a báº¡n Ä‘Æ°á»£c giá»¯ riÃªng tÆ° trÃªn thiáº¿t bá»‹. KhÃ´ng cÃ³ gÃ¬ Ä‘Æ°á»£c chia sáº» trá»« khi Báº N chá»n gá»­i qua cuá»™c gá»i, tin nháº¯n, hoáº·c sao chÃ©p.",
        call_911: "Gá»ŒI 911",
        text_911: "NHáº®N 911",
        gps_label: "Tá»ŒA Äá»˜ GPS",
        gps_badge: "911 TOÃ€N Cáº¦U",
        gps_hint: "ÄÃ¢y lÃ  thÃ´ng tin 911 cáº§n nháº¥t",
        intersection_label: "GIAO Lá»˜ Gáº¦N NHáº¤T",
        intersection_hint: "CÃ¡c Ä‘Æ°á»ng giao giÃºp tÃ¬m báº¡n",
        address_label: "Äá»ŠA CHá»ˆ",
        maps_label: "GOOGLE MAPS",
        copy_btn: "Sao ChÃ©p Táº¥t Cáº£",
        copy_success: "ÄÃ£ Sao ChÃ©p!",
        text_other_btn: "Nháº¯n Cho NgÆ°á»i KhÃ¡c",
        refresh_btn: "LÃ m Má»›i",
        preview_title: "ğŸ“¤ Xem trÆ°á»›c tin nháº¯n (tiáº¿ng Anh cho 911):",
        instructions_title: "ğŸ“ Khi gá»i, nÃ³i tiáº¿ng Anh:",
        text_911_note: "Nashville há»— trá»£ nháº¯n 911. Nháº¯n náº¿u khÃ´ng thá»ƒ nÃ³i.",
        accuracy_excellent: "Äá»™ chÃ­nh xÃ¡c: Xuáº¥t sáº¯c",
        accuracy_good: "Äá»™ chÃ­nh xÃ¡c: Tá»‘t",
        accuracy_moderate: "Äá»™ chÃ­nh xÃ¡c: Trung bÃ¬nh",
        accuracy_poor: "Äá»™ chÃ­nh xÃ¡c: Gáº§n Ä‘Ãºng"
      }
    };

    const rtlLangs = ['ar', 'ku'];
    const langCodes = {
      en: 'en',
      es: 'es',
      ar: 'ar',
      ku: 'ckb',
      vi: 'vi'
    };

    let currentLang = 'en';
    let currentLocation = null;
    let currentAccuracy = null;
    let currentAddress = null;
    let emergencyViewActive = false;

    // View switching
    function showResourcesView() {
      document.getElementById('resources-view').classList.remove('hidden');
      document.getElementById('emergency-view').classList.add('hidden');
      emergencyViewActive = false;
    }

    function showEmergencyView() {
      document.getElementById('resources-view').classList.add('hidden');
      document.getElementById('emergency-view').classList.remove('hidden');
      emergencyViewActive = true;
      getLocation();
    }

    // Navigation event listeners
    document.getElementById('emergencyToggleBtn').addEventListener('click', showEmergencyView);
    document.getElementById('backToResourcesBtn').addEventListener('click', showResourcesView);

    // External links translation
    function updateExternalLinks(lang) {
      document.querySelectorAll('.external-link').forEach(link => {
        const originalUrl = link.dataset.href;
        if (lang === 'en') {
          link.href = originalUrl;
        } else {
          link.href = `https://translate.google.com/translate?sl=en&tl=${langCodes[lang]}&u=${encodeURIComponent(originalUrl)}`;
        }
      });
    }

    // Language switching
    function setLanguage(lang) {
      currentLang = lang;
      const t = translations[lang];

      // Update all translatable elements
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) el.textContent = t[key];
      });

      // Update language buttons in both views
      document.querySelectorAll('.lang-btn, .lang-btn-emergency').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      // Set RTL direction if needed
      if (rtlLangs.includes(lang)) {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', lang);
      } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', lang);
      }

      // Update external links
      updateExternalLinks(lang);

      // Save preference
      localStorage.setItem('nashville-resources-lang', lang);

      // Update emergency display if location is available
      if (currentLocation) updateDisplay();
    }

    // Language button event listeners
    document.querySelectorAll('.lang-btn, .lang-btn-emergency').forEach(btn => {
      btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
    });

    // Load saved language
    const savedLang = localStorage.getItem('nashville-resources-lang');
    if (savedLang && translations[savedLang]) {
      setLanguage(savedLang);
    }

    // Emergency location functions
    function formatCoords(lat, lng) {
      return `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
    }

    function getAccuracyInfo(meters) {
      const t = translations[currentLang];
      if (meters <= 10) return { label: t.accuracy_excellent, class: 'accuracy-excellent' };
      if (meters <= 30) return { label: t.accuracy_good, class: 'accuracy-good' };
      if (meters <= 100) return { label: t.accuracy_moderate, class: 'accuracy-moderate' };
      return { label: t.accuracy_poor, class: 'accuracy-poor' };
    }

    async function reverseGeocode(lat, lng) {
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&addressdetails=1&zoom=18`,
          { headers: { 'User-Agent': 'Emergency911Widget/1.0' } }
        );
        const data = await response.json();
        const addr = data.address || {};
        return {
          street: addr.house_number ? `${addr.house_number} ${addr.road || ''}` : (addr.road || ''),
          city: addr.city || addr.town || addr.village || '',
          state: addr.state || '',
          zip: addr.postcode || ''
        };
      } catch (err) { return null; }
    }

    async function findNearestIntersection(lat, lng) {
      try {
        const query = `[out:json][timeout:10];(way["highway"~"^(primary|secondary|tertiary|residential|unclassified)$"](around:150,${lat},${lng}););out body;`;
        const response = await fetch('https://overpass-api.de/api/interpreter', { method: 'POST', body: query });
        const data = await response.json();
        const roads = data.elements.filter(e => e.type === 'way' && e.tags?.name).map(e => e.tags.name).filter((v, i, a) => a.indexOf(v) === i);
        if (roads.length >= 2) return `${roads[0]} & ${roads[1]}`;
        if (roads.length === 1) return `Near ${roads[0]}`;
        return null;
      } catch (err) { return null; }
    }

    function showLoading() {
      document.getElementById('loadingState').classList.remove('hidden');
      document.getElementById('errorState').classList.add('hidden');
      document.getElementById('mainContent').classList.add('hidden');
    }

    function showError(errorKey) {
      const t = translations[currentLang];
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('errorState').classList.remove('hidden');
      document.getElementById('mainContent').classList.add('hidden');
      document.getElementById('errorMessage').textContent = t[errorKey] || t.error_generic;
    }

    function showContent() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('errorState').classList.add('hidden');
      document.getElementById('mainContent').classList.remove('hidden');
    }

    function updateDisplay() {
      const { lat, lng } = currentLocation;
      const coordsStr = formatCoords(lat, lng);

      document.getElementById('gpsCoords').textContent = coordsStr;

      if (currentAccuracy) {
        const accInfo = getAccuracyInfo(currentAccuracy);
        document.getElementById('accuracyText').textContent = `${accInfo.label} (Â±${Math.round(currentAccuracy)}m)`;
        document.getElementById('accuracyText').className = `accuracy-text ${accInfo.class}`;
      }

      const mapsUrl = `https://maps.google.com/?q=${lat},${lng}`;
      document.getElementById('mapsLink').href = mapsUrl;
      document.getElementById('mapsLink').textContent = mapsUrl;

      document.getElementById('callScript').textContent = `"My GPS coordinates are ${coordsStr}"`;

      updateTextLink();
      updateOutputPreview();
    }

    function updateTextLink() {
      document.getElementById('textBtn').href = `sms:911?body=${encodeURIComponent(buildEmergencyMessage())}`;
    }

    function buildEmergencyMessage() {
      if (!currentLocation) return '';
      const { lat, lng } = currentLocation;
      const coordsStr = formatCoords(lat, lng);

      let msg = `EMERGENCY - MY LOCATION:\n\nGPS: ${coordsStr}\n\n`;

      if (currentAddress?.intersection) msg += `INTERSECTION: ${currentAddress.intersection}\n\n`;

      if (currentAddress?.street) {
        msg += `ADDRESS: ${currentAddress.street}`;
        if (currentAddress.city) msg += `, ${currentAddress.city}`;
        if (currentAddress.state) msg += `, ${currentAddress.state}`;
        if (currentAddress.zip) msg += ` ${currentAddress.zip}`;
        msg += `\n\n`;
      }

      msg += `MAP: https://maps.google.com/?q=${lat},${lng}\n\nAccuracy: Â±${Math.round(currentAccuracy)}m`;

      return msg;
    }

    function updateOutputPreview() {
      document.getElementById('outputPreview').textContent = buildEmergencyMessage();
    }

    async function copyToClipboard() {
      const t = translations[currentLang];
      try {
        await navigator.clipboard.writeText(buildEmergencyMessage());
        const btn = document.getElementById('copyBtn');
        btn.classList.add('copied');
        btn.innerHTML = `<svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg><span>${t.copy_success}</span>`;
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = `<svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>${t.copy_btn}</span>`;
        }, 2000);
      } catch (err) {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = buildEmergencyMessage();
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        const btn = document.getElementById('copyBtn');
        btn.classList.add('copied');
        btn.innerHTML = `<svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg><span>${t.copy_success}</span>`;
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = `<svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>${t.copy_btn}</span>`;
        }, 2000);
      }
    }

    function textSomeoneElse() {
      const message = buildEmergencyMessage();
      window.location.href = `sms:?body=${encodeURIComponent(message)}`;
    }

    async function getLocation() {
      showLoading();

      if (!navigator.geolocation) { showError('error_generic'); return; }

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude: lat, longitude: lng, accuracy } = position.coords;

          currentLocation = { lat, lng };
          currentAccuracy = accuracy;

          showContent();
          updateDisplay();

          const [addr, intersection] = await Promise.all([
            reverseGeocode(lat, lng),
            findNearestIntersection(lat, lng)
          ]);

          if (addr) {
            currentAddress = { ...addr, intersection };

            if (addr.street) {
              let fullAddr = addr.street;
              if (addr.city) fullAddr += `, ${addr.city}`;
              if (addr.state) fullAddr += `, ${addr.state}`;
              if (addr.zip) fullAddr += ` ${addr.zip}`;
              document.getElementById('streetAddress').textContent = fullAddr;
              document.getElementById('addressCard').style.display = 'block';
            }

            if (intersection) {
              document.getElementById('intersection').textContent = intersection;
              document.getElementById('intersectionCard').style.display = 'block';
              document.getElementById('callScript').textContent = `"My GPS coordinates are ${formatCoords(lat, lng)}"\n\n"I'm near ${intersection}"`;
            }
          }

          updateTextLink();
          updateOutputPreview();
        },
        (error) => {
          const errorMap = { 1: 'error_denied', 2: 'error_unavailable', 3: 'error_timeout' };
          showError(errorMap[error.code] || 'error_generic');
        },
        { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
      );
    }

    // Admin modal functionality
    const adminLink = document.getElementById('adminLink');
    const adminModal = document.getElementById('adminModal');
    const adminPassword = document.getElementById('adminPassword');
    const modalCancel = document.getElementById('modalCancel');
    const modalSubmit = document.getElementById('modalSubmit');
    const modalError = document.getElementById('modalError');

    function openModal() {
      adminModal.classList.add('active');
      adminPassword.value = '';
      modalError.classList.remove('show');
      setTimeout(() => adminPassword.focus(), 100);
    }

    function closeModal() {
      adminModal.classList.remove('active');
      adminPassword.value = '';
      modalError.classList.remove('show');
    }

    function handleLogin() {
      const password = adminPassword.value;
      if (password) {
        // Store password hash in session and redirect to admin
        sessionStorage.setItem('adminAuth', btoa(password));
        window.location.href = 'admin.html';
      } else {
        modalError.textContent = 'Please enter a password';
        modalError.classList.add('show');
      }
    }

    adminLink.addEventListener('click', openModal);
    modalCancel.addEventListener('click', closeModal);
    modalSubmit.addEventListener('click', handleLogin);

    adminPassword.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleLogin();
      if (e.key === 'Escape') closeModal();
    });

    adminModal.addEventListener('click', (e) => {
      if (e.target === adminModal) closeModal();
    });
  </script>
</body>
</html>
