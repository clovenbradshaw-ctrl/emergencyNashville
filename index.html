<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Nashville Winter Resources</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1.5rem 1rem;
      padding-top: max(1.5rem, env(safe-area-inset-top));
      padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
      padding-left: max(1rem, env(safe-area-inset-left));
      padding-right: max(1rem, env(safe-area-inset-right));
      color: #fff;
      -webkit-text-size-adjust: 100%;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    @media (max-width: 360px) {
      body {
        padding: 1rem 0.75rem;
        padding-top: max(1rem, env(safe-area-inset-top));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    }
    
    .lang-toggle {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    
    .lang-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 0.6rem 0.85rem;
      min-height: 44px;
      color: #94a3b8;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      touch-action: manipulation;
    }

    @media (hover: hover) {
      .lang-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
      }
    }

    .lang-btn:active {
      background: rgba(255, 255, 255, 0.18);
      color: #fff;
      transform: scale(0.97);
    }

    .lang-btn:focus-visible {
      outline: 2px solid #60a5fa;
      outline-offset: 2px;
    }

    .lang-btn.active {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }
    
    header {
      text-align: center;
      margin-bottom: 1.75rem;
    }
    
    h1 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    @media (max-width: 360px) {
      h1 {
        font-size: 1.4rem;
      }
    }

    .subtitle {
      color: #94a3b8;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    
    .section {
      margin-bottom: 1.25rem;
    }
    
    .section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      margin-bottom: 0.6rem;
      padding-left: 0.25rem;
    }

    .links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    a.link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      min-height: 52px;
      color: #fff;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    a.link i {
      font-size: 1.35rem;
      opacity: 0.8;
      flex-shrink: 0;
    }

    @media (hover: hover) {
      a.link:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
    }

    a.link:active {
      background: rgba(255, 255, 255, 0.18);
      transform: scale(0.98);
    }

    a.link:focus-visible {
      outline: 2px solid #60a5fa;
      outline-offset: 2px;
    }
    
    .featured {
      background: linear-gradient(135deg, #e63946 0%, #d62839 100%);
      border-color: transparent;
      font-weight: 600;
    }

    @media (hover: hover) {
      .featured:hover {
        background: linear-gradient(135deg, #f1404e 0%, #e63946 100%);
        border-color: transparent;
      }
    }

    .featured:active {
      background: linear-gradient(135deg, #d62839 0%, #c41e2e 100%);
    }

    .featured i {
      opacity: 1;
    }

    /* Emergency Link - Subtle utility style */
    .emergency-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: #f87171;
      font-size: 0.85rem;
      font-weight: 500;
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: all 0.15s ease;
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.2);
    }

    .emergency-link i {
      font-size: 1rem;
    }

    .emergency-link:hover {
      background: rgba(248, 113, 113, 0.2);
      color: #fca5a5;
    }

    .emergency-link:active {
      transform: scale(0.98);
    }

    .emergency-link:focus-visible {
      outline: 2px solid #f87171;
      outline-offset: 2px;
    }

    .header-utility {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 0.75rem;
    }

    [dir="rtl"] .header-utility {
      justify-content: flex-start;
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.25rem;
      padding-bottom: 0.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #64748b;
      font-size: 0.8rem;
    }

    .admin-link {
      color: #475569;
      font-size: 0.7rem;
      text-decoration: none;
      cursor: pointer;
      margin-top: 0.75rem;
      display: inline-block;
      transition: color 0.15s ease;
    }

    .admin-link:hover {
      color: #64748b;
    }

    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 1.5rem;
      width: 100%;
      max-width: 320px;
      text-align: center;
    }

    .modal h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #fff;
    }

    .modal input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    .modal input:focus {
      outline: none;
      border-color: #60a5fa;
    }

    .modal-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .modal-btn {
      flex: 1;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .modal-btn.cancel {
      background: rgba(255, 255, 255, 0.1);
      color: #94a3b8;
    }

    .modal-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .modal-btn.submit {
      background: #3b82f6;
      color: #fff;
    }

    .modal-btn.submit:hover {
      background: #2563eb;
    }

    .modal-error {
      color: #f87171;
      font-size: 0.8rem;
      margin-bottom: 0.75rem;
      display: none;
    }

    .modal-error.show {
      display: block;
    }

    [dir="rtl"] a.link {
      flex-direction: row-reverse;
      text-align: right;
    }

    [dir="rtl"] .section-title {
      padding-left: 0;
      padding-right: 0.25rem;
      text-align: right;
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        transform: none !important;
      }
      html {
        scroll-behavior: auto;
      }
    }

    @supports (-webkit-touch-callout: none) {
      body {
        min-height: -webkit-fill-available;
      }
    }

    /* Weather Forecast Styles */
    .forecast-section {
      margin-bottom: 1.25rem;
    }

    .forecast-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.6rem;
      gap: 0.5rem;
    }

    .forecast-header .section-title {
      margin-bottom: 0;
    }

    .zip-input-wrapper {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 0.35rem 0.5rem;
    }

    .zip-input-wrapper i {
      color: #64748b;
      font-size: 0.9rem;
    }

    #zipInput {
      background: transparent;
      border: none;
      outline: none;
      color: #fff;
      font-family: inherit;
      font-size: 0.85rem;
      width: 50px;
      letter-spacing: 0.05em;
    }

    #zipInput::placeholder {
      color: #64748b;
    }

    #fetchBtn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #94a3b8;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    #fetchBtn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
    }

    .day-card {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 0.75rem 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: all 0.2s ease;
    }

    .day-card:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .day-name {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      margin-bottom: 0.25rem;
    }

    .day-date {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .weather-icon {
      font-size: 1.75rem;
      margin-bottom: 0.35rem;
      color: #60a5fa;
    }

    .condition {
      font-size: 0.65rem;
      color: #94a3b8;
      margin-bottom: 0.5rem;
      line-height: 1.3;
      min-height: 1.6rem;
    }

    .temps {
      width: 100%;
    }

    .temp-high, .temp-low {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
    }

    .temp-high {
      color: #f97316;
      margin-bottom: 0.15rem;
    }

    .temp-low {
      color: #38bdf8;
    }

    .temp-high i, .temp-low i {
      font-size: 0.7rem;
    }

    .forecast-loading, .forecast-error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 2rem 1rem;
      color: #64748b;
    }

    .forecast-loading i {
      font-size: 2rem;
      animation: pulse 1.5s ease-in-out infinite;
      margin-bottom: 0.5rem;
      display: block;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .forecast-error {
      color: #f87171;
    }

    .forecast-error i {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .location-display {
      font-size: 0.75rem;
      color: #64748b;
      text-align: center;
      margin-bottom: 0.5rem;
      min-height: 1rem;
    }

    @media (max-width: 400px) {
      .forecast-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .day-card:nth-child(4),
      .day-card:nth-child(5) {
        grid-column: span 1;
      }
      .forecast-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      /* Center last 2 cards */
      .forecast-grid::after {
        content: '';
        grid-column: span 1;
      }
    }

    @media (max-width: 320px) {
      .forecast-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    [dir="rtl"] .forecast-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .zip-input-wrapper {
      flex-direction: row-reverse;
    }

    /* Weather Alert Styles */
    .alerts-container {
      margin-bottom: 1rem;
    }

    .alert-banner {
      padding: 0.75rem 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      animation: slideDown 0.4s ease-out;
      border-radius: 12px;
      margin-bottom: 0.5rem;
    }

    .alert-banner.severity-extreme {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
    }

    .alert-banner.severity-severe {
      background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    }

    .alert-banner.severity-moderate {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    }

    .alert-banner.severity-minor {
      background: linear-gradient(135deg, #ca8a04 0%, #a16207 100%);
    }

    .alert-banner.severity-unknown {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .alert-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
      animation: pulse-alert 2s ease-in-out infinite;
    }

    @keyframes pulse-alert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .alert-content {
      flex: 1;
      min-width: 0;
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.2rem;
    }

    .alert-title {
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.01em;
      color: #fff;
    }

    .alert-severity-badge {
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(0,0,0,0.25);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      color: #fff;
    }

    .alert-description {
      font-size: 0.8rem;
      opacity: 0.95;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      white-space: pre-wrap;
      color: #fff;
    }

    .alert-meta {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.35rem;
      font-size: 0.7rem;
      opacity: 0.85;
      color: #fff;
      flex-wrap: wrap;
    }

    .alert-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .alert-dismiss {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
      min-height: 44px;
      min-width: 44px;
    }

    .alert-dismiss:hover {
      background: rgba(0,0,0,0.35);
    }

    .alert-expand-btn {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.7rem;
      cursor: pointer;
      margin-top: 0.35rem;
      transition: background 0.2s;
    }

    .alert-expand-btn:hover {
      background: rgba(0,0,0,0.35);
    }

    .alert-description.expanded {
      -webkit-line-clamp: unset;
    }

    .no-alerts {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #10b981;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .no-alerts i {
      font-size: 1.1rem;
    }

    .alerts-loading {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #64748b;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .alerts-loading i {
      font-size: 1.1rem;
      animation: pulse 1.5s ease-in-out infinite;
    }

    [dir="rtl"] .alert-banner {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .alert-header {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .alert-meta {
      flex-direction: row-reverse;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="en">English</button>
      <button class="lang-btn" data-lang="es">Español</button>
      <button class="lang-btn" data-lang="ar">العربية</button>
      <button class="lang-btn" data-lang="ku">کوردی</button>
      <button class="lang-btn" data-lang="vi">Tiếng Việt</button>
    </div>
    
    <header>
      <div class="header-utility">
        <a href="emergency.html" class="emergency-link">
          <i class="ph ph-siren"></i>
          <span data-i18n="emergency_911">911 Location</span>
        </a>
      </div>
      <h1 data-i18n="title">Nashville Winter Resources</h1>
      <p class="subtitle" data-i18n="subtitle">Shelter, food & support during extreme weather</p>
    </header>

    <section class="section">
      <div class="section-title" data-i18n="start">Start Here</div>
      <div class="links">
        <a href="https://wttin.org/" class="link featured external-link" target="_blank" rel="noopener noreferrer" data-href="https://wttin.org/">
          <i class="ph ph-compass"></i>
          <span data-i18n="wttin">Where to Turn in Nashville</span>
        </a>
      </div>
    </section>

    <section class="section">
      <div class="section-title" data-i18n="weather_alerts">Weather Alerts</div>
      <div class="alerts-container" id="alertsContainer">
        <div class="alerts-loading">
          <i class="ph ph-cloud"></i>
          <span data-i18n="loading_alerts">Checking for alerts...</span>
        </div>
      </div>
    </section>

    <section class="forecast-section">
      <div class="forecast-header">
        <div class="section-title" data-i18n="forecast">5-Day Forecast</div>
        <div class="zip-input-wrapper">
          <i class="ph ph-map-pin"></i>
          <input type="text" id="zipInput" placeholder="37206" maxlength="5" value="37206" inputmode="numeric" pattern="[0-9]*">
          <button id="fetchBtn" data-i18n="update_btn">Go</button>
        </div>
      </div>
      <p class="location-display" id="locationDisplay"></p>
      <div class="forecast-grid" id="forecastGrid">
        <div class="forecast-loading">
          <i class="ph ph-cloud"></i>
          <p data-i18n="loading_forecast">Loading forecast...</p>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-title" data-i18n="official">Official Resource Hubs</div>
      <div class="links">
        <a href="https://www.nashville.gov/departments/emergency-management/news/january-27-winter-weather-update" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/emergency-management/news/january-27-winter-weather-update">
          <i class="ph ph-cloud-snow"></i>
          <span data-i18n="nashville_weather">Nashville.gov Winter Weather Updates</span>
        </a>
        <a href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather">
          <i class="ph ph-thermometer-cold"></i>
          <span data-i18n="ohs_extreme">Metro OHS – Extreme Weather</span>
        </a>
        <a href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather/shelters" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.nashville.gov/departments/office-homeless-services/get-connected/extreme-weather/shelters">
          <i class="ph ph-list-bullets"></i>
          <span data-i18n="shelter_list">Metro Shelter List</span>
        </a>
        <a href="https://www.tn.gov/tema/tennessee-shelters.html" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.tn.gov/tema/tennessee-shelters.html">
          <i class="ph ph-map-trifold"></i>
          <span data-i18n="tema_map">TEMA Statewide Shelter Map</span>
        </a>
        <a href="https://www.tn.gov/tema/updates/2026-disasters/january-2026-winter-weather.html" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.tn.gov/tema/updates/2026-disasters/january-2026-winter-weather.html">
          <i class="ph ph-warning"></i>
          <span data-i18n="tema_hub">TEMA Winter Weather Hub</span>
        </a>
        <a href="https://www.fema.gov/disaster/2026-winter-storm" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.fema.gov/disaster/2026-winter-storm">
          <i class="ph ph-flag"></i>
          <span data-i18n="fema">FEMA 2026 Winter Storm</span>
        </a>
      </div>
    </section>
    
    <section class="section">
      <div class="section-title" data-i18n="shelter">Shelter & Outreach</div>
      <div class="links">
        <a href="https://www.roomintheinn.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.roomintheinn.org/">
          <i class="ph ph-bed"></i>
          <span>Room in the Inn</span>
        </a>
        <a href="https://www.opentablenashville.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.opentablenashville.org/">
          <i class="ph ph-hand-heart"></i>
          <span>Open Table Nashville</span>
        </a>
        <a href="https://thecontributor.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://thecontributor.org/">
          <i class="ph ph-newspaper"></i>
          <span>The Contributor</span>
        </a>
        <a href="https://www.peoplelovingnashville.com/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.peoplelovingnashville.com/">
          <i class="ph ph-users"></i>
          <span>People Loving Nashville</span>
        </a>
      </div>
    </section>
    
    <section class="section">
      <div class="section-title" data-i18n="food">Food</div>
      <div class="links">
        <a href="https://www.secondharvestmidtn.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.secondharvestmidtn.org/">
          <i class="ph ph-package"></i>
          <span data-i18n="second_harvest">Second Harvest Food Bank</span>
        </a>
        <a href="https://www.secondharvestmidtn.org/find-resources/find-food/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.secondharvestmidtn.org/find-resources/find-food/">
          <i class="ph ph-magnifying-glass"></i>
          <span data-i18n="find_food">Second Harvest – Find Food</span>
        </a>
        <a href="https://dreamstreetstn.com/mobilefood" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://dreamstreetstn.com/mobilefood">
          <i class="ph ph-truck"></i>
          <span data-i18n="dream_streets">Dream Streets Mobile Food</span>
        </a>
      </div>
    </section>
    
    <section class="section">
      <div class="section-title" data-i18n="immigrant">Immigrant Community</div>
      <div class="links">
        <a href="https://www.conexionamericas.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.conexionamericas.org/">
          <i class="ph ph-globe-hemisphere-west"></i>
          <span>Conexión Américas / Casa Azafrán</span>
        </a>
      </div>
    </section>
    
    <section class="section">
      <div class="section-title" data-i18n="legal">Legal & Other Resources</div>
      <div class="links">
        <a href="https://las.org/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://las.org/">
          <i class="ph ph-scales"></i>
          <span data-i18n="legal_aid">Legal Aid Society of Middle TN</span>
        </a>
        <a href="https://www.wnpt.org/agingmatters/unhoused/" class="link external-link" target="_blank" rel="noopener noreferrer" data-href="https://www.wnpt.org/agingmatters/unhoused/">
          <i class="ph ph-info"></i>
          <span data-i18n="npt">NPT Unhoused Resources</span>
        </a>
      </div>
    </section>
    
    <footer>
      <span data-i18n="footer">Share widely · Updated Jan 2026</span>
      <br>
      <a class="admin-link" id="adminLink">Admin</a>
    </footer>
  </div>

  <div class="modal-overlay" id="adminModal">
    <div class="modal">
      <h3>Admin Login</h3>
      <div class="modal-error" id="modalError">Incorrect password</div>
      <input type="password" id="adminPassword" placeholder="Enter password" autocomplete="off">
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="modalCancel">Cancel</button>
        <button class="modal-btn submit" id="modalSubmit">Login</button>
      </div>
    </div>
  </div>

  <script>
    // Store data for re-rendering on language change
    let cachedWeatherData = null;
    let cachedAlertsData = null;

    const translations = {
      en: {
        title: "Nashville Winter Resources",
        subtitle: "Shelter, food & support during extreme weather",
        emergency_911: "911 Location",
        start: "Start Here",
        wttin: "Where to Turn in Nashville",
        official: "Official Resource Hubs",
        nashville_weather: "Nashville.gov Winter Weather Updates",
        ohs_extreme: "Metro OHS – Extreme Weather",
        shelter_list: "Metro Shelter List",
        tema_map: "TEMA Statewide Shelter Map",
        tema_hub: "TEMA Winter Weather Hub",
        fema: "FEMA 2026 Winter Storm",
        shelter: "Shelter & Outreach",
        food: "Food",
        second_harvest: "Second Harvest Food Bank",
        find_food: "Second Harvest – Find Food",
        dream_streets: "Dream Streets Mobile Food",
        immigrant: "Immigrant Community",
        legal: "Legal & Other Resources",
        legal_aid: "Legal Aid Society of Middle TN",
        npt: "NPT Unhoused Resources",
        footer: "Share widely · Updated Jan 2026",
        forecast: "5-Day Forecast",
        update_btn: "Go",
        loading_forecast: "Loading forecast...",
        invalid_zip: "Please enter a valid 5-digit ZIP code",
        forecast_error: "Unable to fetch forecast. Please check the ZIP code.",
        weather_unknown: "Unknown",
        day_sun: "Sun", day_mon: "Mon", day_tue: "Tue", day_wed: "Wed", day_thu: "Thu", day_fri: "Fri", day_sat: "Sat",
        month_jan: "Jan", month_feb: "Feb", month_mar: "Mar", month_apr: "Apr", month_may: "May", month_jun: "Jun",
        month_jul: "Jul", month_aug: "Aug", month_sep: "Sep", month_oct: "Oct", month_nov: "Nov", month_dec: "Dec",
        weather_0: "Clear Sky", weather_1: "Mostly Clear", weather_2: "Partly Cloudy", weather_3: "Overcast",
        weather_45: "Foggy", weather_48: "Rime Fog",
        weather_51: "Light Drizzle", weather_53: "Moderate Drizzle", weather_55: "Dense Drizzle",
        weather_56: "Freezing Drizzle", weather_57: "Heavy Freezing Drizzle",
        weather_61: "Light Rain", weather_63: "Moderate Rain", weather_65: "Heavy Rain",
        weather_66: "Freezing Rain", weather_67: "Heavy Freezing Rain",
        weather_71: "Light Snow", weather_73: "Moderate Snow", weather_75: "Heavy Snow", weather_77: "Snow Grains",
        weather_80: "Light Showers", weather_81: "Moderate Showers", weather_82: "Violent Showers",
        weather_85: "Light Snow Showers", weather_86: "Heavy Snow Showers",
        weather_95: "Thunderstorm", weather_96: "Thunderstorm with Hail", weather_99: "Severe Thunderstorm",
        weather_alerts: "Weather Alerts",
        loading_alerts: "Checking for alerts...",
        no_alerts: "No active weather alerts for this area",
        alert_effective: "Effective",
        alert_expires: "Expires",
        alert_show_details: "Show Details",
        alert_hide_details: "Hide Details",
        severity_extreme: "Extreme",
        severity_severe: "Severe",
        severity_moderate: "Moderate",
        severity_minor: "Minor",
        severity_unknown: "Unknown"
      },
      es: {
        title: "Recursos de Invierno en Nashville",
        subtitle: "Refugio, comida y apoyo durante clima extremo",
        emergency_911: "Ubicación 911",
        start: "Empiece Aquí",
        wttin: "Dónde Acudir en Nashville",
        official: "Centros de Recursos Oficiales",
        nashville_weather: "Actualizaciones del Clima Invernal",
        ohs_extreme: "OHS – Clima Extremo",
        shelter_list: "Lista de Refugios de Metro",
        tema_map: "Mapa de Refugios de Tennessee",
        tema_hub: "Centro de Clima Invernal TEMA",
        fema: "FEMA Tormenta de Invierno 2026",
        shelter: "Refugio y Alcance",
        food: "Comida",
        second_harvest: "Banco de Alimentos Second Harvest",
        find_food: "Second Harvest – Encontrar Comida",
        dream_streets: "Dream Streets Comida Móvil",
        immigrant: "Comunidad Inmigrante",
        legal: "Recursos Legales y Otros",
        legal_aid: "Sociedad de Ayuda Legal de Middle TN",
        npt: "Recursos NPT para Personas sin Hogar",
        footer: "Comparte · Actualizado Ene 2026",
        forecast: "Pronóstico de 5 Días",
        update_btn: "Ir",
        loading_forecast: "Cargando pronóstico...",
        invalid_zip: "Por favor ingrese un código postal válido de 5 dígitos",
        forecast_error: "No se pudo obtener el pronóstico. Verifique el código postal.",
        weather_unknown: "Desconocido",
        day_sun: "Dom", day_mon: "Lun", day_tue: "Mar", day_wed: "Mié", day_thu: "Jue", day_fri: "Vie", day_sat: "Sáb",
        month_jan: "Ene", month_feb: "Feb", month_mar: "Mar", month_apr: "Abr", month_may: "May", month_jun: "Jun",
        month_jul: "Jul", month_aug: "Ago", month_sep: "Sep", month_oct: "Oct", month_nov: "Nov", month_dec: "Dic",
        weather_0: "Cielo Despejado", weather_1: "Mayormente Despejado", weather_2: "Parcialmente Nublado", weather_3: "Nublado",
        weather_45: "Neblina", weather_48: "Niebla Helada",
        weather_51: "Llovizna Ligera", weather_53: "Llovizna Moderada", weather_55: "Llovizna Densa",
        weather_56: "Llovizna Helada", weather_57: "Llovizna Helada Fuerte",
        weather_61: "Lluvia Ligera", weather_63: "Lluvia Moderada", weather_65: "Lluvia Fuerte",
        weather_66: "Lluvia Helada", weather_67: "Lluvia Helada Fuerte",
        weather_71: "Nieve Ligera", weather_73: "Nieve Moderada", weather_75: "Nieve Fuerte", weather_77: "Granos de Nieve",
        weather_80: "Chubascos Ligeros", weather_81: "Chubascos Moderados", weather_82: "Chubascos Violentos",
        weather_85: "Chubascos de Nieve Ligeros", weather_86: "Chubascos de Nieve Fuertes",
        weather_95: "Tormenta Eléctrica", weather_96: "Tormenta con Granizo", weather_99: "Tormenta Severa",
        weather_alerts: "Alertas Meteorológicas",
        loading_alerts: "Buscando alertas...",
        no_alerts: "No hay alertas meteorológicas activas para esta área",
        alert_effective: "Efectiva",
        alert_expires: "Expira",
        alert_show_details: "Mostrar Detalles",
        alert_hide_details: "Ocultar Detalles",
        severity_extreme: "Extrema",
        severity_severe: "Severa",
        severity_moderate: "Moderada",
        severity_minor: "Menor",
        severity_unknown: "Desconocida"
      },
      ar: {
        title: "موارد الشتاء في ناشفيل",
        subtitle: "مأوى وطعام ودعم أثناء الطقس القاسي",
        emergency_911: "موقع 911",
        start: "ابدأ هنا",
        wttin: "أين تتوجه في ناشفيل",
        official: "مراكز الموارد الرسمية",
        nashville_weather: "تحديثات طقس الشتاء",
        ohs_extreme: "خدمات الطقس القاسي",
        shelter_list: "قائمة الملاجئ",
        tema_map: "خريطة ملاجئ تينيسي",
        tema_hub: "مركز طقس الشتاء TEMA",
        fema: "FEMA عاصفة الشتاء 2026",
        shelter: "المأوى والتواصل",
        food: "الطعام",
        second_harvest: "بنك الطعام Second Harvest",
        find_food: "Second Harvest – ابحث عن طعام",
        dream_streets: "Dream Streets طعام متنقل",
        immigrant: "مجتمع المهاجرين",
        legal: "الموارد القانونية وغيرها",
        legal_aid: "جمعية المساعدة القانونية",
        npt: "موارد NPT للمشردين",
        footer: "شارك على نطاق واسع · محدث يناير 2026",
        forecast: "توقعات 5 أيام",
        update_btn: "ابحث",
        loading_forecast: "جارٍ تحميل التوقعات...",
        invalid_zip: "يرجى إدخال رمز بريدي مكون من 5 أرقام",
        forecast_error: "تعذر الحصول على التوقعات. يرجى التحقق من الرمز البريدي.",
        weather_unknown: "غير معروف",
        day_sun: "أحد", day_mon: "إثنين", day_tue: "ثلاثاء", day_wed: "أربعاء", day_thu: "خميس", day_fri: "جمعة", day_sat: "سبت",
        month_jan: "يناير", month_feb: "فبراير", month_mar: "مارس", month_apr: "أبريل", month_may: "مايو", month_jun: "يونيو",
        month_jul: "يوليو", month_aug: "أغسطس", month_sep: "سبتمبر", month_oct: "أكتوبر", month_nov: "نوفمبر", month_dec: "ديسمبر",
        weather_0: "سماء صافية", weather_1: "صافٍ غالباً", weather_2: "غائم جزئياً", weather_3: "غائم",
        weather_45: "ضبابي", weather_48: "ضباب متجمد",
        weather_51: "رذاذ خفيف", weather_53: "رذاذ معتدل", weather_55: "رذاذ كثيف",
        weather_56: "رذاذ متجمد", weather_57: "رذاذ متجمد كثيف",
        weather_61: "مطر خفيف", weather_63: "مطر معتدل", weather_65: "مطر غزير",
        weather_66: "مطر متجمد", weather_67: "مطر متجمد غزير",
        weather_71: "ثلج خفيف", weather_73: "ثلج معتدل", weather_75: "ثلج كثيف", weather_77: "حبيبات ثلجية",
        weather_80: "زخات خفيفة", weather_81: "زخات معتدلة", weather_82: "زخات عنيفة",
        weather_85: "زخات ثلجية خفيفة", weather_86: "زخات ثلجية كثيفة",
        weather_95: "عاصفة رعدية", weather_96: "عاصفة رعدية مع برد", weather_99: "عاصفة رعدية شديدة",
        weather_alerts: "تنبيهات الطقس",
        loading_alerts: "جارٍ البحث عن تنبيهات...",
        no_alerts: "لا توجد تنبيهات طقس نشطة لهذه المنطقة",
        alert_effective: "ساري من",
        alert_expires: "ينتهي",
        alert_show_details: "عرض التفاصيل",
        alert_hide_details: "إخفاء التفاصيل",
        severity_extreme: "قصوى",
        severity_severe: "شديدة",
        severity_moderate: "متوسطة",
        severity_minor: "طفيفة",
        severity_unknown: "غير معروفة"
      },
      ku: {
        title: "سەرچاوەکانی زستانی ناشڤیل",
        subtitle: "پەناگا، خواردن و پشتیوانی لە کاتی کەشوهەوای سەخت",
        emergency_911: "شوێنی 911",
        start: "لێرەوە دەست پێبکە",
        wttin: "لە ناشڤیل بۆ کوێ بڕۆیت",
        official: "ناوەندە فەرمییەکانی سەرچاوە",
        nashville_weather: "نوێکردنەوەکانی کەشوهەوای زستان",
        ohs_extreme: "خزمەتگوزارییەکانی کەشوهەوای سەخت",
        shelter_list: "لیستی پەناگاکان",
        tema_map: "نەخشەی پەناگاکانی تێنێسی",
        tema_hub: "ناوەندی کەشوهەوای زستانی TEMA",
        fema: "زریانی زستانی FEMA 2026",
        shelter: "پەناگا و دەستڕاگەیشتن",
        food: "خواردن",
        second_harvest: "بانکی خواردنی Second Harvest",
        find_food: "Second Harvest – خواردن بدۆزەرەوە",
        dream_streets: "خواردنی گەڕۆکی Dream Streets",
        immigrant: "کۆمەڵگای کۆچبەران",
        legal: "سەرچاوە یاساییەکان و هیتر",
        legal_aid: "کۆمەڵەی یارمەتی یاسایی",
        npt: "سەرچاوەکانی NPT بۆ بێماڵان",
        footer: "بڵاوی بکەرەوە · نوێکراوەتەوە کانوونی دووەم 2026",
        forecast: "پێشبینی 5 ڕۆژ",
        update_btn: "بڕۆ",
        loading_forecast: "پێشبینی بارکردن...",
        invalid_zip: "تکایە کۆدی پۆستی 5 ژمارەیی دروست بنووسە",
        forecast_error: "نەتوانرا پێشبینی بهێنرێت. تکایە کۆدی پۆستی بپشکنە.",
        weather_unknown: "نەزانراو",
        day_sun: "یەکشەم", day_mon: "دووشەم", day_tue: "سێشەم", day_wed: "چوارشەم", day_thu: "پێنجشەم", day_fri: "هەینی", day_sat: "شەمە",
        month_jan: "کانوونی دووەم", month_feb: "شوبات", month_mar: "ئازار", month_apr: "نیسان", month_may: "ئایار", month_jun: "حوزەیران",
        month_jul: "تەمموز", month_aug: "ئاب", month_sep: "ئەیلول", month_oct: "تشرینی یەکەم", month_nov: "تشرینی دووەم", month_dec: "کانوونی یەکەم",
        weather_0: "ئاسمانی ڕوون", weather_1: "زۆربەی ڕوون", weather_2: "هەور کەمێک", weather_3: "هەورین",
        weather_45: "تەم", weather_48: "تەمی ساردبووەوە",
        weather_51: "نمنمی سووک", weather_53: "نمنمی مامناوەند", weather_55: "نمنمی قورس",
        weather_56: "نمنمی ساردبووەوە", weather_57: "نمنمی ساردبووەوەی قورس",
        weather_61: "باران سووک", weather_63: "باران مامناوەند", weather_65: "باران قورس",
        weather_66: "باران ساردبووەوە", weather_67: "باران ساردبووەوەی قورس",
        weather_71: "بەفر سووک", weather_73: "بەفر مامناوەند", weather_75: "بەفر قورس", weather_77: "دەنکە بەفر",
        weather_80: "شەپۆلی سووک", weather_81: "شەپۆلی مامناوەند", weather_82: "شەپۆلی توند",
        weather_85: "شەپۆلی بەفری سووک", weather_86: "شەپۆلی بەفری قورس",
        weather_95: "بروسکە", weather_96: "بروسکە لەگەڵ تەرزە", weather_99: "بروسکەی توند",
        weather_alerts: "ئاگاداریی کەشوهەوا",
        loading_alerts: "گەڕان بۆ ئاگاداریی...",
        no_alerts: "هیچ ئاگاداریی کەشوهەوای چالاک نییە بۆ ئەم ناوچەیە",
        alert_effective: "کاریگەر لە",
        alert_expires: "کۆتایی دێت",
        alert_show_details: "وردەکاری پیشانبدە",
        alert_hide_details: "وردەکاری بشارەوە",
        severity_extreme: "زۆر توند",
        severity_severe: "توند",
        severity_moderate: "مامناوەند",
        severity_minor: "سووک",
        severity_unknown: "نەزانراو"
      },
      vi: {
        title: "Tài Nguyên Mùa Đông Nashville",
        subtitle: "Nơi trú ẩn, thực phẩm & hỗ trợ trong thời tiết khắc nghiệt",
        emergency_911: "Vị Trí 911",
        start: "Bắt Đầu Tại Đây",
        wttin: "Nơi Hướng Dẫn Tại Nashville",
        official: "Trung Tâm Tài Nguyên Chính Thức",
        nashville_weather: "Cập Nhật Thời Tiết Mùa Đông",
        ohs_extreme: "OHS – Thời Tiết Khắc Nghiệt",
        shelter_list: "Danh Sách Nơi Trú Ẩn Metro",
        tema_map: "Bản Đồ Nơi Trú Ẩn Toàn Tiểu Bang",
        tema_hub: "Trung Tâm Thời Tiết Mùa Đông TEMA",
        fema: "FEMA Bão Tuyết 2026",
        shelter: "Nơi Trú Ẩn & Tiếp Cận",
        food: "Thực Phẩm",
        second_harvest: "Ngân Hàng Thực Phẩm Second Harvest",
        find_food: "Second Harvest – Tìm Thực Phẩm",
        dream_streets: "Dream Streets Thực Phẩm Di Động",
        immigrant: "Cộng Đồng Người Nhập Cư",
        legal: "Tài Nguyên Pháp Lý & Khác",
        legal_aid: "Hội Trợ Giúp Pháp Lý Middle TN",
        npt: "Tài Nguyên NPT cho Người Vô Gia Cư",
        footer: "Chia sẻ rộng rãi · Cập nhật Tháng 1 2026",
        forecast: "Dự Báo 5 Ngày",
        update_btn: "Tìm",
        loading_forecast: "Đang tải dự báo...",
        invalid_zip: "Vui lòng nhập mã ZIP gồm 5 chữ số",
        forecast_error: "Không thể tải dự báo. Vui lòng kiểm tra mã ZIP.",
        weather_unknown: "Không rõ",
        day_sun: "CN", day_mon: "T2", day_tue: "T3", day_wed: "T4", day_thu: "T5", day_fri: "T6", day_sat: "T7",
        month_jan: "Th1", month_feb: "Th2", month_mar: "Th3", month_apr: "Th4", month_may: "Th5", month_jun: "Th6",
        month_jul: "Th7", month_aug: "Th8", month_sep: "Th9", month_oct: "Th10", month_nov: "Th11", month_dec: "Th12",
        weather_0: "Trời Quang", weather_1: "Phần Lớn Quang", weather_2: "Có Mây Rải Rác", weather_3: "U Ám",
        weather_45: "Sương Mù", weather_48: "Sương Muối",
        weather_51: "Mưa Phùn Nhẹ", weather_53: "Mưa Phùn Vừa", weather_55: "Mưa Phùn Dày",
        weather_56: "Mưa Phùn Đóng Băng", weather_57: "Mưa Phùn Đóng Băng Nặng",
        weather_61: "Mưa Nhẹ", weather_63: "Mưa Vừa", weather_65: "Mưa To",
        weather_66: "Mưa Đóng Băng", weather_67: "Mưa Đóng Băng Nặng",
        weather_71: "Tuyết Nhẹ", weather_73: "Tuyết Vừa", weather_75: "Tuyết Dày", weather_77: "Hạt Tuyết",
        weather_80: "Mưa Rào Nhẹ", weather_81: "Mưa Rào Vừa", weather_82: "Mưa Rào Dữ Dội",
        weather_85: "Tuyết Rơi Nhẹ", weather_86: "Tuyết Rơi Nặng",
        weather_95: "Giông Bão", weather_96: "Giông Bão Có Mưa Đá", weather_99: "Giông Bão Dữ Dội",
        weather_alerts: "Cảnh Báo Thời Tiết",
        loading_alerts: "Đang kiểm tra cảnh báo...",
        no_alerts: "Không có cảnh báo thời tiết nào cho khu vực này",
        alert_effective: "Có hiệu lực",
        alert_expires: "Hết hạn",
        alert_show_details: "Xem Chi Tiết",
        alert_hide_details: "Ẩn Chi Tiết",
        severity_extreme: "Cực Kỳ Nghiêm Trọng",
        severity_severe: "Nghiêm Trọng",
        severity_moderate: "Trung Bình",
        severity_minor: "Nhẹ",
        severity_unknown: "Không Rõ"
      }
    };

    const rtlLangs = ['ar', 'ku'];

    const langCodes = {
      en: 'en',
      es: 'es',
      ar: 'ar',
      ku: 'ckb',
      vi: 'vi'
    };

    function updateExternalLinks(lang) {
      document.querySelectorAll('.external-link').forEach(link => {
        const originalUrl = link.dataset.href;
        if (lang === 'en') {
          link.href = originalUrl;
        } else {
          link.href = `https://translate.google.com/translate?sl=en&tl=${langCodes[lang]}&u=${encodeURIComponent(originalUrl)}`;
        }
      });
    }

    function setLanguage(lang) {
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      if (rtlLangs.includes(lang)) {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', lang);
      } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', lang);
      }

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });

      updateExternalLinks(lang);
      localStorage.setItem('nashville-resources-lang', lang);

      // Re-render weather data with new language
      if (cachedWeatherData) {
        renderForecast(cachedWeatherData);
      }
      if (cachedAlertsData) {
        renderAlerts(cachedAlertsData);
      }
    }

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
    });

    const savedLang = localStorage.getItem('nashville-resources-lang');
    if (savedLang && translations[savedLang]) {
      setLanguage(savedLang);
    }

    // Admin modal functionality
    const adminLink = document.getElementById('adminLink');
    const adminModal = document.getElementById('adminModal');
    const adminPassword = document.getElementById('adminPassword');
    const modalCancel = document.getElementById('modalCancel');
    const modalSubmit = document.getElementById('modalSubmit');
    const modalError = document.getElementById('modalError');

    function openModal() {
      adminModal.classList.add('active');
      adminPassword.value = '';
      modalError.classList.remove('show');
      setTimeout(() => adminPassword.focus(), 100);
    }

    function closeModal() {
      adminModal.classList.remove('active');
      adminPassword.value = '';
      modalError.classList.remove('show');
    }

    function handleLogin() {
      const password = adminPassword.value;
      if (password) {
        // Store password hash in session and redirect to admin
        sessionStorage.setItem('adminAuth', btoa(password));
        window.location.href = 'admin.html';
      } else {
        modalError.textContent = 'Please enter a password';
        modalError.classList.add('show');
      }
    }

    adminLink.addEventListener('click', openModal);
    modalCancel.addEventListener('click', closeModal);
    modalSubmit.addEventListener('click', handleLogin);

    adminPassword.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleLogin();
      if (e.key === 'Escape') closeModal();
    });

    adminModal.addEventListener('click', (e) => {
      if (e.target === adminModal) closeModal();
    });

    // Weather Forecast Functionality
    const weatherIcons = {
      0: 'ph-sun', 1: 'ph-sun', 2: 'ph-cloud-sun', 3: 'ph-cloud',
      45: 'ph-cloud-fog', 48: 'ph-cloud-fog',
      51: 'ph-cloud-rain', 53: 'ph-cloud-rain', 55: 'ph-cloud-rain',
      56: 'ph-cloud-rain', 57: 'ph-cloud-rain',
      61: 'ph-cloud-rain', 63: 'ph-cloud-rain', 65: 'ph-cloud-rain',
      66: 'ph-cloud-rain', 67: 'ph-cloud-rain',
      71: 'ph-snowflake', 73: 'ph-snowflake', 75: 'ph-snowflake', 77: 'ph-snowflake',
      80: 'ph-cloud-rain', 81: 'ph-cloud-rain', 82: 'ph-cloud-rain',
      85: 'ph-snowflake', 86: 'ph-snowflake',
      95: 'ph-cloud-lightning', 96: 'ph-cloud-lightning', 99: 'ph-cloud-lightning'
    };

    function getCurrentLang() {
      return localStorage.getItem('nashville-resources-lang') || 'en';
    }

    function t(key) {
      const lang = getCurrentLang();
      return translations[lang][key] || translations['en'][key] || key;
    }

    function getDayName(dayIndex) {
      const keys = ['day_sun', 'day_mon', 'day_tue', 'day_wed', 'day_thu', 'day_fri', 'day_sat'];
      return t(keys[dayIndex]);
    }

    function getMonthName(monthIndex) {
      const keys = ['month_jan', 'month_feb', 'month_mar', 'month_apr', 'month_may', 'month_jun',
                    'month_jul', 'month_aug', 'month_sep', 'month_oct', 'month_nov', 'month_dec'];
      return t(keys[monthIndex]);
    }

    function getWeatherLabel(code) {
      return t('weather_' + code) || t('weather_unknown');
    }

    async function getCoordinates(zip) {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json&limit=1`);
      const data = await response.json();
      if (data.length === 0) throw new Error('Location not found');
      return {
        lat: parseFloat(data[0].lat),
        lon: parseFloat(data[0].lon),
        name: data[0].display_name.split(',').slice(0, 2).join(',').trim()
      };
    }

    async function getWeather(lat, lon) {
      const response = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto&forecast_days=5`
      );
      return response.json();
    }

    async function getNWSAlerts(lat, lon) {
      try {
        const response = await fetch(
          `https://api.weather.gov/alerts/active?point=${lat.toFixed(4)},${lon.toFixed(4)}`,
          {
            headers: {
              'User-Agent': '(NashvilleEmergencyResources, contact@example.com)',
              'Accept': 'application/geo+json'
            }
          }
        );
        if (!response.ok) throw new Error('NWS API error');
        const data = await response.json();
        return data.features || [];
      } catch (err) {
        console.error('Failed to fetch NWS alerts:', err);
        return [];
      }
    }

    function getSeverityClass(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme') return 'severity-extreme';
      if (s === 'severe') return 'severity-severe';
      if (s === 'moderate') return 'severity-moderate';
      if (s === 'minor') return 'severity-minor';
      return 'severity-unknown';
    }

    function getSeverityIcon(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme' || s === 'severe') return 'ph-warning-octagon';
      if (s === 'moderate') return 'ph-warning';
      return 'ph-info';
    }

    function getSeverityLabel(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme') return t('severity_extreme');
      if (s === 'severe') return t('severity_severe');
      if (s === 'moderate') return t('severity_moderate');
      if (s === 'minor') return t('severity_minor');
      return t('severity_unknown');
    }

    function formatAlertTime(isoString) {
      if (!isoString) return '';
      const d = new Date(isoString);
      const dayName = getDayName(d.getDay());
      const monthName = getMonthName(d.getMonth());
      const day = d.getDate();
      const hours = d.getHours();
      const minutes = d.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const hour12 = hours % 12 || 12;
      return `${dayName}, ${monthName} ${day}, ${hour12}:${minutes} ${ampm}`;
    }

    function renderAlerts(alerts) {
      const container = document.getElementById('alertsContainer');
      container.innerHTML = '';

      if (!alerts || alerts.length === 0) {
        container.innerHTML = `
          <div class="no-alerts">
            <i class="ph ph-check-circle"></i>
            <span data-i18n="no_alerts">${t('no_alerts')}</span>
          </div>
        `;
        return;
      }

      // Sort by severity (extreme first)
      const severityOrder = { extreme: 0, severe: 1, moderate: 2, minor: 3, unknown: 4 };
      alerts.sort((a, b) => {
        const sA = (a.properties.severity || 'unknown').toLowerCase();
        const sB = (b.properties.severity || 'unknown').toLowerCase();
        return (severityOrder[sA] ?? 4) - (severityOrder[sB] ?? 4);
      });

      alerts.forEach((alert, index) => {
        const props = alert.properties;
        const severity = props.severity || 'Unknown';
        const event = props.event || 'Weather Alert';
        const headline = props.headline || event;
        const description = props.description || '';
        const effective = props.effective;
        const expires = props.expires;

        const banner = document.createElement('div');
        banner.className = `alert-banner ${getSeverityClass(severity)}`;
        banner.style.animationDelay = `${index * 0.1}s`;

        banner.innerHTML = `
          <i class="ph ${getSeverityIcon(severity)} alert-icon"></i>
          <div class="alert-content">
            <div class="alert-header">
              <span class="alert-title">${event}</span>
              <span class="alert-severity-badge">${getSeverityLabel(severity)}</span>
            </div>
            <p class="alert-description" id="alert-desc-${index}">${headline}</p>
            ${description ? `<button class="alert-expand-btn" onclick="toggleAlertExpand(${index}, this)" data-i18n="alert_show_details">${t('alert_show_details')}</button>` : ''}
            <div class="alert-meta">
              ${effective ? `<span><i class="ph ph-clock"></i> ${t('alert_effective')}: ${formatAlertTime(effective)}</span>` : ''}
              ${expires ? `<span><i class="ph ph-clock-countdown"></i> ${t('alert_expires')}: ${formatAlertTime(expires)}</span>` : ''}
            </div>
          </div>
          <button class="alert-dismiss" onclick="this.parentElement.remove()" aria-label="Dismiss alert">
            <i class="ph ph-x"></i>
          </button>
        `;

        // Store full description for expansion
        banner.dataset.fullDescription = description;
        banner.dataset.headline = headline;

        container.appendChild(banner);
      });
    }

    window.toggleAlertExpand = function(index, btn) {
      const desc = document.getElementById(`alert-desc-${index}`);
      const banner = btn.closest('.alert-banner');
      const fullDesc = banner.dataset.fullDescription;
      const headline = banner.dataset.headline;

      if (desc.classList.contains('expanded')) {
        desc.classList.remove('expanded');
        desc.textContent = headline;
        btn.textContent = t('alert_show_details');
      } else {
        desc.classList.add('expanded');
        desc.textContent = fullDesc;
        btn.textContent = t('alert_hide_details');
      }
    };

    function renderForecast(weather) {
      const grid = document.getElementById('forecastGrid');
      grid.innerHTML = '';

      weather.daily.time.forEach((date, index) => {
        const d = new Date(date + 'T12:00:00');
        const code = weather.daily.weather_code[index];
        const icon = weatherIcons[code] || 'ph-question';
        const label = getWeatherLabel(code);
        const high = Math.round(weather.daily.temperature_2m_max[index]);
        const low = Math.round(weather.daily.temperature_2m_min[index]);

        const card = document.createElement('div');
        card.className = 'day-card';
        card.innerHTML = `
          <div class="day-name">${getDayName(d.getDay())}</div>
          <div class="day-date">${getMonthName(d.getMonth())} ${d.getDate()}</div>
          <i class="ph ${icon} weather-icon"></i>
          <div class="condition">${label}</div>
          <div class="temps">
            <div class="temp-high">
              <i class="ph ph-arrow-up"></i>
              <span>${high}°</span>
            </div>
            <div class="temp-low">
              <i class="ph ph-arrow-down"></i>
              <span>${low}°</span>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function showForecastError(message) {
      document.getElementById('forecastGrid').innerHTML = `
        <div class="forecast-error">
          <i class="ph ph-warning-circle"></i>
          <p>${message}</p>
        </div>
      `;
    }

    async function fetchForecast() {
      const zip = document.getElementById('zipInput').value.trim();
      if (!/^\d{5}$/.test(zip)) {
        showForecastError(t('invalid_zip'));
        return;
      }

      document.getElementById('forecastGrid').innerHTML = `
        <div class="forecast-loading">
          <i class="ph ph-cloud"></i>
          <p>${t('loading_forecast')}</p>
        </div>
      `;

      document.getElementById('alertsContainer').innerHTML = `
        <div class="alerts-loading">
          <i class="ph ph-cloud"></i>
          <span>${t('loading_alerts')}</span>
        </div>
      `;

      try {
        const coords = await getCoordinates(zip);
        document.getElementById('locationDisplay').textContent = coords.name;

        // Fetch weather and NWS alerts in parallel
        const [weather, alerts] = await Promise.all([
          getWeather(coords.lat, coords.lon),
          getNWSAlerts(coords.lat, coords.lon)
        ]);

        // Cache data for re-rendering on language change
        cachedWeatherData = weather;
        cachedAlertsData = alerts;

        renderAlerts(alerts);
        renderForecast(weather);
      } catch (err) {
        cachedWeatherData = null;
        cachedAlertsData = null;
        showForecastError(t('forecast_error'));
        document.getElementById('alertsContainer').innerHTML = '';
        console.error(err);
      }
    }

    document.getElementById('fetchBtn').addEventListener('click', fetchForecast);
    document.getElementById('zipInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') fetchForecast();
    });

    // Load forecast on page load
    fetchForecast();
  </script>
</body>
</html>
