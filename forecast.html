<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>5-Day Forecast</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0f1a;
      --bg-card: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
      --text-primary: #f8fafc;
      --text-secondary: rgba(248, 250, 252, 0.6);
      --accent-warm: #f97316;
      --accent-cool: #38bdf8;
      --border-subtle: rgba(255,255,255,0.06);
      --alert-extreme: #dc2626;
      --alert-severe: #ea580c;
      --alert-moderate: #d97706;
      --alert-minor: #ca8a04;
      --alert-unknown: #6b7280;
    }

    body {
      font-family: 'Instrument Sans', sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .atmosphere {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 50% at 20% 40%, rgba(56, 189, 248, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 60%, rgba(249, 115, 22, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse 100% 100% at 50% 0%, rgba(30, 41, 59, 0.5) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    .noise {
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      z-index: 1;
    }

    .alerts-container {
      position: relative;
      z-index: 10;
    }

    .alert-banner {
      padding: 1rem 2rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      animation: slideDown 0.5s ease-out;
      border-bottom: 1px solid rgba(0,0,0,0.2);
    }

    .alert-banner.severity-extreme {
      background: linear-gradient(135deg, var(--alert-extreme) 0%, #991b1b 100%);
    }

    .alert-banner.severity-severe {
      background: linear-gradient(135deg, var(--alert-severe) 0%, #c2410c 100%);
    }

    .alert-banner.severity-moderate {
      background: linear-gradient(135deg, var(--alert-moderate) 0%, #b45309 100%);
    }

    .alert-banner.severity-minor {
      background: linear-gradient(135deg, var(--alert-minor) 0%, #a16207 100%);
    }

    .alert-banner.severity-unknown {
      background: linear-gradient(135deg, var(--alert-unknown) 0%, #4b5563 100%);
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-100%); }
      to { opacity: 1; transform: translateY(0); }
    }

    .alert-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
      margin-top: 0.1rem;
      animation: pulse-alert 2s ease-in-out infinite;
    }

    @keyframes pulse-alert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .alert-content {
      flex: 1;
      min-width: 0;
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 0.25rem;
    }

    .alert-title {
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 0.02em;
    }

    .alert-severity-badge {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      background: rgba(0,0,0,0.25);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }

    .alert-description {
      font-size: 0.875rem;
      opacity: 0.9;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      white-space: pre-wrap;
    }

    .alert-description.expanded {
      -webkit-line-clamp: unset;
    }

    .alert-meta {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .alert-meta span {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .alert-dismiss {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
    }

    .alert-dismiss:hover {
      background: rgba(0,0,0,0.35);
    }

    .alert-expand-btn {
      background: rgba(0,0,0,0.2);
      border: none;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: background 0.2s;
    }

    .alert-expand-btn:hover {
      background: rgba(0,0,0,0.35);
    }

    .translating-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
      opacity: 0.7;
      margin-left: 0.5rem;
    }

    .translating-indicator i {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;
      margin-bottom: 4rem;
      animation: fadeDown 0.8s ease-out;
    }

    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 500;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, rgba(248,250,252,0.7) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .location-display {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      min-height: 1.5rem;
    }

    .controls-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .zip-input-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border-subtle);
      border-radius: 100px;
      padding: 0.5rem 0.5rem 0.5rem 1.25rem;
      transition: all 0.3s ease;
    }

    .zip-input-wrapper:focus-within {
      border-color: rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05);
    }

    .zip-input-wrapper i {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    #zipInput {
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      width: 80px;
      letter-spacing: 0.1em;
    }

    #zipInput::placeholder {
      color: var(--text-secondary);
    }

    #fetchBtn {
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--text-primary);
      padding: 0.6rem 1.25rem;
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #fetchBtn:hover {
      background: rgba(255,255,255,0.12);
      transform: translateY(-1px);
    }

    .lang-selector {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border-subtle);
      border-radius: 100px;
      padding: 0.5rem 1rem;
    }

    .lang-selector i {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    #langSelect {
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      cursor: pointer;
    }

    #langSelect option {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1.5rem;
      flex: 1;
      align-items: stretch;
    }

    .day-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 24px;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      backdrop-filter: blur(10px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(30px);
      position: relative;
      overflow: hidden;
    }

    .day-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    }

    .day-card.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    .day-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: rgba(255,255,255,0.12);
      box-shadow:
        0 20px 40px -20px rgba(0,0,0,0.5),
        0 0 60px -30px rgba(56, 189, 248, 0.2);
    }

    .day-name {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .day-date {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 500;
      margin-bottom: 1.5rem;
    }

    .weather-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      transition: transform 0.3s ease;
      filter: drop-shadow(0 4px 20px rgba(56, 189, 248, 0.2));
    }

    .day-card:hover .weather-icon {
      transform: scale(1.1);
    }

    .condition {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      min-height: 2.5rem;
      line-height: 1.4;
    }

    .temps {
      margin-top: auto;
      width: 100%;
    }

    .temp-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
    }

    .temp-row:first-child {
      border-bottom: 1px solid var(--border-subtle);
    }

    .temp-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .temp-label i {
      font-size: 1rem;
    }

    .temp-high .temp-label i {
      color: var(--accent-warm);
    }

    .temp-low .temp-label i {
      color: var(--accent-cool);
    }

    .temp-value {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-weight: 500;
    }

    .temp-high .temp-value {
      color: var(--accent-warm);
    }

    .temp-low .temp-value {
      color: var(--accent-cool);
    }

    .loading, .error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 3rem;
      animation: pulse 1.5s ease-in-out infinite;
      margin-bottom: 1rem;
      display: block;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .error {
      color: #f87171;
    }

    @media (max-width: 1100px) {
      .forecast-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 700px) {
      .forecast-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      .day-card {
        padding: 1.5rem 1rem;
      }
      .weather-icon {
        font-size: 3rem;
      }
      .alert-banner {
        padding: 0.75rem 1rem;
      }
      .alert-meta {
        flex-direction: column;
        gap: 0.25rem;
      }
      .controls-row {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .forecast-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="atmosphere"></div>
  <div class="noise"></div>

  <div class="alerts-container" id="alertsContainer"></div>

  <div class="container">
    <header>
      <h1 class="title" id="pageTitle">5-Day Forecast</h1>
      <p class="location-display" id="locationDisplay"></p>
      <div class="controls-row">
        <div class="zip-input-wrapper">
          <i class="ph ph-map-pin"></i>
          <input type="text" id="zipInput" placeholder="37206" maxlength="5" value="37206">
          <button id="fetchBtn">Update</button>
        </div>
        <div class="lang-selector">
          <i class="ph ph-translate"></i>
          <select id="langSelect">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="zh">中文</option>
            <option value="vi">Tiếng Việt</option>
            <option value="ko">한국어</option>
            <option value="ar">العربية</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
            <option value="pt">Português</option>
            <option value="ru">Русский</option>
            <option value="ja">日本語</option>
            <option value="hi">हिन्दी</option>
            <option value="tl">Tagalog</option>
          </select>
        </div>
      </div>
    </header>

    <div class="forecast-grid" id="forecastGrid">
      <div class="loading">
        <i class="ph ph-cloud"></i>
        <p id="loadingText">Loading forecast...</p>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // TRANSLATIONS - All UI strings
    // ===========================================
    const translations = {
      en: {
        title: '5-Day Forecast',
        update: 'Update',
        loading: 'Loading forecast...',
        high: 'High',
        low: 'Low',
        showDetails: 'Show Details',
        hideDetails: 'Hide Details',
        effective: 'Effective',
        expires: 'Expires',
        extreme: 'Extreme',
        severe: 'Severe',
        moderate: 'Moderate',
        minor: 'Minor',
        unknown: 'Unknown',
        errorZip: 'Please enter a valid 5-digit ZIP code',
        errorFetch: 'Unable to fetch forecast. Please check the ZIP code and try again.',
        days: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
        months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        conditions: {
          'Clear Sky': 'Clear Sky',
          'Mostly Clear': 'Mostly Clear',
          'Partly Cloudy': 'Partly Cloudy',
          'Overcast': 'Overcast',
          'Foggy': 'Foggy',
          'Rime Fog': 'Rime Fog',
          'Light Drizzle': 'Light Drizzle',
          'Moderate Drizzle': 'Moderate Drizzle',
          'Dense Drizzle': 'Dense Drizzle',
          'Freezing Drizzle': 'Freezing Drizzle',
          'Heavy Freezing Drizzle': 'Heavy Freezing Drizzle',
          'Light Rain': 'Light Rain',
          'Moderate Rain': 'Moderate Rain',
          'Heavy Rain': 'Heavy Rain',
          'Freezing Rain': 'Freezing Rain',
          'Heavy Freezing Rain': 'Heavy Freezing Rain',
          'Light Snow': 'Light Snow',
          'Moderate Snow': 'Moderate Snow',
          'Heavy Snow': 'Heavy Snow',
          'Snow Grains': 'Snow Grains',
          'Light Showers': 'Light Showers',
          'Moderate Showers': 'Moderate Showers',
          'Violent Showers': 'Violent Showers',
          'Light Snow Showers': 'Light Snow Showers',
          'Heavy Snow Showers': 'Heavy Snow Showers',
          'Thunderstorm': 'Thunderstorm',
          'Thunderstorm with Hail': 'Thunderstorm with Hail',
          'Severe Thunderstorm': 'Severe Thunderstorm'
        }
      },
      es: {
        title: 'Pronóstico de 5 Días',
        update: 'Actualizar',
        loading: 'Cargando pronóstico...',
        high: 'Máx',
        low: 'Mín',
        showDetails: 'Ver Detalles',
        hideDetails: 'Ocultar Detalles',
        effective: 'Vigente',
        expires: 'Expira',
        extreme: 'Extremo',
        severe: 'Severo',
        moderate: 'Moderado',
        minor: 'Menor',
        unknown: 'Desconocido',
        errorZip: 'Por favor ingrese un código postal válido de 5 dígitos',
        errorFetch: 'No se pudo obtener el pronóstico. Verifique el código postal e intente nuevamente.',
        days: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
        months: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
        conditions: {
          'Clear Sky': 'Cielo Despejado',
          'Mostly Clear': 'Mayormente Despejado',
          'Partly Cloudy': 'Parcialmente Nublado',
          'Overcast': 'Nublado',
          'Foggy': 'Niebla',
          'Rime Fog': 'Niebla Helada',
          'Light Drizzle': 'Llovizna Ligera',
          'Moderate Drizzle': 'Llovizna Moderada',
          'Dense Drizzle': 'Llovizna Densa',
          'Freezing Drizzle': 'Llovizna Helada',
          'Heavy Freezing Drizzle': 'Llovizna Helada Intensa',
          'Light Rain': 'Lluvia Ligera',
          'Moderate Rain': 'Lluvia Moderada',
          'Heavy Rain': 'Lluvia Intensa',
          'Freezing Rain': 'Lluvia Helada',
          'Heavy Freezing Rain': 'Lluvia Helada Intensa',
          'Light Snow': 'Nevada Ligera',
          'Moderate Snow': 'Nevada Moderada',
          'Heavy Snow': 'Nevada Intensa',
          'Snow Grains': 'Granizo de Nieve',
          'Light Showers': 'Chubascos Ligeros',
          'Moderate Showers': 'Chubascos Moderados',
          'Violent Showers': 'Chubascos Violentos',
          'Light Snow Showers': 'Chubascos de Nieve Ligeros',
          'Heavy Snow Showers': 'Chubascos de Nieve Intensos',
          'Thunderstorm': 'Tormenta Eléctrica',
          'Thunderstorm with Hail': 'Tormenta con Granizo',
          'Severe Thunderstorm': 'Tormenta Severa'
        }
      },
      zh: {
        title: '5天天气预报',
        update: '更新',
        loading: '正在加载预报...',
        high: '最高',
        low: '最低',
        showDetails: '显示详情',
        hideDetails: '隐藏详情',
        effective: '生效时间',
        expires: '过期时间',
        extreme: '极端',
        severe: '严重',
        moderate: '中等',
        minor: '轻微',
        unknown: '未知',
        errorZip: '请输入有效的5位邮政编码',
        errorFetch: '无法获取预报。请检查邮政编码后重试。',
        days: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
        months: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
        conditions: {
          'Clear Sky': '晴朗',
          'Mostly Clear': '大部晴朗',
          'Partly Cloudy': '多云',
          'Overcast': '阴天',
          'Foggy': '有雾',
          'Rime Fog': '雾凇',
          'Light Drizzle': '小毛毛雨',
          'Moderate Drizzle': '毛毛雨',
          'Dense Drizzle': '大毛毛雨',
          'Freezing Drizzle': '冻毛毛雨',
          'Heavy Freezing Drizzle': '大冻毛毛雨',
          'Light Rain': '小雨',
          'Moderate Rain': '中雨',
          'Heavy Rain': '大雨',
          'Freezing Rain': '冻雨',
          'Heavy Freezing Rain': '大冻雨',
          'Light Snow': '小雪',
          'Moderate Snow': '中雪',
          'Heavy Snow': '大雪',
          'Snow Grains': '雪粒',
          'Light Showers': '小阵雨',
          'Moderate Showers': '阵雨',
          'Violent Showers': '暴雨',
          'Light Snow Showers': '小阵雪',
          'Heavy Snow Showers': '大阵雪',
          'Thunderstorm': '雷暴',
          'Thunderstorm with Hail': '雷暴伴冰雹',
          'Severe Thunderstorm': '强雷暴'
        }
      },
      vi: {
        title: 'Dự Báo 5 Ngày',
        update: 'Cập Nhật',
        loading: 'Đang tải dự báo...',
        high: 'Cao',
        low: 'Thấp',
        showDetails: 'Xem Chi Tiết',
        hideDetails: 'Ẩn Chi Tiết',
        effective: 'Có hiệu lực',
        expires: 'Hết hạn',
        extreme: 'Cực đoan',
        severe: 'Nghiêm trọng',
        moderate: 'Trung bình',
        minor: 'Nhẹ',
        unknown: 'Không rõ',
        errorZip: 'Vui lòng nhập mã bưu điện 5 chữ số hợp lệ',
        errorFetch: 'Không thể tải dự báo. Vui lòng kiểm tra mã bưu điện và thử lại.',
        days: ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'],
        months: ['Th1', 'Th2', 'Th3', 'Th4', 'Th5', 'Th6', 'Th7', 'Th8', 'Th9', 'Th10', 'Th11', 'Th12'],
        conditions: {
          'Clear Sky': 'Trời Quang',
          'Mostly Clear': 'Phần Lớn Quang',
          'Partly Cloudy': 'Có Mây',
          'Overcast': 'U Ám',
          'Foggy': 'Có Sương',
          'Rime Fog': 'Sương Muối',
          'Light Drizzle': 'Mưa Phùn Nhẹ',
          'Moderate Drizzle': 'Mưa Phùn',
          'Dense Drizzle': 'Mưa Phùn Dày',
          'Freezing Drizzle': 'Mưa Phùn Đóng Băng',
          'Heavy Freezing Drizzle': 'Mưa Phùn Đóng Băng Nặng',
          'Light Rain': 'Mưa Nhẹ',
          'Moderate Rain': 'Mưa Vừa',
          'Heavy Rain': 'Mưa To',
          'Freezing Rain': 'Mưa Đóng Băng',
          'Heavy Freezing Rain': 'Mưa Đóng Băng Nặng',
          'Light Snow': 'Tuyết Nhẹ',
          'Moderate Snow': 'Tuyết Vừa',
          'Heavy Snow': 'Tuyết Dày',
          'Snow Grains': 'Hạt Tuyết',
          'Light Showers': 'Mưa Rào Nhẹ',
          'Moderate Showers': 'Mưa Rào',
          'Violent Showers': 'Mưa Rào Mạnh',
          'Light Snow Showers': 'Mưa Tuyết Nhẹ',
          'Heavy Snow Showers': 'Mưa Tuyết Nặng',
          'Thunderstorm': 'Giông Bão',
          'Thunderstorm with Hail': 'Giông Bão Kèm Mưa Đá',
          'Severe Thunderstorm': 'Giông Bão Mạnh'
        }
      },
      ko: {
        title: '5일 예보',
        update: '업데이트',
        loading: '예보 로딩 중...',
        high: '최고',
        low: '최저',
        showDetails: '상세 보기',
        hideDetails: '상세 숨기기',
        effective: '발효',
        expires: '만료',
        extreme: '극심',
        severe: '심각',
        moderate: '보통',
        minor: '경미',
        unknown: '미상',
        errorZip: '유효한 5자리 우편번호를 입력하세요',
        errorFetch: '예보를 가져올 수 없습니다. 우편번호를 확인하고 다시 시도하세요.',
        days: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'],
        months: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        conditions: {
          'Clear Sky': '맑음',
          'Mostly Clear': '대체로 맑음',
          'Partly Cloudy': '구름 조금',
          'Overcast': '흐림',
          'Foggy': '안개',
          'Rime Fog': '상고대',
          'Light Drizzle': '가벼운 이슬비',
          'Moderate Drizzle': '이슬비',
          'Dense Drizzle': '짙은 이슬비',
          'Freezing Drizzle': '어는 이슬비',
          'Heavy Freezing Drizzle': '강한 어는 이슬비',
          'Light Rain': '약한 비',
          'Moderate Rain': '비',
          'Heavy Rain': '폭우',
          'Freezing Rain': '어는 비',
          'Heavy Freezing Rain': '강한 어는 비',
          'Light Snow': '약한 눈',
          'Moderate Snow': '눈',
          'Heavy Snow': '폭설',
          'Snow Grains': '싸락눈',
          'Light Showers': '약한 소나기',
          'Moderate Showers': '소나기',
          'Violent Showers': '강한 소나기',
          'Light Snow Showers': '약한 눈보라',
          'Heavy Snow Showers': '강한 눈보라',
          'Thunderstorm': '뇌우',
          'Thunderstorm with Hail': '우박 동반 뇌우',
          'Severe Thunderstorm': '강한 뇌우'
        }
      },
      ar: {
        title: 'توقعات 5 أيام',
        update: 'تحديث',
        loading: 'جاري تحميل التوقعات...',
        high: 'عظمى',
        low: 'صغرى',
        showDetails: 'عرض التفاصيل',
        hideDetails: 'إخفاء التفاصيل',
        effective: 'ساري من',
        expires: 'ينتهي',
        extreme: 'شديد جداً',
        severe: 'شديد',
        moderate: 'معتدل',
        minor: 'طفيف',
        unknown: 'غير معروف',
        errorZip: 'يرجى إدخال رمز بريدي صالح من 5 أرقام',
        errorFetch: 'تعذر الحصول على التوقعات. يرجى التحقق من الرمز البريدي والمحاولة مرة أخرى.',
        days: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],
        months: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],
        conditions: {
          'Clear Sky': 'سماء صافية',
          'Mostly Clear': 'صافٍ غالباً',
          'Partly Cloudy': 'غائم جزئياً',
          'Overcast': 'غائم',
          'Foggy': 'ضبابي',
          'Rime Fog': 'ضباب متجمد',
          'Light Drizzle': 'رذاذ خفيف',
          'Moderate Drizzle': 'رذاذ معتدل',
          'Dense Drizzle': 'رذاذ كثيف',
          'Freezing Drizzle': 'رذاذ متجمد',
          'Heavy Freezing Drizzle': 'رذاذ متجمد كثيف',
          'Light Rain': 'مطر خفيف',
          'Moderate Rain': 'مطر معتدل',
          'Heavy Rain': 'مطر غزير',
          'Freezing Rain': 'مطر متجمد',
          'Heavy Freezing Rain': 'مطر متجمد غزير',
          'Light Snow': 'ثلج خفيف',
          'Moderate Snow': 'ثلج معتدل',
          'Heavy Snow': 'ثلج كثيف',
          'Snow Grains': 'حبيبات ثلجية',
          'Light Showers': 'زخات خفيفة',
          'Moderate Showers': 'زخات معتدلة',
          'Violent Showers': 'زخات عنيفة',
          'Light Snow Showers': 'زخات ثلجية خفيفة',
          'Heavy Snow Showers': 'زخات ثلجية كثيفة',
          'Thunderstorm': 'عاصفة رعدية',
          'Thunderstorm with Hail': 'عاصفة رعدية مع برد',
          'Severe Thunderstorm': 'عاصفة رعدية شديدة'
        }
      },
      fr: {
        title: 'Prévisions sur 5 Jours',
        update: 'Actualiser',
        loading: 'Chargement des prévisions...',
        high: 'Max',
        low: 'Min',
        showDetails: 'Voir Détails',
        hideDetails: 'Masquer Détails',
        effective: 'En vigueur',
        expires: 'Expire',
        extreme: 'Extrême',
        severe: 'Sévère',
        moderate: 'Modéré',
        minor: 'Mineur',
        unknown: 'Inconnu',
        errorZip: 'Veuillez entrer un code postal valide à 5 chiffres',
        errorFetch: 'Impossible de récupérer les prévisions. Veuillez vérifier le code postal et réessayer.',
        days: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
        months: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
        conditions: {
          'Clear Sky': 'Ciel Dégagé',
          'Mostly Clear': 'Plutôt Dégagé',
          'Partly Cloudy': 'Partiellement Nuageux',
          'Overcast': 'Couvert',
          'Foggy': 'Brumeux',
          'Rime Fog': 'Brouillard Givrant',
          'Light Drizzle': 'Bruine Légère',
          'Moderate Drizzle': 'Bruine Modérée',
          'Dense Drizzle': 'Bruine Dense',
          'Freezing Drizzle': 'Bruine Verglaçante',
          'Heavy Freezing Drizzle': 'Forte Bruine Verglaçante',
          'Light Rain': 'Pluie Légère',
          'Moderate Rain': 'Pluie Modérée',
          'Heavy Rain': 'Forte Pluie',
          'Freezing Rain': 'Pluie Verglaçante',
          'Heavy Freezing Rain': 'Forte Pluie Verglaçante',
          'Light Snow': 'Neige Légère',
          'Moderate Snow': 'Neige Modérée',
          'Heavy Snow': 'Forte Neige',
          'Snow Grains': 'Grains de Neige',
          'Light Showers': 'Averses Légères',
          'Moderate Showers': 'Averses Modérées',
          'Violent Showers': 'Averses Violentes',
          'Light Snow Showers': 'Averses de Neige Légères',
          'Heavy Snow Showers': 'Fortes Averses de Neige',
          'Thunderstorm': 'Orage',
          'Thunderstorm with Hail': 'Orage avec Grêle',
          'Severe Thunderstorm': 'Orage Violent'
        }
      },
      de: {
        title: '5-Tage-Vorhersage',
        update: 'Aktualisieren',
        loading: 'Vorhersage wird geladen...',
        high: 'Höchst',
        low: 'Tiefst',
        showDetails: 'Details Anzeigen',
        hideDetails: 'Details Ausblenden',
        effective: 'Gültig ab',
        expires: 'Läuft ab',
        extreme: 'Extrem',
        severe: 'Schwer',
        moderate: 'Mäßig',
        minor: 'Gering',
        unknown: 'Unbekannt',
        errorZip: 'Bitte geben Sie eine gültige 5-stellige Postleitzahl ein',
        errorFetch: 'Vorhersage konnte nicht abgerufen werden. Bitte überprüfen Sie die Postleitzahl und versuchen Sie es erneut.',
        days: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
        months: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
        conditions: {
          'Clear Sky': 'Klarer Himmel',
          'Mostly Clear': 'Überwiegend Klar',
          'Partly Cloudy': 'Teilweise Bewölkt',
          'Overcast': 'Bedeckt',
          'Foggy': 'Neblig',
          'Rime Fog': 'Raunebel',
          'Light Drizzle': 'Leichter Nieselregen',
          'Moderate Drizzle': 'Mäßiger Nieselregen',
          'Dense Drizzle': 'Dichter Nieselregen',
          'Freezing Drizzle': 'Gefrierender Nieselregen',
          'Heavy Freezing Drizzle': 'Starker Gefrierender Nieselregen',
          'Light Rain': 'Leichter Regen',
          'Moderate Rain': 'Mäßiger Regen',
          'Heavy Rain': 'Starker Regen',
          'Freezing Rain': 'Gefrierender Regen',
          'Heavy Freezing Rain': 'Starker Gefrierender Regen',
          'Light Snow': 'Leichter Schnee',
          'Moderate Snow': 'Mäßiger Schnee',
          'Heavy Snow': 'Starker Schnee',
          'Snow Grains': 'Schneegriesel',
          'Light Showers': 'Leichte Schauer',
          'Moderate Showers': 'Mäßige Schauer',
          'Violent Showers': 'Heftige Schauer',
          'Light Snow Showers': 'Leichte Schneeschauer',
          'Heavy Snow Showers': 'Starke Schneeschauer',
          'Thunderstorm': 'Gewitter',
          'Thunderstorm with Hail': 'Gewitter mit Hagel',
          'Severe Thunderstorm': 'Schweres Gewitter'
        }
      },
      pt: {
        title: 'Previsão de 5 Dias',
        update: 'Atualizar',
        loading: 'Carregando previsão...',
        high: 'Máx',
        low: 'Mín',
        showDetails: 'Ver Detalhes',
        hideDetails: 'Ocultar Detalhes',
        effective: 'Em vigor',
        expires: 'Expira',
        extreme: 'Extremo',
        severe: 'Severo',
        moderate: 'Moderado',
        minor: 'Menor',
        unknown: 'Desconhecido',
        errorZip: 'Por favor, insira um código postal válido de 5 dígitos',
        errorFetch: 'Não foi possível obter a previsão. Verifique o código postal e tente novamente.',
        days: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
        months: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        conditions: {
          'Clear Sky': 'Céu Limpo',
          'Mostly Clear': 'Predominantemente Limpo',
          'Partly Cloudy': 'Parcialmente Nublado',
          'Overcast': 'Nublado',
          'Foggy': 'Nevoeiro',
          'Rime Fog': 'Nevoeiro Gelado',
          'Light Drizzle': 'Garoa Leve',
          'Moderate Drizzle': 'Garoa Moderada',
          'Dense Drizzle': 'Garoa Densa',
          'Freezing Drizzle': 'Garoa Congelante',
          'Heavy Freezing Drizzle': 'Garoa Congelante Forte',
          'Light Rain': 'Chuva Leve',
          'Moderate Rain': 'Chuva Moderada',
          'Heavy Rain': 'Chuva Forte',
          'Freezing Rain': 'Chuva Congelante',
          'Heavy Freezing Rain': 'Chuva Congelante Forte',
          'Light Snow': 'Neve Leve',
          'Moderate Snow': 'Neve Moderada',
          'Heavy Snow': 'Neve Forte',
          'Snow Grains': 'Grãos de Neve',
          'Light Showers': 'Pancadas Leves',
          'Moderate Showers': 'Pancadas Moderadas',
          'Violent Showers': 'Pancadas Violentas',
          'Light Snow Showers': 'Pancadas de Neve Leves',
          'Heavy Snow Showers': 'Pancadas de Neve Fortes',
          'Thunderstorm': 'Tempestade',
          'Thunderstorm with Hail': 'Tempestade com Granizo',
          'Severe Thunderstorm': 'Tempestade Severa'
        }
      },
      ru: {
        title: 'Прогноз на 5 Дней',
        update: 'Обновить',
        loading: 'Загрузка прогноза...',
        high: 'Макс',
        low: 'Мин',
        showDetails: 'Показать Детали',
        hideDetails: 'Скрыть Детали',
        effective: 'Действует с',
        expires: 'Истекает',
        extreme: 'Экстремальный',
        severe: 'Серьёзный',
        moderate: 'Умеренный',
        minor: 'Незначительный',
        unknown: 'Неизвестно',
        errorZip: 'Пожалуйста, введите действительный 5-значный почтовый индекс',
        errorFetch: 'Не удалось получить прогноз. Проверьте почтовый индекс и попробуйте снова.',
        days: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
        months: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
        conditions: {
          'Clear Sky': 'Ясно',
          'Mostly Clear': 'Преимущественно Ясно',
          'Partly Cloudy': 'Переменная Облачность',
          'Overcast': 'Пасмурно',
          'Foggy': 'Туман',
          'Rime Fog': 'Изморозь',
          'Light Drizzle': 'Лёгкая Морось',
          'Moderate Drizzle': 'Морось',
          'Dense Drizzle': 'Сильная Морось',
          'Freezing Drizzle': 'Ледяная Морось',
          'Heavy Freezing Drizzle': 'Сильная Ледяная Морось',
          'Light Rain': 'Небольшой Дождь',
          'Moderate Rain': 'Дождь',
          'Heavy Rain': 'Сильный Дождь',
          'Freezing Rain': 'Ледяной Дождь',
          'Heavy Freezing Rain': 'Сильный Ледяной Дождь',
          'Light Snow': 'Небольшой Снег',
          'Moderate Snow': 'Снег',
          'Heavy Snow': 'Сильный Снег',
          'Snow Grains': 'Снежная Крупа',
          'Light Showers': 'Небольшие Ливни',
          'Moderate Showers': 'Ливни',
          'Violent Showers': 'Сильные Ливни',
          'Light Snow Showers': 'Небольшой Снегопад',
          'Heavy Snow Showers': 'Сильный Снегопад',
          'Thunderstorm': 'Гроза',
          'Thunderstorm with Hail': 'Гроза с Градом',
          'Severe Thunderstorm': 'Сильная Гроза'
        }
      },
      ja: {
        title: '5日間予報',
        update: '更新',
        loading: '予報を読み込み中...',
        high: '最高',
        low: '最低',
        showDetails: '詳細を表示',
        hideDetails: '詳細を隠す',
        effective: '発効',
        expires: '有効期限',
        extreme: '極端',
        severe: '深刻',
        moderate: '中程度',
        minor: '軽度',
        unknown: '不明',
        errorZip: '有効な5桁の郵便番号を入力してください',
        errorFetch: '予報を取得できませんでした。郵便番号を確認して再試行してください。',
        days: ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日'],
        months: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
        conditions: {
          'Clear Sky': '晴れ',
          'Mostly Clear': 'ほぼ晴れ',
          'Partly Cloudy': '曇りがち',
          'Overcast': '曇り',
          'Foggy': '霧',
          'Rime Fog': '着氷性霧',
          'Light Drizzle': '弱い霧雨',
          'Moderate Drizzle': '霧雨',
          'Dense Drizzle': '強い霧雨',
          'Freezing Drizzle': '着氷性霧雨',
          'Heavy Freezing Drizzle': '強い着氷性霧雨',
          'Light Rain': '小雨',
          'Moderate Rain': '雨',
          'Heavy Rain': '大雨',
          'Freezing Rain': '着氷性の雨',
          'Heavy Freezing Rain': '強い着氷性の雨',
          'Light Snow': '小雪',
          'Moderate Snow': '雪',
          'Heavy Snow': '大雪',
          'Snow Grains': '雪あられ',
          'Light Showers': '弱いにわか雨',
          'Moderate Showers': 'にわか雨',
          'Violent Showers': '激しいにわか雨',
          'Light Snow Showers': '弱いにわか雪',
          'Heavy Snow Showers': '激しいにわか雪',
          'Thunderstorm': '雷雨',
          'Thunderstorm with Hail': '雹を伴う雷雨',
          'Severe Thunderstorm': '激しい雷雨'
        }
      },
      hi: {
        title: '5-दिन का पूर्वानुमान',
        update: 'अपडेट',
        loading: 'पूर्वानुमान लोड हो रहा है...',
        high: 'अधिकतम',
        low: 'न्यूनतम',
        showDetails: 'विवरण दिखाएं',
        hideDetails: 'विवरण छुपाएं',
        effective: 'प्रभावी',
        expires: 'समाप्त',
        extreme: 'अत्यधिक',
        severe: 'गंभीर',
        moderate: 'मध्यम',
        minor: 'मामूली',
        unknown: 'अज्ञात',
        errorZip: 'कृपया मान्य 5-अंकीय ज़िप कोड दर्ज करें',
        errorFetch: 'पूर्वानुमान प्राप्त नहीं हो सका। कृपया ज़िप कोड जांचें और पुनः प्रयास करें।',
        days: ['रविवार', 'सोमवार', 'मंगलवार', 'बुधवार', 'गुरुवार', 'शुक्रवार', 'शनिवार'],
        months: ['जन', 'फर', 'मार्च', 'अप्रैल', 'मई', 'जून', 'जुलाई', 'अग', 'सित', 'अक्टू', 'नव', 'दिस'],
        conditions: {
          'Clear Sky': 'साफ आसमान',
          'Mostly Clear': 'अधिकतर साफ',
          'Partly Cloudy': 'आंशिक बादल',
          'Overcast': 'घटाटोप',
          'Foggy': 'कोहरा',
          'Rime Fog': 'पाला कोहरा',
          'Light Drizzle': 'हल्की बूंदाबांदी',
          'Moderate Drizzle': 'बूंदाबांदी',
          'Dense Drizzle': 'घनी बूंदाबांदी',
          'Freezing Drizzle': 'जमने वाली बूंदाबांदी',
          'Heavy Freezing Drizzle': 'भारी जमने वाली बूंदाबांदी',
          'Light Rain': 'हल्की बारिश',
          'Moderate Rain': 'बारिश',
          'Heavy Rain': 'भारी बारिश',
          'Freezing Rain': 'जमने वाली बारिश',
          'Heavy Freezing Rain': 'भारी जमने वाली बारिश',
          'Light Snow': 'हल्की बर्फ',
          'Moderate Snow': 'बर्फ',
          'Heavy Snow': 'भारी बर्फ',
          'Snow Grains': 'बर्फ के दाने',
          'Light Showers': 'हल्की बौछारें',
          'Moderate Showers': 'बौछारें',
          'Violent Showers': 'तेज बौछारें',
          'Light Snow Showers': 'हल्की बर्फ की बौछारें',
          'Heavy Snow Showers': 'भारी बर्फ की बौछारें',
          'Thunderstorm': 'तूफान',
          'Thunderstorm with Hail': 'ओलावृष्टि के साथ तूफान',
          'Severe Thunderstorm': 'गंभीर तूफान'
        }
      },
      tl: {
        title: 'Taya ng 5 Araw',
        update: 'I-update',
        loading: 'Naglo-load ng taya...',
        high: 'Mataas',
        low: 'Mababa',
        showDetails: 'Ipakita ang Detalye',
        hideDetails: 'Itago ang Detalye',
        effective: 'Epektibo',
        expires: 'Mag-eexpire',
        extreme: 'Matindi',
        severe: 'Malubha',
        moderate: 'Katamtaman',
        minor: 'Bahagya',
        unknown: 'Hindi Alam',
        errorZip: 'Pakilagay ang valid na 5-digit na ZIP code',
        errorFetch: 'Hindi makuha ang taya. Pakitingnan ang ZIP code at subukan muli.',
        days: ['Linggo', 'Lunes', 'Martes', 'Miyerkules', 'Huwebes', 'Biyernes', 'Sabado'],
        months: ['Ene', 'Peb', 'Mar', 'Abr', 'May', 'Hun', 'Hul', 'Ago', 'Set', 'Okt', 'Nob', 'Dis'],
        conditions: {
          'Clear Sky': 'Malinaw na Kalangitan',
          'Mostly Clear': 'Halos Malinaw',
          'Partly Cloudy': 'Bahagyang Maulap',
          'Overcast': 'Maulap',
          'Foggy': 'Mahamog',
          'Rime Fog': 'Yelong Hamog',
          'Light Drizzle': 'Bahagyang Ambon',
          'Moderate Drizzle': 'Ambon',
          'Dense Drizzle': 'Makapal na Ambon',
          'Freezing Drizzle': 'Nagyeyelong Ambon',
          'Heavy Freezing Drizzle': 'Malakas na Nagyeyelong Ambon',
          'Light Rain': 'Bahagyang Ulan',
          'Moderate Rain': 'Ulan',
          'Heavy Rain': 'Malakas na Ulan',
          'Freezing Rain': 'Nagyeyelong Ulan',
          'Heavy Freezing Rain': 'Malakas na Nagyeyelong Ulan',
          'Light Snow': 'Bahagyang Niyebe',
          'Moderate Snow': 'Niyebe',
          'Heavy Snow': 'Malakas na Niyebe',
          'Snow Grains': 'Butil ng Niyebe',
          'Light Showers': 'Bahagyang Buhos',
          'Moderate Showers': 'Buhos',
          'Violent Showers': 'Malakas na Buhos',
          'Light Snow Showers': 'Bahagyang Buhos ng Niyebe',
          'Heavy Snow Showers': 'Malakas na Buhos ng Niyebe',
          'Thunderstorm': 'Bagyo',
          'Thunderstorm with Hail': 'Bagyo na may Yelo',
          'Severe Thunderstorm': 'Malakas na Bagyo'
        }
      }
    };

    // ===========================================
    // APP STATE
    // ===========================================
    const translationCache = new Map();
    let currentLang = 'en';
    let currentAlerts = [];
    let currentWeather = null;

    const weatherCodes = {
      0: { label: 'Clear Sky', icon: 'ph-sun' },
      1: { label: 'Mostly Clear', icon: 'ph-sun' },
      2: { label: 'Partly Cloudy', icon: 'ph-cloud-sun' },
      3: { label: 'Overcast', icon: 'ph-cloud' },
      45: { label: 'Foggy', icon: 'ph-cloud-fog' },
      48: { label: 'Rime Fog', icon: 'ph-cloud-fog' },
      51: { label: 'Light Drizzle', icon: 'ph-cloud-rain' },
      53: { label: 'Moderate Drizzle', icon: 'ph-cloud-rain' },
      55: { label: 'Dense Drizzle', icon: 'ph-cloud-rain' },
      56: { label: 'Freezing Drizzle', icon: 'ph-cloud-rain' },
      57: { label: 'Heavy Freezing Drizzle', icon: 'ph-cloud-rain' },
      61: { label: 'Light Rain', icon: 'ph-cloud-rain' },
      63: { label: 'Moderate Rain', icon: 'ph-cloud-rain' },
      65: { label: 'Heavy Rain', icon: 'ph-cloud-rain' },
      66: { label: 'Freezing Rain', icon: 'ph-cloud-rain' },
      67: { label: 'Heavy Freezing Rain', icon: 'ph-cloud-rain' },
      71: { label: 'Light Snow', icon: 'ph-snowflake' },
      73: { label: 'Moderate Snow', icon: 'ph-snowflake' },
      75: { label: 'Heavy Snow', icon: 'ph-snowflake' },
      77: { label: 'Snow Grains', icon: 'ph-snowflake' },
      80: { label: 'Light Showers', icon: 'ph-cloud-rain' },
      81: { label: 'Moderate Showers', icon: 'ph-cloud-rain' },
      82: { label: 'Violent Showers', icon: 'ph-cloud-rain' },
      85: { label: 'Light Snow Showers', icon: 'ph-snowflake' },
      86: { label: 'Heavy Snow Showers', icon: 'ph-snowflake' },
      95: { label: 'Thunderstorm', icon: 'ph-cloud-lightning' },
      96: { label: 'Thunderstorm with Hail', icon: 'ph-cloud-lightning' },
      99: { label: 'Severe Thunderstorm', icon: 'ph-cloud-lightning' }
    };

    // ===========================================
    // TRANSLATION HELPERS
    // ===========================================

    // Pre-translated NWS alert types - no API call needed for these
    const alertTranslations = {
      es: {
        'Tornado Warning': 'Advertencia de Tornado',
        'Tornado Watch': 'Vigilancia de Tornado',
        'Severe Thunderstorm Warning': 'Advertencia de Tormenta Severa',
        'Severe Thunderstorm Watch': 'Vigilancia de Tormenta Severa',
        'Flash Flood Warning': 'Advertencia de Inundación Repentina',
        'Flash Flood Watch': 'Vigilancia de Inundación Repentina',
        'Flood Warning': 'Advertencia de Inundación',
        'Flood Watch': 'Vigilancia de Inundación',
        'Flood Advisory': 'Aviso de Inundación',
        'Winter Storm Warning': 'Advertencia de Tormenta Invernal',
        'Winter Storm Watch': 'Vigilancia de Tormenta Invernal',
        'Winter Weather Advisory': 'Aviso de Clima Invernal',
        'Blizzard Warning': 'Advertencia de Ventisca',
        'Ice Storm Warning': 'Advertencia de Tormenta de Hielo',
        'Wind Chill Warning': 'Advertencia de Sensación Térmica',
        'Wind Chill Watch': 'Vigilancia de Sensación Térmica',
        'Wind Chill Advisory': 'Aviso de Sensación Térmica',
        'Cold Weather Advisory': 'Aviso de Clima Frío',
        'Freeze Warning': 'Advertencia de Helada',
        'Freeze Watch': 'Vigilancia de Helada',
        'Frost Advisory': 'Aviso de Escarcha',
        'Hard Freeze Warning': 'Advertencia de Helada Intensa',
        'Hard Freeze Watch': 'Vigilancia de Helada Intensa',
        'Excessive Heat Warning': 'Advertencia de Calor Excesivo',
        'Excessive Heat Watch': 'Vigilancia de Calor Excesivo',
        'Heat Advisory': 'Aviso de Calor',
        'Hurricane Warning': 'Advertencia de Huracán',
        'Hurricane Watch': 'Vigilancia de Huracán',
        'Tropical Storm Warning': 'Advertencia de Tormenta Tropical',
        'Tropical Storm Watch': 'Vigilancia de Tormenta Tropical',
        'Storm Surge Warning': 'Advertencia de Marejada Ciclónica',
        'Storm Surge Watch': 'Vigilancia de Marejada Ciclónica',
        'High Wind Warning': 'Advertencia de Vientos Fuertes',
        'High Wind Watch': 'Vigilancia de Vientos Fuertes',
        'Wind Advisory': 'Aviso de Viento',
        'Extreme Wind Warning': 'Advertencia de Viento Extremo',
        'Dust Storm Warning': 'Advertencia de Tormenta de Polvo',
        'Dense Fog Advisory': 'Aviso de Niebla Densa',
        'Coastal Flood Warning': 'Advertencia de Inundación Costera',
        'Coastal Flood Watch': 'Vigilancia de Inundación Costera',
        'Coastal Flood Advisory': 'Aviso de Inundación Costera',
        'Tsunami Warning': 'Advertencia de Tsunami',
        'Tsunami Watch': 'Vigilancia de Tsunami',
        'Avalanche Warning': 'Advertencia de Avalancha',
        'Avalanche Watch': 'Vigilancia de Avalancha',
        'Fire Warning': 'Advertencia de Incendio',
        'Red Flag Warning': 'Advertencia de Bandera Roja',
        'Fire Weather Watch': 'Vigilancia de Clima de Incendio',
        'Special Weather Statement': 'Comunicado Especial del Tiempo',
        'Severe Weather Statement': 'Comunicado de Clima Severo',
        'Lake Effect Snow Warning': 'Advertencia de Nieve por Efecto Lago',
        'Lake Effect Snow Watch': 'Vigilancia de Nieve por Efecto Lago',
        'Lake Effect Snow Advisory': 'Aviso de Nieve por Efecto Lago',
        'Snow Squall Warning': 'Advertencia de Chubasco de Nieve',
        'Hazardous Weather Outlook': 'Perspectiva de Clima Peligroso',
        'Air Quality Alert': 'Alerta de Calidad del Aire',
        'Rip Current Statement': 'Comunicado de Corriente de Resaca',
        'Beach Hazards Statement': 'Comunicado de Peligros en la Playa'
      },
      zh: {
        'Tornado Warning': '龙卷风警报',
        'Tornado Watch': '龙卷风监视',
        'Severe Thunderstorm Warning': '强雷暴警报',
        'Severe Thunderstorm Watch': '强雷暴监视',
        'Flash Flood Warning': '山洪警报',
        'Flash Flood Watch': '山洪监视',
        'Flood Warning': '洪水警报',
        'Flood Watch': '洪水监视',
        'Flood Advisory': '洪水公告',
        'Winter Storm Warning': '冬季风暴警报',
        'Winter Storm Watch': '冬季风暴监视',
        'Winter Weather Advisory': '冬季天气公告',
        'Blizzard Warning': '暴风雪警报',
        'Ice Storm Warning': '冰暴警报',
        'Wind Chill Warning': '风寒警报',
        'Wind Chill Watch': '风寒监视',
        'Wind Chill Advisory': '风寒公告',
        'Cold Weather Advisory': '寒冷天气公告',
        'Freeze Warning': '霜冻警报',
        'Freeze Watch': '霜冻监视',
        'Frost Advisory': '霜冻公告',
        'Hard Freeze Warning': '严重霜冻警报',
        'Hard Freeze Watch': '严重霜冻监视',
        'Excessive Heat Warning': '极端高温警报',
        'Excessive Heat Watch': '极端高温监视',
        'Heat Advisory': '高温公告',
        'Hurricane Warning': '飓风警报',
        'Hurricane Watch': '飓风监视',
        'Tropical Storm Warning': '热带风暴警报',
        'Tropical Storm Watch': '热带风暴监视',
        'Storm Surge Warning': '风暴潮警报',
        'Storm Surge Watch': '风暴潮监视',
        'High Wind Warning': '大风警报',
        'High Wind Watch': '大风监视',
        'Wind Advisory': '风力公告',
        'Extreme Wind Warning': '极端大风警报',
        'Dust Storm Warning': '沙尘暴警报',
        'Dense Fog Advisory': '浓雾公告',
        'Coastal Flood Warning': '沿海洪水警报',
        'Coastal Flood Watch': '沿海洪水监视',
        'Coastal Flood Advisory': '沿海洪水公告',
        'Tsunami Warning': '海啸警报',
        'Tsunami Watch': '海啸监视',
        'Avalanche Warning': '雪崩警报',
        'Avalanche Watch': '雪崩监视',
        'Fire Warning': '火灾警报',
        'Red Flag Warning': '红旗警报',
        'Fire Weather Watch': '火险天气监视',
        'Special Weather Statement': '特别天气声明',
        'Severe Weather Statement': '恶劣天气声明',
        'Lake Effect Snow Warning': '湖效应雪警报',
        'Lake Effect Snow Watch': '湖效应雪监视',
        'Lake Effect Snow Advisory': '湖效应雪公告',
        'Snow Squall Warning': '暴风雪警报',
        'Hazardous Weather Outlook': '危险天气展望',
        'Air Quality Alert': '空气质量警报'
      },
      vi: {
        'Tornado Warning': 'Cảnh báo Lốc Xoáy',
        'Tornado Watch': 'Theo dõi Lốc Xoáy',
        'Severe Thunderstorm Warning': 'Cảnh báo Dông Bão Mạnh',
        'Severe Thunderstorm Watch': 'Theo dõi Dông Bão Mạnh',
        'Flash Flood Warning': 'Cảnh báo Lũ Quét',
        'Flash Flood Watch': 'Theo dõi Lũ Quét',
        'Flood Warning': 'Cảnh báo Lũ Lụt',
        'Flood Watch': 'Theo dõi Lũ Lụt',
        'Flood Advisory': 'Khuyến cáo Lũ Lụt',
        'Winter Storm Warning': 'Cảnh báo Bão Mùa Đông',
        'Winter Storm Watch': 'Theo dõi Bão Mùa Đông',
        'Winter Weather Advisory': 'Khuyến cáo Thời tiết Mùa Đông',
        'Blizzard Warning': 'Cảnh báo Bão Tuyết',
        'Ice Storm Warning': 'Cảnh báo Bão Băng',
        'Wind Chill Warning': 'Cảnh báo Gió Lạnh',
        'Wind Chill Watch': 'Theo dõi Gió Lạnh',
        'Wind Chill Advisory': 'Khuyến cáo Gió Lạnh',
        'Cold Weather Advisory': 'Khuyến cáo Thời tiết Lạnh',
        'Freeze Warning': 'Cảnh báo Đóng Băng',
        'Freeze Watch': 'Theo dõi Đóng Băng',
        'Frost Advisory': 'Khuyến cáo Sương Giá',
        'Excessive Heat Warning': 'Cảnh báo Nóng Cực Độ',
        'Excessive Heat Watch': 'Theo dõi Nóng Cực Độ',
        'Heat Advisory': 'Khuyến cáo Nóng',
        'Hurricane Warning': 'Cảnh báo Bão',
        'Hurricane Watch': 'Theo dõi Bão',
        'Tropical Storm Warning': 'Cảnh báo Bão Nhiệt Đới',
        'Tropical Storm Watch': 'Theo dõi Bão Nhiệt Đới',
        'High Wind Warning': 'Cảnh báo Gió Mạnh',
        'High Wind Watch': 'Theo dõi Gió Mạnh',
        'Wind Advisory': 'Khuyến cáo Gió',
        'Tsunami Warning': 'Cảnh báo Sóng Thần',
        'Tsunami Watch': 'Theo dõi Sóng Thần',
        'Fire Warning': 'Cảnh báo Cháy Rừng',
        'Red Flag Warning': 'Cảnh báo Cờ Đỏ',
        'Dense Fog Advisory': 'Khuyến cáo Sương Mù Dày',
        'Air Quality Alert': 'Cảnh báo Chất lượng Không khí'
      },
      ko: {
        'Tornado Warning': '토네이도 경보',
        'Tornado Watch': '토네이도 주의보',
        'Severe Thunderstorm Warning': '심한 뇌우 경보',
        'Severe Thunderstorm Watch': '심한 뇌우 주의보',
        'Flash Flood Warning': '돌발 홍수 경보',
        'Flash Flood Watch': '돌발 홍수 주의보',
        'Flood Warning': '홍수 경보',
        'Flood Watch': '홍수 주의보',
        'Winter Storm Warning': '겨울 폭풍 경보',
        'Winter Storm Watch': '겨울 폭풍 주의보',
        'Winter Weather Advisory': '겨울 날씨 주의보',
        'Blizzard Warning': '눈보라 경보',
        'Cold Weather Advisory': '한파 주의보',
        'Freeze Warning': '동결 경보',
        'Heat Advisory': '폭염 주의보',
        'Excessive Heat Warning': '극심한 폭염 경보',
        'Hurricane Warning': '허리케인 경보',
        'Hurricane Watch': '허리케인 주의보',
        'High Wind Warning': '강풍 경보',
        'Wind Advisory': '바람 주의보',
        'Tsunami Warning': '쓰나미 경보',
        'Tsunami Watch': '쓰나미 주의보',
        'Fire Warning': '화재 경보',
        'Air Quality Alert': '대기질 경보'
      },
      fr: {
        'Tornado Warning': 'Alerte Tornade',
        'Tornado Watch': 'Veille Tornade',
        'Severe Thunderstorm Warning': 'Alerte Orage Violent',
        'Severe Thunderstorm Watch': 'Veille Orage Violent',
        'Flash Flood Warning': 'Alerte Crue Éclair',
        'Flash Flood Watch': 'Veille Crue Éclair',
        'Flood Warning': 'Alerte Inondation',
        'Flood Watch': 'Veille Inondation',
        'Winter Storm Warning': 'Alerte Tempête Hivernale',
        'Winter Storm Watch': 'Veille Tempête Hivernale',
        'Winter Weather Advisory': 'Avis Météo Hivernale',
        'Blizzard Warning': 'Alerte Blizzard',
        'Cold Weather Advisory': 'Avis Grand Froid',
        'Freeze Warning': 'Alerte Gel',
        'Heat Advisory': 'Avis Canicule',
        'Excessive Heat Warning': 'Alerte Chaleur Extrême',
        'Hurricane Warning': 'Alerte Ouragan',
        'Hurricane Watch': 'Veille Ouragan',
        'High Wind Warning': 'Alerte Vent Fort',
        'Wind Advisory': 'Avis de Vent',
        'Tsunami Warning': 'Alerte Tsunami',
        'Fire Warning': 'Alerte Incendie',
        'Dense Fog Advisory': 'Avis Brouillard Dense',
        'Air Quality Alert': 'Alerte Qualité de l\'Air'
      },
      de: {
        'Tornado Warning': 'Tornado-Warnung',
        'Tornado Watch': 'Tornado-Beobachtung',
        'Severe Thunderstorm Warning': 'Schweres Gewitter-Warnung',
        'Severe Thunderstorm Watch': 'Schweres Gewitter-Beobachtung',
        'Flash Flood Warning': 'Sturzflut-Warnung',
        'Flood Warning': 'Hochwasser-Warnung',
        'Winter Storm Warning': 'Wintersturm-Warnung',
        'Blizzard Warning': 'Schneesturm-Warnung',
        'Cold Weather Advisory': 'Kältewetter-Hinweis',
        'Freeze Warning': 'Frost-Warnung',
        'Heat Advisory': 'Hitze-Hinweis',
        'Excessive Heat Warning': 'Extreme Hitze-Warnung',
        'Hurricane Warning': 'Hurrikan-Warnung',
        'High Wind Warning': 'Starker Wind-Warnung',
        'Tsunami Warning': 'Tsunami-Warnung',
        'Fire Warning': 'Feuer-Warnung',
        'Air Quality Alert': 'Luftqualitäts-Warnung'
      },
      ja: {
        'Tornado Warning': '竜巻警報',
        'Tornado Watch': '竜巻注意報',
        'Severe Thunderstorm Warning': '激しい雷雨警報',
        'Flash Flood Warning': '鉄砲水警報',
        'Flood Warning': '洪水警報',
        'Winter Storm Warning': '冬の嵐警報',
        'Blizzard Warning': '吹雪警報',
        'Cold Weather Advisory': '寒波注意報',
        'Heat Advisory': '高温注意報',
        'Hurricane Warning': 'ハリケーン警報',
        'Tsunami Warning': '津波警報',
        'Tsunami Watch': '津波注意報',
        'Fire Warning': '火災警報',
        'Air Quality Alert': '大気質警報'
      },
      ar: {
        'Tornado Warning': 'تحذير من إعصار',
        'Tornado Watch': 'مراقبة إعصار',
        'Severe Thunderstorm Warning': 'تحذير من عاصفة رعدية شديدة',
        'Flash Flood Warning': 'تحذير من فيضان مفاجئ',
        'Flood Warning': 'تحذير من فيضان',
        'Winter Storm Warning': 'تحذير من عاصفة شتوية',
        'Blizzard Warning': 'تحذير من عاصفة ثلجية',
        'Cold Weather Advisory': 'تنبيه طقس بارد',
        'Heat Advisory': 'تنبيه حرارة',
        'Hurricane Warning': 'تحذير من إعصار',
        'Tsunami Warning': 'تحذير من تسونامي',
        'Fire Warning': 'تحذير من حريق',
        'Air Quality Alert': 'تنبيه جودة الهواء'
      },
      ru: {
        'Tornado Warning': 'Предупреждение о торнадо',
        'Severe Thunderstorm Warning': 'Предупреждение о сильной грозе',
        'Flash Flood Warning': 'Предупреждение о внезапном наводнении',
        'Flood Warning': 'Предупреждение о наводнении',
        'Winter Storm Warning': 'Предупреждение о зимней буре',
        'Blizzard Warning': 'Предупреждение о метели',
        'Cold Weather Advisory': 'Рекомендация о холодной погоде',
        'Heat Advisory': 'Рекомендация о жаре',
        'Hurricane Warning': 'Предупреждение об урагане',
        'Tsunami Warning': 'Предупреждение о цунами',
        'Fire Warning': 'Предупреждение о пожаре',
        'Air Quality Alert': 'Предупреждение о качестве воздуха'
      },
      pt: {
        'Tornado Warning': 'Alerta de Tornado',
        'Severe Thunderstorm Warning': 'Alerta de Tempestade Severa',
        'Flash Flood Warning': 'Alerta de Enchente Relâmpago',
        'Flood Warning': 'Alerta de Inundação',
        'Winter Storm Warning': 'Alerta de Tempestade de Inverno',
        'Blizzard Warning': 'Alerta de Nevasca',
        'Cold Weather Advisory': 'Aviso de Frio',
        'Heat Advisory': 'Aviso de Calor',
        'Hurricane Warning': 'Alerta de Furacão',
        'Tsunami Warning': 'Alerta de Tsunami',
        'Fire Warning': 'Alerta de Incêndio',
        'Air Quality Alert': 'Alerta de Qualidade do Ar'
      },
      hi: {
        'Tornado Warning': 'बवंडर चेतावनी',
        'Flood Warning': 'बाढ़ चेतावनी',
        'Winter Storm Warning': 'शीतकालीन तूफान चेतावनी',
        'Heat Advisory': 'गर्मी सलाह',
        'Hurricane Warning': 'तूफान चेतावनी',
        'Tsunami Warning': 'सुनामी चेतावनी',
        'Fire Warning': 'आग चेतावनी',
        'Air Quality Alert': 'वायु गुणवत्ता चेतावनी'
      },
      tl: {
        'Tornado Warning': 'Babala ng Buhawi',
        'Severe Thunderstorm Warning': 'Babala ng Matinding Bagyo',
        'Flash Flood Warning': 'Babala ng Biglaang Baha',
        'Flood Warning': 'Babala ng Baha',
        'Winter Storm Warning': 'Babala ng Bagyo sa Taglamig',
        'Heat Advisory': 'Payo sa Matinding Init',
        'Hurricane Warning': 'Babala ng Bagyo',
        'Tsunami Warning': 'Babala ng Tsunami',
        'Fire Warning': 'Babala ng Sunog',
        'Air Quality Alert': 'Babala sa Kalidad ng Hangin'
      }
    };

    function t(key) {
      const lang = translations[currentLang] || translations.en;
      return lang[key] || translations.en[key] || key;
    }

    function tCondition(condition) {
      const lang = translations[currentLang] || translations.en;
      return (lang.conditions && lang.conditions[condition]) || condition;
    }

    function tSeverity(severity) {
      const s = (severity || '').toLowerCase();
      return t(s) || severity;
    }

    // Look up pre-translated alert type (returns null if not found)
    function tAlert(alertType, targetLang) {
      if (targetLang === 'en' || !alertType) return alertType;
      const langAlerts = alertTranslations[targetLang];
      if (langAlerts && langAlerts[alertType]) {
        return langAlerts[alertType];
      }
      return null; // Not found, will fall back to API
    }

    // ===========================================
    // PERSISTENT CACHE (localStorage)
    // ===========================================
    const CACHE_KEY = 'weather_translations_v1';
    const CACHE_EXPIRY_DAYS = 30;

    function loadTranslationCache() {
      try {
        const stored = localStorage.getItem(CACHE_KEY);
        if (stored) {
          const { data, timestamp } = JSON.parse(stored);
          // Check if cache is still valid (30 days)
          const age = Date.now() - timestamp;
          if (age < CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000) {
            Object.entries(data).forEach(([k, v]) => translationCache.set(k, v));
            console.log(`Loaded ${Object.keys(data).length} cached translations`);
          } else {
            localStorage.removeItem(CACHE_KEY);
          }
        }
      } catch (e) {
        console.warn('Failed to load translation cache:', e);
      }
    }

    function saveTranslationCache() {
      try {
        const data = Object.fromEntries(translationCache);
        localStorage.setItem(CACHE_KEY, JSON.stringify({
          data,
          timestamp: Date.now()
        }));
      } catch (e) {
        console.warn('Failed to save translation cache:', e);
      }
    }

    // Load cache on startup
    loadTranslationCache();

    // ===========================================
    // TRANSLATION WITH FALLBACK CHAIN
    // ===========================================
    // Priority: Pre-translated → Cache → MyMemory → LibreTranslate → English

    async function tryMyMemory(text, targetLang) {
      const truncated = text.substring(0, 450);
      const encoded = encodeURIComponent(truncated);

      const response = await fetch(
        `https://api.mymemory.translated.net/get?q=${encoded}&langpair=en|${targetLang}`
      );

      if (!response.ok) throw new Error('MyMemory API error');

      const data = await response.json();

      // Check for rate limit or quota exceeded
      if (data.responseStatus === 429 ||
          (data.responseData?.translatedText || '').includes('MYMEMORY WARNING')) {
        throw new Error('MyMemory rate limited');
      }

      if (data.responseStatus === 200 && data.responseData?.translatedText) {
        let translated = data.responseData.translatedText;
        // Fix all-caps responses
        if (translated === translated.toUpperCase() && translated.length > 10) {
          translated = translated.charAt(0) + translated.slice(1).toLowerCase();
        }
        return translated;
      }

      throw new Error('MyMemory no translation');
    }

    async function tryLibreTranslate(text, targetLang) {
      // LibreTranslate public instances (try multiple)
      const instances = [
        'https://libretranslate.com',
        'https://translate.argosopentech.com',
        'https://translate.terraprint.co'
      ];

      const truncated = text.substring(0, 450);

      for (const instance of instances) {
        try {
          const response = await fetch(`${instance}/translate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              q: truncated,
              source: 'en',
              target: targetLang,
              format: 'text'
            })
          });

          if (response.ok) {
            const data = await response.json();
            if (data.translatedText) {
              return data.translatedText;
            }
          }
        } catch (e) {
          // Try next instance
          continue;
        }
      }

      throw new Error('LibreTranslate all instances failed');
    }

    async function translateText(text, targetLang) {
      if (!text || targetLang === 'en') return text;

      // 1. Check pre-translated alert types (instant, no API)
      const preTranslated = tAlert(text, targetLang);
      if (preTranslated) {
        return preTranslated;
      }

      // 2. Check in-memory + localStorage cache
      const cacheKey = `${text.substring(0, 100)}|${targetLang}`;
      if (translationCache.has(cacheKey)) {
        return translationCache.get(cacheKey);
      }

      // 3. Try MyMemory API first (free, 5k chars/day)
      try {
        const translated = await tryMyMemory(text, targetLang);
        translationCache.set(cacheKey, translated);
        saveTranslationCache(); // Persist to localStorage
        return translated;
      } catch (err) {
        console.warn('MyMemory failed:', err.message);
      }

      // 4. Fallback to LibreTranslate
      try {
        const translated = await tryLibreTranslate(text, targetLang);
        translationCache.set(cacheKey, translated);
        saveTranslationCache();
        return translated;
      } catch (err) {
        console.warn('LibreTranslate failed:', err.message);
      }

      // 5. All translation APIs failed - return original with marker
      console.error('All translation services failed for:', text.substring(0, 50));
      return text; // Return English as fallback
    }

    // ===========================================
    // UI UPDATE
    // ===========================================
    function updateUILanguage() {
      document.getElementById('pageTitle').textContent = t('title');
      document.getElementById('fetchBtn').textContent = t('update');

      // Re-render forecast if we have data
      if (currentWeather) {
        renderForecast(currentWeather);
      }

      // Re-render alerts if we have them
      if (currentAlerts.length > 0) {
        renderAlerts(currentAlerts);
      }
    }

    // ===========================================
    // API FUNCTIONS
    // ===========================================
    async function getCoordinates(zip) {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json&limit=1`);
      const data = await response.json();
      if (data.length === 0) throw new Error('Location not found');
      return {
        lat: parseFloat(data[0].lat),
        lon: parseFloat(data[0].lon),
        name: data[0].display_name.split(',').slice(0, 2).join(',')
      };
    }

    async function getWeather(lat, lon) {
      const response = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto&forecast_days=5`
      );
      return response.json();
    }

    async function getNWSAlerts(lat, lon) {
      try {
        const response = await fetch(
          `https://api.weather.gov/alerts/active?point=${lat.toFixed(4)},${lon.toFixed(4)}`,
          {
            headers: {
              'User-Agent': '(WeatherForecastApp, contact@example.com)',
              'Accept': 'application/geo+json'
            }
          }
        );
        if (!response.ok) throw new Error('NWS API error');
        const data = await response.json();
        return data.features || [];
      } catch (err) {
        console.error('Failed to fetch NWS alerts:', err);
        return [];
      }
    }

    // ===========================================
    // ALERT RENDERING
    // ===========================================
    function getSeverityClass(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme') return 'severity-extreme';
      if (s === 'severe') return 'severity-severe';
      if (s === 'moderate') return 'severity-moderate';
      if (s === 'minor') return 'severity-minor';
      return 'severity-unknown';
    }

    function getSeverityIcon(severity) {
      const s = (severity || '').toLowerCase();
      if (s === 'extreme' || s === 'severe') return 'ph-warning-octagon';
      if (s === 'moderate') return 'ph-warning';
      return 'ph-info';
    }

    function formatAlertTime(isoString) {
      if (!isoString) return '';
      const d = new Date(isoString);
      const lang = translations[currentLang] || translations.en;
      const dayName = lang.days[d.getDay()];
      const monthName = lang.months[d.getMonth()];
      const day = d.getDate();
      const hour = d.getHours();
      const minute = d.getMinutes().toString().padStart(2, '0');
      const ampm = hour >= 12 ? 'PM' : 'AM';
      const hour12 = hour % 12 || 12;
      return `${dayName.substring(0, 3)}, ${monthName} ${day}, ${hour12}:${minute} ${ampm}`;
    }

    async function renderAlerts(alerts) {
      const container = document.getElementById('alertsContainer');
      container.innerHTML = '';
      currentAlerts = alerts;

      if (!alerts || alerts.length === 0) return;

      const severityOrder = { extreme: 0, severe: 1, moderate: 2, minor: 3, unknown: 4 };
      alerts.sort((a, b) => {
        const sA = (a.properties.severity || 'unknown').toLowerCase();
        const sB = (b.properties.severity || 'unknown').toLowerCase();
        return (severityOrder[sA] ?? 4) - (severityOrder[sB] ?? 4);
      });

      for (let index = 0; index < alerts.length; index++) {
        const alert = alerts[index];
        const props = alert.properties;
        const severity = props.severity || 'Unknown';
        const event = props.event || 'Weather Alert';
        const headline = props.headline || event;
        const description = props.description || '';
        const effective = props.effective;
        const expires = props.expires;

        const banner = document.createElement('div');
        banner.className = `alert-banner ${getSeverityClass(severity)}`;
        banner.style.animationDelay = `${index * 0.1}s`;

        // Translate event name and headline
        let displayEvent = event;
        let displayHeadline = headline;

        if (currentLang !== 'en') {
          displayEvent = await translateText(event, currentLang);
          displayHeadline = await translateText(headline, currentLang);
        }

        banner.innerHTML = `
          <i class="ph ${getSeverityIcon(severity)} alert-icon"></i>
          <div class="alert-content">
            <div class="alert-header">
              <span class="alert-title">${displayEvent}</span>
              <span class="alert-severity-badge">${tSeverity(severity)}</span>
            </div>
            <p class="alert-description" id="alert-desc-${index}">${displayHeadline}</p>
            ${description ? `<button class="alert-expand-btn" data-index="${index}">${t('showDetails')}</button>` : ''}
            <div class="alert-meta">
              ${effective ? `<span><i class="ph ph-clock"></i> ${t('effective')}: ${formatAlertTime(effective)}</span>` : ''}
              ${expires ? `<span><i class="ph ph-clock-countdown"></i> ${t('expires')}: ${formatAlertTime(expires)}</span>` : ''}
            </div>
          </div>
          <button class="alert-dismiss" onclick="this.parentElement.remove()" aria-label="Dismiss alert">
            <i class="ph ph-x"></i>
          </button>
        `;

        banner.dataset.fullDescription = description;
        banner.dataset.headline = displayHeadline;
        banner.dataset.originalDescription = description;
        banner.dataset.index = index;

        container.appendChild(banner);

        // Add event listener for expand button
        const expandBtn = banner.querySelector('.alert-expand-btn');
        if (expandBtn) {
          expandBtn.addEventListener('click', async function() {
            await toggleAlertExpand(index, this);
          });
        }
      }
    }

    async function toggleAlertExpand(index, btn) {
      const desc = document.getElementById(`alert-desc-${index}`);
      const banner = btn.closest('.alert-banner');
      const originalDesc = banner.dataset.originalDescription;
      const headline = banner.dataset.headline;

      if (desc.classList.contains('expanded')) {
        desc.classList.remove('expanded');
        desc.textContent = headline;
        btn.textContent = t('showDetails');
      } else {
        desc.classList.add('expanded');

        // Show loading indicator
        btn.innerHTML = `<i class="ph ph-spinner" style="animation: spin 1s linear infinite;"></i>`;

        let displayDesc = originalDesc;
        if (currentLang !== 'en') {
          displayDesc = await translateText(originalDesc, currentLang);
        }

        desc.textContent = displayDesc;
        btn.textContent = t('hideDetails');
      }
    }

    // ===========================================
    // FORECAST RENDERING
    // ===========================================
    function renderForecast(weather) {
      const grid = document.getElementById('forecastGrid');
      grid.innerHTML = '';
      currentWeather = weather;

      const lang = translations[currentLang] || translations.en;

      weather.daily.time.forEach((date, index) => {
        const d = new Date(date + 'T12:00:00');
        const code = weather.daily.weather_code[index];
        const info = weatherCodes[code] || { label: 'Unknown', icon: 'ph-question' };
        const high = Math.round(weather.daily.temperature_2m_max[index]);
        const low = Math.round(weather.daily.temperature_2m_min[index]);

        const dayName = lang.days[d.getDay()];
        const monthName = lang.months[d.getMonth()];
        const conditionLabel = tCondition(info.label);

        const card = document.createElement('div');
        card.className = 'day-card';
        card.innerHTML = `
          <div class="day-name">${dayName}</div>
          <div class="day-date">${monthName} ${d.getDate()}</div>
          <i class="ph ${info.icon} weather-icon"></i>
          <div class="condition">${conditionLabel}</div>
          <div class="temps">
            <div class="temp-row temp-high">
              <span class="temp-label"><i class="ph ph-arrow-up"></i> ${t('high')}</span>
              <span class="temp-value">${high}°</span>
            </div>
            <div class="temp-row temp-low">
              <span class="temp-label"><i class="ph ph-arrow-down"></i> ${t('low')}</span>
              <span class="temp-value">${low}°</span>
            </div>
          </div>
        `;
        grid.appendChild(card);

        setTimeout(() => card.classList.add('loaded'), index * 100);
      });
    }

    function showError(message) {
      document.getElementById('forecastGrid').innerHTML = `
        <div class="error">
          <i class="ph ph-warning-circle" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
          <p>${message}</p>
        </div>
      `;
    }

    function showLoading() {
      document.getElementById('forecastGrid').innerHTML = `
        <div class="loading">
          <i class="ph ph-cloud"></i>
          <p>${t('loading')}</p>
        </div>
      `;
    }

    // ===========================================
    // MAIN FETCH
    // ===========================================
    async function fetchForecast() {
      const zip = document.getElementById('zipInput').value.trim();
      if (!/^\d{5}$/.test(zip)) {
        showError(t('errorZip'));
        return;
      }

      showLoading();
      document.getElementById('alertsContainer').innerHTML = '';

      try {
        const coords = await getCoordinates(zip);
        document.getElementById('locationDisplay').textContent = coords.name;

        const [weather, alerts] = await Promise.all([
          getWeather(coords.lat, coords.lon),
          getNWSAlerts(coords.lat, coords.lon)
        ]);

        await renderAlerts(alerts);
        renderForecast(weather);
      } catch (err) {
        showError(t('errorFetch'));
        console.error(err);
      }
    }

    // ===========================================
    // INITIALIZATION
    // ===========================================
    function detectBrowserLanguage() {
      const browserLang = navigator.language.split('-')[0];
      const supported = Object.keys(translations);
      if (supported.includes(browserLang)) {
        document.getElementById('langSelect').value = browserLang;
        currentLang = browserLang;
      }
    }

    document.getElementById('fetchBtn').addEventListener('click', fetchForecast);
    document.getElementById('zipInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') fetchForecast();
    });

    document.getElementById('langSelect').addEventListener('change', async (e) => {
      currentLang = e.target.value;
      updateUILanguage();
    });

    // Initialize
    detectBrowserLanguage();
    updateUILanguage();
    fetchForecast();
  </script>
</body>
</html>
